<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Php · 阿尤</title><meta name="description" content="Php - 阿尤"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/blog/index.ico"><link rel="stylesheet" href="/blog/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://ayou129.github.io/blog/atom.xml" title="阿尤"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="阿尤" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/blog/" class="logo-link"><img src="/blog/index.ico" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/blog/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/blog/archives/" target="_self" class="nav-list-link">历史文章</a></li><li class="nav-list-item"><a href="/blog/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><!--mixin postList()--><!--    .archive--><!--        - var year = 0;--><!--        - var change = false;--><!--        - page.posts.each(function (item) {--><!--            - var itemYear = date(item.date, 'YYYY') - 0;--><!--            - change = year !== itemYear;--><!--            - year = change ? itemYear : year;--><!--            if change--><!--                h2.archive-year!= year--><!--            .post-item--><!--                +postInfo(item)--><!--                a.post-title-link(href= url_for(item.path))--><!--                    != item.title--><!--        - })--><div class="post"><article class="post-block"><h1 class="post-title">Php</h1><div class="post-info">创建于：2016年4月26日<span style="margin-left: 0.5rem"></span>上次更新：2022年4月21日</div><div class="post-content"><h1 id="Php"><a href="#Php" class="headerlink" title="Php"></a>Php</h1><h2 id="查看配置文件"><a href="#查看配置文件" class="headerlink" title="查看配置文件"></a>查看配置文件</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#查看php安装的扩展</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/php/</span>sbin/php -m 或 php -m | <span class="keyword">grep</span> zip</span><br><span class="line"></span><br><span class="line">#查看php.ini的存储位置</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/php/</span>sbin/php -i | <span class="keyword">grep</span> <span class="string">&#x27;php.ini&#x27;</span></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/php/</span>sbin/php-fpm -i | <span class="keyword">grep</span> <span class="string">&#x27;php.ini&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="安装-root权限"><a href="#安装-root权限" class="headerlink" title="安装(root权限)"></a>安装(root权限)</h2><blockquote>
<p><code>https://www.php.net/downloads.php</code></p>
</blockquote>
<h3 id="安装相关依赖包："><a href="#安装相关依赖包：" class="headerlink" title="安装相关依赖包："></a>安装相关依赖包：</h3><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">yum</span> <span class="comment">install</span> <span class="literal">-</span><span class="comment">y</span> <span class="comment">gcc</span> <span class="comment">curl</span> <span class="comment">libxml2</span> <span class="comment">libxml2</span><span class="literal">-</span><span class="comment">devel</span> <span class="comment">openssl</span> <span class="comment">openssl</span><span class="literal">-</span><span class="comment">devel</span> <span class="comment">bzip2</span> <span class="comment">bzip2</span><span class="literal">-</span><span class="comment">devel libcurl libcurl-devel libjpeg libjpeg</span><span class="literal">-</span><span class="comment">devel libpng libpng-devel freetype freetype</span><span class="literal">-</span><span class="comment">devel gmp gmp-devel libmcrypt libmcrypt</span><span class="literal">-</span><span class="comment">devel readline readline-devel libxslt libxslt</span><span class="literal">-</span><span class="comment">devel</span> <span class="comment">re2c</span></span><br></pre></td></tr></table></figure>

<h3 id="安装php"><a href="#安装php" class="headerlink" title="安装php"></a>安装php</h3><blockquote>
<p><code>http://hk2.php.net</code>是国内网站，mirror是压缩包，下载后解压获得所有php文件<br>备用链接<br><code>http://hk1.php.net/get/php-7.1.26.tar.gz/from/this/mirror</code><br><code>http://php.net/get/php-7.1.26.tar.gz/from/a/mirror</code></p>
</blockquote>
<h3 id="编译安装php"><a href="#编译安装php" class="headerlink" title="编译安装php"></a>编译安装php</h3><p>安装dg-jpeg扩展</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下载jpeg扩展包</span></span><br><span class="line">wget http:<span class="regexp">//</span>www.ijg.org<span class="regexp">/files/</span>jpegsrc.v8b.tar.gz </span><br><span class="line"><span class="comment">#解压缩扩展包</span></span><br><span class="line">tar -zxvf  jpegsrc.v8b.tar.gz </span><br><span class="line"><span class="comment">#安装</span></span><br><span class="line">cd jpeg-<span class="number">8</span>b</span><br><span class="line">.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>php-kuozhan/jpeg --enable-shared --enable-static </span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>src/</span><br><span class="line">wget http:<span class="regexp">//</span>php.net<span class="regexp">/get/</span>php-<span class="number">7.2</span>.<span class="number">30</span>.tar.gz<span class="regexp">/from/</span>a/mirror</span><br><span class="line">tar -zxvf mirror</span><br></pre></td></tr></table></figure>

<p>–with-php-config&#x3D;&#x2F;usr&#x2F;local&#x2F;php&#x2F;bin&#x2F;php-config \ 指定版本号，暂时不适用</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">cd php-<span class="number">7.2</span>.<span class="number">30</span></span><br><span class="line">./configure <span class="string">\</span></span><br><span class="line">--prefix=/usr/local/php <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-config-file-path=/usr/local/php/etc <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-pear=DIR <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-tsrm-pthreads <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-pdo-mysql <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-mysqli <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-freetype-dir=/usr/include/freetype2 <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-openssl <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-curl <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-gettext <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-zlib=/usr <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-png-dir <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-freetype-dir <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-jpeg-dir <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-zlib-dir <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-gd <span class="string">\</span></span><br><span class="line">--enable-opcache <span class="string">\</span></span><br><span class="line">--enable-bcmath <span class="string">\</span></span><br><span class="line">--enable-mbstring <span class="string">\</span></span><br><span class="line">--enable-sockets <span class="string">\</span></span><br><span class="line">--enable-zip <span class="string">\</span></span><br><span class="line">--enable-fpm <span class="string">\</span></span><br><span class="line">--enable-xml <span class="string">\</span></span><br><span class="line">--enable-cli <span class="string">\</span></span><br><span class="line">--<span class="keyword">with</span>-jpeg-dir=/usr/local/php-kuozhan/jpeg</span><br><span class="line"></span><br><span class="line"><span class="comment">#暂时注释掉--with-apxs2=/usr/local/apache/bin/apxs \</span></span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h3 id="复制配置文件-php-ini"><a href="#复制配置文件-php-ini" class="headerlink" title="复制配置文件(php.ini)"></a>复制配置文件(php.ini)</h3><p>php配置文件的路径已经指定到&#x2F;usr&#x2F;local&#x2F;etc<br>只需要复制源码中的 <code>php.ini-development</code>或者 <code>php.ini-production</code>到usr&#x2F;local&#x2F;etc目录下即可，vi打开需要的扩展包</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp <span class="regexp">/usr/</span>src<span class="regexp">/php-7.2.30/</span>php.ini-development <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>etc/php.ini &amp;&amp;</span><br><span class="line">cp <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>etc<span class="regexp">/php-fpm.conf.default /u</span>sr<span class="regexp">/local/</span>php<span class="regexp">/etc/</span>php-fpm.conf &amp;&amp;</span><br><span class="line">cp <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>etc<span class="regexp">/php-fpm.d/</span>www.conf.<span class="keyword">default</span> <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>etc<span class="regexp">/php-fpm.d/</span>www.conf &amp;&amp;</span><br><span class="line">cp <span class="regexp">/usr/</span>src<span class="regexp">/php-7.2.30/</span>sapi<span class="regexp">/fpm/i</span>nit.d.php-fpm <span class="regexp">/etc/i</span>nit.d/php-fpm &amp;&amp;</span><br><span class="line">chmod +x <span class="regexp">/etc/i</span>nit.d/php-fpm &amp;&amp;</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/php/</span>sbin/php-fpm -t</span><br></pre></td></tr></table></figure>


<h3 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑文件</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#export前增加环境变量</span></span><br><span class="line">PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/php/bin</span><span class="symbol">:/usr/local/php/sbin</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新载入profile</span></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>


<h3 id="Pear设置"><a href="#Pear设置" class="headerlink" title="Pear设置"></a>Pear设置</h3><ol>
<li><code>pear config-set http_proxy &#39;http://127.0.0.1:10808&#39;</code> 设置pecl源，之后可以在 <code>/usr/local/src/php-XXXX/</code> 执行 <code>pear install xxx</code></li>
</ol>
<h2 id="安装扩展"><a href="#安装扩展" class="headerlink" title="安装扩展"></a>安装扩展</h2><h3 id="Reids"><a href="#Reids" class="headerlink" title="Reids"></a>Reids</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/src/</span><br><span class="line">wget https://pecl.php.net/get/redis-5.2.0.tgz</span><br><span class="line">tar -zxvf redis-5.2.0.tgz</span><br><span class="line">cd redis-5.2.0</span><br><span class="line"></span><br><span class="line">/usr/local/php/bin/phpize</span><br><span class="line">./configure --with-php-config=/usr/local/php/bin/php-config</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">vim /usr/local/php/etc/php.ini</span><br><span class="line">#shift + g 跳到最后一行</span><br><span class="line">[redis]</span><br><span class="line">extension=redis.so</span><br><span class="line"></span><br><span class="line">php -m</span><br></pre></td></tr></table></figure>
<h3 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h3><h2 id="安装Redis扩展"><a href="#安装Redis扩展" class="headerlink" title="安装Redis扩展"></a>安装Redis扩展</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/src/</span><br><span class="line">wget https://pecl.php.net/get/zookeeper-0.6.4.tgz</span><br><span class="line">tar -zxvf zookeeper-0.6.4.tgz</span><br><span class="line">cd zookeeper-0.6.4</span><br><span class="line"></span><br><span class="line">/usr/local/php/bin/phpize</span><br><span class="line">./configure --with-php-config=/usr/local/php/bin/php-config  --with-libzookeeper-dir=/usr/local/zookeeper</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">vim /usr/local/php/etc/php.ini</span><br><span class="line">#shift + g 跳到最后一行</span><br><span class="line">[zookeeper]</span><br><span class="line">extension=zookeeper.so</span><br><span class="line"></span><br><span class="line">php -m</span><br></pre></td></tr></table></figure>
<h2 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h2><p>一般Server程序都是运行在系统后台，这与普通的交互式命令行程序有很大的区别。<code>glibc</code> 里有一个函数 <code>daemon</code> 。调用此函数，就可使当前进程脱离终端变成一个守护进程，具体内容参见 <code>man daemon</code>。PHP中暂时没有此函数，当然也可以写一个PHP的扩展函数来实现。</p>
<h3 id="PHP命令行程序实现守护进程化的方法"><a href="#PHP命令行程序实现守护进程化的方法" class="headerlink" title="PHP命令行程序实现守护进程化的方法"></a>PHP命令行程序实现守护进程化的方法</h3><ol>
<li><p>使用nohup</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup php myprog.php &gt; log.txt &amp;  <span class="comment">#这里就实现了守护进程化。</span></span><br></pre></td></tr></table></figure>
<ul>
<li>单独执行 php myprog.php，当按下ctrl+c时就会中断程序执行，会kill当前进程以及子进程。</li>
<li><code>php myprog.php &amp;</code> 这样执行程序虽然也是转为后台运行，实际上是依赖终端的，当用户退出终端时进程就会被杀掉。</li>
</ul>
</li>
<li><p>使用PHP代码来实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">daemonize</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$pid</span> = pcntl_fork();</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$pid</span> == -<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;fork(1) failed!\n&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">elseif</span> (<span class="variable">$pid</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="comment">//让由用户启动的进程退出</span></span><br><span class="line">		<span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//建立一个有别于终端的新session以脱离终端</span></span><br><span class="line">	posix_setsid();</span><br><span class="line"></span><br><span class="line">	<span class="variable">$pid</span> = pcntl_fork();</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$pid</span> == -<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;fork(2) failed!\n&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">elseif</span> (<span class="variable">$pid</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="comment">//父进程退出, 剩下子进程成为最终的独立进程</span></span><br><span class="line">		<span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">daemonize();</span><br><span class="line">sleep(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p> 用上面代码即可实现守护进程化，当你的PHP程序需要转为后台运行时，只需要调用一次封装好的函数daemonize()即可。</p>
<p> 注：这里没有实现标准输入输出的重定向。</p>
</li>
</ol>
<h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>安装wamp以及前置安装文件<br>[MSVBCRT](&#x2F;downloads&#x2F;MSVBCRT.AIO.2020.04.10.X86 X64.exe)<br><a href="/downloads/wampserver3.1.7_x64.exe">wamp</a></p>
<p>安装redis扩展<br><a href="/downloads/php_redis.dll">php_redis.dll</a></p>
<p>安装amqp以及rabbitmq扩展</p>
<ol>
<li>下载扩展包 <a href="/downloads/rabbitmq.4.dll">rabbitmq.4.dll</a> <a href="/downloads/php_amqp.dll">php_amqp.dll</a></li>
</ol>
<p>php.ini</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[redis]</span></span><br><span class="line"><span class="attr">extension</span>=php_redis.dll</span><br><span class="line"></span><br><span class="line"><span class="section">[amqp]</span></span><br><span class="line"><span class="attr">extension</span>=php_amqp.dll</span><br></pre></td></tr></table></figure>

<p>httpd.conf</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">LoadFile</span> <span class="string">&quot;C:/wamp64/bin/php/php7.2.14/ext/rabbitmq.4.dll&quot;</span></span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/blog/p/cc1b9611/" class="prev">上一篇</a><a href="/blog/p/953688bc/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = 'p/6edc6731/';
var disqus_title = 'Php';
var disqus_url = 'https://ayou129.github.io/blog/p/6edc6731/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2022 <a href="https://ayou129.github.io/blog">阿尤</a>.</p><!--p © #{year} #[a(href=config.url)!= config.author], powered by #[a(href=hexoURL, target="_blank") Hexo] and #[a(href=apolloURL, target="_blank") hexo-theme-apollo].--></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>