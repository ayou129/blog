<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#42b983"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog/public/index.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/public/index.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/public/index.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#42b983">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ayou129.github.io","root":"/blog/","images":"/blog/images","scheme":"Muse","darkmode":false,"version":"8.14.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":"flat","style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/blog/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog/js/config.js"></script>

    <meta name="description" content="暂无描述">
<meta property="og:type" content="article">
<meta property="og:title" content="UE游戏开发">
<meta property="og:url" content="https://ayou129.github.io/blog/p/614a8811/index.html">
<meta property="og:site_name" content="阿尤">
<meta property="og:description" content="暂无描述">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/isDead.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E6%A0%B9%E6%8D%AER_key%E4%BF%9D%E5%AD%98%E7%94%A8%E6%88%B7%E5%BD%93%E5%89%8D%E5%9C%A8%E4%B8%96%E7%95%8C%E4%B8%AD%E7%9A%84%E5%90%91%E9%87%8F.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E9%97%A8%E5%A2%9E%E5%8A%A0%E5%BC%80%E5%85%B3.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E9%97%A8%E5%A2%9E%E5%8A%A0%E7%A2%B0%E6%92%9E.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E4%B8%A4%E4%B8%AA%E5%85%B3%E9%94%AE%E5%B8%A7.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E5%B0%86%E9%97%A8%E6%89%93%E5%BC%80%E5%9C%B0%E7%BC%93%E6%85%A2%E4%B8%80%E4%BA%9B.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/BP_hat.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/BP_third_person.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E7%BD%91%E6%A0%BC%E9%AA%A8%E9%AA%BC.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E6%89%A3%E5%87%8F%E8%A7%92%E8%89%B2%E7%94%9F%E5%91%BD%E5%80%BC01.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E6%89%A3%E5%87%8F%E8%A7%92%E8%89%B2%E7%94%9F%E5%91%BD%E5%80%BC%E5%AE%8C%E6%95%B4%E7%89%8801.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E6%89%A3%E5%87%8F%E8%A7%92%E8%89%B2%E7%94%9F%E5%91%BD%E5%80%BC%E5%AE%8C%E6%95%B4%E7%89%8802.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/WBP_health_bar.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/ThirdPerson.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/ThirdPerson_CreateHealthBarEvent.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/WBP_health_bar_bind.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/BP_repair_box.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/AdventureCharacter.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/FirstPerson_AnimBP.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/FirstPerson_AnimBP%E4%BA%8B%E4%BB%B6%E8%93%9D%E5%9B%BE%E6%9B%B4%E6%96%B0%E5%8A%A8%E7%94%BB.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/walk_run.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/walk_run_view.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E7%BB%84%E4%BB%B6%E8%93%9D%E5%9B%BE%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/S_ItemInfo.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/DT_Items_0001.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/CanvasPanelMainHUD.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/SurvivalGamePC_add_to_viewport.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/GM_SurvivalGame%E4%B8%96%E7%95%8C%E5%9C%BA%E6%99%AF%E8%AE%BE%E7%BD%AE.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/W_MainWidget.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/GetInventoryWidget.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/ThirdPerson_AnimBP%E6%AF%8F%E4%B8%AA%E9%AA%A8%E9%AA%BC%E7%9A%84%E5%88%86%E5%B1%82%E6%B7%B7%E5%90%88.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/ActorFoliage%E5%BF%AB%E9%80%9F%E6%94%BE%E7%BD%AE%E7%89%A9%E4%BD%93.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/ContainerItems.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/DrainStamFunction_add%E8%80%90%E5%8A%9B%E5%80%BC%E6%94%B9%E5%8F%98%E9%80%9F%E5%BA%A6.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/FirstPersonCharacter%E8%80%90%E5%8A%9B%E5%86%B2%E5%88%BA%E6%94%B9%E5%8F%98%E9%80%9F%E5%BA%A6.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/RegenStaminaFunction_add%E8%80%90%E5%8A%9B%E5%80%BC%E6%94%B9%E5%8F%98%E9%80%9F%E5%BA%A6.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/SurvivalGamePC_LevelNotifyOnClient.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E4%BF%AE%E6%94%B9W_Inventory%E6%8E%A7%E4%BB%B6%E7%9A%84%E7%AD%89%E7%BA%A7%E6%8F%90%E7%A4%BA.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E4%B8%89%E8%A7%92%E5%BD%A2%E5%A2%99%E5%A3%81%E5%BB%BA%E9%80%A0%E7%89%A9.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/130%E8%A3%85%E5%BC%B9.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/%E5%8A%A8%E7%94%BB%E7%BB%93%E6%9D%9F%E5%90%8E%E8%A3%85%E4%B8%8A%E5%BC%B9%E8%8D%AF%E5%B9%B6%E6%89%A3%E9%99%A4_%E6%92%AD%E6%94%BEUI.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/614a8811/M_Trail.png">
<meta property="article:published_time" content="2023-11-08T19:08:49.000Z">
<meta property="article:modified_time" content="2023-11-08T19:08:49.000Z">
<meta property="article:author" content="阿尤">
<meta property="article:tag" content="learning, coding, writing, 学习, 编程, 阿尤">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ayou129.github.io/blog/p/614a8811/isDead.png">


<link rel="canonical" href="https://ayou129.github.io/blog/p/614a8811/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://ayou129.github.io/blog/p/614a8811/","path":"p/614a8811/","title":"UE游戏开发"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>UE游戏开发 | 阿尤</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<link rel="alternate" href="/blog/atom.xml" title="阿尤" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">
      <img class="custom-logo-image" src="/blog/uploads/%E9%98%BF%E5%B0%A4%E5%8A%A8%E6%BC%AB%E5%A4%B4.jpeg" alt="阿尤">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">阿尤</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">37</span></a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">2</span></a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">66</span></a></li><li class="menu-item menu-item-sitemap"><a href="/blog/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#UExz"><span class="nav-number">1.</span> <span class="nav-text">UExz</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E6%95%B4%E6%91%84%E5%83%8F%E5%A4%B4%E7%9A%84%E4%BD%8D%E7%BD%AE%EF%BC%8C%E5%B0%86%E6%91%84%E5%83%8F%E5%A4%B4%E7%BB%91%E5%AE%9A%E5%88%B0%E5%A4%B4%E9%83%A8"><span class="nav-number">1.1.</span> <span class="nav-text">调整摄像头的位置，将摄像头绑定到头部</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E%E5%8A%A0-%E9%BC%A0%E6%A0%87%E6%8E%A7%E5%88%B6%E5%99%A8%E6%97%8B%E8%BD%AC%E5%8A%9F%E8%83%BD"><span class="nav-number">1.2.</span> <span class="nav-text">增加 鼠标控制器旋转功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E8%A1%80%E6%9D%A1%E5%92%8C%E6%8A%A4%E7%94%B2"><span class="nav-number">1.3.</span> <span class="nav-text">添加血条和护甲</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unreal-Engine-5-tutorial"><span class="nav-number">2.</span> <span class="nav-text">Unreal Engine 5 tutorial</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lyra-Cross-platform-UI-framework"><span class="nav-number">3.</span> <span class="nav-text">Lyra Cross-platform UI framework</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%93%9D%E5%9B%BE"><span class="nav-number">3.1.</span> <span class="nav-text">蓝图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%BE%E5%8F%96%E7%89%A9%E5%93%81-%E6%A8%A1%E5%9E%8B%E5%B8%A6%E5%B8%BD%E5%AD%90"><span class="nav-number">3.2.</span> <span class="nav-text">拾取物品+模型带帽子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UE5-%E8%AF%BE%E7%A8%8B-%E7%AC%AC%E4%B8%80%E4%BA%BA%E7%A7%B0-%E5%A4%9A%E4%BA%BA%E7%94%9F%E5%AD%98%E6%B8%B8%E6%88%8F"><span class="nav-number">4.</span> <span class="nav-text">UE5 课程 第一人称 多人生存游戏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0"><span class="nav-number">4.1.</span> <span class="nav-text">第一章</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6-Adventure-Character"><span class="nav-number">4.1.1.</span> <span class="nav-text">安装插件 Adventure Character</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E7%9B%AE%E5%BD%95"><span class="nav-number">4.1.2.</span> <span class="nav-text">构建目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8"><span class="nav-number">4.1.3.</span> <span class="nav-text">8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-%E5%A2%9E%E5%8A%A0%E7%AC%AC%E4%B8%89%E4%BA%BA%E7%A7%B0"><span class="nav-number">4.1.4.</span> <span class="nav-text">9 增加第三人称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10"><span class="nav-number">4.1.5.</span> <span class="nav-text">10</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-%E6%A6%82%E5%BF%B5"><span class="nav-number">4.1.6.</span> <span class="nav-text">11 概念</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0"><span class="nav-number">4.2.</span> <span class="nav-text">第二章</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#14"><span class="nav-number">4.2.1.</span> <span class="nav-text">14</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-%E8%83%8C%E5%8C%85"><span class="nav-number">4.2.2.</span> <span class="nav-text">15 背包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16"><span class="nav-number">4.2.3.</span> <span class="nav-text">16</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17-%E7%8E%A9%E5%AE%B6%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AEUI"><span class="nav-number">4.2.4.</span> <span class="nav-text">17 玩家统计数据UI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#18-%E5%88%9B%E5%BB%BA%E5%AE%9E%E9%99%85%E7%9A%84%E8%83%8C%E5%8C%85UI"><span class="nav-number">4.2.5.</span> <span class="nav-text">18 创建实际的背包UI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#19-%E5%AE%9E%E7%8E%B0-%E8%83%8C%E5%8C%85%E8%81%94%E5%8A%A8UI"><span class="nav-number">4.2.6.</span> <span class="nav-text">19 实现 背包联动UI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20"><span class="nav-number">4.2.7.</span> <span class="nav-text">20</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#21-22-%E8%83%BD%E5%A4%9F%E5%B0%86%E7%89%A9%E5%93%81-%E4%BD%BF%E7%94%A8%E9%BC%A0%E6%A0%87%E5%B7%A6%E9%94%AE-%E6%BB%91%E5%8A%A8"><span class="nav-number">4.2.8.</span> <span class="nav-text">21 &amp; 22 能够将物品 使用鼠标左键 滑动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#23-%E5%A4%84%E7%90%86%E5%90%8E%E7%AB%AF-%E8%83%BD%E5%A4%9F%E5%B0%86%E7%89%A9%E5%93%81%E9%BC%A0%E6%A0%87%E5%B7%A6%E9%94%AE%E4%BB%8E%E4%B8%80%E4%B8%AA%E6%8F%92%E6%A7%BD%E8%BD%AC%E7%A7%BB%E5%88%B0%E5%8F%A6%E4%B8%80%E4%B8%AA%E6%8F%92%E6%A7%BD"><span class="nav-number">4.2.9.</span> <span class="nav-text">23 处理后端 能够将物品鼠标左键从一个插槽转移到另一个插槽</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#24-%E5%AE%8C%E6%88%90-%E8%83%8C%E5%8C%85%E7%89%A9%E5%93%81%E6%8B%96%E6%94%BE-%E9%80%BB%E8%BE%91"><span class="nav-number">4.2.10.</span> <span class="nav-text">24 完成 背包物品拖放 逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25-26-%E5%88%9B%E5%BB%BA%E5%BF%AB%E6%8D%B7%E6%A0%8F"><span class="nav-number">4.2.11.</span> <span class="nav-text">25 &amp; 26 创建快捷栏</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#27-%E5%88%9B%E5%BB%BA%E5%BF%AB%E6%8D%B7%E6%A0%8F%E8%83%8C%E5%8C%85%E8%93%9D%E5%9B%BE%E5%AD%90%E7%B1%BB"><span class="nav-number">4.2.12.</span> <span class="nav-text">27 创建快捷栏背包蓝图子类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#28-%E5%88%9B%E5%BB%BA%E5%8F%AF%E8%A3%85%E5%A4%87%E7%9A%84%E7%89%A9%E5%93%81-%E7%9B%B8%E5%85%B3%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%9A%E8%93%9D%E5%9B%BE%E3%80%81%E6%9E%9A%E4%B8%BE%E3%80%81%E7%BB%93%E6%9E%84%E3%80%81%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.2.13.</span> <span class="nav-text">28 创建可装备的物品 相关的文件：蓝图、枚举、结构、接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#29-%E5%88%9B%E5%BB%BA-%E5%B7%A5%E5%85%B7%E3%80%81%E6%96%A7%E5%A4%B4-%E7%9A%84%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="nav-number">4.2.14.</span> <span class="nav-text">29 创建 工具、斧头 的相关文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#30-%E5%88%9B%E5%BB%BA%E5%B7%A5%E5%85%B7%E3%80%81%E6%96%A7%E5%A4%B4%E7%9A%84UI-%E4%BB%A5%E5%8F%8A%E5%BF%AB%E6%8D%B7%E6%A0%8F%E9%80%BB%E8%BE%91"><span class="nav-number">4.2.15.</span> <span class="nav-text">30 创建工具、斧头的UI 以及快捷栏逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#31-%E7%BB%A7%E7%BB%AD%E5%AE%8C%E6%88%90-%E5%BF%AB%E6%8D%B7%E6%A0%8F-%E9%80%BB%E8%BE%91"><span class="nav-number">4.2.16.</span> <span class="nav-text">31 继续完成 快捷栏 逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#32-%E9%87%8D%E5%A4%8D%E6%8C%89%E4%B8%8B%E5%BF%AB%E6%8D%B7%E9%94%AE%EF%BC%8C%E5%A6%82%E6%9E%9C%E7%89%A9%E5%93%81%E5%B7%B2%E7%BB%8F%E8%A3%85%E5%A4%87%EF%BC%8C%E5%B0%B1%E5%8D%B8%E4%B8%8B%E7%89%A9%E5%93%81"><span class="nav-number">4.2.17.</span> <span class="nav-text">32 重复按下快捷键，如果物品已经装备，就卸下物品</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#33-%E8%A3%85%E5%A4%87%E6%96%A7%E5%A4%B4%E5%90%8E%EF%BC%8C%E5%B7%A6%E9%94%AE%E6%8C%A5%E5%8A%A8"><span class="nav-number">4.2.18.</span> <span class="nav-text">33 装备斧头后，左键挥动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#34"><span class="nav-number">4.2.19.</span> <span class="nav-text">34</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#35-%E5%88%9B%E5%BB%BA%E6%94%B6%E8%8E%B7-%E7%A0%8D%E6%A0%91%E6%8E%89%E6%9C%A8%E5%A4%B4-%E7%B3%BB%E7%BB%9F-%E6%8C%A5%E5%8A%A8%E6%96%A7%E5%A4%B4%E7%A0%8D%E6%A0%91%EF%BC%8C%E8%83%BD%E5%A4%9F%E6%94%B6%E8%8E%B7%E6%9C%A8%E5%A4%B4"><span class="nav-number">4.2.20.</span> <span class="nav-text">35 创建收获(砍树掉木头)系统 挥动斧头砍树，能够收获木头</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#36-%E4%BD%BF%E7%94%A8%E6%96%A7%E5%A4%B4%E7%A0%8D%E6%A0%91%E6%94%B6%E8%8E%B7%E6%9C%A8%E5%A4%B4%EF%BC%8C%E6%98%BE%E7%A4%BA%E6%94%B6%E8%8E%B7%E7%9A%84%E7%89%A9%E5%93%81"><span class="nav-number">4.2.21.</span> <span class="nav-text">36 使用斧头砍树收获木头，显示收获的物品</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#37-%E4%BD%BF%E7%94%A8%E6%96%A7%E5%A4%B4%E7%A0%8D%E6%A0%91%EF%BC%8C%E5%BD%93%E6%A0%91%E6%9C%A8%E8%A2%AB%E7%A0%8D%E5%80%92%E6%97%B6%EF%BC%8C%E6%A0%91%E6%9C%A8%E6%B6%88%E5%A4%B1%EF%BC%8C%E6%98%BE%E7%A4%BA%E6%A0%91%E6%9C%A8%E7%9A%84%E5%80%92%E4%B8%8B%E5%8A%A8%E7%94%BB"><span class="nav-number">4.2.22.</span> <span class="nav-text">37 使用斧头砍树，当树木被砍倒时，树木消失，显示树木的倒下动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#38-%E7%9B%B8%E4%BA%92%E7%A7%BB%E5%8A%A8-%E5%BF%AB%E6%8D%B7%E6%A0%8F%E5%92%8C%E8%83%8C%E5%8C%85%E7%9A%84%E7%89%A9%E5%93%81"><span class="nav-number">4.2.23.</span> <span class="nav-text">38 相互移动 快捷栏和背包的物品</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0"><span class="nav-number">4.3.</span> <span class="nav-text">第四章</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#39-40-%E6%A0%91%E5%80%92%E4%B8%8B%E5%90%8E%E5%BB%B6%E6%97%B6%E6%BA%B6%E8%A7%A3%E9%94%80%E6%AF%81"><span class="nav-number">4.3.1.</span> <span class="nav-text">39 &amp; 40 树倒下后延时溶解销毁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#41-%E5%88%9B%E5%BB%BA%E7%9F%B3%E9%95%90%E4%BB%A5%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="nav-number">4.3.2.</span> <span class="nav-text">41 创建石镐以及相关文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#42-%E9%87%8D%E5%86%99%E7%9F%B3%E9%95%90%E7%9A%84%E6%94%B6%E8%8E%B7%E9%80%BB%E8%BE%91"><span class="nav-number">4.3.3.</span> <span class="nav-text">42 重写石镐的收获逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#43-%E7%9F%B3%E5%A4%B4%E7%A2%8E%E8%A3%82%E6%95%88%E6%9E%9C"><span class="nav-number">4.3.4.</span> <span class="nav-text">43 石头碎裂效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#44-%E7%81%8C%E6%9C%A8%E4%B8%9BUI%E3%80%81%E6%8B%BE%E5%8F%96%E9%80%BB%E8%BE%91%E4%BB%A5%E5%8F%8A%E6%8B%BE%E5%8F%96%E5%8A%A8%E4%BD%9C"><span class="nav-number">4.3.5.</span> <span class="nav-text">44 灌木丛UI、拾取逻辑以及拾取动作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#45-%E4%BF%AE%E5%A4%8D%E5%8A%A8%E7%94%BB%E8%93%9D%E5%9B%BE%E4%B8%8B%E5%8D%8A%E8%BA%AB%E7%AA%81%E5%85%80%E7%9A%84BUG"><span class="nav-number">4.3.6.</span> <span class="nav-text">45 修复动画蓝图下半身突兀的BUG</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#46-%E8%83%8C%E5%8C%85%E7%89%A9%E5%93%81%E5%A0%86%E5%8F%A0%E5%8A%9F%E8%83%BD"><span class="nav-number">4.3.7.</span> <span class="nav-text">46 背包物品堆叠功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#47-%E6%B7%BB%E5%8A%A0%E6%94%B6%E8%8E%B7%E5%8A%9F%E8%83%BD%E7%9A%84%E8%A7%86%E8%A7%89%E7%89%B9%E6%95%88%E5%92%8C%E5%A3%B0%E9%9F%B3"><span class="nav-number">4.3.8.</span> <span class="nav-text">47 添加收获功能的视觉特效和声音</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#48-%E4%BF%AE%E5%A4%8D%E7%81%8C%E6%9C%A8%E4%B8%9B%E7%9A%84%E6%8B%BE%E5%8F%96%E9%80%BB%E8%BE%91%EF%BC%8C%E7%81%8C%E6%9C%A8%E4%B8%9B%E6%8B%BE%E5%8F%96%E4%BB%A5%E5%8F%8A%E6%B6%88%E5%A4%B1%E6%97%B6%E6%9C%89%E5%A3%B0%E9%9F%B3%E5%92%8C%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C"><span class="nav-number">4.3.9.</span> <span class="nav-text">48 修复灌木丛的拾取逻辑，灌木丛拾取以及消失时有声音和视觉效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#49-%E5%88%A9%E7%94%A8%E6%A4%8D%E7%89%A9%E7%BB%98%E7%94%BB-%E5%AE%9E%E7%8E%B0%E5%BF%AB%E9%80%9F%E6%94%BE%E7%BD%AE%E7%89%A9%E4%BD%93"><span class="nav-number">4.3.10.</span> <span class="nav-text">49 利用植物绘画 实现快速放置物体</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E7%89%A9%E5%93%81%E5%88%B6%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="nav-number">4.4.</span> <span class="nav-text">第五章 物品制作系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#50-51-%E7%8E%A9%E5%AE%B6%E5%88%B6%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="nav-number">4.4.1.</span> <span class="nav-text">50 &amp; 51 玩家制作系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#52-%E5%88%B6%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84UI"><span class="nav-number">4.4.2.</span> <span class="nav-text">52 制作系统的UI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#53-%E5%88%B6%E4%BD%9C%E6%8E%A7%E4%BB%B6%E5%88%87%E6%8D%A2%E4%B8%8D%E5%90%8C%E7%AA%97%E5%8F%A3"><span class="nav-number">4.4.3.</span> <span class="nav-text">53 制作控件切换不同窗口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%82%B9%E5%87%BB-Inventory-or-Crafting-%E5%88%87%E6%8D%A2%E7%BB%84%E4%BB%B6"><span class="nav-number">4.4.3.1.</span> <span class="nav-text">点击 Inventory or Crafting 切换组件</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%82%B9%E5%87%BB-Misc-or-Tools-or-Armor-or-Structures-%E5%88%87%E6%8D%A2%E7%BB%84%E4%BB%B6"><span class="nav-number">4.4.3.1.1.</span> <span class="nav-text">点击 Misc or Tools or Armor or Structures 切换组件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#54-%E5%9C%A8%E5%88%B6%E4%BD%9C%E7%AA%97%E5%8F%A3%E4%B8%AD%E7%82%B9%E5%87%BB%E6%9F%90%E4%B8%AA%E7%89%A9%E5%93%81%EF%BC%8C%E6%98%BE%E7%A4%BA%E5%88%B6%E4%BD%9C%E4%BF%A1%E6%81%AF"><span class="nav-number">4.4.4.</span> <span class="nav-text">54 在制作窗口中点击某个物品，显示制作信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#55-%E5%88%B6%E4%BD%9C%E7%89%A9%E5%93%81-1-%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%9C%89%E8%B6%B3%E5%A4%9F%E7%9A%84%E5%8E%9F%E6%96%99"><span class="nav-number">4.4.5.</span> <span class="nav-text">55 制作物品 1 检测是否有足够的原料</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#56-%E5%88%B6%E4%BD%9C%E7%89%A9%E5%93%81-2-%E5%88%B6%E4%BD%9C%E5%87%BA%E7%89%A9%E5%93%81"><span class="nav-number">4.4.6.</span> <span class="nav-text">56 制作物品 2 制作出物品</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#57-%E5%88%B6%E4%BD%9C%E7%89%A9%E5%93%81-3-%E5%A2%9E%E5%8A%A0%E5%88%B6%E4%BD%9C%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="nav-number">4.4.7.</span> <span class="nav-text">57 制作物品 3 增加制作进度条</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#58-%E5%88%B6%E4%BD%9C%E7%89%A9%E5%93%81-4-%E4%BF%AE%E5%A4%8DBUG"><span class="nav-number">4.4.8.</span> <span class="nav-text">58 制作物品 4 修复BUG</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0"><span class="nav-number">4.5.</span> <span class="nav-text">第六章</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#59-%E7%BB%9F%E8%AE%A1%E6%8E%A7%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.5.1.</span> <span class="nav-text">59 统计控件介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#60-%E7%BB%9F%E8%AE%A1%E6%8E%A7%E4%BB%B6UI"><span class="nav-number">4.5.2.</span> <span class="nav-text">60 统计控件UI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#61-%E7%BB%9F%E8%AE%A1%E6%8E%A7%E4%BB%B6%E7%BB%93%E6%9E%84%E6%96%87%E4%BB%B6%EF%BC%8C%E6%94%BB%E5%87%BB%E5%85%B6%E4%BB%96%E7%8E%A9%E5%AE%B6%E9%80%A0%E6%88%90%E4%BC%A4%E5%AE%B3"><span class="nav-number">4.5.3.</span> <span class="nav-text">61 统计控件结构文件，攻击其他玩家造成伤害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#62-%E9%A3%9F%E7%89%A9%E5%92%8C%E6%B0%B4%E7%9A%84%E6%B6%88%E8%80%97"><span class="nav-number">4.5.4.</span> <span class="nav-text">62 食物和水的消耗</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#63-%E8%87%AA%E5%8A%A8%E6%89%A3%E5%87%8F%E8%A1%80%E9%87%8F-%E9%A5%A5%E9%A5%BF%E5%92%8C%E5%8F%A3%E6%B8%B4%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%A7%A6%E5%8F%91%E6%8F%90%E7%A4%BA"><span class="nav-number">4.5.5.</span> <span class="nav-text">63 自动扣减血量 &amp;&amp; 饥饿和口渴，并且触发提示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#64-%E8%80%90%E5%8A%9B%E6%B6%88%E8%80%97%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="nav-number">4.5.6.</span> <span class="nav-text">64 耐力消耗和恢复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#65-Shift%E9%94%AE-%E5%A2%9E%E5%8A%A0%E5%86%B2%E5%88%BA%E5%8A%9F%E8%83%BD"><span class="nav-number">4.5.7.</span> <span class="nav-text">65 Shift键 增加冲刺功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#66-%E6%B5%86%E6%9E%9C%E7%AD%89%E9%A3%9F%E7%89%A9%E7%9A%84%E6%81%A2%E5%A4%8D%E6%95%88%E6%9E%9C"><span class="nav-number">4.5.8.</span> <span class="nav-text">66 浆果等食物的恢复效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#67-%E6%B6%88%E8%80%97%E5%93%81%E6%8C%81%E7%BB%AD%E5%A2%9E%E7%9B%8A%E6%95%88%E6%9E%9C"><span class="nav-number">4.5.9.</span> <span class="nav-text">67 消耗品持续增益效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#68-%E7%8E%A9%E5%AE%B6%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E7%AA%97%E5%8F%A3%E9%83%A8%E4%BB%B6%EF%BC%88%E7%8E%A9%E5%AE%B6%E7%AD%89%E7%BA%A7%E4%BF%A1%E6%81%AF%EF%BC%89UI"><span class="nav-number">4.5.10.</span> <span class="nav-text">68 玩家统计信息窗口部件（玩家等级信息）UI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#69-%E7%8E%A9%E5%AE%B6%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E7%AA%97%E5%8F%A3%E9%83%A8%E4%BB%B6%EF%BC%88%E7%8E%A9%E5%AE%B6%E7%AD%89%E7%BA%A7%E4%BF%A1%E6%81%AF%EF%BC%89%E9%80%BB%E8%BE%91"><span class="nav-number">4.5.11.</span> <span class="nav-text">69 玩家统计信息窗口部件（玩家等级信息）逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#70-%E7%BB%8F%E9%AA%8C%E5%92%8C%E5%8D%87%E7%BA%A7-%E9%80%BB%E8%BE%91"><span class="nav-number">4.5.12.</span> <span class="nav-text">70 经验和升级 逻辑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#71-%E7%BB%8F%E9%AA%8C%E5%92%8C-%E5%8D%87%E7%BA%A7-%E5%A2%9E%E5%8A%A0%E9%80%9A%E7%9F%A5"><span class="nav-number">4.5.13.</span> <span class="nav-text">71 经验和 升级 增加通知</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%BB%8F%E9%AA%8C%E9%80%9A%E7%9F%A5"><span class="nav-number">4.5.13.1.</span> <span class="nav-text">添加经验通知</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%8E%A9%E5%AE%B6%E5%8D%87%E7%BA%A7%E9%80%9A%E7%9F%A5"><span class="nav-number">4.5.13.2.</span> <span class="nav-text">玩家升级通知</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#72-%E7%8E%A9%E5%AE%B6%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE-%E6%8A%80%E8%83%BD%E7%82%B9"><span class="nav-number">4.5.14.</span> <span class="nav-text">72 玩家统计数据 技能点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0"><span class="nav-number">4.6.</span> <span class="nav-text">第七章</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#73-%E7%9B%94%E7%94%B2%E8%A3%85%E5%A4%87"><span class="nav-number">4.6.1.</span> <span class="nav-text">73 盔甲装备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#74-%E5%88%9B%E5%BB%BA%E7%9B%94%E7%94%B2%E5%8D%A1%E6%A7%BD%E9%83%A8%E4%BB%B6UI"><span class="nav-number">4.6.2.</span> <span class="nav-text">74 创建盔甲卡槽部件UI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#75-%E5%88%9B%E5%BB%BA%E8%A3%85%E7%94%B2%E7%89%A9%E5%93%81%E7%B1%BB"><span class="nav-number">4.6.3.</span> <span class="nav-text">75 创建装甲物品类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#76-%E8%AE%BE%E7%BD%AE%E8%A3%85%E5%A4%87%E8%A3%85%E7%94%B2%E5%8A%9F%E8%83%BD"><span class="nav-number">4.6.4.</span> <span class="nav-text">76 设置装备装甲功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#77-%E8%A3%85%E5%A4%87%E7%A7%BB%E5%8A%A8%E5%88%B0%E8%83%8C%E5%8C%85"><span class="nav-number">4.6.5.</span> <span class="nav-text">77 装备移动到背包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#78-%E8%AE%BE%E7%BD%AE%E6%92%AD%E6%94%BE%E5%99%A8%E7%AA%97%E5%8F%A3%E8%93%9D%E5%9B%BE%E7%AC%AC-1-%E9%83%A8%E5%88%86"><span class="nav-number">4.6.6.</span> <span class="nav-text">78 设置播放器窗口蓝图第 1 部分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#79-%E8%AE%BE%E7%BD%AE%E6%92%AD%E6%94%BE%E5%99%A8%E7%AA%97%E5%8F%A3%E8%93%9D%E5%9B%BE%E7%AC%AC-2-%E9%83%A8%E5%88%86"><span class="nav-number">4.6.7.</span> <span class="nav-text">79 设置播放器窗口蓝图第 2 部分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#80-%E8%AE%BE%E7%BD%AE%E6%92%AD%E6%94%BE%E5%99%A8%E7%AA%97%E5%8F%A3%E8%93%9D%E5%9B%BE%E7%AC%AC-3-%E9%83%A8%E5%88%86"><span class="nav-number">4.6.8.</span> <span class="nav-text">80 - 设置播放器窗口蓝图第 3 部分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#81-%E6%94%BB%E5%87%BB%E6%97%B6%E5%A2%9E%E5%8A%A0%E6%8A%A4%E7%94%B2%E5%B1%9E%E6%80%A7-%E7%A9%BF%E6%88%B4%E6%8A%A4%E7%94%B2%E5%90%8E%E4%BC%A4%E5%AE%B3%E5%87%8F%E5%B0%91"><span class="nav-number">4.6.9.</span> <span class="nav-text">81 攻击时增加护甲属性 穿戴护甲后伤害减少</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#82-%E6%B7%BB%E5%8A%A0-%E8%A3%85%E5%A4%87%E8%80%90%E7%94%A8%E6%80%A7%E5%92%8C%E6%9B%B4%E6%96%B0%E7%89%A9%E5%93%81%E6%A7%BD%E9%83%A8%E4%BB%B6UI"><span class="nav-number">4.6.10.</span> <span class="nav-text">82 添加 装备耐用性和更新物品槽部件UI</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Branch-%E5%88%A4%E6%96%AD-LocalNewDurability-%E6%98%AF%E5%90%A6%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E0-True-%E8%AE%BE%E7%BD%AE-ItemInfo-%E7%9A%84-CurHP-0-%E8%A3%85%E5%A4%87%E7%A0%B4%E7%A2%8E"><span class="nav-number">5.</span> <span class="nav-text">Branch 判断 LocalNewDurability 是否小于等于0- True  - 设置 ItemInfo 的 CurHP &#x3D; 0 装备破碎</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#83-%E4%BF%AE%E5%A4%8D-%E6%8B%96%E5%8A%A8%E9%83%A8%E4%BB%B6%E6%97%B6%E7%9A%84UI%E5%B1%95%E7%A4%BA"><span class="nav-number">5.0.1.</span> <span class="nav-text">83 修复 拖动部件时的UI展示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0"><span class="nav-number">5.1.</span> <span class="nav-text">第八章</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#84-%E5%BB%BA%E7%AD%91%E7%B3%BB%E7%BB%9F%E7%AE%80%E4%BB%8B"><span class="nav-number">5.1.1.</span> <span class="nav-text">84 建筑系统简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#85-%E5%BB%BA%E7%AD%91%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%E6%96%87%E4%BB%B6"><span class="nav-number">5.1.2.</span> <span class="nav-text">85 建筑系统基础文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#86-%E5%88%9B%E5%BB%BA%E5%BB%BA%E7%AD%91%E7%B3%BB%E7%BB%9F%E7%BB%84%E4%BB%B6-%E5%92%8C-%E9%94%AE%E7%9B%98B%E9%94%AE%E9%A2%84%E8%A7%88%E5%BB%BA%E7%AD%91%E7%89%A9%E5%8A%9F%E8%83%BD"><span class="nav-number">5.1.3.</span> <span class="nav-text">86 创建建筑系统组件 和 键盘B键预览建筑物功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#87-%E8%AE%BE%E7%BD%AE%E9%A2%84%E8%A7%88%E9%A2%9C%E8%89%B2-%E4%BB%A5%E5%8F%8A%E9%BC%A0%E6%A0%87%E5%B7%A6%E9%94%AE%E7%82%B9%E5%87%BB%E5%90%8E-%E5%8F%AF%E4%BB%A5%E5%88%9B%E5%BB%BA%E5%BB%BA%E9%80%A0%E7%89%A9"><span class="nav-number">5.1.4.</span> <span class="nav-text">87 设置预览颜色 以及鼠标左键点击后 可以创建建造物</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#88-%E6%A3%80%E6%9F%A5%E5%BB%BA%E9%80%A0%E7%89%A9%E6%98%AF%E5%90%A6%E9%87%8D%E5%8F%A0-%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">5.1.5.</span> <span class="nav-text">88 检查建造物是否重叠 客户端+服务端</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#89-%E5%AE%9E%E7%8E%B0%E7%BD%91%E6%A0%BC%E6%8D%95%E6%8D%89-%E8%83%BD%E5%A4%9F%E4%BC%98%E5%8C%96%E6%94%BE%E7%BD%AE%E5%BB%BA%E7%AD%91%E7%89%A9%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">5.1.6.</span> <span class="nav-text">89 实现网格捕捉 能够优化放置建筑物的位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#90-%E6%B7%BB%E5%8A%A0%E5%A2%99%E5%A3%81%E4%BB%A5%E5%8F%8A%E5%BC%80%E5%85%B3%E5%8F%AF%E6%9E%84%E5%BB%BA%E8%B0%83%E8%AF%95"><span class="nav-number">5.1.7.</span> <span class="nav-text">90 添加墙壁以及开关可构建调试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#91-%E4%BF%AE%E5%A4%8DBUG-%E6%B7%BB%E5%8A%A0%E5%A4%A9%E8%8A%B1%E6%9D%BF"><span class="nav-number">5.1.8.</span> <span class="nav-text">91 修复BUG 添加天花板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#92-%E5%A2%9E%E5%8A%A0%E6%B5%AE%E5%8A%A8%E6%A3%80%E6%9F%A5%EF%BC%8C%E5%A4%A9%E8%8A%B1%E6%9D%BF%E4%B8%8D%E9%9C%80%E8%A6%81%E6%A3%80%E6%9F%A5%EF%BC%8C%E6%A1%8C%E5%AD%90%E9%9C%80%E8%A6%81%E6%A3%80%E6%9F%A5"><span class="nav-number">5.1.9.</span> <span class="nav-text">92 增加浮动检查，天花板不需要检查，桌子需要检查</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#93-%E6%B7%BB%E5%8A%A0%E9%97%A8%E7%AA%97%E5%92%8C%E9%97%A8%E7%9A%84%E5%BC%80%E5%85%B3"><span class="nav-number">5.1.10.</span> <span class="nav-text">93 添加门窗和门的开关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#94-%E6%B7%BB%E5%8A%A0%E4%B8%89%E8%A7%92%E5%BD%A2%E5%9F%BA%E7%A1%80"><span class="nav-number">5.1.11.</span> <span class="nav-text">94 添加三角形基础</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#95-%E6%B7%BB%E5%8A%A0%E5%9D%A1%E9%81%93%E5%92%8C%E5%9B%B4%E6%A0%8F-%E7%9A%84%E5%BB%BA%E9%80%A0%E7%89%A9"><span class="nav-number">5.1.12.</span> <span class="nav-text">95 添加坡道和围栏 的建造物</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#96-%E4%B8%89%E8%A7%92%E5%BD%A2%E5%A4%A9%E8%8A%B1%E6%9D%BF"><span class="nav-number">5.1.13.</span> <span class="nav-text">96 三角形天花板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#97-%E6%B7%BB%E5%8A%A0%E5%8F%AF%E4%BA%A4%E4%BA%92%E7%9A%84%E7%81%AB%E7%82%AC"><span class="nav-number">5.1.14.</span> <span class="nav-text">97 添加可交互的火炬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#98-%E6%B7%BB%E5%8A%A0%E6%A5%BC%E6%A2%AF%E5%92%8C%E5%BA%8A"><span class="nav-number">5.1.15.</span> <span class="nav-text">98 添加楼梯和床</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#99-%E6%B7%BB%E5%8A%A0-%E5%B7%A6%E5%8F%B3%E4%B8%89%E8%A7%92%E5%BD%A2%E5%A2%99%E5%A3%81%E5%92%8C%E5%B1%8B%E9%A1%B6"><span class="nav-number">5.1.16.</span> <span class="nav-text">99 添加 左右三角形墙壁和屋顶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#100-%E6%B7%BB%E5%8A%A0-%E4%B8%89%E8%A7%92%E5%BD%A2%E5%A2%99%E5%A3%81%E5%BB%BA%E9%80%A0%E7%89%A9"><span class="nav-number">5.1.17.</span> <span class="nav-text">100 添加 三角形墙壁建造物</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#101-%E4%B8%BA%E5%BB%BA%E9%80%A0%E7%89%A9%E5%A2%9E%E5%8A%A0%E6%8D%9F%E5%9D%8F%E5%92%8C%E7%A0%B4%E5%9D%8F%E6%95%88%E6%9E%9C"><span class="nav-number">5.1.18.</span> <span class="nav-text">101 为建造物增加损坏和破坏效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#102-%E6%B7%BB%E5%8A%A0%E9%99%84%E5%8A%A0%E4%BC%A4%E5%AE%B3-1"><span class="nav-number">5.1.19.</span> <span class="nav-text">102 添加附加伤害 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#103-%E6%B7%BB%E5%8A%A0%E9%99%84%E5%8A%A0%E4%BC%A4%E5%AE%B3-2"><span class="nav-number">5.1.20.</span> <span class="nav-text">103 添加附加伤害 2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Bed"><span class="nav-number">5.1.20.1.</span> <span class="nav-text">Bed</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#DoorFrame-%E5%92%8C-DoorMaster-%E5%92%8C-Torch"><span class="nav-number">5.1.20.2.</span> <span class="nav-text">DoorFrame 和 DoorMaster 和 Torch</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#FenceMaster"><span class="nav-number">5.1.20.3.</span> <span class="nav-text">FenceMaster</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RampMaster"><span class="nav-number">5.1.20.4.</span> <span class="nav-text">RampMaster</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RoofLeftMaster-%E5%92%8C-RoofRightMaster"><span class="nav-number">5.1.20.5.</span> <span class="nav-text">RoofLeftMaster 和 RoofRightMaster</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RoofLargeMaster"><span class="nav-number">5.1.20.6.</span> <span class="nav-text">RoofLargeMaster</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#104-%E6%B7%BB%E5%8A%A0%E9%99%84%E5%8A%A0%E4%BC%A4%E5%AE%B3-3-%E5%B0%86%E6%89%80%E6%9C%89%E5%89%A9%E4%B8%8B%E7%9A%84%E7%89%A9%E5%93%81%E9%83%BD%E5%A2%9E%E5%8A%A0%E7%A0%B4%E5%9D%8F%E6%95%88%E6%9E%9C"><span class="nav-number">5.1.21.</span> <span class="nav-text">104 添加附加伤害 3 将所有剩下的物品都增加破坏效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#105-%E4%BF%AE%E5%A4%8D%E6%B5%AE%E5%8A%A8%E5%A4%A9%E8%8A%B1%E6%9D%BF"><span class="nav-number">5.1.22.</span> <span class="nav-text">105 修复浮动天花板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#106-%E6%B7%BB%E5%8A%A0%E6%9E%84%E5%BB%BA%E7%89%A9%E7%9A%84%E6%8F%90%E7%A4%BA%E7%9A%84%E4%BF%A1%E6%81%AF%E9%83%A8%E4%BB%B6"><span class="nav-number">5.1.23.</span> <span class="nav-text">106 添加构建物的提示的信息部件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#107-%E6%B7%BB%E5%8A%A0%E6%8B%86%E9%99%A4%E5%BB%BA%E9%80%A0%E7%89%A9%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-number">5.1.24.</span> <span class="nav-text">107 添加拆除建造物的功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#108-%E5%B0%86%E5%BB%BA%E9%80%A0%E7%B3%BB%E7%BB%9F%E5%92%8C%E5%BA%93%E5%AD%98%E7%B3%BB%E7%BB%9F%E8%BF%9E%E6%8E%A5%E8%B5%B7%E6%9D%A5"><span class="nav-number">5.1.25.</span> <span class="nav-text">108 将建造系统和库存系统连接起来</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#109-%E6%B7%BB%E5%8A%A0%E6%89%80%E6%9C%89%E5%8F%AF%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E7%B1%BB"><span class="nav-number">5.1.26.</span> <span class="nav-text">109 添加所有可构建项目和类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#110-%E4%BF%AE%E5%A4%8D%E5%BB%BA%E9%80%A0%E7%B3%BB%E7%BB%9F%E7%9A%84bug"><span class="nav-number">5.1.27.</span> <span class="nav-text">110 修复建造系统的bug</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0"><span class="nav-number">5.2.</span> <span class="nav-text">第九章</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC10%E7%AB%A0"><span class="nav-number">5.3.</span> <span class="nav-text">第10章</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#126-%E7%AE%80%E4%BB%8B"><span class="nav-number">5.3.1.</span> <span class="nav-text">126 简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#127-%E8%AE%BE%E7%BD%AE%E6%AD%A5%E6%9E%AA%E5%8A%A8%E7%94%BB%E5%92%8C%E7%89%A9%E5%93%81%E7%B1%BB%E5%88%AB"><span class="nav-number">5.3.2.</span> <span class="nav-text">127 设置步枪动画和物品类别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#128-%E8%AE%BE%E7%BD%AE%E6%AD%A5%E6%9E%AA%E5%B0%84%E5%87%BB-1"><span class="nav-number">5.3.3.</span> <span class="nav-text">128 设置步枪射击 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#129-%E8%AE%BE%E7%BD%AE%E6%AD%A5%E6%9E%AA%E5%B0%84%E5%87%BB-2"><span class="nav-number">5.3.4.</span> <span class="nav-text">129 设置步枪射击 2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#130-%E8%AE%BE%E7%BD%AE-%E6%AD%A5%E6%9E%AA%E8%A3%85%E5%BC%B9%E5%92%8C%E5%BC%B9%E8%8D%AF"><span class="nav-number">5.3.5.</span> <span class="nav-text">130 设置 步枪装弹和弹药</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#131-%E6%AD%A5%E6%9E%AA-%E6%AF%8F%E6%AC%A1%E4%BD%BF%E7%94%A8%E5%90%8E%E5%87%8F%E5%B0%91%E8%80%90%E4%B9%85%E5%BA%A6"><span class="nav-number">5.3.6.</span> <span class="nav-text">131 步枪 每次使用后减少耐久度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#132-%E7%81%AB%E7%AE%AD%E5%8F%91%E5%B0%84%E5%99%A8"><span class="nav-number">5.3.7.</span> <span class="nav-text">132 火箭发射器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#133-%E7%81%AB%E7%AE%AD%E5%8F%91%E5%B0%84%E5%99%A8%E5%8F%91%E5%B0%84-1"><span class="nav-number">5.3.8.</span> <span class="nav-text">133 火箭发射器发射 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#134-%E7%81%AB%E7%AE%AD%E5%8F%91%E5%B0%84%E5%99%A8%E5%8F%91%E5%B0%84-2"><span class="nav-number">5.3.9.</span> <span class="nav-text">134 火箭发射器发射 2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#135-%E7%81%AB%E7%AE%AD%E5%8F%91%E5%B0%84%E5%99%A8-%E9%81%87%E5%88%B0%E7%89%A9%E4%BD%93%E7%88%86%E7%82%B8"><span class="nav-number">5.3.10.</span> <span class="nav-text">135 火箭发射器 遇到物体爆炸</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#136-%E7%81%AB%E7%AE%AD%E5%8F%91%E5%B0%84%E5%99%A8-%E8%A3%85%E5%BC%B9"><span class="nav-number">5.3.11.</span> <span class="nav-text">136 火箭发射器 装弹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#137-%E5%A2%9E%E5%8A%A0%E5%BC%93"><span class="nav-number">5.3.12.</span> <span class="nav-text">137 增加弓</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#138-%E5%BC%93%E5%B0%84%E5%87%BB"><span class="nav-number">5.3.13.</span> <span class="nav-text">138 弓射击</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#139-%E8%AE%BE%E7%BD%AE%E5%BC%93-%E7%A2%B0%E6%92%9E%E7%89%A9%E4%BD%93%E4%BA%A7%E7%94%9F%E4%BC%A4%E5%AE%B3"><span class="nav-number">5.3.14.</span> <span class="nav-text">139 设置弓 碰撞物体产生伤害</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#140-%E5%BC%93-%E8%A3%85%E5%BC%B9"><span class="nav-number">5.3.15.</span> <span class="nav-text">140 弓 装弹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC11%E7%AB%A0"><span class="nav-number">5.4.</span> <span class="nav-text">第11章</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC12%E7%AB%A0-%E5%88%9B%E5%BB%BA%E7%A4%BE%E4%BC%9A%E7%B3%BB%E7%BB%9F"><span class="nav-number">5.5.</span> <span class="nav-text">第12章 创建社会系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC13%E7%AB%A0-%E5%88%9B%E5%BB%BA%E5%BC%80%E6%94%BE%E4%B8%96%E7%95%8C%E5%9C%B0%E5%9B%BE"><span class="nav-number">5.6.</span> <span class="nav-text">第13章 创建开放世界地图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%86%E9%A1%B9%E7%9B%AE%E4%BB%8E-5-0-%E6%9B%B4%E6%96%B0%E5%88%B0-5-2"><span class="nav-number">5.6.1.</span> <span class="nav-text">将项目从 5.0 更新到 5.2</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC14%E7%AB%A0-%E5%A4%9A%E7%94%9F%E7%89%A9%E7%BE%A4%E8%90%BD-%E7%A8%8B%E5%BA%8F%E6%A0%91%E5%8F%B6"><span class="nav-number">5.7.</span> <span class="nav-text">第14章 多生物群落&#x2F;程序树叶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC15%E7%AB%A0-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F"><span class="nav-number">5.8.</span> <span class="nav-text">第15章 人工智能系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC16%E7%AB%A0-%E7%A8%8B%E5%BA%8F%E5%8C%BA"><span class="nav-number">5.9.</span> <span class="nav-text">第16章 程序区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC17%E7%AB%A0-%E7%8E%A9%E5%AE%B6%E5%B0%8F%E5%9C%B0%E5%9B%BE"><span class="nav-number">5.10.</span> <span class="nav-text">第17章 玩家小地图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC18%E7%AB%A0-%E4%BF%9D%E5%AD%98-%E5%8A%A0%E8%BD%BD%E7%B3%BB%E7%BB%9F"><span class="nav-number">5.11.</span> <span class="nav-text">第18章 保存&#x2F;加载系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC19%E7%AB%A0-Steam-%E4%BC%9A%E8%AF%9D-%E5%89%8D%E7%AB%AF%E5%B0%8F%E6%8E%A7%E4%BB%B6"><span class="nav-number">5.12.</span> <span class="nav-text">第19章 Steam 会话&#x2F;前端小控件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC20%E7%AB%A0-%E4%B8%93%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%BE%E7%BD%AE%E5%92%8C%E6%89%98%E7%AE%A1"><span class="nav-number">5.13.</span> <span class="nav-text">第20章 专用服务器设置和托管</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#232"><span class="nav-number">5.13.1.</span> <span class="nav-text">232</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#233-%E5%8A%A0%E8%BD%BD%E6%92%AD%E6%94%BE%E5%99%A8%E9%94%99%E8%AF%AF%E4%BF%AE%E5%A4%8D"><span class="nav-number">5.13.2.</span> <span class="nav-text">233 加载播放器错误修复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#234-%E6%B8%B8%E6%88%8F%E5%AE%9E%E4%BE%8B%E5%92%8C%E4%B8%BB%E6%9C%BA%E4%BC%9A%E8%AF%9D"><span class="nav-number">5.13.3.</span> <span class="nav-text">234 游戏实例和主机会话</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE-%E6%89%98%E7%AE%A1%E9%80%BB%E8%BE%91"><span class="nav-number">5.13.3.1.</span> <span class="nav-text">设置 托管逻辑</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">5.13.4.</span> <span class="nav-text"></span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC21%E7%AB%A0"><span class="nav-number">5.14.</span> <span class="nav-text">第21章</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E8%A1%A5%E5%85%85"><span class="nav-number">5.15.</span> <span class="nav-text">结构补充</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-number">6.</span> <span class="nav-text">知识点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E4%B8%80%E6%AC%BE%E6%B8%B8%E6%88%8F"><span class="nav-number">7.</span> <span class="nav-text">设计一款游戏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Common"><span class="nav-number">7.1.</span> <span class="nav-text">Common</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">阿尤</p>
  <div class="site-description" itemprop="description">成长就是不断发现自己是SB的过程！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ayou129.github.io/blog/p/614a8811/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="阿尤">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿尤">
      <meta itemprop="description" content="成长就是不断发现自己是SB的过程！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="UE游戏开发 | 阿尤">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UE游戏开发
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-09 03:08:49" itemprop="dateCreated datePublished" datetime="2023-11-09T03:08:49+08:00">2023-11-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>暂无描述</p>
<span id="more"></span>

<p>惠普提：<a href="https://www.alibabafonts.com/#/home" target="_blank" rel="noopener">https://www.alibabafonts.com/#/home</a></p>
<h2 id="UExz"><a href="#UExz" class="headerlink" title="UExz"></a>UExz</h2><p>教程开发版本 4.16.2</p>
<p>Marketplace下载<br>Animation Starter Pack</p>
<ul>
<li>reloading</li>
<li>射击</li>
<li>移动</li>
<li>动画</li>
</ul>
<p>创建项目</p>
<ul>
<li>First Person</li>
</ul>
<h3 id="调整摄像头的位置，将摄像头绑定到头部"><a href="#调整摄像头的位置，将摄像头绑定到头部" class="headerlink" title="调整摄像头的位置，将摄像头绑定到头部"></a>调整摄像头的位置，将摄像头绑定到头部</h3><p>Follow Camera -&gt; Socket -&gt; Head<br>将摄像头调整进入头前方</p>
<h3 id="增加-鼠标控制器旋转功能"><a href="#增加-鼠标控制器旋转功能" class="headerlink" title="增加 鼠标控制器旋转功能"></a>增加 鼠标控制器旋转功能</h3><p>Follow Camera： Setting -&gt; Use Controller Rotation Yaw<br>角色： Pawn -&gt; Use Controller Rotation Yaw</p>
<p>添加项目 FPS Tutorial</p>
<h3 id="添加血条和护甲"><a href="#添加血条和护甲" class="headerlink" title="添加血条和护甲"></a>添加血条和护甲</h3><p>添加血条和护甲 变量 float</p>
<h2 id="Unreal-Engine-5-tutorial"><a href="#Unreal-Engine-5-tutorial" class="headerlink" title="Unreal Engine 5 tutorial"></a>Unreal Engine 5 tutorial</h2><p>鼠标右键 按住，wsad 移动方向</p>
<p>鼠标左键 选择对象</p>
<h2 id="Lyra-Cross-platform-UI-framework"><a href="#Lyra-Cross-platform-UI-framework" class="headerlink" title="Lyra Cross-platform UI framework"></a>Lyra Cross-platform UI framework</h2><p>核心游戏驱动 Actors<br>Character&#x2F;Pawn 控制的游戏对象<br>Controller 控制游戏对象、客户端向服务器发送请求的通道<br>Player State 其他玩家需要知道的信息</p>
<ul>
<li>当前得分<br>Game State 游戏的综合信息</li>
<li>当前的游戏阶段</li>
<li>剩余时间</li>
</ul>
<p>模块化</p>
<p>Lura UI</p>
<p>游戏模式</p>
<ul>
<li>占点模式</li>
<li>爆破模式</li>
</ul>
<h3 id="蓝图"><a href="#蓝图" class="headerlink" title="蓝图"></a>蓝图</h3><p>和平精英手游 使用什么配置的电脑进行开发的 普通的mac可以开发吗？<br>我用的macbook pro 2020年 apple M1芯片 16GB内存 1TB硬盘 8核心GPU可以进行开发吗？<br>台式机需要什么配置才能进行开发？</p>
<p>知识点：</p>
<ol>
<li>快捷键 快速取消 链接  alt+左键</li>
</ol>
<p>Event BeginPlay<br>print String<br>hello world<br>10s</p>
<p>变量<br>isDead?<br>boolean<br>details &#x3D;&gt; default value<br>变量拖进 事件图标中，isDead?false红色<br>new branch</p>
<ul>
<li>print string 角色已死亡</li>
<li>print string 角色正常</li>
</ul>
<p><img src="/blog/p/614a8811/isDead.png" alt="isDead.png"></p>
<p>增加整型类型血量变量health</p>
<p><img src="/blog/p/614a8811/%E6%A0%B9%E6%8D%AER_key%E4%BF%9D%E5%AD%98%E7%94%A8%E6%88%B7%E5%BD%93%E5%89%8D%E5%9C%A8%E4%B8%96%E7%95%8C%E4%B8%AD%E7%9A%84%E5%90%91%E9%87%8F.png" alt="根据R_key保存用户当前在世界中的向量.png"></p>
<p>创建可以开关的门<br>要点：</p>
<ol>
<li>碰撞重叠，弹出按键</li>
</ol>
<p>blueprints -&gt; 01_door_bp -&gt; BP_door（蓝图 ）<br>门框door frame：static mesh</p>
<p>碰撞要点：</p>
<ul>
<li>Box 碰撞盒体</li>
<li>Graph<ul>
<li>Box组件右下角 事件中添加：On Component Begin Overlap 内容开始重叠 actor &#x3D;&gt; 下方 cast</li>
<li>Box组件右下角 事件中添加：On Component End Overlap 内容结束重叠 actor &#x3D;&gt; 下方 cast</li>
<li>Cast to …  (third person character) 转换为第三人称角色</li>
<li>f Get Player Controller<ul>
<li>Enable Input</li>
<li>Disable Input</li>
</ul>
</li>
<li>E key</li>
<li>Flip Flop</li>
<li>Set Relative Rotation 设置相对旋转 z 90°   x2</li>
<li>Door组件-&gt;根据Flip Flop的值设置相对旋转</li>
</ul>
</li>
</ul>
<p><img src="/blog/p/614a8811/%E9%97%A8%E5%A2%9E%E5%8A%A0%E5%BC%80%E5%85%B3.png" alt="门增加开关.png"></p>
<p>设置门无法穿越</p>
<ul>
<li>打开门的材质</li>
<li>Collision -&gt; add box simplified collision 简单碰撞<br><img src="/blog/p/614a8811/%E9%97%A8%E5%A2%9E%E5%8A%A0%E7%A2%B0%E6%92%9E.png" alt="门增加碰撞.png"></li>
</ul>
<p>将门打开地缓慢一些<br>要点：</p>
<ol>
<li>timeline<ol start="2">
<li>两个关键帧，且自动<br><img src="/blog/p/614a8811/%E4%B8%A4%E4%B8%AA%E5%85%B3%E9%94%AE%E5%B8%A7.png" alt="两个关键帧.png"></li>
</ol>
</li>
<li>make rotator 创建 自旋转<br><img src="/blog/p/614a8811/%E5%B0%86%E9%97%A8%E6%89%93%E5%BC%80%E5%9C%B0%E7%BC%93%E6%85%A2%E4%B8%80%E4%BA%9B.png" alt="将门打开地缓慢一些.png"></li>
</ol>
<p>相关介绍<br>选取父类：<br>Actor：基本的游戏对象，如灯光、摄像机、触发器、门、帽子等<br>Pawn：可以被控制的游戏对象，如玩家、敌人、车辆等<br>Character：Pawn的子类，可以移动、跳跃、攻击等<br>PlayerController：玩家控制器，如玩家输入、控制角色等<br>PlayerState：玩家状态，如玩家得分、玩家队伍等<br>PlayerCameraManager：玩家摄像机管理器，如玩家视角、镜头抖动等<br>GameModeBase：游戏模式，如占点模式、爆破模式等<br>GameInstance：游戏实例，如游戏设置、玩家信息等<br>GameSession：游戏会话，如玩家列表、游戏状态等<br>GameStateBase：游戏状态，如游戏阶段、剩余时间等</p>
<h3 id="拾取物品-模型带帽子"><a href="#拾取物品-模型带帽子" class="headerlink" title="拾取物品+模型带帽子"></a>拾取物品+模型带帽子</h3><p>导入包</p>
<p>BluePrints-&gt;02_HatPickup_BP-&gt;BP_HatPickup Actor</p>
<p>增加 静态网格HatMesh<br>增加 材质SM_Hat</p>
<ul>
<li>增加 碰撞球体 Sphere 放大：半径65<ul>
<li>事件图标中添加：On Component Begin Overlap</li>
<li>事件图标中添加：On Component End Overlap<br>增加 文字【E】拾取 躺着</li>
</ul>
</li>
<li>设置文字 Press [E] to Pickup 碰撞了 person 才显示</li>
</ul>
<p>Person</p>
<ul>
<li>创建 自定义事件 EquipHat 装备帽子</li>
<li>增加 静态网格 HatMesh，并且等待穿戴<ul>
<li>增加 事件 f set static Mesh<ul>
<li>new Mesh 从 事件 装备帽子中获取</li>
</ul>
</li>
<li>拖动 HatMesh 到 Target</li>
</ul>
</li>
<li>增加 事件 Attach Component to Component<ul>
<li>绑定父组件<ul>
<li>Mesh (CharacterMesh)</li>
</ul>
</li>
<li>绑定子组件<ul>
<li>HatMesh</li>
</ul>
</li>
<li>对齐到目标<ul>
<li>三个全部对齐到目标</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>角色-帽子 碰撞后 &amp; 按e键 触发 EquipHat</p>
<ul>
<li>E key</li>
<li>Flip Flop</li>
<li>Cast to BP 角色<ul>
<li>As 要 绑定Event， 也就是 EquipHat 装备帽子事件</li>
</ul>
</li>
<li>bind 区域的 begin overlap -&gt; other actor</li>
</ul>
<p>写好Event后测试</p>
<p>绑定帽子的位置<br>打开person的骨骼设置<br>person -&gt; 网格体 -&gt; 打开文件夹 -&gt; 打开网格体 -&gt; 打开骨骼<br>找到头部骨骼 search head</p>
<ul>
<li>创建 附加 插槽 Hat Socket 绑定帽子Event的socketName</li>
<li>预览帽子资源，调整位置</li>
</ul>
<p>装备帽子后删除帽子<br><img src="/blog/p/614a8811/BP_hat.png" alt="BP_hat.png"></p>
<p><img src="/blog/p/614a8811/BP_third_person.png" alt="BP_third_person.png"></p>
<p><img src="/blog/p/614a8811/%E7%BD%91%E6%A0%BC%E9%AA%A8%E9%AA%BC.png" alt="网格骨骼.png"></p>
<p>创建一个 扣减角色生命值的 Actor<br>03_damage_box -&gt; BP_damage_box -&gt; actor</p>
<p>玩家</p>
<ul>
<li>增加 Health float 属性</li>
<li>增加 Health 损耗 Event</li>
</ul>
<p>物体</p>
<ul>
<li>增加碰撞体</li>
<li>Set</li>
<li>Set Timer By Event</li>
<li>扣减玩家生命值 Event</li>
<li>Apply Damage</li>
</ul>
<p><img src="/blog/p/614a8811/%E6%89%A3%E5%87%8F%E8%A7%92%E8%89%B2%E7%94%9F%E5%91%BD%E5%80%BC01.png" alt="扣减角色生命值01.png"><br>要点：</p>
<ol>
<li>将 角色 提升为变量</li>
<li>Set Timer By Event &amp; sub</li>
<li>Event 执向自定义Event -&gt; ApplyDamage<ul>
<li>循环 lopping &#x3D; true</li>
</ul>
</li>
<li>角色 蓝图 -&gt; Event AnyDamage</li>
</ol>
<p>完整版：</p>
<ul>
<li>碰撞体蓝图：<br><img src="/blog/p/614a8811/%E6%89%A3%E5%87%8F%E8%A7%92%E8%89%B2%E7%94%9F%E5%91%BD%E5%80%BC%E5%AE%8C%E6%95%B4%E7%89%8801.png" alt="扣减角色生命值完整版01.png"></li>
<li>角色蓝图：<br><img src="/blog/p/614a8811/%E6%89%A3%E5%87%8F%E8%A7%92%E8%89%B2%E7%94%9F%E5%91%BD%E5%80%BC%E5%AE%8C%E6%95%B4%E7%89%8802.png" alt="扣减角色生命值完整版02.png"></li>
</ul>
<p>增加生命值UI<br>目录：03_damage_box</p>
<ul>
<li>用户页面 -&gt; 空间蓝图 -&gt; 用户控件<ul>
<li>Canvas Panel &amp; ProgressBar</li>
<li>name：WBP_health_bar<br>Canvas Panel</li>
</ul>
</li>
<li>ProgressBar<ul>
<li>Percent 进度条数值 可以进行bind<ul>
<li>要点：从其他蓝图中bind<ol>
<li>get player pawn 获取与此UI关联的角色</li>
<li>cast to third person character 将角色转换为第三人称角色</li>
<li>get health</li>
<li>*100 mul</li>
<li>bind</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/blog/p/614a8811/WBP_health_bar.png" alt="WBP_health_bar.png"></p>
<p><img src="/blog/p/614a8811/ThirdPerson.png" alt="ThirdPerson.png"></p>
<p><img src="/blog/p/614a8811/ThirdPerson_CreateHealthBarEvent.png" alt="ThirdPerson_CreateHealthBarEvent.png"></p>
<p><img src="/blog/p/614a8811/WBP_health_bar_bind.png" alt="WBP_health_bar_bind.png"></p>
<p>添加 角色血条 到角色画布视图上 Event</p>
<ul>
<li>打开蓝图</li>
<li>添加Event CreateHealthBarEvent<ul>
<li>create widget -&gt; user interface -&gt; Create Widget<ul>
<li>绑定角色 Get Player Controller</li>
</ul>
</li>
<li>add to viewport</li>
</ul>
</li>
</ul>
<p>触发 角色血条 Event<br>当比赛开始时增加血条UI<br>Add Input Mapping的Event BeginPlay事件增加</p>
<ul>
<li>add sequence 在原有的基play础上，顺序执行<ul>
<li>CreateHealthBarEvent 触发上面创建的血条UI事件</li>
</ul>
</li>
</ul>
<p>玩家离开 则不扣血<br>要点：</p>
<ol>
<li>定时器不断触发，将计数器的返回值 存储为变量TimerReference 为定时器句柄</li>
<li>定时器句柄中 get后，方法：Clear and Invalidate Timer Handle 可以停止定时功能。<br>碰撞体 end overload</li>
</ol>
<p>增加特效：粒子系统<br>包：FX Variety Pack</p>
<p>导入特效包</p>
<p>扣血碰撞体 增加组件</p>
<ul>
<li>粒子发射器 cascade particle system component</li>
</ul>
<p>恢复血量碰撞体<br><img src="/blog/p/614a8811/BP_repair_box.png" alt="BP_repair_box.png"></p>
<h2 id="UE5-课程-第一人称-多人生存游戏"><a href="#UE5-课程-第一人称-多人生存游戏" class="headerlink" title="UE5 课程 第一人称 多人生存游戏"></a>UE5 课程 第一人称 多人生存游戏</h2><h3 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h3><h4 id="安装插件-Adventure-Character"><a href="#安装插件-Adventure-Character" class="headerlink" title="安装插件 Adventure Character"></a>安装插件 Adventure Character</h4><p>一定要先着色，再打开</p>
<p><img src="/blog/p/614a8811/AdventureCharacter.png" alt="AdventureCharacter.png"></p>
<p>安装完成之后会多一个Man文件夹 </p>
<h4 id="构建目录"><a href="#构建目录" class="headerlink" title="构建目录"></a>构建目录</h4><ul>
<li>Man 设置颜色<ul>
<li>Animations 动画，导入除了Arms.FBX以外的FBX(骨骼选择 UE4_Mannequin_Skeleton)</li>
<li>Arms 手臂，导入Arms.FBX(骨骼选择UE4_Mannequin_Skeleton)<ul>
<li>Arms 骨骼网格体 设置材质 M_Man_Body</li>
</ul>
</li>
</ul>
</li>
<li>Main<ul>
<li>复制 [第一人称的 Character BP] 到该文件夹中</li>
</ul>
</li>
</ul>
<p>注意事项：</p>
<ol>
<li>文件夹 Content 属性 修复重定向</li>
</ol>
<h4 id="8"><a href="#8" class="headerlink" title="8"></a>8</h4><p>FirstPersonMap<br>BP_FirstPersonCharacter 第一人称角色</p>
<p>FirstPersonBP 第一人称蓝图<br>FirstPerson_AnimBP 第一人称动画 蓝图<br>FirstPersonBS 第三人称 (1 D)混合空间</p>
<ul>
<li>assets details 轴设置 -&gt; 水平轴 name：speed 800</li>
<li>Idle stan —- Jog 0 600 —- running2 800</li>
<li>骨骼 SK_Man_Full_01</li>
</ul>
<p>Event Blueprint Update时间 每一帧更新<br><img src="/blog/p/614a8811/FirstPerson_AnimBP.png" alt="FirstPerson_AnimBP.png"><br><img src="/blog/p/614a8811/FirstPerson_AnimBP%E4%BA%8B%E4%BB%B6%E8%93%9D%E5%9B%BE%E6%9B%B4%E6%96%B0%E5%8A%A8%E7%94%BB.png" alt="FirstPerson_AnimBP事件蓝图更新动画.png"><br><img src="/blog/p/614a8811/walk_run.png" alt="walk_run.png"><br><img src="/blog/p/614a8811/walk_run_view.png" alt="walk_run_view.png"></p>
<p>补充：</p>
<ol>
<li>角色BP，替换Arms</li>
<li>如果不显示手臂，则需要设置动画蓝图 FirstPerson_AnimBP</li>
<li>词汇：Idle&#x2F;Walk&#x2F;Run</li>
</ol>
<h4 id="9-增加第三人称"><a href="#9-增加第三人称" class="headerlink" title="9 增加第三人称"></a>9 增加第三人称</h4><p>增加蓝图<br>ThirdPerson_AnimBP 第一人称动画 蓝图<br>ThirdPersonBS 第三人称 (1 D)混合空间</p>
<ul>
<li>assets details 轴设置 -&gt; 水平轴 name：speed 800</li>
<li>Idle —- running1 0 600 —- running2 800</li>
<li>骨骼 SK_Man_Full_01</li>
</ul>
<p>第三人称蓝图 搞定后，角色蓝图中添加 Skeletal Mesh<br>角色</p>
<ul>
<li>第一人称</li>
<li>第三人称 SK_Man_Full_01</li>
</ul>
<ol>
<li>调整好位置</li>
<li>增加动画类 ThirdPersonAnimBP</li>
<li>摄像头不可见，Mesh setting  Owner No See</li>
</ol>
<p>补充：</p>
<ol>
<li>视图中 透视 功能 可以更方便的调整角色的位置</li>
<li>Play 按钮 可以设置多个玩家，模式为 as Client</li>
</ol>
<h4 id="10"><a href="#10" class="headerlink" title="10"></a>10</h4><p>如何在编辑器中测试多人游戏<br>两种不同的游戏服务器</p>
<ul>
<li>Listen 本地服务器</li>
<li>Client 专用服务器</li>
</ul>
<h4 id="11-概念"><a href="#11-概念" class="headerlink" title="11 概念"></a>11 概念</h4><p>继承<br>蓝图基类 Actor</p>
<ul>
<li>墙壁</li>
</ul>
<p>Pawn 可以随时拥有或取消</p>
<ul>
<li>汽车</li>
<li>马</li>
<li>坐骑</li>
<li>飞机</li>
</ul>
<p>Character<br>运动组件 步行、跑步、跳跃、爬行</p>
<p>Player Controller<br>存储逻辑的蓝图类</p>
<p>Game Model Base<br>游戏规则<br>分数<br>生成位置</p>
<p>Actor Component<br>可以添加到蓝图中的组件<br>背包组件<br>建筑组件</p>
<p>Scene Component</p>
<p>BP物品基类<br>BP装备基类</p>
<ul>
<li>斧头</li>
<li>镐</li>
</ul>
<h3 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h3><p>Inventory：建筑物品(家具)清单，财产清单</p>
<p>主背包组件 or 主项目容器 蓝图容器</p>
<ul>
<li>背包相关的功能<ul>
<li>堆叠物品</li>
<li>增加</li>
<li>删除</li>
</ul>
</li>
</ul>
<p>玩家 快捷栏 组件播放器<br>玩家 物品栏组件<br>存储容器</p>
<ul>
<li>锻造工具台</li>
<li>死去的玩家</li>
<li>掉在地上的袋子</li>
</ul>
<p><img src="/blog/p/614a8811/%E7%BB%84%E4%BB%B6%E8%93%9D%E5%9B%BE%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB.png" alt="组件蓝图继承关系.png"></p>
<p>thing：</p>
<ol>
<li>打开直接在编辑器中，不重新打开标签页<br>编辑 首选项 assets editor open location Default改成 Main Window</li>
</ol>
<h4 id="14"><a href="#14" class="headerlink" title="14"></a>14</h4><p>_Main BluePrints Enums<br>创建枚举类型</p>
<p>E_ItemType</p>
<ul>
<li>Resource 资源</li>
<li>Equipment 装备</li>
<li>Armor 盔甲</li>
<li>Consumable 消耗品</li>
<li>Buildable 建筑物品</li>
</ul>
<p>BP_第一人称Character 增加变量 选择枚举类型 test_menu E_ItemType</p>
<p>E_ItemRarity 稀有类型</p>
<ul>
<li>Common</li>
<li>Uncommon</li>
<li>Rare 稀有</li>
<li>Epic 史诗</li>
<li>Legendary 传奇</li>
</ul>
<p>E_ArmorType 盔甲类型</p>
<ul>
<li>Helmet 头盔</li>
<li>Chest 胸</li>
<li>Pants 裤子</li>
<li>Boots 靴子</li>
</ul>
<p>创建 BluePrints Structures 文件夹<br>创建 蓝图-结构 S_ItemInfo</p>
<ul>
<li>ItemId int</li>
<li>ItemQuantity int 数量</li>
<li>ItemIcon Texture 2D</li>
<li>ItemName Text</li>
<li>ItemDesc Text</li>
<li>ItemDamage int 损害值</li>
<li>ItemRarity E_ItemRarity 稀有</li>
<li>ItemCurHp int 物品当前血量</li>
<li>ItemMaxHp int 物品最大血量</li>
<li>IsStackable bool 是否可堆叠</li>
<li>StackSize int 堆叠大小</li>
<li>ItemType E_ItemType 物品类型</li>
<li>ItemClassRef 创建下方BP_ItemMaster 类class引用</li>
<li>ArmorType E_ArmorType 盔甲类型</li>
<li>UseAmmo? bool 是否使用弹药</li>
<li>CurrAmmo int 当前弹药</li>
<li>MaxAmmo int 最大弹药</li>
</ul>
<p>创建 BluePrints Items 文件夹<br>创建 蓝图-Class Actor  BP_ItemMaster<br><img src="/blog/p/614a8811/S_ItemInfo.png" alt="S_ItemInfo.png"></p>
<p>安装库 [Craft Resources Icons]  会增加文件夹 CraftResourcesIcons</p>
<p>创建 BluePrints DataTables 文件夹<br>创建 其他-数据表-选择S_ItemInfo DT_Items<br>木头 0 0 wood_10_b 木头 用于制作各种物品的资源 0 Common 0 0 可堆叠100 Resource Helmet<br><img src="/blog/p/614a8811/DT_Items_0001.png" alt="DT_Items_0001.png"></p>
<h4 id="15-背包"><a href="#15-背包" class="headerlink" title="15 背包"></a>15 背包</h4><p>核心：</p>
<ol>
<li>角色蓝图中 按键1触发事件 BPC_PlayerInventory 继承的 BPC_ItemsContainer 中的 AddItemOnServer 事件</li>
<li>BPC_ItemsContainer<ul>
<li>AddItem 增加物品</li>
<li>FindEmptySlot 找到空的槽位</li>
</ul>
</li>
</ol>
<p>创建文件夹 Inventory 修改为蓝色颜色<br>创建蓝图类 Actor Component BPC_ItemsContainer</p>
<ul>
<li>创建变量 Items S_ItemInfo <ul>
<li>修改类型为 Array</li>
<li>创建 方法 FindEmptySlot <ul>
<li>Items<ul>
<li>[For Each Loop with Break] &#x3D;&gt; [Break S_ItemInfo 中断]<ul>
<li>Equals ItemId &#x3D;&#x3D; 0 &#x3D;&gt; [Branch] 分支判断</li>
<li>Outputs<ul>
<li>Success? bool</li>
<li>EmptyIndex int</li>
</ul>
</li>
<li>Completed<ul>
<li>ReturnNode Out生成的节点<ul>
<li>FoundEmptySlot? true</li>
<li>EmptySlotIndex</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建方法 AddItem，item 来源通过 Inputs 传入<ul>
<li>增加本地变量 LocalItemInfo S_ItemInfo</li>
<li>增加本地变量 LocalEmptyIndex int</li>
<li>set LocalItemInfo</li>
<li>通过 FindEmptySlot 找到空的槽位<ul>
<li>Branch<ul>
<li>True<ul>
<li>LocalEmptyIndex</li>
<li>变量Items &#x3D;&gt; Set Array Elem 设置Item，索引值为 LocalEmptyIndex，值为 LocalItemInfo</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Outputs<ul>
<li>Success? bool 勾选</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 子蓝图类 BPC_PlayerInventory 继承 BPC_ItemsContainer</li>
</ul>
<p>移动角色蓝图到 _Main 的 BluePrints 文件夹中</p>
<ul>
<li>增加组件 BPC_PlayerInventory<ul>
<li>Details 设定 30个空的槽位</li>
</ul>
</li>
<li>事件图 中 增加 按键1<ul>
<li>获取数据表行 Get Data Table Row &#x3D;&gt; DT_Items<ul>
<li>Data Table DT_Items</li>
<li>Row Name 1 [要先设置数据表的name才能同步1]</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>蓝图类 Actor Component BPC_ItemsContainer</p>
<ul>
<li>创建 自定义事件 AddItemOnServer<ul>
<li>详情 Graph 设置 Replicates &#x3D;&gt; Run On Server </li>
<li>增加 Item S_ItemInfo</li>
</ul>
</li>
<li>增加 AddItem 方法</li>
</ul>
<p>调试</p>
<ul>
<li>BPC_ItemsContainer 的 set Array Elem 的Item 右键 watch</li>
<li>BPC_PlayerInventory in BP_FirstPersonCharacter(Server,spawned)</li>
<li>点击绿色三角形运行，按1键，可以看到物品的变化</li>
<li>尝试按30次1键，可以看到物品的变化，最后会提示没有空的槽位</li>
</ul>
<p>tips:增加路由节点，控制流程更好展示</p>
<h4 id="16"><a href="#16" class="headerlink" title="16"></a>16</h4><p>小控件</p>
<ul>
<li>小地图</li>
<li>跨界蓝</li>
<li>背包等</li>
</ul>
<p>创建文件夹 _Main&#x2F;Widgets<br>创建文件 UserInterface -&gt; W_MainWidget[Widget Blueprint -&gt; User Widget]<br>创建按钮<br>创建 Canvas Panel</p>
<ul>
<li>TextBlock Main HUD<br><img src="/blog/p/614a8811/CanvasPanelMainHUD.png" alt="CanvasPanelMainHUD.png"></li>
</ul>
<p>创建蓝图类 SurvivalGamePC[PlayerController]</p>
<ul>
<li>Event BeginPlay</li>
<li>Switch Has Authority</li>
<li>Create Widget[Construct None] &#x3D;&gt; W_MainWidget,Owning Player &#x3D;&gt; self</li>
<li>set[创建变量 MainWidgetRef]</li>
<li>add to viewport<br><img src="/blog/p/614a8811/SurvivalGamePC_add_to_viewport.png" alt="SurvivalGamePC_add_to_viewport.png"></li>
</ul>
<p>创建文件夹 Blueprints GameModes<br>创建蓝图类 Blueprints GameModes GM_SurvivalGame[Game Mode Base]<br>第一人称Map 窗口 世界场景设置</p>
<ul>
<li>设置游戏模式为 GM_SurvivalGame</li>
<li>默认 Pawn Class 为 BP_FirstPersonCharacter</li>
<li>默认 PlayerControllerClass 为 SurvivalGamePC<br><img src="/blog/p/614a8811/GM_SurvivalGame%E4%B8%96%E7%95%8C%E5%9C%BA%E6%99%AF%E8%AE%BE%E7%BD%AE.png" alt="GM_SurvivalGame世界场景设置.png"></li>
</ul>
<h4 id="17-玩家统计数据UI"><a href="#17-玩家统计数据UI" class="headerlink" title="17 玩家统计数据UI"></a>17 玩家统计数据UI</h4><p>new f _Main&#x2F;Widgets&#x2F;Textures 并导入文件<br>new f _Main&#x2F;Widgets InventoryWidgets 背包控件文件夹</p>
<ul>
<li>new UserInterface -&gt; W_Inventory[Widget Blueprint -&gt; User Widget]</li>
<li>Size Box<ul>
<li>详情 Child Layout：Width Override 1650，Height Override 880</li>
<li>垂直框[Vertical Box]<ul>
<li>间隔区[Spacer]：详情 Size 80</li>
<li>水平框[Horizontal Box]：详情 Size &#x3D; Fill<ul>
<li>垂直框[Vertical Box] ： padding 15 20 15 20 Size &#x3D; Fill<ul>
<li>间隔区[Spacer]：详情 Size 80 </li>
<li>水平框[Horizontal Box]：详情 Size &#x3D; Fill<ul>
<li>边界[Border] ：详情 Size &#x3D; Fill ，Brush Image 选择 InventoryBack<ul>
<li>垂直框[Vertical Box]<ul>
<li>水平框[Horizontal Box]：详情 Size &#x3D; Fill<ul>
<li>Button 透明度0 Rename:InventoryButton 是变量 水平居中<ul>
<li>Text Inventory size28 样式 颜色</li>
</ul>
</li>
<li>Button 透明度0 Rename:CraftingButton 是变量 水平居中<ul>
<li>Text Crafting size28 样式 颜色</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>间隔区[Spacer]：详情 Size 30</li>
</ul>
</li>
<li>垂直框[Vertical Box] ： padding 20 0 20 0 Size &#x3D; Fill<ul>
<li>边界[Border] ：详情 Size &#x3D; Fill ，Brush Image 选择 PlayerStatsBack<ul>
<li>垂直框[Vertical Box]<ul>
<li>水平框[Horizontal Box]：详情 Size &#x3D; Fill<ul>
<li>Text Player Name 居中 padding-top 20</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>边界[Border] ：padding 20  ，Size &#x3D; Fill Brush Image 选择 PlayerStatsBack</li>
</ul>
</li>
<li>间隔区[Spacer]：详情 Size 80-90</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>open W_MainWidget</p>
<ul>
<li>UserCreated 导入 W_Inventory，设置为不可见，<b>通过图表中的按钮触发可见性</b><ul>
<li>设置 描点[Size To Content] 居中 &amp; 自动调整大小<ul>
<li>Position 0 0，设置为居中0.5 0.5</li>
</ul>
</li>
<li>行为：Visibility 可视</li>
</ul>
</li>
<li>图表[Graph] 右上角<ul>
<li>自定义事件 SetInventoryVisibility 设置背包可见性<ul>
<li>Inputs<ul>
<li>Visibility? bool</li>
</ul>
</li>
<li>Branch<ul>
<li>True<ul>
<li>Set Visibility[Target W_Inventory] 设置可见性<ul>
<li>New Visibility Visibility</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>Set Visibility[Target W_Inventory] 设置可见性<ul>
<li>New Visibility Hidden</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>open SurvivalGamePC</p>
<ul>
<li>add v InventoryShown? bool</li>
<li>i 键</li>
<li>Tab 键</li>
<li>自定义事件 InventoryOnClient<ul>
<li>判断 InventoryShown? bool<ul>
<li>True<ul>
<li>Set Inventory Visibility FORM MainWidget<ul>
<li>Visibility? bool false</li>
<li>Show Mouse Cursor false 含义：隐藏鼠标光标</li>
<li>Set Input Mode Game Only FROM self 含义：只能在游戏中使用</li>
<li>InventoryShown? bool false</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>Set InventoryVisibility<ul>
<li>Visibility? bool true</li>
<li>Show Mouse Cursor true 含义：显示鼠标光标</li>
<li>Set Input Mode Game And UI FROM self</li>
<li>InventoryShown? bool true</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/blog/p/614a8811/W_MainWidget.png" alt="W_MainWidget.png"></p>
<h4 id="18-创建实际的背包UI"><a href="#18-创建实际的背包UI" class="headerlink" title="18 创建实际的背包UI"></a>18 创建实际的背包UI</h4><p>将下载好的纹理 放入 _Main&#x2F;Widgets&#x2F;Textures 文件夹中</p>
<p>new W_InventorySlot[用户-Wid] _Main&#x2F;Widgets InventoryWidgets</p>
<ul>
<li>尺寸框 [Size Box] 详情 Child Layout：Width Override 75，Height Override 75<ul>
<li>覆层 [Overlay]<ul>
<li>[Borer] 重命名 SlotStyle 详情 Image Brush 选择 InventorySlot 居中[水平填充]？</li>
<li>[Borer] Tex_wood_05_b padding 4</li>
<li>TopText[TextBlock] 内容DMG100%,是变量 size9 顶部对齐 padding 7 5 5 5，引用 透明度100 </li>
<li>BottomText[TextBlock] 内容30&#x2F;30,是变量 size13 底部对齐 padding 5 5 5 10，引用 透明度100</li>
<li>尺寸框 [Size Box] Fill Color 绿色 padding 5，Height Override 7<ul>
<li>Item HP[Progress Bar]</li>
</ul>
</li>
<li>QuantityText[TextBlock] 内容x100,是变量 size13 详情 Text 0 居中 padding 5 5 5 10，引用 透明度100</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>tips:</p>
<ul>
<li>填充屏幕，要选择屏幕上所需，这样宽度就正常显示</li>
</ul>
<h4 id="19-实现-背包联动UI"><a href="#19-实现-背包联动UI" class="headerlink" title="19 实现 背包联动UI"></a>19 实现 背包联动UI</h4><p>new W_ItemContainerGrid [用户-Wid] _Main&#x2F;Widgets InventoryWidgets目录</p>
<ul>
<li><p>滚动框 [Scroll Box]</p>
<ul>
<li>Grid [Uniform Grid Panel] 是变量</li>
</ul>
</li>
<li><p>图表 生成</p>
</li>
<li><p>add var SlotsPerRow int，可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</p>
</li>
<li><p>add var 总槽数TotalSlots int，可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</p>
</li>
<li><p>add var ContainerType 下方创建 E_ContainerType，可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</p>
</li>
<li><p>add var Slots W_InventorySlot Array</p>
</li>
<li><p>add fun AddSlots 增加槽位</p>
<ul>
<li>Inputs<ul>
<li>Amount int 数量</li>
</ul>
</li>
<li>add local var LocalLoopIndex int</li>
<li>For Loop<ul>
<li>First Index <code>一定是1，不然会多一个卡槽</code></li>
<li>Loop Body<ul>
<li>Create Widget</li>
</ul>
</li>
<li>增加到 Slots Array 中 [Slots数组的add方法]</li>
</ul>
</li>
</ul>
</li>
<li><p>add fun AddSlotToGrid</p>
<ul>
<li>Inputs<ul>
<li>Index int</li>
<li>Slot W_InventorySlot</li>
</ul>
</li>
<li>add local var LocalSlotIndex int</li>
<li>add local var LocalSlot W_InventorySlot</li>
<li>将子项添加到统一网格 [add Child to Uniform Grid]<ul>
<li>set Row by Slot Index &#x2F; Slots Per Row 向下取整</li>
<li>set Column</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>new 枚举 E_ContainerType</p>
<ul>
<li>PlayerInventory 玩家背包</li>
<li>PlayerHotbar 玩家快捷栏</li>
<li>PlayerStorage 玩家存储</li>
<li>PlayerArmor 玩家护甲</li>
</ul>
<p>写完事件图[核心事件启动逻辑、AddSlot、AddSlotToGrid]后，打开 W_Inventory，导入 W_ItemContainerGrid by User Created中。</p>
<ul>
<li>详情：填充Fill，padding20<ul>
<li>Slots Per Row 5</li>
<li>Total Slots 30</li>
<li>Container Type Player Inventory</li>
</ul>
</li>
</ul>
<p>隐藏 W_InventorySlot hidden</p>
<ul>
<li>SlotStyle 可见</li>
<li>ItemIcon 可见</li>
<li>TopText</li>
<li>BottomText</li>
<li>Item HP</li>
</ul>
<h4 id="20"><a href="#20" class="headerlink" title="20"></a>20</h4><p>open BPC_ItemsContainer</p>
<ul>
<li><p>Add Fun UpdateUI</p>
<ul>
<li>add Var ContainerType E_ContainerType ，可编辑实例[Instance Editable]</li>
<li>Inputs<ul>
<li>Index Ing</li>
<li>ItemInfo S_ItemInfo</li>
<li>ResetSlot? bool</li>
</ul>
</li>
<li>判断是否 ResetSlot? bool<ul>
<li>True<ul>
<li>Set Array Elem<ul>
<li>Index</li>
<li>ItemInfo</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>切换 ContainerType 枚举使用 Switch on Enum</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>AddItem</p>
<ul>
<li>更新Node时，同时更新UI</li>
</ul>
</li>
</ul>
<p>add Interfaces 文件夹 [_Main&#x2F;Blueprints 目录]<br>add BPI_SurvivalCharacter 蓝图接口 文件 [_Main&#x2F;Blueprints&#x2F;Interfaces 目录]</p>
<ul>
<li>创建 方法 GetControllerFromChar<ul>
<li>Return Node</li>
<li>ControllerRef [SurvivalGamePC 对象引用]</li>
</ul>
</li>
</ul>
<p>add BPI_SurvivalGamePC 蓝图接口 文件 [_Main&#x2F;Blueprints Interface 目录]</p>
<ul>
<li>创建 方法 SurvivalGamePCRef<ul>
<li>Return Node</li>
<li>PlayerControllerRef [SurvivalGamePC 对象引用]</li>
</ul>
</li>
</ul>
<p>SurvivalGamePC 类设置 蓝图接口 增加 BPI_SurvivalGamePC<br>左边总览可以看到 SurvivalGamePCRef</p>
<p>BP_FirstPersonCharacter 类设置 接口 增加 BPI_SurvivalCharacter<br>左边总览可以看到 GetControllerFromChar</p>
<ul>
<li>Get Controller From Char</li>
<li>SurvivalGamePCRef<ul>
<li>FROM GET Controller</li>
</ul>
</li>
<li>Return Node<ul>
<li>ControllerRef</li>
</ul>
</li>
</ul>
<p>open BPC_ItemsContainer</p>
<ul>
<li>Get Controller From Char<ul>
<li>FROM Get Owner</li>
</ul>
</li>
<li>Update Item Slot<ul>
<li>FORM 下方的事件</li>
</ul>
</li>
</ul>
<p>open SurvivalGamePC</p>
<ul>
<li>add 自定义事件 UpdateItemSlot 重点 <strong>在其拥有的客户端上运行</strong><ul>
<li>Inputs<ul>
<li>ContainerType E_ContainerType</li>
<li>Index int</li>
<li>ItemInfo S_ItemInfo</li>
</ul>
</li>
<li>更新的是 MainWidgetRef 中的 W_Inventory 的 W_ItemContainerGrid 的 Slots，通过变量 Slots 的 Get</li>
<li>Is Valid? 判断是否有效<ul>
<li>有效 执行 W_InventorySlot 的 UpdateSlot</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Open W_InventorySlot</p>
<ul>
<li>add 自定义事件 UpdateSlot<ul>
<li>Inputs<ul>
<li>ItemInfo S_ItemInfo 设置变量 ItemInfo</li>
<li>Break S_ItemInfo 指定元素可见<ul>
<li>ItemIcon<ul>
<li>设置来自纹理的笔刷 [Set Brush From Texture]</li>
<li>设置可见性 [Set Visibility]</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>总结：<br>UpdateUI 方法：<br>传递 索引 ItemInfo 是否重置<br>如果重置，就直接设置<br>执行 UpdateItemSlot 方法，传递 容器、索引和ItemInfo</p>
<p>检查点：</p>
<ol>
<li>BP_FirstPersonCharacter 1key 触发事件，背包UI显示</li>
<li>BPC_ItemsContainer</li>
<li>SurvivalGamePC</li>
<li>W_InventorySlot UpdateSlot</li>
<li>BP_FirstPersonCharacter GetControllerFromChar</li>
</ol>
<ul>
<li>PlayerControllerRef<ul>
<li>FROM Get Controller</li>
</ul>
</li>
</ul>
<h4 id="21-22-能够将物品-使用鼠标左键-滑动"><a href="#21-22-能够将物品-使用鼠标左键-滑动" class="headerlink" title="21 &amp; 22 能够将物品 使用鼠标左键 滑动"></a>21 &amp; 22 能够将物品 使用鼠标左键 滑动</h4><p>open W_InventorySlot<br>重写父级方法<br>按下鼠标按钮 [On Mouse Button Down]</p>
<ul>
<li>Mouse Event 按下时侦测拖动 [Detect Drag if Pressed]</li>
<li>Drag Key 鼠标左键</li>
<li>return node</li>
</ul>
<p>open W_InventorySlot Graph</p>
<ul>
<li>add var HasItemInSlot? bool</li>
<li>UpdateSlot 事件 第三个 Set HasItemInSlot? bool &#x3D; true</li>
</ul>
<p>copy W_InventorySlot rename W_DraggedItem<br>open W_DraggedItem 增加变量 下面变量全部 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</p>
<ul>
<li>add var ImageIcon Texture 2D</li>
<li>add var TextTop Text</li>
<li>add var ItemType E_ItemType</li>
<li>add var Quantity Int</li>
<li>add var UserAmmo? bool</li>
<li>add var CurrAmmo int</li>
<li>add var MaxAmmo int</li>
<li>add var CurrHP int</li>
<li>add var MaxHP int </li>
<li>删除 变量 HasItemInSlot? bool</li>
</ul>
<p>创建蓝图类 ItemDrag _Main&#x2F;Blueprints Widgets InventoryWidgets 目录 DragDropOperation 类型</p>
<ul>
<li>创建变量 并且全部 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]<ul>
<li>add var SlotIndex int</li>
<li>add var FromContainerType E_ContainerType</li>
<li>add var ItemType E_ItemType</li>
<li>add var ArmorType E_ArmorType</li>
</ul>
</li>
</ul>
<p>open W_InventorySlot 重写父类方法 发现拖动时 [On Drag Detected] 方法</p>
<ul>
<li>判断 变量 HasItemInSlot?</li>
<li>True<ul>
<li>创建控件 [Create Widget] W_Dragged<ul>
<li>W_DraggedItem</li>
<li>Owning Player ?????</li>
<li>其他成员使用 ItemInfo Break S_ItemInfo 进行赋值<ul>
<li>直接拖动，自动会转换格式</li>
<li>特殊的：ItemDamage &#x3D;&#x3D;&#x3D; TextTop</li>
</ul>
</li>
</ul>
</li>
<li>创建拖放操作 [Create Drag] Item</li>
<li>设置拖放操作 [Set Drag] Item<ul>
<li>上控件 &#x3D;&gt; 本拖放的 Default Drag Visual</li>
<li>class ItemDrag</li>
<li>Slot Index 提升变量 ItemIndex</li>
<li>FromContainer 提升变量 FromContainerType E_ContainerType</li>
<li>Item Type 使用Break的ItemInfo的 ItemType</li>
<li>Armor Type 使用Break的ItemInfo的 ArmorType</li>
<li>return node</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>open W_DraggedItem</p>
<ol>
<li>删除事件 UpdateSlot</li>
<li>重写事件 Event Construct</li>
</ol>
<ul>
<li>获取 ItemIcon 设置来自纹理的笔刷 [Set Brush From Texture] <ul>
<li>ItemIcon 目标</li>
<li>ImageIcon 纹理资产</li>
</ul>
</li>
<li>ItemType [Selection] 切换枚举使用 [Switch on Enum]<ul>
<li>Resource<ul>
<li>Quantity Text &#x3D;&gt; 设置文本 [Set Text(Text)] <ul>
<li>Quantity &#x3D;&gt; Format Text x{quantity} &#x3D;&gt; [In text]</li>
</ul>
</li>
<li>Quantity Text &#x3D;&gt; Set Visibility</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>松开鼠标按钮</p>
<h4 id="23-处理后端-能够将物品鼠标左键从一个插槽转移到另一个插槽"><a href="#23-处理后端-能够将物品鼠标左键从一个插槽转移到另一个插槽" class="headerlink" title="23 处理后端 能够将物品鼠标左键从一个插槽转移到另一个插槽"></a>23 处理后端 能够将物品鼠标左键从一个插槽转移到另一个插槽</h4><p>open W_InventorySlot<br>重写 放置时[On Drop] 方法</p>
<p>open BP_FirstPersonCharacter</p>
<ul>
<li>圈 1Key 触发事件 Rename 增加物品Debug</li>
<li>add 自定义事件 OnSlotDropOnServer 运行在服务器中，防止作弊  实际的物品放置逻辑<ul>
<li>Inputs<ul>
<li>TargetContainerType E_ContainerType</li>
<li>ContainerType E_ContainerType</li>
<li>FromIndex int</li>
<li>DroppedIndex int 落下位置的索引</li>
<li>ArmorType E_ArmorType</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>open BPI_SurvivalCharacter</p>
<ul>
<li>add fun GetSurvivalCharacterRef<ul>
<li>Output<ul>
<li>SurvivalCharacterRef [BP_FirstPersonCharacter 对象引用]</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>open BP_FirstPersonCharacter 左下方出现 GetSurvivalCharacterRef &amp;&amp; open</p>
<ul>
<li>self</li>
</ul>
<p>open W_InventorySlot &amp;&amp; open On Drop 方法</p>
<ul>
<li>Operator &#x3D;&gt; To Cast To ItemDrag 防止蓝图总是被加载<ul>
<li>As Item Drag<ul>
<li>As Item Drag 的 SlotIndex &#x3D;&gt; set LocalSlotIndex</li>
<li>As Item Drag 的 ContainerType &#x3D;&gt; set LocalFromContainerType</li>
</ul>
</li>
<li>Get Survival Character Ref<ul>
<li>目标 获取 玩家 角色</li>
</ul>
</li>
<li>On Slot Drop On Server<ul>
<li>Target Container &#x3D;&gt; FormContainerType</li>
<li>From Target Container &#x3D;&gt; LocalFromContainerType</li>
<li>From Index &#x3D;&gt; SlotIndex</li>
<li>Dropped Index<ul>
<li>FROM Item Index</li>
</ul>
</li>
<li>Armor Type<ul>
<li>FROM Cast To ItemDrag 的 Armor Type</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Return</li>
</ul>
<p>open BPC_ItemsContainer<br>创建 自定义事件 OnSlotDrop 放置物品 在服务器上运行</p>
<ul>
<li>Inputs<ul>
<li>FromContainer BPC_ItemsContainer</li>
<li>FromIndex int</li>
<li>DroppedIndex int</li>
</ul>
</li>
<li>Replicates Run On Server</li>
</ul>
<p>增加 方法 HandleSlotDrop 增加描述 在子类重写 红色</p>
<ul>
<li>Inputs<ul>
<li>FromContainerType BPC_ItemsContainer</li>
<li>FromIndex int</li>
<li>DroppedIndex int</li>
</ul>
</li>
</ul>
<p>图表中 OnSlotDrop &#x3D;&gt; HandleSlotDrop ，并连接三个参数</p>
<p>open BP_FirstPersonCharacter 的 自定义事件 OnSlotDropOnServer<br>放置物品，执行 OnSlotDrop方法，目标和来源都是 BPC_PlayerInventory，相当于从背包中换了一个位置<br>OnSlotDropOnServer &#x3D;&gt; OnSlotDrop<br>BPC_PlayerInventory -&gt; 选择 select PlayerInventory 是来源也是目标</p>
<h4 id="24-完成-背包物品拖放-逻辑"><a href="#24-完成-背包物品拖放-逻辑" class="headerlink" title="24 完成 背包物品拖放 逻辑"></a>24 完成 背包物品拖放 逻辑</h4><p>open BPC_ItemsContainer 创建 方法 TransferItem</p>
<ul>
<li>Inputs<ul>
<li>ToComponent BPC_ItemsContainer</li>
<li>ToSpecificIndex int</li>
<li>ItemIndexToTransfer int</li>
</ul>
</li>
</ul>
<p>open BPC_PlayerInventory<br>重写 方法 HandleSlotDrop</p>
<ul>
<li>全部提升为 局部变量 Local开头</li>
<li>LocalFromContainerType 的 ContainerType 的 Switch On E_ContainerType<ul>
<li>PlayerInventory</li>
<li>Transfer Item<ul>
<li>目标 &#x3D;&gt; LocalFromContainerType</li>
<li>To Component &#x3D;&gt; self</li>
<li>To Specific Index &#x3D;&gt; LocalDroppedIndex</li>
<li>Item Index To Transfer &#x3D;&gt; LocalFromIndex</li>
</ul>
</li>
</ul>
</li>
<li>return node</li>
</ul>
<p>open BPC_ItemsContainer 的 TransferItem</p>
<ul>
<li>删除调用父类的方法</li>
<li>全部提升为 局部变量 Local开头<ul>
<li>特殊：ToComponent &#x3D;&gt; 存为 LocalReceiverComponent</li>
<li>特殊：ItemIndexToTransfer &#x3D;&gt; 存为 LocalItemIndex</li>
</ul>
</li>
<li>Is Valid 检查 LocalReceivedItemInfo 检查传入的组件，是否有效<ul>
<li>True<ul>
<li>GetItemAtIndex by LocalItemIndex item的值 设置局部变量 LocalItemToTransfer</li>
<li>AddItemToIndex<ul>
<li>目标 &#x3D;&gt; LocalReceiverComponent</li>
<li>Item &#x3D;&gt; LocalItemToTransfer</li>
<li>LocalSpecificIndex &#x3D;&gt; LocalToSpecificIndex</li>
<li>FromIndex &#x3D;&gt; LocalItemIndex</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 FindItemByIndex<ul>
<li>思路：遍历所有的物品，找到对应的物品，返回索引。<ul>
<li>Items 是否为有效索引[Is Valid Index]</li>
<li>Items GET方法 By Index</li>
<li>判断失败 也返回空</li>
<li>Set Index 为 LocalIndex</li>
<li>方法设置为 纯函数[Pure] 不会引入任何副作用，确保某些函数不会修改任何状态 高效</li>
</ul>
</li>
<li>Inputs<ul>
<li>Index int</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 AddItemToIndex<ul>
<li>思路：<ul>
<li>先判断 槽位是否是空的 下方 IsSlotEmpty?</li>
</ul>
</li>
<li>Inputs<ul>
<li>Item S_ItemInfo</li>
<li>SpecificIndex int</li>
<li>FromIndex int</li>
</ul>
</li>
<li>全部提升为 局部变量 Local开头</li>
<li>判断<ul>
<li>false return Success? false</li>
</ul>
</li>
<li>Items 的 设置阵列元素 [Set Array Elem]<ul>
<li>Index &#x3D; LocalIndex</li>
<li>Item &#x3D; LocalItem</li>
</ul>
</li>
<li>Return Success? true</li>
<li>Outputs<ul>
<li>Success? bool</li>
</ul>
</li>
</ul>
</li>
<li>add fun IsSlotEmpty?<ul>
<li>Inputs<ul>
<li>Index int</li>
</ul>
</li>
<li>Items GET方法 By Index</li>
<li>判断是否有效 Break S_ItemInfo <ul>
<li>True<ul>
<li>ItemId &#x3D;&#x3D; 0 槽位是空</li>
<li>return node SlotEmpty? true</li>
</ul>
</li>
<li>False<ul>
<li>return node SlotEmpty? false</li>
</ul>
</li>
</ul>
</li>
<li>Outputs<ul>
<li>SlotEmpty? bool</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>open BPC_PlayerInventory<br>重写 方法 AddItemToIndex ，增加 更新UI逻辑</p>
<ul>
<li>Get Owner 的 Get Controller From Char</li>
<li>Update Item Slot 运行在客户端上<ul>
<li>目标 上方char的 Controller ref</li>
<li>ContainerType 是 父类的 ContainerType，可以直接获取</li>
<li>Index 是 LocalToSpecificIndex</li>
<li>ItemInfo 是 父类的 FindItemByIndex By SpecificIndex</li>
</ul>
</li>
<li>Return Node Success? bool</li>
</ul>
<p>open W_ItemContainerGrid 图表 AddSlots 方法，Create Widget 后面 Return Value</p>
<ul>
<li>Set ItemIndex<ul>
<li>ItemIndex &#x3D; Slots-&gt;add 返回的值</li>
</ul>
</li>
</ul>
<p>然后就可以拖动复制了。</p>
<p>接下来新增 BPC_ItemsContainer 的 RemoveItemByIndex 方法，用于删除移动前的物品</p>
<ul>
<li>Inputs<ul>
<li>Index int</li>
</ul>
</li>
<li>Items 的 设置阵列元素 [Set Array Elem]<ul>
<li>Index &#x3D; LocalIndex</li>
<li>Item &#x3D; 留空即可</li>
</ul>
</li>
<li>Return Node Success? true</li>
</ul>
<p>什么时候调用呢？BPC_ItemsContainer 的 TransferItem 方法中</p>
<ul>
<li>AddItemToIndex 后 判断Success? bool</li>
<li>True<ul>
<li>RemoveItemByIndex<ul>
<li>Index &#x3D; LocalItemIndex</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>W_InventorySlot 中 新增 自定义 方法 ResetSlot</p>
<ul>
<li>隐藏所有的元素 Set Visibility Hidden<ul>
<li>ItemIcon</li>
<li>TopText</li>
<li>BottomText</li>
<li>Item HP</li>
<li>Quantity Text</li>
</ul>
</li>
<li>Set HasItemInSlot? bool &#x3D; false</li>
</ul>
<p>SurvivalGamePC 中的 事件图中</p>
<ul>
<li>复制 UpdateItemSlot 重命名为 ResetItemSlot</li>
<li>设置 运行在客户端</li>
<li>Update Slot Event 换成 ResetSlot</li>
</ul>
<p>open BPC_PlayerInventory 重写 RemoveItemByIndex 方法<br>增加 更新UI逻辑</p>
<ul>
<li>Get Owner 的 Get Controller From Char</li>
<li>Reset Item Slot 运行在客户端上<ul>
<li>目标 上方char的 Controller ref</li>
<li>ContainerType 是 父类的 ContainerType，可以直接获取</li>
<li>Index 是 Input Index</li>
</ul>
</li>
</ul>
<p>整体思路：</p>
<ol>
<li>第一人称角色蓝图 [BP_FirstPersonCharacter] 中 添加了蓝图组件 玩家背包组件 [BPC_PlayerInventory]</li>
<li>玩家背包组件 [BPC_PlayerInventory] 继承了 父类 物品容器蓝图 [BPC_ItemsContainer]<ul>
<li>物品蓝图中有如下方法：<ul>
<li>AddItem 增加物品</li>
<li>FindEmptySlot 找到空的槽位</li>
<li>UpdateUI 更新UI</li>
<li>UpdateItemSlot 更新物品槽位</li>
<li>HandleSlotDrop 处理物品槽位</li>
<li>TransferItem 转移物品</li>
<li>FindItemByIndex 通过索引查找物品</li>
<li>AddItemToIndex 增加物品到指定的索引</li>
<li>IsSlotEmpty? 判断槽位是否为空</li>
<li>ResetItemSlot 重置物品槽位</li>
<li>RemoveItemByIndex 删除物品</li>
</ul>
</li>
</ul>
</li>
<li><code>角色蓝图</code> [BP_FirstPersonCharacter] 1 key 触发 <code>玩家背包组件</code> [BPC_PlayerInventory] 中的 <code>AddItemOnServer</code> 事件<ul>
<li><code>AddItemOnServer</code> 事件中调用了 <code>AddItem</code> 方法<ul>
<li>先看 index 是否是空槽位</li>
<li>设置 item 进入 Items 指定 Index 的位置</li>
<li>更新UI事件<ul>
<li>执行 <code>拥有者</code> 的 <code>Get Controller From Char</code> 方法 的 SurvivalGamePC 中的 <code>UpdateItemSlot</code> 事件<ul>
<li>执行 W_Inventory 的 <code>UpdateSlot</code> 方法<ul>
<li>设置 不是空槽位</li>
<li>设置 多个参数可见</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>附加：W_InventorySlot 中的 已有鼠标按键被按下事件 [On Mouse Button Down] 方法<ul>
<li>监听鼠标左键</li>
</ul>
</li>
<li>附加：W_InventorySlot 中的 控件开始拖动事件 [OnDropDetected] 方法</li>
<li>附加：W_InventorySlot 中的 控件拖动放下事件 [OnDrop] 方法</li>
</ol>
<ul>
<li>获取玩家角色 Get Survival Character Ref</li>
<li>执行 插槽放置事件 [On Slot Drop On Server] <ul>
<li>执行 BPC_ItemsContainer 的 [Handle Slot Drop] 自定义事件<ul>
<li>执行 Handle Slot Drop 方法，由 玩家背包组件 [BPC_PlayerInventory] 重写<ul>
<li>判断来源是玩家背包组件</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>调试 BPC_ItemsContainer 的 AddItem 观察Items的变化</p>
<h4 id="25-26-创建快捷栏"><a href="#25-26-创建快捷栏" class="headerlink" title="25 &amp; 26 创建快捷栏"></a>25 &amp; 26 创建快捷栏</h4><p>快捷栏 砍树 收集木头</p>
<p>下载并导入资源 Hotbar.TGA、BoxButton.TGA 安装在 _Main&#x2F;Widgets&#x2F;Textures 文件夹中<br>new UserInterface -&gt; W_Hotbar [Widget Blueprint -&gt; User Widget] 在 _Main&#x2F;Widgets InventoryWidgets 目录<br>size box </p>
<ul>
<li>详情 Child Layout：Width Override 740，Height Override 100</li>
<li>Desired on Screen</li>
<li>Border  0.7 透明度  Brush Image 选择 Hotbar 居中<ul>
<li>垂直框[Vertical Box]：Size &#x3D; Fill<ul>
<li>间隔区[Spacer]：Size 10</li>
<li>水平框[Horizontal Box]：<ul>
<li>用户 创建 W_ItemContainerGrid<ul>
<li>Size &#x3D; Fill</li>
<li>Slots Per Row 9</li>
<li>Total Slots 8</li>
<li>Container Type Player Hotbar</li>
</ul>
</li>
</ul>
</li>
<li>水平框[Horizontal Box]<ul>
<li>统一网格 [Uniform Grid Panel] Size &#x3D; Fill<ul>
<li>边界 [Border] Brush Image 选择 BoxButton 居中<ul>
<li>文本块 [Text Block]：Size &#x3D; Fill<ul>
<li>Text 1<ul>
<li>设置文本 [Set Text(Text)] <ul>
<li>1</li>
</ul>
</li>
<li>设置字体 [Set Font] <ul>
<li>Size 9</li>
<li>Column 0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>边界 [Border]：Size &#x3D; Fill Brush Image 选择 BoxButton 居中<ul>
<li>文本块 [Text Block]：Size &#x3D; Fill<ul>
<li>Text 2<ul>
<li>设置文本 [Set Text(Text)]<ul>
<li>2</li>
</ul>
</li>
<li>设置字体 [Set Font]<ul>
<li>Size 9</li>
<li>Column 1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>… 8个</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>open W_MainWidget 添加 W_Hotbar <code>注意不要拖进左下角层级中，拖到右边的屏幕中，不然会缩放</code></p>
<ul>
<li>底部居中</li>
<li>设置 描点[Size To Content] 居中 &amp; 自动调整大小<ul>
<li>Position 0 0，设置为居中0.5 1.2</li>
</ul>
</li>
</ul>
<h4 id="27-创建快捷栏背包蓝图子类"><a href="#27-创建快捷栏背包蓝图子类" class="headerlink" title="27 创建快捷栏背包蓝图子类"></a>27 创建快捷栏背包蓝图子类</h4><p>创建 蓝图类 BPC_PlayerHotbar 继承 BPC_ItemsContainer 在 _Main&#x2F;Blueprints Inventory 目录</p>
<p>open BP_FirstPersonCharacter 添加组件 BPC_PlayerHotbar</p>
<ul>
<li>设置 Items 为 8个空的槽位</li>
<li>设置 ContainerType 为 PlayerHotbar</li>
</ul>
<h4 id="28-创建可装备的物品-相关的文件：蓝图、枚举、结构、接口"><a href="#28-创建可装备的物品-相关的文件：蓝图、枚举、结构、接口" class="headerlink" title="28 创建可装备的物品 相关的文件：蓝图、枚举、结构、接口"></a>28 创建可装备的物品 相关的文件：蓝图、枚举、结构、接口</h4><p>根据 ItemMaster 父类蓝图 在 _Main&#x2F;Blueprints&#x2F;Items 目录 创建子类 BP_EquipableMaster 可装备的类</p>
<p>创建 Equipable 文件夹 在 _Main&#x2F;Blueprints&#x2F;Items 目录<br>创建 第一人称文件：根据 EquipableMaster 父类蓝图 在 Equipable 目录 创建子类 BP_FirstPersonEquipable<br>创建 第三人称文件：复制 BP_FirstPersonEquipable 重命名为 BP_ThirdPersonEquipable</p>
<p>创建蓝图枚举 E_EquipableState 可装备状态 在 _Main&#x2F;Blueprints Enums 目录</p>
<ul>
<li>Hatchet 斧头</li>
<li>Bow 弓</li>
<li>Rock 石头</li>
<li>Rifle 步枪</li>
<li>RocketLauncher 火箭发射器</li>
<li>Default 默认</li>
<li>Spear 矛</li>
<li>Swimming 游泳</li>
</ul>
<p>创建蓝图结构 S_EquipableInfo 在 _Main&#x2F;Blueprints&#x2F;Structures 目录</p>
<ul>
<li>SocketName Name </li>
<li>AnimationState E_EquipableState</li>
<li>FirstPersonEquipableClass BP_FirstPersonEquipable 类引用 不然子类无法设置</li>
</ul>
<p>创建 蓝图接口 BPI_EquipableItem 在 _Main&#x2F;Blueprints&#x2F;Interfaces 目录</p>
<ul>
<li>add fun GetEquipableRef<ul>
<li>Outputs<ul>
<li>EquipableRef [BP_EquipableMaster 对象引用]</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Open BP_EquipableMaster</p>
<ul>
<li>add var EquipableInfo S_EquipableInfo</li>
<li>默认类 禁用 [Start with Tick Enabled] 提高性能和优化游戏，不用每一帧都执行</li>
<li>类设置 增加 接口 BPI_EquipableItem</li>
<li>编译保存后 打开 GetEquipableRef<ul>
<li>增加对自身的引用</li>
</ul>
</li>
</ul>
<h4 id="29-创建-工具、斧头-的相关文件"><a href="#29-创建-工具、斧头-的相关文件" class="headerlink" title="29 创建 工具、斧头 的相关文件"></a>29 创建 工具、斧头 的相关文件</h4><p>创建文件夹 _Main&#x2F;Meshes<br>创建文件夹 _Main&#x2F;Meshes&#x2F;Equipables<br>创建文件夹 _Main&#x2F;Widgets&#x2F;Textures&#x2F;ItemIcon<br>下载并导入资源 StoneHatchet.TGA 安装在 _Main&#x2F;Widgets&#x2F;Textures&#x2F;ItemIcon 文件夹中<br>下载并导入资源 SM_Hatchet.fbx 安装在 _Main&#x2F;Meshes&#x2F;Equipables 文件夹中</p>
<p>创建文件夹 _Main Materials Equipables Materials<br>将资源文件 Material_001 移动到新建的文件夹 _Main Materials Equipables Materials 中<br>将 axe_low_Material.001开头的四个文件 移动到新建的文件夹 _Main&#x2F;Meshes&#x2F;Equipables&#x2F;Materials 中</p>
<p>打开 Material_001 将四个文件拖入到 Material_001 中</p>
<ul>
<li>浅黄色 BaseColor</li>
<li>黑白色 Metallic 金属色</li>
<li>全白色 Roughness 粗糙度</li>
<li>蓝色 Normal 普通的</li>
</ul>
<p>保存退出后 Open SM_Hatchet 可以看到效果</p>
<p>创建文件夹 Tools、Tools&#x2F;Hatchet 在 _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipable 目录中<br>创建 BP_FirstPersonEquipable 的子类 BP_FP_Hatchet[第一人称] 进入 Tools<br>创建 BP_ThirdPersonEquipable 的子类 BP_TP_Hatchet[第三人称] 进入 Tools<br>创建 BP_FP_Hatchet 的子类 BP_FP_StoneHatchet 进入 Tools&#x2F;Hatchet<br>创建 BP_TP_Hatchet 的子类 BP_TP_StoneHatchet 进入 Tools&#x2F;Hatchet</p>
<p>Open BP_FP_Hatchet 增加 静态网格 来放置斧头</p>
<ul>
<li>静态网格 选择 SM_Hatchet<br>Open BP_FP_Hatchet 增加 静态网格 来放置斧头</li>
<li>静态网格 选择 SM_Hatchet</li>
</ul>
<p>Open DT_Items 数据表 添加一行，并且设置行命名为 2</p>
<ul>
<li>ItemId 2</li>
<li>ItemQuantity 1 数量</li>
<li>ItemIcon 选择 StoneHatchet</li>
<li>ItemName 石斧</li>
<li>ItemDescription 石斧</li>
<li>ItemDamage 100</li>
<li>ItemRarity Common</li>
<li>ItemCurHP 100</li>
<li>ItemMaxHP 100</li>
<li>IsStackable? 不可堆叠</li>
<li>StackSize 1</li>
<li>ItemType Equipable 可装备的</li>
<li>ItemClassRef BP_TP_StoneHatchet</li>
<li>ArmorType Helmet 头盔</li>
</ul>
<h4 id="30-创建工具、斧头的UI-以及快捷栏逻辑"><a href="#30-创建工具、斧头的UI-以及快捷栏逻辑" class="headerlink" title="30 创建工具、斧头的UI 以及快捷栏逻辑"></a>30 创建工具、斧头的UI 以及快捷栏逻辑</h4><p>补充：使用快捷栏中的物品 设置斧头</p>
<p>下载并导入资源 HatchetIdleTP.FBX 和 Hatchet_Idle.FBX 安装在 Man Animations 文件夹中<br>骨骼选择 UE4_Mannequin_Skeleton</p>
<p>创建 拿着斧头的 动画混合空间 在 _Main Animations，复制 FirstPersonBS 重命名为 HatchetBS_FP 这是第一人称的<br>open this<br>动画编辑</p>
<ul>
<li>Hatchet_Idle 0</li>
<li>Hatchet_Walk 600</li>
<li>Hatchet_Run 800</li>
</ul>
<p>创建 拿着斧头的 动画混合空间 在 _Main Animations，复制 ThirdPersonBS 重命名为 HatchetBS_TP 这是第三人称的<br>open this<br>动画编辑</p>
<ul>
<li>HatchetIdleTP 0</li>
<li>Running1 600</li>
<li>Running2 800</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>add var EquippedState E_EquipableState</li>
<li>修改 详情 EquippedState 为 Hatchet</li>
</ul>
<p>OPEN FirstPerson_AnimBP </p>
<ul>
<li>增加变量 EquippedItem E_EquipableState 默认值设置为 Default</li>
<li>找到 Idle&#x2F;Walk&#x2F;Run<ul>
<li>Speed 先设置变量 默认值是800</li>
<li>FirstPersonBS_FP</li>
<li>[Blend Poses (E_EquipableState)] 根据不同的装备状态，播放不同的动画<ul>
<li>增加 添加元素引脚 Hatchet [Pose]<ul>
<li>HatchetBS_FP<ul>
<li>Speed 是当前的 Speed</li>
</ul>
</li>
</ul>
</li>
<li>Active Enum Item &lt;&#x3D;&gt; 变量 EquippedItem</li>
<li>Default Blend Time 0.1</li>
<li>Hatchet Blend Time 0.1</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>事件蓝图更新动画 [EventBlueprintUpdateAnimation]</p>
<ul>
<li>增加 Get Survival Character Ref<ul>
<li>目标 Get Owner 的 Return Value</li>
</ul>
</li>
<li>设置变量 EquippedState [Set Equipped State]<ul>
<li>目标 SurvivalCharacterRef</li>
</ul>
</li>
</ul>
<p>OPEN ThirdPerson_AnimBP</p>
<ul>
<li>增加变量 EquippedItem E_EquipableState 默认值设置为 Default</li>
<li>找到 Idle&#x2F;Walk&#x2F;Run<ul>
<li>Speed 先设置变量 默认值是800</li>
<li>ThirdPersonBS</li>
<li>[Blend Poses (E_EquipableState)] 根据不同的装备状态，播放不同的动画<ul>
<li>增加 添加元素引脚 Hatchet [Pose]<ul>
<li>HatchetBS_TP<ul>
<li>Speed 是当前的 Speed</li>
</ul>
</li>
</ul>
</li>
<li>Active Enum Item &lt;&#x3D;&gt; 变量 EquippedItem</li>
<li>Default Blend Time 0.1</li>
<li>Hatchet Blend Time 0.1</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>事件蓝图更新动画 [EventBlueprintUpdateAnimation]</p>
<ul>
<li>增加 Get Survival Character Ref<ul>
<li>目标 Get Owner 的 Return Value</li>
</ul>
</li>
<li>设置变量 EquippedState [Set Equipped State]<ul>
<li>目标 SurvivalCharacterRef</li>
</ul>
</li>
</ul>
<p>增加跳跃栏键 time：11.27<br>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>创建 方法 UseHotbarFunction<ul>
<li>Inputs<ul>
<li>Index int</li>
</ul>
</li>
<li>设置变量 HotbarIndex &#x3D; Index</li>
</ul>
</li>
<li>创建 自定义事件 HotBarOnServer 运行在服务器中，防止作弊<ul>
<li>Inputs<ul>
<li>Index int</li>
</ul>
</li>
</ul>
</li>
<li>增加 1-8 Key 都对应 HotBarOnServer 并且修改 Index 的值<ul>
<li>Index 1  - Index 0</li>
<li>Index 2   …</li>
<li>Index 3</li>
<li>Index 4</li>
<li>Index 5</li>
<li>Index 6</li>
<li>Index 7</li>
<li>Index 8  - Index 7</li>
<li>增加 Comment 注释 [快捷键 HotBarKeys]</li>
</ul>
</li>
</ul>
<p>OPEN BPC_PlayerHotbar 中</p>
<ul>
<li>创建 方法 CheckHotbar 检查快捷栏是否为空</li>
<li>Inputs<ul>
<li>Index int</li>
</ul>
</li>
<li>Outputs<ul>
<li>HasItemInSlot? bool</li>
<li>ItemType ItemType</li>
</ul>
</li>
<li>判断 Items &#x3D;&gt; Get &#x3D;&gt; Break S_ItemInfo ?&#x3D; 0</li>
<li>Return Node <ul>
<li>HasItemInSlot? bool</li>
<li>ItemType &#x3D;&#x3D; Break S_ItemInfo &#x3D;&gt; ItemType</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图 </p>
<ul>
<li>创建 变量 ThirdPersonEquippedItem Actors 对象引用</li>
<li>OPEN 方法 UseHotbarFunction<ul>
<li>Set Hotbar Index</li>
<li>判断 BPC_PlayerHotbar 的 CheckHotbar<ul>
<li>Index &#x3D;&gt; HotbarIndex</li>
</ul>
</li>
<li>切换枚举 [Switch on E_ItemType]<ul>
<li>处理 可装备的 类型</li>
</ul>
</li>
<li>ThirdPersonEquippedItem 为了避免潜在的异常情况 <code>右键</code>转换为 Validated Get，检查 第三人称装备的物品是否有效<ul>
<li>true 角色已经装备了物品<ul>
<li>print string “角色已经装备了物品”</li>
</ul>
</li>
<li>false 角色没有装备物品<ul>
<li>执行下方的 SpawnEquipaableThirdPerson<ul>
<li>这行好像没有用… Class &#x3D;&gt; Actor Class &#x3D;&gt; ThirdPersonEquipableClass</li>
<li>ItemInfo &#x3D;&gt; PlayerHotbar 的 Items 的 Get(通过 HotbarIndex 获取) </li>
<li>Class &#x3D;&gt; PlayerHotbar 的 Items 的 Get(通过 HotbarIndex 获取) &#x3D;&gt; Break S_ItemInfo 的 ItemClassRef</li>
<li>ItemIndex &#x3D;&gt; HotbarIndex</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>新增 自定义事件 SpawnEquipaableThirdPerson 运行在服务器中，防止作弊<ul>
<li>Inputs<ul>
<li>Class Actor 类</li>
<li>ItemInfo S_ItemInfo</li>
<li>EquippedIndex int</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 自定义事件 HotBarOnServer</p>
<ul>
<li>Use Hotbar Function<ul>
<li>Index &#x3D;&gt; Index</li>
</ul>
</li>
</ul>
<h4 id="31-继续完成-快捷栏-逻辑"><a href="#31-继续完成-快捷栏-逻辑" class="headerlink" title="31 继续完成 快捷栏 逻辑"></a>31 继续完成 快捷栏 逻辑</h4><p>OPEN BP_FirstPersonCharacter 事件图 </p>
<ul>
<li>OPEN SpawnEquipaableThirdPerson 自定义事件<ul>
<li>EquippedIndex 提升为变量 EquippedIndex</li>
</ul>
</li>
<li>[SpawnActor]<ul>
<li>Class &#x3D;&gt; Class</li>
<li>Spawn Transform 右键 分割结构体引脚</li>
</ul>
</li>
<li>Set ThirdPersonEquippedItem<ul>
<li>目标 Spawn Actor 的 Return Value</li>
</ul>
</li>
<li>Get Equipable Ref<ul>
<li>Ref &#x3D;&gt; EquipableInfo &#x3D;&gt; Break S_EquipableInfo<ul>
<li>目标 ThirdPersonEquippedItem</li>
<li>Socket Name &#x3D;&gt; 下方的 ToolSocket</li>
</ul>
</li>
</ul>
</li>
<li>下方的 MulticastWeaponEquip<ul>
<li>Target &#x3D;&gt; ThirdPersonEquippedItem</li>
<li>Socket Name &#x3D;&gt; Break S_EquipableInfo 的 SocketName</li>
<li>EquippedState &#x3D;&gt; Break S_EquipableInfo 的 AnimationState</li>
</ul>
</li>
</ul>
<p>OPEN SK_Man_Full_01</p>
<ul>
<li>hand_r <ul>
<li>右键 add socket添加插槽<ul>
<li>rename ToolSocket</li>
<li>右键ToolSocket 增加预览资源 SM_Hatchet</li>
<li>预览动画 - HatchetIdle</li>
<li>详情 调整位置 <ul>
<li>Location：-4.57 1.66 -17</li>
<li>Rotation：19.9 -0(这里可以更斜一些) 70</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_StoneHatchet 类默认值 </p>
<ul>
<li>SocketName ToolSocket</li>
<li>AnimationState Hatchet</li>
<li>FirstPersonEquipClass BP_FP_StoneHatchet</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图 </p>
<ul>
<li>新增 自定义事件 MulticastWeaponEquip 运行在组播中，防止作弊<ul>
<li>Inputs<ul>
<li>Target Actor 对象引用</li>
<li>SocketName Name</li>
<li>EquippedState E_EquipableState</li>
</ul>
</li>
<li>? Is Valid<ul>
<li>False<ul>
<li>组件中的 ThirdPersonMesh 右键 转换成有效的 GET</li>
<li>Attach Actor To Component<ul>
<li>Target &#x3D;&#x3D; Inputs Target </li>
<li>Parent &#x3D;&#x3D; 第三人称网格 </li>
<li>Socket Name 事件的 Input</li>
<li>Location Snap to Target</li>
<li>Rotation Snap to Target</li>
<li>Scale Rule Snap to Target</li>
</ul>
</li>
<li>Set EquippedState<ul>
<li>EquippedState 事件的 Input</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>增加物品Debug<ul>
<li>取消1 key 使用 R key</li>
<li>添加第二个数据表中 也就是斧头</li>
<li>添加到 快捷栏中 BPC Player Hotbar</li>
</ul>
</li>
</ul>
<p>增加 装备可装备的物品 的更新UI逻辑<br>OPEN SurvivalGamePC</p>
<ul>
<li>add 方法 GetInventoryWidget 替换 UpdateItemSlot 和 ResetItemSlot 的 ?IsValid 前的获取逻辑<ul>
<li>Inputs<ul>
<li>ContainerType E_ContainerType</li>
<li>SlotIndex int</li>
</ul>
</li>
<li>ContainerType &#x3D;&gt; Select 返回索引处的选项</li>
<li>Outputs<ul>
<li>Widget W_InventorySlot 对象引用<br><img src="/blog/p/614a8811/GetInventoryWidget.png" alt="GetInventoryWidget.png"></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BPC_ItemsContainer</p>
<ul>
<li>UpdateUI 增加 Player HotBar 连接</li>
</ul>
<p>2玩家，运行后发现 默认是手持空物体，设置 BP_FirstPersonCharacter 的 EquipableState 默认值 Default</p>
<p>运行后还是发现走动会有bug<br>OPEN BP_ItemMaster</p>
<ul>
<li>类默认 Replicates 勾选，能够复制或在多人游戏中使用</li>
</ul>
<p>运行后按R能出现斧头，但是第一人称看不到动画<br>OPEN BP_TP_Hatchet</p>
<ul>
<li>StaticMesh 设置 Owner No See &#x3D; true</li>
</ul>
<p>再次运行，发现第一人称的斧头出现了，但是第三人称的没有出现<br>设置 BP_FP_Hatchet、BP_TP_Hatchet 中的 Static Mesh</p>
<ul>
<li>碰撞预设 Collision Presets 选择 NoCollision</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>增加 Set Owner<ul>
<li>New Owner &#x3D; self</li>
</ul>
</li>
</ul>
<p>改完之后，其他玩家能看到，自己看不到斧头<br>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>创建 自定义事件 SpawnEquipaableFirstPerson 运行在客户端中，防止作弊<ul>
<li>Inputs<ul>
<li>Class Actor 类引用</li>
<li>SocketName Name</li>
</ul>
</li>
</ul>
</li>
<li>SpawnActor<ul>
<li>Return Value 设置变量 FirstPersonEquippedItem</li>
</ul>
</li>
<li>Attach Actor To Component<ul>
<li>Target FirstPersonEquippedItem</li>
<li>Socket Name &#x3D;&gt; SocketName</li>
<li>Location Snap to Target</li>
<li>Rotation Snap to Target</li>
<li>Scale Rule Snap to Target</li>
</ul>
</li>
</ul>
<p>在 SpawnEquipaableThirdPerson 的 MulticastWeaponEquip 最后增加 SpawnEquipaableFirstPerson</p>
<p>思路：</p>
<ol>
<li>1-8快捷键 触发 HotBarOnServer 事件，传递 指定的插槽 Index &#x3D;&gt; UseHotbarFunction</li>
<li>UseHotbarFunction</li>
</ol>
<ul>
<li>检查 Hotbar 指定Index 是否有物品</li>
<li>Switch 快捷键类型 只处理 Equipable</li>
<li>SpawnEquipaableThirdPerson 生成第三人称的物品<ul>
<li>SpawnActor 生成物品</li>
<li>通过 FirstPersonEquippedItem 以及 Get Equipable Ref 获取物品的信息 得到 EquipableInfo 进行 Break 得到具体信息</li>
<li>设置所有者 斧头 不是第一人称可见 ?这里有疑问</li>
<li>MulticastWeaponEquip 组播给所有客户端<ul>
<li>先验证 ? is vali</li>
<li>Attack Actor To Component 附加到第三人称网格</li>
<li>Set EquippedState 设置第三人称网格的装备状态</li>
</ul>
</li>
<li>SpawnEquipaableFirstPerson 生成第一人称的物品<ul>
<li>SpawnActor 生成物品</li>
<li>Attach Actor To Component 附加到第一人称网格</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="32-重复按下快捷键，如果物品已经装备，就卸下物品"><a href="#32-重复按下快捷键，如果物品已经装备，就卸下物品" class="headerlink" title="32 重复按下快捷键，如果物品已经装备，就卸下物品"></a>32 重复按下快捷键，如果物品已经装备，就卸下物品</h4><p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>创建 自定义事件 DequipWeaponThirdPerson 组播运行<ul>
<li>Inputs<ul>
<li>EquippedState E_EquipableState</li>
</ul>
</li>
<li>设置变量 EquippedState &#x3D; default</li>
</ul>
</li>
<li>创建 自定义事件 DequipWeaponFirstPerson 客户端运行<ul>
<li>FirstPersonEquippedItem 进行销毁 Destory Actor</li>
</ul>
</li>
<li>在 UseHotbar 的 判断玩家是否已经装备了物品的分支中<ul>
<li>True<ul>
<li>ThirdPersonEquippedItem 销毁 进行销毁 Destory Actor</li>
<li>组播 DequipWeaponThirdPerson 通知该用户卸下物品</li>
<li>客户端执行 DequipWeaponFirstPerson</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>增加 描述文本</p>
<ul>
<li>装备物品</li>
<li>卸下物品</li>
</ul>
<h4 id="33-装备斧头后，左键挥动"><a href="#33-装备斧头后，左键挥动" class="headerlink" title="33 装备斧头后，左键挥动"></a>33 装备斧头后，左键挥动</h4><p>OPEN BPI_SurvivalCharacter</p>
<ul>
<li>add fun ThirdPersonMontage<ul>
<li>Inputs<ul>
<li>ThirdPersonMontage Montage Object 对象引用</li>
</ul>
</li>
</ul>
</li>
<li>add fun FirstPersonMontage<ul>
<li>Inputs<ul>
<li>FirstPersonMontage Montage Object 对象引用</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BPI_EquipableItem</p>
<ul>
<li>add fun UseItemInterface<ul>
<li>Inputs<ul>
<li>CharRef BP_FirstPersonCharacter 对象引用</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>创建 自定义事件 LeftMouseOnServer 运行在服务器中，防止作弊<ul>
<li>获取 ThirdPersonEquippedItem 转为有效的 GET<ul>
<li>执行 Interface 中的 Use Item Interface<ul>
<li>CharRef &#x3D;&gt; self</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>增加 鼠标左键按下事件 left mouse<ul>
<li>LeftMouseOnServer</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Hatchet 事件图 </p>
<ul>
<li>删除 方法 GetEquipableRef</li>
<li>开始写Interface规范的 UseItemInterface，双击它</li>
<li>EventUseItemInterface<ul>
<li>增加 变量 IsSwinging? bool </li>
<li>Inputs<ul>
<li>CharRef BP_FirstPersonCharacter 对象引用</li>
</ul>
</li>
<li>判断 IsSwinging? bool<ul>
<li>False<ul>
<li>Set IsSwinging? bool &#x3D; true</li>
</ul>
</li>
<li>True<ul>
<li>提升变量 CharRef </li>
<li>FirstPersonMontage(message)<ul>
<li>Hatchet_Chop_Montage Montage 选择的是 Hatchet_Chop 文件 右键创建 AnimMontage</li>
</ul>
</li>
<li>ThirdPersonMontage(message)<ul>
<li>选择的是 Hatchet_Chop 文件 右键创建 AnimMontage</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>创建 自定义事件 MontageMulticast 组播运行<ul>
<li>Inputs<ul>
<li>ThirdPersonMontage &#x3D; Anim Montage Object 对象引用</li>
</ul>
</li>
<li>Play Montage<ul>
<li>骨骼网格组件 &#x3D; ThirdPersonMesh</li>
<li>Montage To Play &#x3D; ThirdPersonMontage</li>
</ul>
</li>
</ul>
</li>
<li>创建 自定义事件 MontageOnClient 客户端运行<ul>
<li>Inputs<ul>
<li>FirstPersonMontage &#x3D; Anim Montage Object 对象引用</li>
</ul>
</li>
<li>Play Montage<ul>
<li>骨骼网格组件 &#x3D; FirstPersonMesh</li>
<li>Montage To Play &#x3D; FirstPersonMontage</li>
</ul>
</li>
</ul>
</li>
<li>开始写 Interface 规范的 FirstPersonMontage，双击它<ul>
<li>MontageOnClient 客户端运行</li>
</ul>
</li>
<li>开始写 Interface 规范的 ThirdPersonMontage，双击它<ul>
<li>MontageMulticast 组播运行</li>
</ul>
</li>
</ul>
<p>OPEN FirstPerson_AnimBP</p>
<ul>
<li>new State Machine</li>
<li>增加一个 Slot DefaultSlot</li>
</ul>
<p>OPEN ThirdPerson_AnimBP</p>
<ul>
<li>new State Machine</li>
<li>增加一个 Slot DefaultSlot</li>
</ul>
<p>运行之后，可以左键挥动斧头了，但是只能挥动一次</p>
<p>OPEN BPI_EquipableItem</p>
<ul>
<li>创建 方法 NotifyInterface</li>
<li>创建 方法 EndAnimation</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>MontageMulticast 方法<ul>
<li>Play Montage 的 完成事件<ul>
<li>获取 ThirdPersonEquippedItem 转为有效的 GET</li>
<li>End Animation</li>
</ul>
</li>
<li>Play Montage 的 通知开始事件<ul>
<li>获取 ThirdPersonEquippedItem 转为有效的 GET</li>
<li>NotifyInterface</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Hatchet 事件图</p>
<ul>
<li>双击 NotifyInterface</li>
<li>双击 End Animation<ul>
<li>设置 IsSwinging? bool &#x3D; false</li>
</ul>
</li>
</ul>
<p>运行后就可以一直挥动斧头了</p>
<p>增加</p>
<p>OPEN Hatchet_Chop_Montage</p>
<ul>
<li>在‘1’行右键 Add Notify<ul>
<li>声音</li>
<li>粒子效果</li>
<li>12的位置 增加 蒙太奇通知 [MontageNotify]</li>
</ul>
</li>
</ul>
<h4 id="34"><a href="#34" class="headerlink" title="34"></a>34</h4><p>下载资源文件<br>创建文件夹</p>
<ul>
<li>_Main&#x2F;Meshes PalmTrees 并且导入所有 Palm 开头的 .fpx 文件<ul>
<li>可以删除 Tree 开头的白色材料 文件</li>
</ul>
</li>
<li>_Main&#x2F;Meshes Materials 并且导入所有 .TGA 文件<ul>
<li>创建 材质 M_PalmMaster<ul>
<li>Base Color 创建 TextureSampleParameter2D 命名 BaseColor<ul>
<li>Texture 是默认的 DefaultTexture</li>
</ul>
</li>
<li>Normal 创建 TextureSampleParameter2D 命名 NormalMap<ul>
<li>Texture 选择 palm02_normal</li>
</ul>
</li>
</ul>
</li>
<li>为 M_PalmMaster 右键 创建 材质实例 M_Palm01<ul>
<li>详情 勾选 Global 的 BaseColor、NormalMap<ul>
<li>BaseColor 设置为 palm02</li>
<li>NormalMap 设置为 palm02_normal</li>
</ul>
</li>
</ul>
</li>
<li>复制 M_Palm01 重命名为 M_Palm02<ul>
<li>BaseColor 设置为 coconut</li>
<li>NormalMap 设置为 coconut_normal</li>
</ul>
</li>
<li>复制 M_Palm02 重命名为 M_Palm03<ul>
<li>BaseColor 设置为 stem</li>
<li>NormalMap 设置为 stem_normal</li>
</ul>
</li>
<li>复制 M_Palm03 重命名为 M_Palm04<ul>
<li>BaseColor 设置为 palm_top</li>
<li>NormalMap 设置为 palm_top_normal</li>
</ul>
</li>
<li>创建 材质 M_PalmLeaf<ul>
<li>复制下列三个文件，到 M_PalmLeaf 中<ul>
<li>coconut_palm_leaf</li>
<li>coconut_palm_leaf_alpha</li>
<li>coconut_palm_leaf_Normal</li>
</ul>
</li>
<li>设置 M_PalmLeaf<ul>
<li>材质 Blend Mode 为 Masked 遮罩</li>
<li>材质 Two Sided 勾选 双面</li>
</ul>
</li>
<li>连接<ul>
<li>绿色 设置为 BaseColor</li>
<li>白色 设置为 透明度遮罩 Opacity Mask </li>
<li>蓝紫色 设置为 Normal</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN Palm_01&#x2F;02&#x2F;03&#x2F;04&#x2F;05 都设置</p>
<ul>
<li>元素0 材质插槽 M_Palm01</li>
<li>元素1 材质插槽 M_Palm02</li>
<li>元素2 材质插槽 M_Palm03</li>
<li>元素3 材质插槽 M_Palm03</li>
<li>元素4 材质插槽 M_PalmLeaf</li>
<li>元素5 材质插槽 M_Palm04</li>
</ul>
<p>将5中树 放到 Map中</p>
<p>创建 下列文件夹 在 _Main&#x2F;Blueprints 目录中</p>
<ul>
<li>HarvestingSystem</li>
<li>HarvestingSystem&#x2F;ChildClasses</li>
<li>HarvestingSystem&#x2F;ChildClasses&#x2F;LargeItemCLasses</li>
<li>HarvestingSystem&#x2F;ChildClasses&#x2F;LargeItemCLasses&#x2F;PalmTress</li>
</ul>
<p>创建蓝图类[Actor]  BP_HarvestableMaster _Main&#x2F;Blueprints&#x2F;HarvestingSystem 目录中<br>并且打开 HarvestableMaster</p>
<ul>
<li>默认类设置 <ul>
<li>Actor Tick 的 Start with Tick Enabled 取消勾选</li>
<li>可复制 Replicates 勾选</li>
</ul>
</li>
</ul>
<p>创建 BP_HarvestableMaster 的蓝图子类 BP_LargeItemMaster<br>创建 BP_HarvestableMaster 的蓝图子类 BP_GroundItemMaster</p>
<p>创建 BPI_LargeItem 的蓝图接口 在 _Main&#x2F;Blueprints&#x2F;Interfaces 目录中</p>
<ul>
<li>add fun GetLargeItemRef<ul>
<li>Outputs<ul>
<li>Ref BP_LargeItemMaster 对象引用</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_LargeItemMaster </p>
<ul>
<li>添加接口 BPI_LargeItem</li>
<li>设置 接口的 GetLargeItemRef<ul>
<li>Ref &#x3D;&gt; self</li>
</ul>
</li>
<li>设置变量 Health float 默认值50</li>
<li>(？这里有疑问) 增加静态网格 Static Mesh 让子类可以设置</li>
</ul>
<p>为 BP_LargeItemMaster 添加蓝图子类 <code>BP_Tree</code> 移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;ChildClasses&#x2F;LargeItemCLasses 目录中</p>
<ul>
<li>设置 静态网格 Static Mesh 为 SM_Tree ?????</li>
</ul>
<p>为 BP_Tree 添加蓝图子类 BP_Palm01 移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;ChildClasses&#x2F;LargeItemCLasses&#x2F;PalmTress 目录中</p>
<ul>
<li>静态网格 改变材质 Palm_01</li>
</ul>
<p>复制 BP_Palm01 重命名为 BP_Palm02</p>
<ul>
<li>静态网格 改变材质 Palm_02</li>
</ul>
<p>复制 BP_Palm01 重命名为 BP_Palm03</p>
<ul>
<li>静态网格 改变材质 Palm_03</li>
</ul>
<p>复制 BP_Palm01 重命名为 BP_Palm04</p>
<ul>
<li>静态网格 改变材质 Palm_04</li>
</ul>
<p>复制 BP_Palm01 重命名为 BP_Palm05</p>
<ul>
<li>静态网格 改变材质 Palm_05</li>
</ul>
<p>如果设置了 BP_Tree 的 静态网格 改变材质 Mobility Static 静态，在Map拖动物体的时候不会出现材质</p>
<h4 id="35-创建收获-砍树掉木头-系统-挥动斧头砍树，能够收获木头"><a href="#35-创建收获-砍树掉木头-系统-挥动斧头砍树，能够收获木头" class="headerlink" title="35 创建收获(砍树掉木头)系统 挥动斧头砍树，能够收获木头"></a>35 创建收获(砍树掉木头)系统 挥动斧头砍树，能够收获木头</h4><p>编辑-项目设置-碰撞-创建对象通道</p>
<ul>
<li>Structure Ignore</li>
</ul>
<p>OPEN BPI_SurvivalCharacter</p>
<ul>
<li>add fun GetArrowLocation<ul>
<li>Outputs<ul>
<li>Location Vector</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>视图 移动 第三人称+第一人称摄像机+第一人称 到胶囊中间</li>
<li>为 胶囊体组件 增加 箭头组件[Arrow] 在 第一人称摄像机下 位置在 胶囊前方 人物胸前</li>
<li>双击 GetArrowLocation 方法<ul>
<li>Location &#x3D;&gt; Arrow1 的 Get World Location</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Hatchet 事件图</p>
<ul>
<li>创建 自定义事件 ServerOverlap 运行在服务器中，防止作弊<ul>
<li>Inputs<ul>
<li>SpherePos Vector</li>
</ul>
</li>
<li>Sphere Overlap Actors<ul>
<li>Radius 60</li>
<li>Object Types &#x3D;&#x3D; Make array &#x3D;&#x3D; [0]Structure</li>
<li>Actors to Ignore &#x3D;&#x3D; Make array &#x3D;&#x3D; [0] &#x3D;&#x3D; CharRef</li>
</ul>
</li>
<li>Draw Debug Sphere<ul>
<li>Location &#x3D;&gt; 方法参数 SpherePos</li>
<li>Radius 60</li>
<li>Segments 12</li>
<li>Color 红色</li>
<li>Duration 10</li>
<li>Thickness 2</li>
</ul>
</li>
</ul>
</li>
<li>创建 自定义事件 GetRotationClient 运行在客户端中，防止作弊<ul>
<li>Get Arrow Location<ul>
<li>目标 Get Owner 的 Return Value</li>
</ul>
</li>
<li>Server Overlap<ul>
<li>SpherePos &#x3D;&gt; Get Arrow Location 的 Location</li>
</ul>
</li>
</ul>
</li>
<li>Event Notify Interface<ul>
<li>Get Rotation Client</li>
</ul>
</li>
</ul>
<p>OPEN BP_Tree</p>
<ul>
<li>设置静态网格 碰撞 Presets 为 Custom<ul>
<li>Object Type Structure</li>
</ul>
</li>
</ul>
<p>运行后 就可以命中树了</p>
<p>OPEN BP_TP_Hatchet 事件图</p>
<ul>
<li>方法 ServerOverlap<ul>
<li>绘制调试球体后<ul>
<li>判断 球体重叠[Sphere Overlap Actors] 的 Return Value<ul>
<li>True<ul>
<li>print string “击中了 树”</li>
<li>For Each Loop</li>
<li>收获叶子[HarvestFoliage]方法 For 的 Loop Body<ul>
<li>Ref 连接 Array Element</li>
<li>设置伤害固定 15</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>print string “没有击中任何东西”</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 收获叶子[HarvestFoliage]<ul>
<li>Inputs<ul>
<li>Damage float</li>
<li>Ref Actor 对象引用</li>
</ul>
</li>
<li>Damage 设置本地变量 LocalDamage</li>
<li>Get Large Item Ref<ul>
<li>思路：获取物品的当前血量，减去伤害，如果血量小于等于0，就销毁物品</li>
<li>减去后的血量 小于等于 0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建文件夹 Destructables 在 _Main&#x2F;Blueprints&#x2F;HarvestingSystem 目录中<br>创建蓝图类Actor BP_DestructableHarvestable _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables 目录中</p>
<p>创建 蓝图结构 S_ResourceStructure 在 _Main&#x2F;Blueprints&#x2F;Structures 目录</p>
<ul>
<li>ResourceId Name</li>
<li>Quantity int 这里临时用了 float</li>
</ul>
<p>创建 蓝图结构 S_LargeItem 在 _Main&#x2F;Blueprints&#x2F;Structures 目录</p>
<ul>
<li>Class BP_DestructableHarvestable 类引用</li>
<li>GivenItems S_ResourceStructure 数组</li>
</ul>
<p>创建 其他-数据表[Miscellaneous Data Table] DT_LargeItemResources 在 _Main&#x2F;DataTables 目录</p>
<ul>
<li>创建文件时的 行结构 S_LargeItem</li>
<li>newRow 重命名 BP_Palm02_C<ul>
<li>ResourceId 1</li>
<li>Quantity 3</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Hatchet 事件图</p>
<ul>
<li>收获叶子[HarvestFoliage]<ul>
<li><code>&gt;=</code> 0的判断后</li>
<li>Get Data Table Row<ul>
<li>Data Table &#x3D;&gt; DT_LargeItemResources</li>
<li>Row Name &#x3D;&gt; Get Large Item Ref 的 Get Class 的 Get Class Name</li>
<li>Output Row &#x3D;&gt; Break S_LargeItem<ul>
<li>设置本地变量 GivenResources</li>
</ul>
</li>
</ul>
</li>
<li>For Each Loop  GivenResources</li>
<li>CharRef 的 Get Survival Character Ref(Message)</li>
<li>Survival Character Ref 的 Harvest Item On Server 下方需要创建<ul>
<li>Resource &#x3D;&gt; For 的 Array Element</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>创建 方法 HarvestItemFunction<ul>
<li>Inputs<ul>
<li>Resource S_ResourceStructure</li>
</ul>
</li>
<li>Break S_ResourceStructure FROM 参数 Resource</li>
<li>Get Data Table Row None<ul>
<li>Data Table &#x3D;&gt; DT_Items</li>
<li>Row Name &#x3D;&gt; Break S_ResourceStructure 的 ResourceId</li>
</ul>
</li>
<li>设置 局部变量 LocalQuantity<ul>
<li>Quantity &#x3D;&gt; Break S_ResourceStructure 的 Quantity</li>
</ul>
</li>
<li>设置局部变量 LocalOutRow<ul>
<li>Output Row &#x3D;&gt; Get Data Table Row None 的 Output Row</li>
</ul>
</li>
<li>Set Member In S_ItemInfo<ul>
<li>勾选 Quantity 并且设置 &#x3D;&#x3D; LocalQuantity</li>
</ul>
</li>
<li>BPC_PlayerInventory 的 Add Item On Server<ul>
<li>Item &#x3D;&#x3D; 上一个 Struct Out</li>
</ul>
</li>
</ul>
</li>
<li>创建 自定义事件 收获物品 HarvestItemOnServer 运行在服务器中，防止作弊<ul>
<li>Inputs<ul>
<li>Resource S_ResourceStructure</li>
</ul>
</li>
<li>调用 方法 HarvestItemFunction</li>
</ul>
</li>
</ul>
<p>运行 R 左键 瞄准 Palm02 树木，发现收获了 3个 木头，除了Palm02其他的收获不到</p>
<h4 id="36-使用斧头砍树收获木头，显示收获的物品"><a href="#36-使用斧头砍树收获木头，显示收获的物品" class="headerlink" title="36 使用斧头砍树收获木头，显示收获的物品"></a>36 使用斧头砍树收获木头，显示收获的物品</h4><p>创建 控件 W_ItemAdded _Main&#x2F;Widgets&#x2F;InventoryWidgets 目录中</p>
<ul>
<li>添加 变量 ResourceImage Texture2D 对象引用<ul>
<li>勾选 Instance Editable&#x2F;Expose On Spawn</li>
</ul>
</li>
<li>添加 变量 ResourceQuantity int<ul>
<li>勾选 Instance Editable&#x2F;Expose On Spawn</li>
</ul>
</li>
<li>添加 变量 ResourceName Text<ul>
<li>勾选 Instance Editable&#x2F;Expose On Spawn</li>
</ul>
</li>
<li>ResourceWindow[size box]  W300 H45<ul>
<li>水平Box<ul>
<li>边界 Brush Color 黑色 透明度 0.5<ul>
<li>水平Box<ul>
<li>size box W40<ul>
<li>Resourceicon [iamge] <code>Padding 5</code>  <code>是变量</code> Brush绑定 ResourceImage</li>
</ul>
</li>
<li>Text Size20 <code>垂直居中</code> <code>获得了</code>   <code>Color And Opacity 蓝色</code></li>
<li>ResourceText Text <code>Size16</code> <code>FIll</code> <code>水平居中</code> <code>x44 石头</code>   <code>Color And Opacity 蓝色</code>  <code>是变量</code> Text绑定 创建 ResourceText 通过 数量和名称拼接<ul>
<li>FormatText<ul>
<li>Format String <code>x&#123;0&#125; &#123;1&#125;</code></li>
<li>Argument 0 <code>是变量</code> 数量</li>
<li>Argument 1 <code>是变量</code> 名称</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN W_MainWidget</p>
<ul>
<li>创建 垂直框 ResourceCollected  <code>布局 左中</code>，并且 Is Variable  W250 H380</li>
<li>创建 自定义事件 ShowItemCollected<ul>
<li>Inputs<ul>
<li>ResourceImage Texture2D 对象引用</li>
<li>ResourceQuantity int</li>
<li>ResourceName Text</li>
</ul>
</li>
<li>Create Widget [construct None]<ul>
<li>Class &#x3D;&gt; W_ItemAdded</li>
<li>ResourceImage &#x3D;&gt; ResourceImage</li>
<li>ResourceQuantity &#x3D;&gt; ResourceQuantity</li>
<li>ResourceName &#x3D;&gt; ResourceName</li>
</ul>
</li>
<li>Resource Collected 的 Add Child<ul>
<li>Content &#x3D;&gt; Create Widget 的 Return Value</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN SurvivalGamePC</p>
<ul>
<li>创建 自定义事件 ShowItemWidget 运行在客户端中，防止作弊<ul>
<li>Inputs<ul>
<li>ResourceImage Texture2D 对象引用</li>
<li>ResourceQuantity int</li>
<li>ResourceName Text</li>
</ul>
</li>
<li>Main Widget Ref 的 Show Item Collected<ul>
<li>ResourceImage &#x3D;&gt; ResourceImage</li>
<li>ResourceQuantity &#x3D;&gt; ResourceQuantity</li>
<li>ResourceName &#x3D;&gt; ResourceName</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>HarvestItemFunction 中 AddItemOnServer 后<ul>
<li>获取 控制器 的 SurvivalGamePCRef<ul>
<li>Show Item Widget<ul>
<li>ResourceImage &#x3D;&gt; LocalOutRow 的 ItemImage</li>
<li>ResourceQuantity &#x3D;&gt; LocalQuantity</li>
<li>ResourceName &#x3D;&gt; LocalOutRow 的 ItemName</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>运行后 砍树收获木头，会在右上角显示收获的物品，但是控件没有自动消失<br>OPEN W_ItemAdded</p>
<ul>
<li>增加 动画 Animations FadeOut <ul>
<li>增加 轨道 Track ResourceWindow<ul>
<li>增加 Track Render Opacity 渲染不透明度<ul>
<li>增加 关键帧 0s 2s 3s</li>
<li>在第三帧 3s 的时候 透明度 0</li>
</ul>
</li>
<li>打开 图示<ul>
<li>Event Construct 创建控件之后<ul>
<li>Fade Out 的 播放动画 Play Animation<ul>
<li>Num Loops To Play 1</li>
<li>Playback Speed 1</li>
</ul>
</li>
<li>绑定到完成的动画 [Bind To Animation Finished] <ul>
<li>Delegate 绑定 创建 自定义事件 DestroySelf<ul>
<li>Remove from Parent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>检查 W_MainWidget 中 Resourceicon 要绑定 ResourceImage</li>
</ul>
<p>运行测试</p>
<p><strong>整体思路</strong><br>鼠标左键</p>
<ul>
<li>BP_FirstPersonCharacter 事件 LeftMouseOnServer 在服务器中运行<ul>
<li>处理 第三人称 可装备的物品<ul>
<li>通过 Char Ref 获取 第三人称装备的物品 并且执行 对应的 UseItemInterface</li>
</ul>
</li>
</ul>
</li>
<li>BP_TP_Hatchet 事件 UseItemInterface<ul>
<li>处理正在挥手</li>
<li>第一人称蒙太奇动画<ul>
<li>BP_FirstPersonCharacter 事件 MontageOnClient 播放蒙太奇，结束</li>
</ul>
</li>
<li>第三人称蒙太奇动画<ul>
<li>BP_FirstPersonCharacter 事件 ThirdPersonMontage</li>
<li>BP_FirstPersonCharacter 事件 MontageMulticast 所有机器上执行</li>
<li>BP_FirstPersonCharacter 事件 NotifyInterface<ul>
<li>BP_TP_Hatchet 事件 NotifyInterface 客户端中运行</li>
<li>BP_TP_Hatchet 事件 GetRotationClient 客户端中运行</li>
<li>BP_TP_Hatchet 事件 ServerOverlap 服务器中运行</li>
<li>BP_TP_Hatchet 事件 Harvest Foliage<ul>
<li>判断血量</li>
<li>指定收货物品 DT_LargeItemResources 木头 数量 3</li>
<li>BP_FirstPersonCharacter 事件 HarvestItemOnServer 收获物品 <ul>
<li>BP_FirstPersonCharacter 事件 HarvestItemFunction 收获物品<ul>
<li>BPC_ItemsContainer 事件 AddItemOnServer 添加物品</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="37-使用斧头砍树，当树木被砍倒时，树木消失，显示树木的倒下动画"><a href="#37-使用斧头砍树，当树木被砍倒时，树木消失，显示树木的倒下动画" class="headerlink" title="37 使用斧头砍树，当树木被砍倒时，树木消失，显示树木的倒下动画"></a>37 使用斧头砍树，当树木被砍倒时，树木消失，显示树木的倒下动画</h4><p>OPEN FirstPersonMap</p>
<ul>
<li>删除 不相关的东西</li>
</ul>
<p>OPEN BP_DestructableHarvestable 事件图</p>
<ul>
<li>类默认设置 关闭 Tick,启用复制</li>
<li>增加 变量 Direction Vector<ul>
<li>勾选 Instance Editable&#x2F;Expose On Spawn</li>
</ul>
</li>
</ul>
<p>为 BP_DestructableHarvestable 添加蓝图子类 BP_DestroyableTree 移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables 目录中<br>OPEN BP_DestroyableTree 事件图</p>
<ul>
<li>增加 胶囊碰撞[Capsule Collision]<ul>
<li>增加静态网格 下面在添加资源</li>
<li>Scale 1 1 9</li>
<li>物理 Physics<ul>
<li>模拟物理 Simulate Physics 开启</li>
<li>Mass in KG 2000</li>
</ul>
</li>
<li>Location 0 0 402 跟树一样的高度<ul>
<li>1 <ul>
<li>位置 -0.000005 60 40</li>
<li>旋转 -70 0 0</li>
<li>缩放 1 1 0.1</li>
</ul>
</li>
<li>2<ul>
<li>位置 -0.000005 -60 40</li>
<li>旋转 70 0 0</li>
<li>缩放 1 1 0.1</li>
</ul>
</li>
<li>3….. 手动调整，数值算不过来</li>
</ul>
</li>
<li>在树顶部 创建四个 胶囊碰撞，分布四周，尾部低一些</li>
</ul>
</li>
<li>静态网格<ul>
<li>资源 Palm_02</li>
</ul>
</li>
<li>事件图<ul>
<li>Event Begin Play<ul>
<li>Switch Has Authority</li>
<li>AddForce 方法</li>
</ul>
</li>
<li>增加局部变量 Force float 1500</li>
<li>增加 方法 AddForce 增加一些力，让树倒在角色对面<ul>
<li>指向 Add Force(Capsule)<ul>
<li>目标是 Capsule</li>
<li>Force &#x3D;&gt; Direction * Force</li>
<li>勾选 Accel Change</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Hatchet 事件图</p>
<ul>
<li>在方法 收获树叶 HarvestFoliage 的 判断 当前血量 &lt;&#x3D; 0 时，调用<ul>
<li>获取数据表行 Get Data Table Row DT_largeItemResources<ul>
<li>Data Table &#x3D;&gt; DT_LargeItemResources</li>
<li>Row Name &#x3D;&gt; Get Large Item Ref 的 Get Class 的 Get Class Name</li>
<li>Output Row<ul>
<li>设置本地变量 LocalDestructClass 类引用</li>
<li>Break S_LargeItem<ul>
<li>Class &#x3D;&gt; 设置局部变量 LocalDestructClass</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Get Large Item Ref 的 Get Actor Transform</li>
<li>Return Value 设置局部变量 LocalTransform</li>
<li>Get Large Item Ref 的 Destroy Actor</li>
<li>SpawnActor<ul>
<li>Class &#x3D;&gt; LocalDestructClass Break S_LargeItem 的 Class</li>
<li>Transform &#x3D;&gt; LocalTransform</li>
<li>Direction &#x3D;&gt; Char Ref &#x3D;&gt; Get Actor Forward Vector</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建文件夹</p>
<ul>
<li>PalmTress 目录 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables 下</li>
</ul>
<p>为 BP_DestroyableTree 添加蓝图子类 BP_PalmDestMaster 移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables 目录中<br>为 BP_PalmDestMaster 添加蓝图子类 BP_PalmDest02 移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables&#x2F;PalmTress 目录中<br>OPEN DT_LargeItemResources 修改 BP_PalmDest02_C 的 Class 为 BP_PalmDest02</p>
<p>运行后 可以砍树 倒树了，但是倒树后，树还在</p>
<p>OPEN Palm_02</p>
<ul>
<li>设置 Collision Presets &#x3D; NoCollision</li>
</ul>
<p>OPEN BP_DestroyableTree 事件图</p>
<ul>
<li>设置 <code>静态网格</code> Collision Presets &#x3D; NoCollision</li>
<li>设置 <code>所有的 碰撞体</code> Collision Presets &#x3D; BlockALl</li>
<li>设置 <code>所有的 碰撞体</code> 物理 Mass 400，营造出头重脚轻</li>
</ul>
<p>OPEN Palm_02</p>
<ul>
<li>查看角度 Simple 碰撞</li>
<li>remove 碰撞</li>
<li>增加 胶囊简化碰撞<ul>
<li>R 键 缩小</li>
<li>移动</li>
<li>调整角度</li>
</ul>
</li>
</ul>
<p>OPEN BP_DestroyableTree 事件图</p>
<ul>
<li>设置 <code>静态网格</code> Collision Presets &#x3D; BlockAllDynamic</li>
</ul>
<p>下面设置可以穿过这棵树<br>OPEN BP_DestroyableTree 事件图</p>
<ul>
<li>设置 <code>所有的 碰撞体</code> 碰撞预设 自定义 Pawn Overlap 勾选</li>
<li>设置 <code>静态网格</code> 碰撞预设 自定义 Pawn Overlap 勾选</li>
</ul>
<p>设置树倒下的动画和延时销毁效果<br>OPEN BP_DestroyableTree 事件图</p>
<ul>
<li>确保 <code>所有的 碰撞体</code> Object Type &#x3D; PhysicsBody</li>
</ul>
<p>OPEN BP_DestructableHarvestable 事件图</p>
<ul>
<li>设置 Direction 变量 复制为 Replicated</li>
</ul>
<p>OPEN BP_DestroyableTree 事件图</p>
<ul>
<li>Authority 和 Remote 都链接 Add Force</li>
<li>事件开始运行 方法 的 AddForce后</li>
<li>Delay 3s<ul>
<li>完成后 Destroy Actor</li>
</ul>
</li>
</ul>
<h4 id="38-相互移动-快捷栏和背包的物品"><a href="#38-相互移动-快捷栏和背包的物品" class="headerlink" title="38 相互移动 快捷栏和背包的物品"></a>38 相互移动 快捷栏和背包的物品</h4><p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>OnSlotDropOnServer 方法 兼容一下 BPC_Player_Hotbar<ul>
<li>换掉 <code>2个 Select</code>， 之前的select是 BPC_Player_Inventory 对象引用</li>
<li>从 参数 拉取 TargetContainerType 的 Select 并且<code>先连接Select的Return Value==OnSlotDrop的目标</code><ul>
<li>就会变成 BPC_ItemsContainer 对象引用</li>
</ul>
</li>
<li>增加 BPC_Player_Hotbar 对象引用</li>
</ul>
</li>
</ul>
<p>OPEN BPC_PlayerHotbar 事件图</p>
<ul>
<li>重写方法 HandleSlotDrop<ul>
<li>删除父类方法</li>
<li>参数 FromContainer 提升为 局部变量 LocalFromContainer</li>
<li>参数 FromIndex 提升为 局部变量 LocalFromIndex</li>
<li>参数 DroppedIndex 提升为 局部变量 LocalDroppedIndex</li>
<li>LocalFromContainer 的 ContainerType -&gt; Switch</li>
<li>LocalFromContainer 的 Transform Item<ul>
<li>接受 Switch 的 PlayerInventory和PlayerHotbar</li>
<li>Target -&gt; LocalFromContainer</li>
<li>To Component -&gt; self</li>
<li>To Specific Index -&gt; LocalDroppedIndex</li>
<li>ItemIndexToTranfser -&gt; LocalFromIndex</li>
</ul>
</li>
<li>Return Node</li>
</ul>
</li>
<li>重写方法 AddItemToIndex<ul>
<li>继承父类方法，继续往下处理</li>
<li>拥有者的 Get Controller from Char</li>
<li>上一个的 Controller Ref 的 UpdateItemSlot<ul>
<li>Target -&gt; Controller Ref</li>
<li>ContainerType -&gt; ContainerType</li>
<li>Index 参数的 Index</li>
<li>ItemInfo？？？？</li>
</ul>
</li>
<li>Return Node</li>
</ul>
</li>
<li>重写方法 RemoveItemByIndex<ul>
<li>和上面一样</li>
</ul>
</li>
</ul>
<p>OPEN BPC_PlayerInventory 事件图</p>
<ul>
<li>HandleSlotDrop<ul>
<li>Transfer Item 中接受多一个 PlayerHotbar</li>
</ul>
</li>
</ul>
<p>OPEN W_ItemContainerGrid</p>
<ul>
<li>方法 AddSlots 中 要区分一下 ContainerType，然后传递给后方<ul>
<li>末尾(Add Slot To Grid方法后) 设置 变量 ContainerType<ul>
<li>设置 新增网格内布的 Item 的 ContainerType</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN W_InventorySlot </p>
<ul>
<li>On Drop 方法，将TargetContainer 用 ContainerType动态替换，之前是写死的</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>可装备的物品Comment</li>
<li>创建 自定义事件 DequipCurrentItemOnServer<ul>
<li>Inputs<ul>
<li>Index int</li>
</ul>
</li>
<li>判断 Index &#x3D;&#x3D; 变量 EquippedIndex<ul>
<li>ThirdPersonEquippedItem 右键 获取有效的第三人称装备物品</li>
<li>销毁 Actor 连接 ThirdPersonEquippedItem</li>
<li>DequipWeaponThirdPerson</li>
<li>DequipWeaponFirstPerson</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BPC_PlayerHotbar</p>
<ul>
<li>方法 RemoveItemByIndex 后面跟</li>
<li>拥有者的 Get Controller from Char<ul>
<li>执行 Controller Ref 的 RemoveItemFromHotbar<ul>
<li>Index &#x3D;&gt; 参数 Index</li>
<li>ContainerType &#x3D;&gt; 参数 ContainerType</li>
</ul>
</li>
</ul>
</li>
<li>拥有者的 Get Survival Char Ref<ul>
<li>执行 Survival Char Ref 的 DequipCurrentItemOnServer<ul>
<li>Index &#x3D;&gt; 参数 Index</li>
</ul>
</li>
</ul>
</li>
<li>Return Node</li>
</ul>
<p>运行 测试 拖动物品从快捷栏到背包，可以卸下物品了</p>
<h3 id="第四章"><a href="#第四章" class="headerlink" title="第四章"></a>第四章</h3><h4 id="39-40-树倒下后延时溶解销毁"><a href="#39-40-树倒下后延时溶解销毁" class="headerlink" title="39 &amp; 40 树倒下后延时溶解销毁"></a>39 &amp; 40 树倒下后延时溶解销毁</h4><p>OPEN M_PalmMaster</p>
<ul>
<li>M_PalmMaster<ul>
<li>选中 M_PalmMaster 混合模式 Blend Mode 为 Masked 遮罩</li>
</ul>
</li>
<li>创建 Texture Sample<ul>
<li>Texture 纹理设置 T_noise01 如果没有，因为是引擎的，所以需要在 <code>文件夹视图中 点击 设置 显示引擎内容</code></li>
<li>RGB <ul>
<li>Add <ul>
<li>B <ul>
<li>创建 Constant<ul>
<li>转换为参数 Convert to Parameter</li>
<li>Rename Dissolve</li>
<li>Default 1</li>
</ul>
</li>
</ul>
</li>
<li>A<ul>
<li>创建 Constant<ul>
<li>转换为参数 Convert to Parameter</li>
<li>Rename Contrast</li>
<li>Default 50</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>A连接 创建 CheapContrast<ul>
<li>连接两个 Contrast</li>
<li>Result 连接到 M_PalmMaster 的 Opacity Mask</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN M_Palm01</p>
<ul>
<li>Global Scalar Parameter Values<ul>
<li>Dissolve </li>
<li>Contrast 会用到它</li>
</ul>
</li>
</ul>
<p>OPEN M_PalmLeaf</p>
<ul>
<li>创建 Texture Sample<ul>
<li>原来的(黑白的、连接了不透明蒙版) Texture Sample RGB 指向创建<ul>
<li>创建 Lerp[LinearInterpolate]</li>
</ul>
</li>
<li>RGB再指向 Leap 的 B<ul>
<li>最后输出到 M_PalmLeaf 的 Opacity Mask</li>
</ul>
</li>
</ul>
</li>
<li>Texture 纹理设置 T_Noise01<ul>
<li>RGB <ul>
<li>Add<ul>
<li>A<ul>
<li>连接 RGB</li>
</ul>
</li>
<li>B <ul>
<li>创建 Constant<ul>
<li>转换为参数 Convert to Parameter</li>
<li>Rename Dissolve</li>
<li>Default 1</li>
<li>连接第二条线到 Lerp 的 Alpha</li>
</ul>
</li>
</ul>
</li>
<li>Return 连接到 Lerp 的 A</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>右键文件 M_PalmLeaf 创建 材质实例</p>
<ul>
<li>Rename M_PalmLeaf_Inst</li>
</ul>
<p>选中 P_Palm01&#x2F;02&#x2F;03&#x2F;04&#x2F;05 右键 编辑</p>
<ul>
<li>全部修改 Element4 为 M_PalmLeaf_Inst</li>
</ul>
<p>开始写溶解的逻辑</p>
<p>OPEN BP_PalmDestMaster 事件图</p>
<ul>
<li>Event 开始播放 - Parent BeginPlay</li>
<li>Delay 10s</li>
<li>将组件的 静态网格 拖入事件图 创建动态材料 Create Dynamic Material Instance<ul>
<li>Target &#x3D;&gt; 静态网格</li>
<li>Material &#x3D;&gt; M_Palm01</li>
<li>因为 静态网格材料有多个，所以需要 循环多次</li>
<li>Return Value 设置静态变量 Mat0</li>
</ul>
</li>
<li>再次 Static Mesh</li>
<li>再次 创建动态材料 Create Dynamic Material Instance<ul>
<li>Target &#x3D;&gt; 静态网格</li>
<li>Material &#x3D;&gt; M_Palm02</li>
<li>因为 静态网格材料有多个，所以需要 For</li>
<li>Return Value 设置静态变量 Mat2</li>
</ul>
</li>
<li>再次 Static Mesh</li>
<li>再次 创建动态材料 Create Dynamic Material Instance<ul>
<li>…</li>
</ul>
</li>
<li>再次 Static Mesh</li>
<li>再次 创建动态材料 Create Dynamic Material Instance<ul>
<li>…</li>
</ul>
</li>
<li>再次 Static Mesh</li>
<li>再次 创建动态材料 Create Dynamic Material Instance<ul>
<li>… 6个，第四个材质选择 M_PalmLeaf_Inst</li>
</ul>
</li>
<li>add Timeline<ul>
<li>取消 Play 接线，使用<code>Play from start</code>接线</li>
<li>Rename FadeWay</li>
<li>Length 5s</li>
<li>增加浮点型轨道 rename float_0<ul>
<li>t0 1</li>
<li>t5 -1 </li>
<li>选中两个关键帧，右键设置为自动</li>
</ul>
</li>
</ul>
</li>
<li>Timeline 的 update &#x3D;&gt; Mat0 然后 设置标量参数值[Set scalar parameter value]<ul>
<li>Target &#x3D;&gt; 变量 Mat0&#x2F;1&#x2F;2&#x2F;3&#x2F;4&#x2F;5</li>
<li>Timeline &lt;&#x3D;&gt; float_0 </li>
<li>Parameter Name &#x3D; Dissolve</li>
</ul>
</li>
<li>Timeline 的 Finished &#x3D;&gt; Static Mesh 的 Set Visibility</li>
</ul>
<p>可以通过如下设置树的销毁时间<br>OPEN BP_DestroyableTree 事件图</p>
<ul>
<li>事件图 的 Delay 10s </li>
<li>类默认设置 初始寿命 Initial Life Span 0</li>
</ul>
<h4 id="41-创建石镐以及相关文件"><a href="#41-创建石镐以及相关文件" class="headerlink" title="41 创建石镐以及相关文件"></a>41 创建石镐以及相关文件</h4><p>下载资源 </p>
<ul>
<li>导入 .jpg 石镐贴图 到 _Main&#x2F;Widgets&#x2F;Textures&#x2F;ItemIcons 目录中</li>
<li>导入 .FBX 文件 <code>材质导入方式 设置为 不创建材料</code> 到 _Main&#x2F;Meshes&#x2F;Equipables 目录中</li>
<li>导入 .png 文件 到 _Main&#x2F;Meshes&#x2F;Equipables&#x2F;Materials 目录中<ul>
<li>创建材质<ul>
<li>Rename M_StonePickMaster<ul>
<li>双击进入编辑</li>
<li>创建 Texture Sample Parameter2D<ul>
<li>Rename BaseColor</li>
<li>RGB 创建 Multiply<ul>
<li>Return Value 连接到 核心的 Base Color</li>
<li>B 创建 Vector Parameter<ul>
<li>Rename Tint 0 0 0 0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Texture Sample Parameter2D<ul>
<li>Rename NormalMap</li>
<li>设置材质文件 DefaultNormal</li>
<li>连接到 核心的 Normal</li>
</ul>
</li>
</ul>
</li>
<li>右键文件 M_StonePickMaster 创建材质实例 M_StonePick01</li>
<li>右键文件 M_StonePickMaster 创建材质实例 M_StonePick02</li>
<li>右键文件 M_StonePickMaster 创建材质实例 M_StonePick03</li>
<li>编辑三个实例文件<ul>
<li>第一个实例文件 参数<ul>
<li>BaseColor 设置为 pickaxe_lowpoly_002_Material_001_BaseMap</li>
<li>NormalMap 设置为 pickaxe_lowpoly_002_Material_001_NorMal</li>
<li>Tint 中间偏上左一点点的灰色 1&#x2F;12 1&#x2F;2 处</li>
</ul>
</li>
<li>第二个实例文件 参数<ul>
<li>BaseColor 设置为 pickaxe_lowpoly_002_Material_002_BaseMap</li>
<li>NormalMap 设置为 pickaxe_lowpoly_002_Material_002_NorMal</li>
<li>Tint 正中间的白色 通过右边直接划到最顶上</li>
</ul>
</li>
<li>第三个实例文件 参数<ul>
<li>BaseColor 设置为 pickaxe_lowpoly_002_Material_BaseMap</li>
<li>NormalMap 设置为 pickaxe_lowpoly_002_Material_NorMal</li>
<li>Tint 棕色 右上角滑块 第一个 2&#x2F;3处  第二个1&#x2F;8处</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN StonePickaxe 静态网格体</p>
<ul>
<li>设置三个材质元素<ul>
<li>0 M_StonePick02</li>
<li>0 M_StonePick03</li>
<li>0 M_StonePick01</li>
</ul>
</li>
</ul>
<p>创建文件夹 Pickaxe 目录 _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipables&#x2F;Tools 目录中<br>为 BP_TP_Hatchet 添加蓝图子类 BP_TP_StonePickaxe 移动到 _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipables&#x2F;Tools&#x2F;Pickaxe 目录中<br>为 BP_FP_Hatchet 添加蓝图子类 BP_FP_StonePickaxe 移动到 _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipables&#x2F;Tools&#x2F;Pickaxe 目录中</p>
<p>OPEN BP_TP_StonePickaxe</p>
<ul>
<li>设置 静态网格 Static Mesh 为 StonePickaxe</li>
</ul>
<p>OPEN BP_FP_StonePickaxe</p>
<ul>
<li>设置 静态网格 Static Mesh 为 StonePickaxe</li>
</ul>
<p>为 石镐 增加 数据表信息<br>OPEN DT_Items</p>
<ul>
<li>新增行<ul>
<li>ID 3</li>
<li>数量1</li>
<li>icon图 StonePickaxe</li>
<li>ItemName 石镐</li>
<li>ItemDescription 一把能够碎石的石镐</li>
<li>ItemClassRef BP_TP_StonePickaxe</li>
<li>ItemType Equipment</li>
<li>ItemCurHp 100</li>
<li>ItemMaxHp 100</li>
<li>伤害 100</li>
</ul>
</li>
</ul>
<p>增加R快捷键 添加一个石镐到快捷栏<br>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>Get Data Table Row<ul>
<li>Row Name 3</li>
</ul>
</li>
</ul>
<p>运行测试，可以在快捷栏中添加石镐了，但是 石镐没有图片 以及 手持的石镐没有显示</p>
<ul>
<li>没有设置图片是因为 图片没有保存，全部保存</li>
<li>手持的石镐没有显示是因为 没有设置 穿戴信息</li>
</ul>
<p>OPEN BP_TP_StonePickaxe</p>
<ul>
<li>类默认设置 穿戴信息<ul>
<li>SocketName 为 ToolSocket</li>
<li>ThirdPersonEquipClass BP_FP_StonePickaxe</li>
</ul>
</li>
</ul>
<p>OPEN BP_FP_StonePickaxe</p>
<ul>
<li>类默认设置 穿戴信息<ul>
<li>SocketName 为 ToolSocket</li>
<li>ThirdPersonEquipClass BP_FP_StonePickaxe</li>
</ul>
</li>
</ul>
<h4 id="42-重写石镐的收获逻辑"><a href="#42-重写石镐的收获逻辑" class="headerlink" title="42 重写石镐的收获逻辑"></a>42 重写石镐的收获逻辑</h4><p>创建 蓝图枚举 E_ToolTier 在 _Main&#x2F;Blueprints&#x2F;Enums 目录中</p>
<ul>
<li>Stone 含义：石头</li>
<li>Iron 含义：铁</li>
</ul>
<p>创建 蓝图枚举 E_HarvestingToolType 在 _Main&#x2F;Blueprints&#x2F;Enums 目录中</p>
<ul>
<li>Pickaxe 含义：石镐</li>
<li>Hatchet 含义：斧头</li>
</ul>
<p>使用枚举<br>OPEN S_ResourceStructure</p>
<ul>
<li>add PreferredToolType E_HarvestingToolType 首选工具类型</li>
</ul>
<p>这时 也需要修改 S_LargeItem 的 GivenItems<br>OPEN S_LargeItem</p>
<ul>
<li>设置 GivenItems S_ResourceStructure</li>
</ul>
<p>OPEN DT_LargeItemResources</p>
<ul>
<li>修改 BP_PalmDest02_C 的 <ul>
<li>ResourceId 为 1</li>
<li>Quantity 为 3</li>
<li>PreferredToolType 为 Hatchet</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Hatchet 事件图</p>
<ul>
<li>增加 变量 ToolType E_HarvestingToolType</li>
<li>增加变量 ToolTier E_ToolTier</li>
<li>HarvestFoliage 方法<ul>
<li>For Each Loop 循环 的 Array Element 导出为 Break 拆分 S_ResourceStructure<ul>
<li>PreferredToolType 导出 相等（枚举） ToolType &#x3D;&#x3D; PreferredToolType 链接下方的 选择浮动的 Pick A</li>
<li>添加数学表达式 [Add Math Expression] (((BaseVar * Rate) * ToolTypeVar) * ToolTierVar) * DamageVar 描述：BaseVar数量 * Rate配置文件中的服务器速率<ul>
<li>BaseVar &#x3D;&gt; Break S_ResourceStructure 的 Quantity</li>
<li>Rate 配置文件中的服务器速率现在设置1</li>
<li>ToolTypeVar &#x3D;&gt; 拖动创建 范围内随机浮点  select flot<ul>
<li>范围内随机浮点 [Random float in range] 作为A<ul>
<li>Min 0.2</li>
<li>Max 0.4</li>
</ul>
</li>
<li>范围内随机浮点 [Random float in range] 作为B<ul>
<li>Min 0.01</li>
<li>Max 0.1</li>
</ul>
</li>
</ul>
</li>
<li>ToolTierVar &#x3D;&gt; 拖动创建 选择 select<ul>
<li>Index A 链接 变量 ToolTier</li>
<li>范围内随机浮点 [Random float in range] 作为 Stone<ul>
<li>Min 0.8</li>
<li>Max 1.2</li>
</ul>
</li>
<li>范围内随机浮点 [Random float in range] 作为 Lron<ul>
<li>Min 1.2</li>
<li>Max 1.6</li>
</ul>
</li>
</ul>
</li>
<li>DamageVar 链接 局部变量 LocalDamage</li>
<li>Return Value Truncate 作为整数</li>
<li>作为整数 并且 设置本地变量 LocalResourceQuantity</li>
</ul>
</li>
<li>HarvestItemOnServer 的 Resource 拖动创建资源结构 Make S_ResourceStructure<ul>
<li>ResourceId &#x3D;&gt; Break S_ResourceStructure 的 ResourceId</li>
<li>Quantity &#x3D;&gt; LocalResourceQuantity</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>增加斧头砍树能收货更多木头的逻辑<br>因为运算公式中包含了 首选工具类型，所以自动适配了斧头和石镐<br>OPEN BP_TP_StoneHatchet 事件图<br>可装备信息</p>
<ul>
<li>ToolType 为 Hatchet</li>
<li>ToolTier 为 Stone</li>
</ul>
<p>注意事项：</p>
<ul>
<li>梳理 斧头 和 石镐 的 首选武器类型，两个都应该在子类设置</li>
</ul>
<p>最后检查：<br>DT_Items</p>
<ul>
<li>斧头 视频是 BP_TP_StoneHatchet</li>
<li>石镐 视频是 BP_TP_StonePickaxe</li>
</ul>
<p>BP_EquipableMaster</p>
<ul>
<li>GetEquipableRef 对自身引用</li>
</ul>
<p>BP_FirstPersonCharacter</p>
<ul>
<li>第一人称静态网格 拥有者不可见</li>
<li>第三人称静态网格 仅拥有者可见</li>
<li>事件图<ul>
<li>生成 Actor 后 要设置拥有者为 self 也就是 BP_FirstPersonCharacter 这样网格设置的不可见才有效</li>
<li>第一人称生成Actor+</li>
<li>第三人称生成Actor+</li>
</ul>
</li>
</ul>
<p>斧头 和 石镐 的父类 BP_TP_Hatchet</p>
<ul>
<li>拥有者不可见</li>
</ul>
<p>斧头 和 石镐 的父类 BP_TP_Hatchet</p>
<ul>
<li>仅拥有者可见</li>
</ul>
<p>Hatchet</p>
<ul>
<li>BP_FP_StoneHatchet<ul>
<li>SocketName 为 ToolSocket</li>
<li>ThirdPersonEquipClass 不设置</li>
</ul>
</li>
<li>BP_TP_StoneHatchet 静态网格<ul>
<li>拥有者不可见</li>
<li>FirstPersonEquipClass  BP_FP_StoneHatchet</li>
</ul>
</li>
</ul>
<p>Pickaxe</p>
<ul>
<li>BP_FP_StonePickaxe<ul>
<li>SocketName 为 ToolSocket</li>
<li>ThirdPersonEquipClass 不设置</li>
</ul>
</li>
<li>BP_TP_StonePickaxe 静态网格<ul>
<li>拥有者不可见</li>
<li>FirstPersonEquipClass  BP_FP_StonePickaxe</li>
</ul>
</li>
</ul>
<h4 id="43-石头碎裂效果"><a href="#43-石头碎裂效果" class="headerlink" title="43 石头碎裂效果"></a>43 石头碎裂效果</h4><p>岩石可破坏类</p>
<p>创建目录 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;ChildClasses&#x2F;LargeItemClasses</p>
<p>为 BP_LargeItemMaster [搜索文件名] 创建蓝图子类 BP_Rock 移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;ChildClasses&#x2F;LargeItemClasses 目录中</p>
<p>添加 虚幻引擎资源 Get Content &#x3D;&gt; Quixel Bridge &#x3D;&gt; 3D Assets ，下载完之后会出现文件夹</p>
<ul>
<li>关键词：beach bolder</li>
<li>中等质量下载</li>
</ul>
<p>OPEN BP_Rock</p>
<ul>
<li>设置 静态网格 S_Beach_Boulder_ukopeijs_lod3_Var1</li>
</ul>
<p>创建目录 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;ChildClasses&#x2F;LargeItemClasses&#x2F;Rocks<br>为 BP_Rock 创建蓝图子类 BP_BeachRock01 </p>
<ul>
<li>移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;ChildClasses&#x2F;LargeItemClasses&#x2F;Rocks 目录中</li>
</ul>
<p>OPEN DT_LargeItemResources</p>
<ul>
<li>新增行<ul>
<li>Row Mame BP_BeachRock01_C</li>
<li>GivenItems<ul>
<li>Index[0]<ul>
<li>ResourceId 4</li>
<li>Quantity 3</li>
<li>PreferredToolType Pickaxe</li>
</ul>
</li>
<li>Index[1]<ul>
<li>ResourceId 5</li>
<li>Quantity 1</li>
<li>PreferredToolType Pickaxe</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN DT_Items</p>
<ul>
<li>新增行<ul>
<li>ID 4</li>
<li>数量1</li>
<li>icon图 tex_stone_09_b</li>
<li>ItemName 石头</li>
<li>ItemDescription 一块石头</li>
<li>ItemClassRef None</li>
<li>ItemType Resource</li>
<li>可堆叠</li>
<li>堆叠数量 100</li>
<li>ItemRarity Common</li>
</ul>
</li>
<li>新增行<ul>
<li>ID 5</li>
<li>数量1</li>
<li>icon图 tex_stone_07_b</li>
<li>ItemName 铁矿</li>
<li>ItemDescription  一块铁矿</li>
<li>ItemClassRef None</li>
<li>ItemType Resource</li>
<li>可堆叠</li>
<li>堆叠数量 100</li>
<li>ItemRarity Common</li>
</ul>
</li>
</ul>
<p>为 BP_DestructableHarvestable 添加蓝图子类 BP_DestructableRock<br>OPEN BP_DestructableRock</p>
<ul>
<li>添加组件 几何体集 [Geometry Collection]</li>
</ul>
<p>Map中 添加 S_Beach_Boulder_ukopeijs_lod3_Var1</p>
<ul>
<li>选择 爆裂模式 Fracture Shift+6</li>
<li>创建一个 几何集合<ul>
<li>目录：_Main&#x2F;Meshes&#x2F;DestructableMeshes 右键先创建</li>
</ul>
</li>
<li>点击统一<ul>
<li>Min Voronoi Sites 20</li>
<li>Max Voronoi Sites 20</li>
</ul>
</li>
<li>然后从map中删除，因为已经创建了几何集合文件</li>
</ul>
<p>OPEN BP_DestructableRock</p>
<ul>
<li>几何体集 [Geometry Collection]<ul>
<li>设置 混沌物理 其他集 S_Beach_Boulder_ukopeijs_lod3_Var1_GeometryCollection 几何体集文件</li>
</ul>
</li>
</ul>
<p>增加力量，让石头碎开</p>
<p>创建蓝图类 破坏类 fieldSystemActor BP_DestructionForce 移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables 目录中<br>OPEN it 增加力量</p>
<ul>
<li>增加组件 径向衰减 [Radial Falloff]</li>
<li>增加组件 Sphere Collision</li>
<li>事件图 Event BeginPlay</li>
<li>Field System 组件的 添加临时场 [Add Transient Field]<ul>
<li>Enable Field 勾选</li>
<li>Physics Type &#x3D;&gt; 外部张力 [External Strain]</li>
<li>Field Node &#x3D;&gt; 组件 Radial Falloff 的 Set Radial Falloff 的 Return Value<ul>
<li>Field Magnitude &#x3D;&gt; 500000</li>
<li>Sphere Radius &#x3D;&gt; Sphere 的 Get Scaled Sphere Radius 的 Return Value</li>
<li>Center Position &#x3D;&gt; Sphere 的 Get World Location 的 Return Value</li>
</ul>
</li>
</ul>
</li>
<li>延迟 2s</li>
<li>Destroy Actor</li>
</ul>
<p>OPEN BP_DestructableRock</p>
<ul>
<li>Event BeginPlay</li>
<li>创建 Actor [Spawn Actor]<ul>
<li>Class &#x3D;&gt; BP_DestructionForce</li>
<li>Transform &#x3D;&gt; 右键 拆分引脚 后的 <code>Spawn Transform Location</code> FROM <code>Get Actor Location </code></li>
</ul>
</li>
<li>延迟 8s</li>
<li>Destroy Actor</li>
</ul>
<p>创建文件夹 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables&#x2F;Rocks<br>为 BP_DestructableRock 创建蓝图子类 BP_BeachRockDest01 移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables&#x2F;Rocks 目录中</p>
<p>OPEN DT_LargeItemResources</p>
<ul>
<li>设置 BP_BeachRock01_C 的<ul>
<li>Class BP_BeachRockDest01</li>
</ul>
</li>
</ul>
<p>Map 中 拖入 BP_BeachRock01，石镐破坏石头，一直提示没有击中，因为没有设置碰撞</p>
<p>OPEN S_Beach_Boulder_ukopeijs_lod3_Var1  注意 <code>不是几何体集文件</code></p>
<ul>
<li>碰撞<ul>
<li>增加 26DOP 简单碰撞</li>
</ul>
</li>
</ul>
<p>OPEN BP_Rock</p>
<ul>
<li>静态网格 碰撞 </li>
<li>碰撞预设 自定义</li>
<li>Object Type Structure</li>
</ul>
<p>这里保存之后可能无法刷新map中石头的属性，所以需要重新打开一下map或者删除石头重新拖入</p>
<p>因为 BP_TP_Hatchet 中 ServerOverlap方法中 只重叠了 Structure 的碰撞，所以设置好之后 就可以重叠了</p>
<p>运行，重试，发现掉落的物品 有0数量的</p>
<p>OPEN BP_TP_Hatchet 收获逻辑中 加判断</p>
<ul>
<li>如果当前数量&lt;&#x3D; 0 则不收获</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>发送石镐</li>
</ul>
<p>运行，重试，发现掉落的物品 会卡主角色</p>
<p>OPEN BP_DestructableRock</p>
<ul>
<li>碰撞 自定义碰撞<ul>
<li>Pawn 设置 Overlap 重叠</li>
</ul>
</li>
</ul>
<p>运行，重试，发现角色会穿过 树 和石头<br>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>碰撞 自定义碰撞<ul>
<li>Structure 设置 Block 阻止</li>
</ul>
</li>
</ul>
<p>运行，重试，石头不碎了</p>
<p>OPEN BP_DestructableForce</p>
<ul>
<li>Sphere<ul>
<li>变换 Scale 缩放 2 2 2  <code>球体zxy方向放大2倍</code></li>
</ul>
</li>
</ul>
<p>OPEN BP_DestructableRock</p>
<ul>
<li>Geometry Collection<ul>
<li>混沌物理 [Chaos Physics]<ul>
<li>Clustering</li>
<li>集群分组损坏阈值 [Cluster GroupingDamage Threshold]<ul>
<li>5000</li>
<li>500</li>
<li>50</li>
</ul>
</li>
</ul>
</li>
<li>碰撞 自定义碰撞<ul>
<li>Pawn Overlap 重叠</li>
<li>Structure Ignore 忽略</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>问题：<br>涉及到石头碎裂程度的地方有：</p>
<ul>
<li>BP_DestructableForce<ul>
<li>Sphere<ul>
<li>缩放</li>
</ul>
</li>
</ul>
</li>
<li>BP_DestructableRock<ul>
<li>Geometry Collection<ul>
<li>混沌物理 [Chaos Physics]<ul>
<li>Clustering</li>
<li>集群分组损坏阈值 [Cluster GroupingDamage Threshold] <code>这里还有问题，调大调小没有效果</code><ul>
<li>5000</li>
<li>500</li>
<li>50</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>设置径向衰减 [Radial Falloff]<ul>
<li>Field Magnitude &#x3D;&gt; 500000</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>但是修改了一些参数没效果，后期不上 TODO FIXME</p>
<h4 id="44-灌木丛UI、拾取逻辑以及拾取动作"><a href="#44-灌木丛UI、拾取逻辑以及拾取动作" class="headerlink" title="44 灌木丛UI、拾取逻辑以及拾取动作"></a>44 灌木丛UI、拾取逻辑以及拾取动作</h4><p>添加 虚幻引擎资源 Get Content &#x3D;&gt; Quixel Bridge &#x3D;&gt; 3D Plants ，下载完之后会出现文件夹</p>
<ul>
<li>关键词：tropical palm Fresh Healthy 灌木丛  特征：叶子最大 三个叶子</li>
<li>中等质量下载</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图<br>增加 E 键 拾取逻辑</p>
<ul>
<li>E key<ul>
<li>InteractOnServer</li>
</ul>
</li>
<li>创建 自定义事件 服务器上运行 InteractOnServer<ul>
<li>OverlapGroundItems(重叠地面上的物品)</li>
</ul>
</li>
<li>创建 自定义事件 服务器上运行 OverlapGroundItems<ul>
<li>球体 重叠 Actors [Sphere Overlap Actors]<ul>
<li>Sphere Pos &#x3D;&gt; Get Actor Location</li>
<li>Object Type &#x3D;&gt; Make Array [0] WorldStatic 只和 WorldStatic 的进行重叠</li>
<li>Actors to Ignore &#x3D;&gt; Make Array [0] self 忽略第三人称的 Actor</li>
</ul>
</li>
<li>Draw Debug Sphere<ul>
<li>Location &#x3D;&gt; Get Actor Location 在当前的Actor的位置</li>
<li>Radius &#x3D;&gt; 70</li>
<li>Line Color &#x3D;&gt; 红色</li>
<li>Duration &#x3D;&gt; 3</li>
<li>Thickness &#x3D;&gt; 2</li>
</ul>
</li>
<li>判断 球体重叠Actors 的 Return Value<ul>
<li>打印 重叠 &#x2F; 没有重叠</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建 文件夹 GroundItemClasses 目录 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;ChildClasses 下 放置 岩石、地面</p>
<p>OPEN BP_GroundItemMaster</p>
<ul>
<li>创建 静态网格 <ul>
<li>设置 静态网格 S_Tropical_Palm_rkqjj_Var1_lod1</li>
</ul>
</li>
<li>增加变量 Health float <ul>
<li>默认值 50</li>
</ul>
</li>
<li>设置碰撞预设<ul>
<li>自定义</li>
<li>Object WorldStatic</li>
<li>Pawn Overlap 重叠</li>
</ul>
</li>
</ul>
<p>创建蓝图接口 BPI_GroundItem 目录 _Main&#x2F;Blueprints&#x2F;Interfaces 下<br>OPEN it</p>
<ul>
<li>创建方法 GetGroundItemRef<ul>
<li>Outputs<ul>
<li>Ref BP_Ground_Item_Master Object Reference</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_GroundItemMaster 增加接口</p>
<ul>
<li>类设置 BPI_GroundItem</li>
<li>双击 GetGroundItemRef<ul>
<li>对自身引用</li>
</ul>
</li>
</ul>
<p>为 BP_GroundItemMaster 创建子类 BP_TropicalBush01 移动到 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;ChildClasses&#x2F;GroundItemClasses 目录中</p>
<p>创建文件夹 TropicalBushes 目录 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;ChildClasses&#x2F;GroundItemClasses 目录中<br>移动 BP_TropicalBush01 到 TropicalBushes 目录中</p>
<p>为 资源 增加碰撞 S_Tropical_Palm_rkqjj_Var1_lod1  OPEN it</p>
<ul>
<li>碰撞 球体简单碰撞<ul>
<li>调小半径 tips:右上角小icon 选择 旋转右边的 缩放</li>
</ul>
</li>
</ul>
<p>Map 中 添加 BP_TropicalBush01 子类，运行测试，e键可以命中了</p>
<p>接下来，需要在地面上放置一些资源</p>
<p>OPEN DT_Items</p>
<ul>
<li>增加行 浆果<ul>
<li>RowName 6</li>
<li>ID 6</li>
<li>数量 1</li>
<li>icon图 tex_herbs_05_b</li>
<li>ItemName 浆果</li>
<li>ItemDescription 浆果，可以食用恢复血量</li>
<li>ItemClassRef None</li>
<li>可堆叠</li>
<li>堆叠数量 100</li>
</ul>
</li>
<li>增加行 叶子<ul>
<li>RowName 7</li>
<li>ID 7</li>
<li>数量 1</li>
<li>icon图 tex_herbs_06_b</li>
<li>ItemName 叶子</li>
<li>ItemDescription 一片叶子</li>
<li>ItemClassRef None</li>
<li>可堆叠</li>
<li>堆叠数量 100</li>
</ul>
</li>
</ul>
<p>创建 其他-数据表 PICK &#x3D;&gt; S_LargeItem 名字 DT_GroundResources  在 _Main&#x2F;DataTables 目录中</p>
<ul>
<li>新增行<ul>
<li>BP_TropicalBush01_C</li>
<li>GivenItems<ul>
<li>浆果<ul>
<li>ResourceId 6</li>
<li>Quantity 3</li>
<li>PreferredToolType Pickaxe</li>
</ul>
</li>
<li>叶子<ul>
<li>ResourceId 7</li>
<li>Quantity 1</li>
<li>PreferredToolType Pickaxe</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>创建 方法 HarvestGroundItem<ul>
<li>Inputs<ul>
<li>Ref Actor Object Reference</li>
</ul>
</li>
<li>GetGroundItemRef(Message) &#x3D;&gt; Ref</li>
<li>地面的物品 当前血量 扣减 15</li>
<li>判断 当前血量 &lt;&#x3D; 0<ul>
<li>false<ul>
<li>通过数据表 获取物品 Get Data Table Row<ul>
<li>Row Table &#x3D;&gt; DT_GroundResources</li>
<li>Row Name &#x3D;&gt; 物品的类名 [ Ref &#x3D;&gt; Get Class &#x3D;&gt; Get Class Display Name]</li>
<li>Out Row &#x3D;&gt; break 后 的 GivenItems(设置了两个物品) 设置局部变量 LocalGivenResources</li>
</ul>
</li>
<li>对GivenItems进行循环<ul>
<li>For Each Loop LocalGivenResources<ul>
<li>Array Element<ul>
<li>Break S_ResourceStructure<ul>
<li>ResourceId &#x3D;&gt; Array Element 的 ResourceId</li>
<li>Quantity &#x3D;&gt; Array Element 的 Quantity</li>
</ul>
</li>
</ul>
</li>
<li>数学表达式 [Math Expression] (BaseVar * RateVar) * RandomVar<ul>
<li>BaseVar &#x3D;&gt; Break S_ResourceStructure 的 Quantity</li>
<li>RateVar &#x3D;&gt; 1</li>
<li>RandomVar &#x3D;&gt; 范围内随机浮点 [Random float in range]<ul>
<li>Min 0.3</li>
<li>Max 1.2</li>
</ul>
</li>
<li>Return Value Truncate 作为整数</li>
<li>作为整数 并且 设置本地变量 LocalQuantity</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>增加 LocalQuantity &lt;&#x3D;0 的判断</li>
<li>HarvestItemOnServer<ul>
<li>创建 S_ResourceStructure<ul>
<li>ResourceId &#x3D;&gt; Break S_ResourceStructure 的 ResourceId</li>
<li>Quantity &#x3D;&gt; LocalQuantity</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>角色 与 GroundItemMaster 重叠的灌木丛 Actor<ul>
<li>HarvestGroundItem <ul>
<li>Ref &#x3D; 重叠的 Actors &#x3D;&gt; copy</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN FirstPersonMap 导入静态文件 S_Tropical_Palm_rkqjj_Var1_lod1</p>
<ul>
<li>选择 S_Tropical_Palm_rkqjj_Var1_lod1 后 Shift 6</li>
<li>创建几何集合<ul>
<li>目录：_Main&#x2F;Meshes&#x2F;DestructableMeshes 右键先创建</li>
<li>点击统一</li>
<li>生成后，右侧是 selected:100</li>
</ul>
</li>
<li>删除静态文件</li>
</ul>
<p>为 BP_DestructableHarvestable 添加蓝图子类 BP_GroundItemDestruct 在 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables 目录中</p>
<ul>
<li>增加组件 几何体集 [Geometry Collection]<ul>
<li>几何体 静态网格 S_Tropical_Palm_rkqjj_Var1_lod1_GeometryCollection</li>
<li>碰撞预设<ul>
<li>自定义<ul>
<li>Pawn Overlap 重叠 ,不然角色会卡住</li>
</ul>
</li>
</ul>
</li>
<li>集群分组损坏阈值 [Cluster GroupingDamage Threshold] 破坏值高的话 效果会差<ul>
<li>5000</li>
<li>500</li>
<li>50</li>
</ul>
</li>
</ul>
</li>
<li>事件图<ul>
<li>Event BeginPlay</li>
<li>Spawn Actor from Class BP_DestructionForce<ul>
<li>Class BP_DestructionForce</li>
<li>Spawn Transform &#x3D;&gt; 右键 拆分引脚 后的 <code>Spawn Transform Location</code> FROM <code>Get Actor Location</code></li>
</ul>
</li>
<li>Delay 5s</li>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
<p>创建文件夹 _Main&#x2F;Blueprints&#x2F;HarvestingSystem&#x2F;Destructables&#x2F;Blushes<br>为 BP_GroundItemDestruct 创建蓝图子类 BP_TropicalBush01Dest 移动到 Blushes</p>
<p>设置数据表 DT_GroundResources</p>
<ul>
<li>Class<ul>
<li>增加破坏类 BP_TropicalBush01Dest_C</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>HarvestGroundItem<ul>
<li>如果当前的血量 &lt;&#x3D; 则销毁<ul>
<li>Get Data Table Row DT_GroundResources<ul>
<li>Row Name &#x3D;&gt; 物品的类名 [ Ref &#x3D;&gt; Get Class &#x3D;&gt; Get Class Display Name]</li>
<li>Out Row Break<ul>
<li>Class 设置局部变量 LocalDestructableClass</li>
<li>?Is Valid 物品的ref 是否有效<ul>
<li>设置局部变量 LocalTransform FROM 物品的ref &#x3D;&gt; Get Actor Transform</li>
</ul>
</li>
<li>Destroy Actor 物品的ref</li>
<li>Spawn Actor None 生成破坏类<ul>
<li>Class &#x3D;&gt; LocalDestructableClass</li>
<li>Spawn Transform &#x3D;&gt; LocalTransform</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>增加视觉提示UI，播放蒙太奇</p>
<ul>
<li>核心：</li>
</ul>
<p>创建蒙太奇文件 Pickup_Montage FROM 动画 Pickup</p>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>增加变量 ?IsHarvesting bool</li>
<li>创建 自定义事件 服务器上运行 HarvestMontageOnServer<ul>
<li>判断是否正在收获 ?IsHarvesting<ul>
<li>false<ul>
<li>设置 ?IsHarvesting 为 true</li>
<li>播放蒙太奇 Play Montage<ul>
<li>在 第三人称网格组件 ThirdPersonMesh 播放蒙太奇</li>
<li>Montage &#x3D;&gt; Pickup_Montage</li>
<li>Play Rate &#x3D;&gt; 1</li>
<li>播放完成后<ul>
<li>设置 ?IsHarvesting 为 false</li>
</ul>
</li>
</ul>
</li>
<li>MontageOnClient 在客户端上播放</li>
<li>MontageMulticast 在组播上播放</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>事件 OverlapGroundItems 的 重叠 HarvestGroundItem 后<ul>
<li>HarvestMontageOnServer</li>
</ul>
</li>
<li>事件 MontageMulticast 的 EndAnimation 下方 第三人称持有武器物品 如果没有验证成功 将 ?IsHarvesting 设置为 false</li>
</ul>
<h4 id="45-修复动画蓝图下半身突兀的BUG"><a href="#45-修复动画蓝图下半身突兀的BUG" class="headerlink" title="45 修复动画蓝图下半身突兀的BUG"></a>45 修复动画蓝图下半身突兀的BUG</h4><p>动画中身体下半部分很突兀，设置只有身体上半部分动画</p>
<p>OPEN ThirdPerson_AnimBP</p>
<ul>
<li>状态引擎 [New State Machine] 拆分引脚<ul>
<li>连接 新保存的缓存姿势<ul>
<li>Rename Cache</li>
</ul>
</li>
</ul>
</li>
<li>拆分到了这 每个骨骼的分层混合 [Layered blend per bone]<ul>
<li>Base Pose &#x3D;&gt; 使用缓存姿势 [Use cached pose ‘Cache’]</li>
<li>Blend Poses 0 &#x3D;&gt; 使用缓存姿势 [Use cached pose ‘Cache’] 的 Slot ‘DefaultSlot’</li>
<li>Return 输出姿势</li>
</ul>
</li>
<li>点击 分层混合 详情<ul>
<li>层设置 [Layer Setup]<ul>
<li>创建元素<ul>
<li>分支过滤器 [Branch Filters]<ul>
<li>创建元素<ul>
<li>Bone Name &#x3D;&gt; spine_01(骨骼腰部) 选择的是骨骼的名称</li>
<li>Blend Depth &#x3D;&gt; 1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN UE4_Mannequin_Skeleton 可以查看</p>
<p><img src="/blog/p/614a8811/ThirdPerson_AnimBP%E6%AF%8F%E4%B8%AA%E9%AA%A8%E9%AA%BC%E7%9A%84%E5%88%86%E5%B1%82%E6%B7%B7%E5%90%88.png" alt="ThirdPerson_AnimBP每个骨骼的分层混合.png"></p>
<h4 id="46-背包物品堆叠功能"><a href="#46-背包物品堆叠功能" class="headerlink" title="46 背包物品堆叠功能"></a>46 背包物品堆叠功能</h4><p>物品堆叠功能</p>
<ul>
<li><p>加入物品时检测</p>
</li>
<li><p>检测物品是否可以堆叠</p>
<ul>
<li>While 循环 判断未添加的数量<ul>
<li>同类物品 &amp; 可堆叠数量</li>
<li>return<ul>
<li>?IsStackable bool</li>
<li>Index int</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>堆叠物品</p>
<ul>
<li>增加数量</li>
<li>移除物品</li>
</ul>
</li>
<li><p>创建方法 HasItemsToStack</p>
<ul>
<li>Inputs<ul>
<li>ItemInfo S_ItemInfo</li>
</ul>
</li>
<li>Outputs<ul>
<li>?ItemExistsInInv bool</li>
</ul>
</li>
<li>设置局部变量 LocalItemInfo</li>
<li>For Each Loop with Break<ul>
<li>Array &#x3D;&gt; LocalItemInfo</li>
</ul>
</li>
<li>Break FROM Array Element<ul>
<li>判断 LocalItemInfo 和 循环体内的 ItemInfo id 是否相等<ul>
<li>false<ul>
<li>continue</li>
</ul>
</li>
<li>true<ul>
<li>判断 LocalItemInfo 和 循环体内的 ItemInfo 是否可堆叠<ul>
<li>false<ul>
<li>continue</li>
</ul>
</li>
<li>true<ul>
<li>?ItemExistsInInv 设置为 true</li>
<li>break</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>优化：</p>
<ul>
<li>Select Int</li>
<li>And Bool</li>
<li>Clamp(Integer) 限制最大值<ul>
<li>Mix</li>
<li>Max</li>
</ul>
</li>
</ul>
<p>用图表示</p>
<p><code>这里存在问题</code>，当一次获取很多个物品时，外部只是 增加了最多一个对象的UI展示，但是实际上增加了很多个对象，这里需要优化</p>
<h4 id="47-添加收获功能的视觉特效和声音"><a href="#47-添加收获功能的视觉特效和声音" class="headerlink" title="47 添加收获功能的视觉特效和声音"></a>47 添加收获功能的视觉特效和声音</h4><p>下载UE引擎资源 </p>
<ul>
<li>打开引擎市场 </li>
<li>search <ul>
<li>Starter VFX Pack</li>
</ul>
</li>
<li>安装</li>
</ul>
<p>下载 音效资源文件，导入 创建的文件夹 _Main&#x2F;Sounds&#x2F;Harvesting</p>
<p>创建 声音 声音CUE文件</p>
<ul>
<li>Rename SC_RockDestroy</li>
<li>OPEN it, 随机选择一个音效播放</li>
<li>Random<ul>
<li>in<ul>
<li>Wave Player：RockDestroy1</li>
<li>Wave Player：RockDestroy2</li>
<li>Wave Player：RockDestroy3</li>
</ul>
</li>
</ul>
</li>
<li>调制器 [Modulator]<ul>
<li>Pitch Min 0.95</li>
<li>Pitch Max 1.05</li>
<li>Volume Min 0.95</li>
<li>Volume Max 1.05</li>
</ul>
</li>
<li>Modulator 的 Output &#x3D;&gt; 喇叭</li>
</ul>
<p>复制 P_Destruction_Concrete 粒子效果</p>
<ul>
<li>Rename P_DestructionRock</li>
<li>OPEN it</li>
<li>双击删除 Emitters 中的 derbis_a</li>
<li>TIPS<ul>
<li>空格键能看到效果</li>
</ul>
</li>
</ul>
<p>复制 P_Ceramic 粒子效果</p>
<ul>
<li>Rename P_PickaxeHit</li>
<li>OPEN it</li>
<li>删除 Emitters 中的 sparks</li>
<li>删除 Emitters 中的 glow</li>
</ul>
<p>创建 声音衰减文件 HarvestingAtt 保存到 _Main&#x2F;Sounds&#x2F;Harvesting 目录中</p>
<p>OPEN BP_DestructableRock 事件图</p>
<ul>
<li>创建 自定义事件 组播运行 MulticastFX<ul>
<li>Spawn Emitter at Location<ul>
<li>Emitter Template &#x3D;&gt; P_DestructionRock</li>
<li>Location &#x3D;&gt; Get Actor Location</li>
<li>Rotation &#x3D;&gt; Get Actor Rotation</li>
</ul>
</li>
</ul>
</li>
<li>Event BeginPlay 创建破坏类后面<ul>
<li>MulticastFX</li>
<li>Play Sound at Location<ul>
<li>Sound &#x3D;&gt; SC_RockDestroy</li>
<li>Location &#x3D;&gt; Get Actor Location</li>
<li>Attenuation Settings &#x3D;&gt; HarvestingAtt</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>运行测试石头，可以看到破碎云效果和声音.</p>
<p>将声音设置成</p>
<ul>
<li>指定半径内播放</li>
<li>距离衰减</li>
</ul>
<p>OPEN BP_TP_Hatchet</p>
<ul>
<li>创建 自定义事件 组播运行 HitFXMulticast<ul>
<li>Inputs<ul>
<li>Location Vector 位置</li>
<li>Rotation Rotator 旋转</li>
</ul>
</li>
<li>往上级找，发现也需要设置Interface文件，下面设置</li>
<li>增加变量 TraceDistance float<ul>
<li>默认值 100</li>
</ul>
</li>
<li>Line Trace By Channel<ul>
<li>Start &#x3D;&gt; 参数 Location</li>
<li>End &#x3D;&gt; 参数 Location + (参数 Rotation 的 Get Forward Vector * TraceDistance)</li>
<li>Draw Debug Type &#x3D;&gt; 持久 [Persistent]</li>
<li>Out Hit &#x3D;&gt; Break Hit Result</li>
</ul>
</li>
<li>Spawn Emitter at Location<ul>
<li>Emitter Template &#x3D;&gt; P_PickaxeHit</li>
<li>Location &#x3D;&gt; Break Hit Result 的 Impact Point</li>
</ul>
</li>
</ul>
</li>
<li>ServerOverlap 方法<ul>
<li>修改Inputs<ul>
<li>增加 Rotation Rotator 旋转</li>
</ul>
</li>
<li>在 收获方法 的后面 调用 HitFXMulticast<ul>
<li>Location &#x3D;&gt; 球体的 Pos</li>
<li>Rotation &#x3D;&gt; 球体的 Rotation</li>
</ul>
</li>
</ul>
</li>
<li>检测碰撞 不需要 DebugSphere</li>
</ul>
<p>OPEN BPI_SurvivalCharacter</p>
<ul>
<li>Get Arrow Location<ul>
<li>增加 Outputs<ul>
<li>Rotation Rotator 旋转</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>Get Arrow Location 方法<ul>
<li>Rotation &#x3D;&gt; Arrow1(前方的角度) 的 Get World Rotation</li>
</ul>
</li>
</ul>
<p>运行测试，敲碎石头也有效果和声音，石镐敲击石头有效果，但是没有声音</p>
<p>给石镐敲击增加声音</p>
<p>下载UE引擎资源</p>
<ul>
<li>打开引擎市场</li>
<li>search<ul>
<li>easy build system V…</li>
<li>free 免费的</li>
</ul>
</li>
<li>安装</li>
<li>但是文件太多太大了，选择文件夹 <ul>
<li>EasyBuildingSystem&#x2F;Audio&#x2F;Sounds&#x2F;Interactions 右键 迁移[Migrate] 弹出资源报告</li>
<li>选择当前项目路径的 ${项目路径}&#x2F;Content</li>
<li>保存后，项目会多出 EasyBuildingSystem 文件夹 包含了SC_Pickaxe_Hit、SC_Hatchet_Hit</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Hatchet</p>
<ul>
<li>HitFXMulticast<ul>
<li>Spawn Emitter at Location 后</li>
<li>Play Sound at Location<ul>
<li>Sound &#x3D;&gt; 提升为变量 HitSound SoundBase</li>
<li>Location &#x3D;&gt; 参数 Location</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>打开 BP_TP_StonePickaxe 设置变量 HitSound 为 SC_Pickaxe_Hit<br>打开 BP_TP_StoneHatchet 设置变量 HitSound 为 SC_Hatchet_Hit</p>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>切换 斧头和石镐</li>
</ul>
<p>运行后 石镐和斧头挥动就可以听到声音了</p>
<h4 id="48-修复灌木丛的拾取逻辑，灌木丛拾取以及消失时有声音和视觉效果"><a href="#48-修复灌木丛的拾取逻辑，灌木丛拾取以及消失时有声音和视觉效果" class="headerlink" title="48 修复灌木丛的拾取逻辑，灌木丛拾取以及消失时有声音和视觉效果"></a>48 修复灌木丛的拾取逻辑，灌木丛<code>拾取</code>以及<code>消失时</code>有声音和视觉效果</h4><p>修复判断是否正在拾取逻辑的位置，提前判断</p>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>HarvestMontageOnServer 的 判断逻辑 放到 OverlapGroundItems 中</li>
<li>增加对持有物品的判断<ul>
<li>如果持有物品，则不能拾取</li>
</ul>
</li>
</ul>
<p>复制 P_PickaxeHit</p>
<ul>
<li>Rename P_BushHarvest</li>
<li>双击删除 wisp</li>
<li>编辑 impact的 必须<ul>
<li>更改材质 M_Leaves_A</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>创建 自定义事件 组播 BushMulticast</li>
<li>生成发射器 Spawn Emitter at Location 和粒子相关<ul>
<li>Emitter Template &#x3D;&gt; P_BushHarvest</li>
<li>Location &#x3D;&gt; Get Actor Location 的 Return Value</li>
</ul>
</li>
<li>HarvestMontageOnServer 方法的最后面调用 BushMulticast</li>
</ul>
<p>修改 粒子效果 让视觉体验更好</p>
<p>下载本地资源 BushSFX 的 三个 音频文件到 _Main&#x2F;Sounds&#x2F;Harvesting 目录中</p>
<ul>
<li>bush01.wav</li>
<li>bush02.wav</li>
<li>bush03.wav</li>
</ul>
<p>复制文件 SC_RockDestroy</p>
<ul>
<li>Rename SC_BushPick</li>
<li>OPEN it, 随机选择一个音效播放</li>
<li>Random<ul>
<li>in<ul>
<li>Wave Player：RockDestroy1</li>
<li>Wave Player：RockDestroy2</li>
<li>Wave Player：RockDestroy3</li>
</ul>
</li>
</ul>
</li>
<li>调制器 [Modulator]<ul>
<li>Pitch Min 0.95</li>
<li>Pitch Max 1.05</li>
<li>Volume Min 0.95</li>
<li>Volume Max 1.05</li>
</ul>
</li>
<li>Modulator 的 Output &#x3D;&gt; 喇叭</li>
</ul>
<p>OPEN BP_FirstPersonCharacter 事件图</p>
<ul>
<li>自定义事件 组播 BushMulticast 最后一个方法后面<ul>
<li>播放声音 Play Sound at Location<ul>
<li>Sound &#x3D;&gt; SC_BushPick</li>
<li>Location &#x3D;&gt; Get Actor Location</li>
<li>Attenuation Settings &#x3D;&gt; HarvestingAtt</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>运行测试，灌木丛<code>拾取</code>以及<code>消失时</code>有声音和视觉效果。</p>
<h4 id="49-利用植物绘画-实现快速放置物体"><a href="#49-利用植物绘画-实现快速放置物体" class="headerlink" title="49 利用植物绘画 实现快速放置物体"></a>49 利用植物绘画 实现快速放置物体</h4><p>说明：</p>
<ul>
<li>Foliage[植物]</li>
</ul>
<p>创建文件夹 ActorFoliage 目录 _Main&#x2F;Blueprints&#x2F;HarvestingSystem 下<br>创建文件夹 LargeItems 目录 ActorFoliage 下<br>创建文件夹 PalmTree 目录 LargeItems 下</p>
<p>创建 Foliage - Actor Foliage 目录 PalmTree 下</p>
<ul>
<li>Rename AF_Palm02</li>
<li>OPEN it</li>
<li>Actor Class &#x3D;&gt; BP_Palm02</li>
</ul>
<p>OPEN Map</p>
<ul>
<li>切换 叶子 模式[Foliage Model]</li>
<li>增加叶子 SM_Cube 如果不行，可以打开浏览器拖动<ul>
<li>保存路径 LevelPrototyping&#x2F;Meshes</li>
</ul>
</li>
<li>将 AF_Palm02 拖入到 叶子 的白色cube中 or 点击白色cube 右键 替换 AF_Palm02<ul>
<li>勾选 cube</li>
</ul>
</li>
<li>点击绘画，可以放置多个cube，相当于快速放置物体</li>
</ul>
<p><img src="/blog/p/614a8811/ActorFoliage%E5%BF%AB%E9%80%9F%E6%94%BE%E7%BD%AE%E7%89%A9%E4%BD%93.png" alt="ActorFoliage快速放置物体.png"></p>
<p>总结：</p>
<ol>
<li>利用Map中的 植物绘画功能，可以快速放置多个物体</li>
</ol>
<h3 id="第五章-物品制作系统"><a href="#第五章-物品制作系统" class="headerlink" title="第五章 物品制作系统"></a>第五章 物品制作系统</h3><h4 id="50-51-玩家制作系统"><a href="#50-51-玩家制作系统" class="headerlink" title="50 &amp; 51 玩家制作系统"></a>50 &amp; 51 玩家制作系统</h4><p>创建文件夹 CraftingWidgets 目录 _Main&#x2F;Widgets 下<br>创建 用户组件 窗口控件 W_CraftingSlot 目录 CraftingWidgets 下</p>
<ul>
<li>size box 宽度 70 高度 70 切换模式<ul>
<li>border Image Inventory_Slot_Background<ul>
<li>按钮 Button<ul>
<li>样式<ul>
<li>Image tex_wood_05_b</li>
<li>Draw as Image 画成图像</li>
<li>悬停效果 复制 Normal Tint 改为 右下角的 黄色 E2B12BFF</li>
<li>按压效果 复制 Normal Tint 改为 浅绿色 3D7E1AFF</li>
<li>Button Rename SelectItemButton 是变量</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建 蓝图枚举类 E_CraftingType 目录 _Main&#x2F;Blueprints&#x2F;Enums 下</p>
<ul>
<li>PlayerInventory 玩家背包</li>
<li>CookingPot 烹饪锅</li>
<li>CraftingBench 工作台</li>
<li>Forge 锻造台</li>
<li>AdvanceWorkbench 高级工作台</li>
<li>StorageBox 存储箱</li>
</ul>
<p>创建 蓝图枚举类 E_ItemCategory 目录 _Main&#x2F;Blueprints&#x2F;Enums 下</p>
<ul>
<li>Misc 杂项</li>
<li>Tools 工具</li>
<li>Armor 防具</li>
<li>Structures 建筑</li>
</ul>
<p>创建 蓝图结构 S_ItemStruct 目录 CraftingStructs 下</p>
<ul>
<li>ItemID int</li>
<li>ItemQuantity int</li>
</ul>
<p>创建 结构文件夹 CraftingStructs 目录 _Main&#x2F;Blueprints&#x2F;Structures 下<br>创建 蓝图结构 S_ItemRecipes 配方 目录 CraftingStructs 下</p>
<ul>
<li>ItemID int</li>
<li>ItemName Text</li>
<li>ItemDescription Text</li>
<li>RequiredLevel int</li>
<li>ItemIcon Texture 2D 对象引用</li>
<li>RequiredItems S_ItemStruct Array</li>
<li>ItemCategory E_ItemCategory </li>
<li>ItemExperience int 经验</li>
</ul>
<p>创建 数据表格 PICK S_ItemRecipes 名字 DT_PlayerItemRecipes 保存到 _Main&#x2F;DataTables 目录中</p>
<ul>
<li>增加行（先加石斧的配方）<ul>
<li>RowName 2</li>
<li>ItemID 2</li>
<li>ItemName 石斧</li>
<li>ItemDescription ..</li>
<li>ItemIcon StoneHatchet</li>
<li>RequiredLevel 1</li>
<li>ItemCategory Tools</li>
<li>RequiredItems 通过木头和石头制作<ul>
<li>Index0<ul>
<li>ItemId 1</li>
<li>ItemQuantity 3</li>
</ul>
</li>
<li>Index1<ul>
<li>ItemId 4</li>
<li>ItemQuantity 1</li>
</ul>
</li>
</ul>
</li>
<li>ItemExperience 10</li>
</ul>
</li>
</ul>
<p>OPEN W_CraftingSlot 事件图</p>
<ul>
<li>创建 变量 ItemID int 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>创建 变量 ContainerType E_ContainerType 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>创建 变量 ImageTexture Texture 2D 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>创建 变量 CanCraftItem? bool</li>
<li>创建 变量 CraftingType E_CraftingType</li>
<li>创建 变量 ItemIndex Index</li>
</ul>
<p>创建 用户组件 窗口控件 W_CraftingContainerGrid 目录 CraftingWidgets 下</p>
<ul>
<li>Scroll Box<ul>
<li>统一 Uniform Grid Panel Rename:Grid 是变量</li>
</ul>
</li>
<li>事件图<ul>
<li>设置变量 SlotsPerRow Int 每行的数量 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>创建变量 ContainerType E_ContainerType 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>创建变量 CraftingType E_CraftingType 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>创建变量 ItemCategory E_ItemCategory 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>设置变量 Slots W_CraftingSlot Array 这个slots里面存的就是 所有 W_CraftingSlot</li>
<li>设置变量 ItemIndex Int</li>
<li>创建 方法 AddSlots<ul>
<li>核心：根据参数和数据表，创建 W_CraftingSlot 控件，放入到 Grid 中</li>
<li>Inputs<ul>
<li>CraftingType E_CraftingType</li>
</ul>
</li>
<li>Select 通过类型 选择对应的数据表<ul>
<li>PlayerInventory</li>
<li>CookingPot</li>
<li>CraftingBench DT_PlayerItemRecipes</li>
<li>Forge</li>
<li>AdvanceWorkbench</li>
<li>StorageBox</li>
<li>Return Value 设置本地变量 LocalDataTableRef [Data Table]</li>
</ul>
</li>
<li>Get Data Table Row Names<ul>
<li>table &#x3D;&gt; 本地变量 LocalDataTableRef</li>
</ul>
</li>
<li>For Each Loop<ul>
<li>Array &#x3D;&gt; Out Row Names</li>
</ul>
</li>
<li>获得数据表行 None[Get Data Table Row NONE]</li>
<li>Break S_ItemRecipe</li>
<li>两个判断<ul>
<li>参数容器类型 是否等于 玩家背包类型</li>
<li>参数建造类型 是否等于 配方中的建造类型</li>
</ul>
</li>
<li>创建 W_CraftingSlot 控件 [Create Widget]<ul>
<li>Class &#x3D;&gt; W_CraftingSlot</li>
<li>Owning Player &#x3D;&gt; Get Owning Player</li>
<li>Image Texture 表物品的 ItemIcon</li>
<li>ItemID &#x3D;&gt; 表物品的 ItemID</li>
<li>ContainerType &#x3D;&gt; 参数 ContainerType</li>
</ul>
</li>
<li>Slots Add 方法 &#x3D;&gt; 生成控件的 Return Value</li>
<li>生成控件的 Return Value 的 Set ItemIndex &#x3D;&gt; ItemIndex</li>
<li>AddSlotToGrid<ul>
<li>Index &#x3D;&gt; ItemIndex</li>
<li>Slot &#x3D;&gt; 生成控件的 Return Value</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>事件图<ul>
<li>Event Construct<ul>
<li>AddSlotToGrid<ul>
<li>含义：</li>
<li>Inputs<ul>
<li>Index int</li>
<li>Slot W_CraftingSlot 对象引用</li>
</ul>
</li>
<li>设置 局部变量 LocalSlotIndex Int </li>
<li>设置 局部变量 LocalCraftingSlot W_CraftingSlot</li>
<li>Add Child to Uniform Grid<ul>
<li>目标 &#x3D;&gt; Grid </li>
<li>Content &#x3D;&gt; LocalCratingSlot</li>
<li>Set Row<ul>
<li>行判断依据：当前索引 除法[Division] 每行的数量 截断[Truncate] 舍弃小数 &#x3D; 行</li>
</ul>
</li>
<li>Set Column<ul>
<li>列判断依据：当前索引 除法（整数和余数）[Division(Whole and Remainder)] 每行的数量 取余数（Remainder） &#x3D; 列</li>
</ul>
</li>
</ul>
</li>
<li>Return Node</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>方法 AddSlotToGrid</p>
<ul>
<li>Inputs<ul>
<li>Index int</li>
<li>Slot W_CraftingSlot 对象引用</li>
</ul>
</li>
<li>设置局部变量 LocalSlotIndex</li>
<li>设置局部变量 LocalCratingSlot</li>
<li>Add Child to Uniform Grid<ul>
<li>目标 &#x3D;&gt; Grid </li>
<li>Content &#x3D;&gt; LocalCratingSlot</li>
<li>Slot Index &#x3D;&gt; LocalSlotIndex</li>
<li>创建 变量 SlotPreRow Int</li>
<li>Set Row<ul>
<li>行判断依据：</li>
</ul>
</li>
<li>Set Column<ul>
<li>列判断依据：</li>
</ul>
</li>
<li>Return Node</li>
</ul>
</li>
</ul>
<p>总结：</p>
<ol>
<li>创建了 W_CraftingSlot 控件，用于放入 CraftingContainerGrid 中</li>
<li>创建了 W_CraftingContainerGrid 控件，用于放入 CraftingContainer 中</li>
<li>创建了 CraftingContainerGrid 中的 AddSlots 方法，用于根据 CraftingType 类型，从数据表中获取数据，创建 W_CraftingSlot 控件，放入到 CraftingContainerGrid 中</li>
<li>创建了 CraftingContainerGrid 中的 AddSlotToGrid 方法，用于设置 W_CraftingSlot 控件的位置</li>
<li>创建了 蓝图枚举类 E_CraftingType，用于区分 CraftingContainerGrid 的类型</li>
<li>创建了 蓝图枚举类 E_ItemCategory，用于区分 Item 的类型</li>
<li>创建了 蓝图结构 S_ItemStruct，用于存储 Item 的信息</li>
<li>创建了 蓝图结构 S_ItemRecipe，用于存储 Item 的配方信息</li>
<li>创建了 数据表格 PICK S_ItemRecipes，用于存储 Item 的配方信息</li>
</ol>
<h4 id="52-制作系统的UI"><a href="#52-制作系统的UI" class="headerlink" title="52 制作系统的UI"></a>52 制作系统的UI</h4><p>下载 本地资源文件 6个.TGA文件 导入到 _Main&#x2F;Widgets&#x2F;Textures 目录中</p>
<p>OPEN W_CraftingSlot</p>
<ul>
<li>Event Construct<ul>
<li>参数 SelectItemButton</li>
<li>Set Style<ul>
<li>in Style<ul>
<li>Make ButtonStyle<ul>
<li>Normal 使用 Make SlateBrush 传入<ul>
<li>Image &#x3D;&gt; 变量 ImageTexture</li>
<li>SlateBrush &#x3D;&gt; 传给 Normal</li>
</ul>
</li>
<li>Hovered 使用 Make SlateBrush 传入<ul>
<li>Image &#x3D;&gt; 变量 ImageTexture</li>
<li>Tint &#x3D;&gt; 使用 Make SlateColor 传入<ul>
<li>黄色 E2B12BFF</li>
</ul>
</li>
</ul>
</li>
<li>Pressed 使用 Make SlateBrush 传入<ul>
<li>Image &#x3D;&gt; 变量 ImageTexture</li>
<li>Tint &#x3D;&gt; 使用 Make LinearColor 传入</li>
<li>绿色</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建控件 W_CraftingWindow 目录 CraftingWidgets 下</p>
<ul>
<li>size box 宽度 500 高度 500 切换模式<ul>
<li>水平<ul>
<li>垂直 将整个窗口移动到左外方 变换 -100<ul>
<li>size box 宽度 80 高度 80 padding-top:10<ul>
<li>Button Rename:MiscButton Image boxbutton Draw As Border Tint 白色<ul>
<li>样式<ul>
<li>悬停效果 复制 Normal Tint 改为 右下角的 黄色 E2B12BFF</li>
<li>按压效果 复制 Normal Tint 改为 浅绿色 3D7E1AFF</li>
<li>组件 Border<ul>
<li>样式<ul>
<li>padding 4 15 4 15</li>
<li>水平垂直拉伸 内容水平垂直拉伸</li>
<li>Image ropeicon(绳索)</li>
<li>Draw as Image 画成图像</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>——— Button 复制到一共4个button ————-</li>
</ul>
</li>
<li>复制 Box Size 第二个 Button Rename:ToolsButton Image:ToolsIcon</li>
<li>复制 Box Size 第三个 Button Rename:ArmorButton Image:armoricon</li>
<li>复制 Box Size 第四个 Button Rename:StructuresButton Image:structuresicon</li>
</ul>
</li>
<li>垂直 填充 变换:-50<ul>
<li>Widget Switcher 填充 Padding:10 Rename:CraftingGridSwitcher<ul>
<li>创建的组件 W_CraftingContainerGrid ActiveWidgetIndex:1 Rename MiscRecipes<ul>
<li>ItemCategory:Misc</li>
<li>SlotsPerRow:3</li>
</ul>
</li>
<li>创建的组件 W_CraftingContainerGrid ActiveWidgetIndex:1? Rename ToolsRecipes<ul>
<li>ItemCategory:Tools</li>
<li>SlotsPerRow:3</li>
</ul>
</li>
<li>创建的组件 W_CraftingContainerGrid Rename ArmorRecipes<ul>
<li>ItemCategory:Armor</li>
<li>SlotsPerRow:3</li>
</ul>
</li>
<li>创建的组件 W_CraftingContainerGrid Rename StructureRecipes<ul>
<li>ItemCategory:Structure</li>
<li>SlotsPerRow:3</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>垂直 填充 变换:-50<ul>
<li>Widget Switcher 填充 Rename:CraftRecipeInfo<ul>
<li>border Image:craftoverlay Rename:SelectItemTipWindow<ul>
<li>垂直框 Padding:5 30 5 2 水平居中 垂直顶<ul>
<li>Text Block Text:选择一个物品</li>
<li>Text Block Text:建造 Size:20</li>
</ul>
</li>
</ul>
</li>
<li>border Image:craftoverlay Rename:CraftItemWindow color:褐色<ul>
<li>垂直 Padding:4 2 4 2 水平填充 垂直填充<ul>
<li>水平<ul>
<li>size box 填充 水平居中 垂直居中 宽度 80 高度 80 Padding-top:15<ul>
<li>Overlay<ul>
<li>Border 水平垂直拉伸 内容水平垂直拉伸 color:红色 FF0500FF <strong>Rename:CanCraftBorder 是变量</strong></li>
<li>Border 水平垂直拉伸 内容水平垂直拉伸 padding:4 color:黑色 000000FF</li>
<li>Image 水平垂直拉伸 Padding:5 Image:tex_wood_02 Rename:ItemImage 是变量</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>水平 padding:0 10 0 5<ul>
<li>垂直 填充<ul>
<li>Text Block Text:物品名称 Size:15 Rename:ItemNameText 是变量</li>
<li>Text Block Text:RequiredLevel:1 Size:12 Rename:RequiredLevelText 是变量</li>
</ul>
</li>
</ul>
</li>
<li>水平<ul>
<li>border 填充 Tint：黑色，A0.8<ul>
<li>Editable Text(Multi-Line) Text:该项目的描述将位于此多行且可编辑的文本框中.文本框设置为只读<ul>
<li>样式补充：size:10 typeface:Italic 勾选isReadOnly Rename:ItemDescriptionText 是变量</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>水平 padding: 0 10 0 5<ul>
<li>复制一个 ItemName Rename:Ingredients:</li>
</ul>
</li>
<li>水平 填充 padding:0 5 0 10<ul>
<li>Scroll Box Rename RequiredItemsWidget 填充 是变量</li>
</ul>
</li>
<li>水平 padding: 0 5 0 10<ul>
<li>Button Rename CraftItemButton<ul>
<li>样式<ul>
<li>填充</li>
<li>padding:4 2 4 2</li>
<li>Tint:白色</li>
<li>Image:button</li>
<li>Draw as Image 画成图像</li>
<li>悬停效果 复制 Normal Tint 改为 右下角的 黄色 E2B12BFF</li>
<li>按压效果 复制 Normal Tint 改为 浅绿色 3D7E1AFF</li>
</ul>
</li>
<li>Text Block<ul>
<li>Text:制作</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="53-制作控件切换不同窗口"><a href="#53-制作控件切换不同窗口" class="headerlink" title="53 制作控件切换不同窗口"></a>53 制作控件切换不同窗口</h4><p>OPEN W_Inventory</p>
<ul>
<li>增加 Widget Switcher 在 W_ItemContainerGrid 旁边 Fill Padding:20 Rename:InventoryWidgetSwitcher 是变量</li>
<li>将 W_ItemContainerGrid 控件 放入 Widget Switcher 中 并且删除 Padding SwitcherActiveIndex:0</li>
<li>将 W_CraftingWindow 控件 放入 Widget Switcher SwitcherActiveIndex:1</li>
</ul>
<h5 id="点击-Inventory-or-Crafting-切换组件"><a href="#点击-Inventory-or-Crafting-切换组件" class="headerlink" title="点击 Inventory or Crafting 切换组件"></a>点击 Inventory or Crafting 切换组件</h5><p>OPEN W_Inventory</p>
<ul>
<li>OnClicked(InventoryButton)<ul>
<li>设置激活的控件索引 InventoryWidgetSwitcher &#x3D;&gt; Set Active Widget Index<ul>
<li>Widget Switcher &#x3D;&gt; InventoryWidgetSwitcher</li>
<li>Index &#x3D;&gt; 0</li>
</ul>
</li>
</ul>
</li>
<li>OnClicked(CraftingButton)<ul>
<li>设置激活的控件索引 InventoryWidgetSwitcher &#x3D;&gt; Set Active Widget Index<ul>
<li>Widget Switcher &#x3D;&gt; InventoryWidgetSwitcher</li>
<li>Index &#x3D;&gt; 1</li>
</ul>
</li>
</ul>
</li>
</ul>
<h6 id="点击-Misc-or-Tools-or-Armor-or-Structures-切换组件"><a href="#点击-Misc-or-Tools-or-Armor-or-Structures-切换组件" class="headerlink" title="点击 Misc or Tools or Armor or Structures 切换组件"></a>点击 Misc or Tools or Armor or Structures 切换组件</h6><p>OPEN W_CraftingWindow</p>
<ul>
<li>OnClicked(MiscButton)<ul>
<li>设置激活的WidgetIndex Set Active Widget Index<ul>
<li>Widget Switcher &#x3D;&gt; CraftingGridSwitcher</li>
<li>Index &#x3D;&gt; 0</li>
</ul>
</li>
</ul>
</li>
<li>OnClicked(ToolsButton) <ul>
<li>设置激活的WidgetIndex Set Active Widget Index<ul>
<li>Widget Switcher &#x3D;&gt; CraftingGridSwitcher</li>
<li>Index &#x3D;&gt; 1</li>
</ul>
</li>
</ul>
</li>
<li>OnClicked(ArmorButton)<ul>
<li>设置激活的WidgetIndex Set Active Widget Index<ul>
<li>Widget Switcher &#x3D;&gt; CraftingGridSwitcher</li>
<li>Index &#x3D;&gt; 2</li>
</ul>
</li>
</ul>
</li>
<li>OnClicked(StructuresButton)<ul>
<li>设置激活的WidgetIndex Set Active Widget Index<ul>
<li>Widget Switcher &#x3D;&gt; CraftingGridSwitcher</li>
<li>Index &#x3D;&gt; 3</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>思路：</p>
<ol>
<li>W_CraftingWindow 中的 CraftingGridSwitcher 组件，用于切换 CraftingContainerGrid 组件</li>
<li>W_CraftingWindow 中的 CraftingRecipeInfo 组件，用于显示 CraftingContainerGrid 组件中的 CraftingSlot 组件的信息</li>
</ol>
<p>OPEN DT_PlayerItemRecipes</p>
<ul>
<li>通过复制 新增行<ul>
<li>RowName 3</li>
<li>ItemID 3</li>
<li>ItemName 石镐</li>
<li>ItemDescription ..</li>
<li>ItemIcon StonePickaxe</li>
<li>其他一样</li>
</ul>
</li>
<li>复制上面新增的 什么都不变</li>
<li>通过复制 新增行<ul>
<li>RowName 4</li>
<li>ItemID 4</li>
<li>ItemName 绳子</li>
<li>ItemDescription ..</li>
<li>ItemIcon Tex_strings_05_b</li>
<li>ItemCategory Misc 杂项</li>
</ul>
</li>
</ul>
<p>运行，测试，可以看到对应的物品</p>
<h4 id="54-在制作窗口中点击某个物品，显示制作信息"><a href="#54-在制作窗口中点击某个物品，显示制作信息" class="headerlink" title="54 在制作窗口中点击某个物品，显示制作信息"></a>54 在制作窗口中点击某个物品，显示制作信息</h4><p>创建 用户控件 制作原料 W_CraftingIngredient 目录 _Main&#x2F;Widgets&#x2F;CraftingWidgets 下</p>
<ul>
<li>size box 宽度 130 高度 40 切换屏幕上所需模式<ul>
<li>Border 笔刷颜色:黑色0.5透明度 padding:1 5 1 1<ul>
<li>水平框 padding 0<ul>
<li>垂直框 垂直居中<ul>
<li>Image Rename:ResourceImage 是变量</li>
</ul>
</li>
<li>垂直框 填充<ul>
<li>Text Block Text:x10 木头 Size:10 垂直居中 填充 Rename:ResourceName 是变量 padding: 3 0 0 0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>事件图<ul>
<li>创建变量 ItemSelectedID Int</li>
<li>创建变量 ResourceText Text 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>创建变量 ResourceQuantity Int 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>创建变量 ResourceIcon Texture 2D 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>构造事件<ul>
<li>ResourceName -&gt; Set Text<ul>
<li>Format Text [x{Quantity} {Resource}]  传入 In Text<ul>
<li>变量 ResourceQuantity</li>
<li>变量 ResourceText</li>
</ul>
</li>
</ul>
</li>
<li>ResourceImage -&gt; 使用纹理设置笔刷 [Set Brush From Texture]<ul>
<li>Texture &#x3D;&gt; 变量 ResourceIcon</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>点击制作物品，展示制作信息</p>
<p>OPEN W_CraftingWindow</p>
<ul>
<li>创建 自定义事件 ShowItemRequirements COMMENT 展示用户制作TAB的信息<ul>
<li>Inputs<ul>
<li>ItemSelectedID int</li>
</ul>
</li>
<li>CraftRecipeInfo -&gt; Set Active Widget Index<ul>
<li>Index &#x3D;&gt; 1</li>
</ul>
</li>
<li>Get Data Table Row  去找数据表当中的配方<ul>
<li>Table &#x3D;&gt; DT_PlayerItemRecipes</li>
<li>Row Name &#x3D;&gt; ItemSelectedID -&gt; To Text (Integer)</li>
</ul>
</li>
<li>SetupCraftingInfoTab<ul>
<li>RecipeInfo &#x3D;&gt; Get Data Table Row 的 输出行</li>
</ul>
</li>
</ul>
</li>
<li>增加 方法 SetupCraftingInfoTab<ul>
<li>Inputs<ul>
<li>ItemRecipe S_ItemRecipe</li>
</ul>
</li>
<li>设置局部变量 LocalItemRecipe S_ItemRecipe</li>
<li>Break S_ItemRecipe<ul>
<li>设置需要同步的信息<ul>
<li>ID等等</li>
</ul>
</li>
<li>重点在 配方<ul>
<li>通过配方的ID 去DT_Items中找物品的详情</li>
<li>数量是配方的数量</li>
<li>循环体外部要提前清空 RequiredItemsWidget 的子控件 使用方法：Clear Children</li>
<li>添加子控件 使用方法：Add Child</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="55-制作物品-1-检测是否有足够的原料"><a href="#55-制作物品-1-检测是否有足够的原料" class="headerlink" title="55 制作物品 1 检测是否有足够的原料"></a>55 制作物品 1 检测是否有足够的原料</h4><p>思路：</p>
<ol>
<li>用户点击 制作按钮</li>
<li>根据制作按钮 找到当前的RequiredItems物品 For Each Loop</li>
<li>根据 For Each Loop 中的物品ID 和 数量</li>
<li>去背包中查找是否有足够的物品</li>
</ol>
<ul>
<li>false print </li>
<li>true print</li>
</ul>
<p>OPEN W_CraftingWindow</p>
<ul>
<li>方法 ShowItemRequirements 展示用户制作TAB的信息后，还要展示配方进度</li>
<li>CheckIfCanCraftItemOnServer 通过 Get Player Character 的 Get Survival Char Ref <ul>
<li>Inputs<ul>
<li>ID int</li>
<li>Container E_ContainerType</li>
<li>TableType E_CraftingType</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 自定义事件 CheckIfCanCraftItemOnServer[在服务器运行]<ul>
<li>Inputs<ul>
<li>ID int</li>
<li>Container E_ContainerType</li>
<li>TableType E_CraftingType</li>
</ul>
</li>
<li>调用 CanCraftItem</li>
<li>调用 UpdateCraftStatusOnClient 下面要创建 通过 Get Controller 的 Survival Game RCRef</li>
</ul>
</li>
<li>创建方法 CanCraftItem<ul>
<li>Inputs<ul>
<li>ID int</li>
<li>ContainerType E_ContainerType</li>
<li>TableType E_CraftingType</li>
</ul>
</li>
<li>通过数据表获取配方 传递给 背包组件 的 ContainerItems 方法</li>
<li>Outputs<ul>
<li>CanCraft? bool</li>
</ul>
</li>
<li>Return Node</li>
</ul>
</li>
</ul>
<p>OPEN BPC_ItemsContainer</p>
<ul>
<li>创建 方法 ContainerItems<ul>
<li>Inputs<ul>
<li>RequiredItems S_ItemStruct Array</li>
</ul>
</li>
<li>设置 局部变量 LocalRequiredItems S_ItemStruct Array</li>
<li>设置 局部变量 HasItem? S_ItemStruct Array</li>
<li>For Each Loop Break &#x3D;&gt; S_ItemStruct</li>
<li>For Each Loop Break &#x3D;&gt; Items</li>
<li>找对应id的物品</li>
<li>判断：拥有物品的数量 &gt;&#x3D; 配方的物品数量</li>
<li>HasItem? 这里使用数组包含不合格的成员，判定材料是否足够 <ul>
<li>Remove Index</li>
<li>Is Empty</li>
</ul>
</li>
<li>通过判断 HasItem 是否是空 Return Node<ul>
<li>Outputs<ul>
<li>CanCraft? bool</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/blog/p/614a8811/ContainerItems.png" alt="ContainerItems.png"></p>
<p>OPEN SurvivalGamePC</p>
<ul>
<li>创建 自定义事件 UpdateCraftStatusOnClient<ul>
<li>Inputs<ul>
<li>CanCraft? bool</li>
</ul>
</li>
</ul>
</li>
<li>调用 MainWidgetRef 的 Target W_Inventory 的 W_CraftingWindow 的 UpdateCraftStatus<ul>
<li>CanCraft? &#x3D;&gt; CanCraft?</li>
</ul>
</li>
</ul>
<p>OPEN W_CraftingWindow</p>
<ul>
<li>创建 自定义事件 UpdateCraftStatus 根据 CanCraft? 是否可以制作 <ul>
<li>Inputs<ul>
<li>CanCraft? bool</li>
</ul>
</li>
<li>更改 border CanCraftBorder 的颜色 浅绿色 3D7E1AFF or 红色 FF0023FF</li>
<li>更改 CraftItemButton 的 Enable 是否可以点击<ul>
<li>set Enabled<ul>
<li>Enabled &#x3D;&gt; CanCraft?</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>运行测试，可以通过按制作按钮是否可以点击 来判断是否有足够的原料</p>
<h4 id="56-制作物品-2-制作出物品"><a href="#56-制作物品-2-制作出物品" class="headerlink" title="56 制作物品 2 制作出物品"></a>56 制作物品 2 制作出物品</h4><p>思路：</p>
<ul>
<li>用户点击 制作按钮</li>
<li>执行 第三人称角色 的 CraftItemOnServer 方法</li>
<li>执行 第三人称角色 的 CraftItemFunction 方法<ul>
<li>判断制作状态</li>
<li>判断材料是否足够 </li>
<li>扣减材料</li>
</ul>
</li>
<li>执行 AddCraftedItem<ul>
<li>增加物品</li>
</ul>
</li>
<li>播报 AddCraftedItem</li>
</ul>
<p>OPEN BPC_ItemsContainer</p>
<ul>
<li>创建 方法 RemoveItems 删除Items中的物品<ul>
<li>思路：<ul>
<li>从Items中找到对应的物品，通过方法 GetIndexesOfItems 通过物品ID获取Items中所有的索引</li>
<li>扣除中：<ul>
<li>如果物品数量大于等于扣除数量，直接扣除，扣完执行下一个配方进行扣除</li>
<li>如果物品数量小于扣除数量，记录剩余未扣除的数量，删除物品，继续循环扣除</li>
</ul>
</li>
</ul>
</li>
<li>Inputs<ul>
<li>ItemsToRemove S_ItemStruct Array</li>
</ul>
</li>
<li>创建本地变量 LocalItemsToRemove S_ItemStruct Array</li>
<li>创建本地变量 LocalItemsToRemoveList S_ItemStruct Array</li>
<li>后面省略 …</li>
</ul>
</li>
<li>创建方法 GetIndexesOfItems 通过物品ID获取Items中所有的索引<ul>
<li>创建本地变量 IndexesFound int Array</li>
<li>Inputs<ul>
<li>ItemsID int</li>
</ul>
</li>
<li>Outputs<ul>
<li>Indexes int Array</li>
</ul>
</li>
<li>设置本地变量 LocalID</li>
<li>For Each Loop Break &#x3D;&gt; Items</li>
<li>break<ul>
<li>branch and bool<ul>
<li>判断 id 是否等于 LocalID</li>
<li>判断 Quantity 是否大于 0</li>
<li>符合条件<ul>
<li>IndexesFound 添加 Index</li>
</ul>
</li>
</ul>
</li>
<li>IndexesFound add Break的Index</li>
<li>完成后<ul>
<li>Return Node<ul>
<li>Indexes &#x3D;&gt; IndexesFound</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>增加变量 ?IsCrafting bool 制作状态</li>
<li>创建 方法 CraftItemFunction 制作物品方法<ul>
<li>思路<ul>
<li>物品制作有状态，需要判断是否可以制作，是否正在制作，是否制作完成</li>
<li>根据物品配方ID 找到配方信息<ul>
<li>给予的数量</li>
<li>物品ID DT_Items 找到物品的信息，放入 Items 中<ul>
<li>找到的物品ID存入局部变量备用</li>
<li>要找出背包中相同的物品，合并</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Inputs<ul>
<li>ItemID int</li>
<li>ContainerType E_ContainerType</li>
<li>CraftingType E_CraftingType</li>
</ul>
</li>
<li>Outputs<ul>
<li>CanCraft? bool</li>
<li>ContainerTypeOut E_ContainerType</li>
</ul>
</li>
</ul>
</li>
<li>创建 播报方法 AddCraftedItemFunction<ul>
<li>思路<ul>
<li>通过被制造物品ID 也就是配方表中的RowName 找到 DT_Items 对应的物品信息，进行播报</li>
</ul>
</li>
<li>Inputs<ul>
<li>ItemID text</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 AddCraftedItem 增加物品<ul>
<li>思路<ul>
<li>通过物品ID 找到物品信息，放入 Items 中</li>
</ul>
</li>
<li>Inputs</li>
<li>Outputs<ul>
<li>ItemID Text</li>
<li>ContainerType E_ContainerType</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="57-制作物品-3-增加制作进度条"><a href="#57-制作物品-3-增加制作进度条" class="headerlink" title="57 制作物品 3 增加制作进度条"></a>57 制作物品 3 增加制作进度条</h4><p>思路：</p>
<ul>
<li>点击制作 扣除材料后 增加制作进度条</li>
<li>BP_FirstPersonCharacter 中 调用了 SurvivalGamePC 的 ShowCraftingProgressBarOnClient 方法</li>
<li>SurvivalGamePC 中 调用了 W_MainWidget 的 ShowCraftingBar 方法</li>
<li>W_MainWidget 中 调用了 W_CraftingProgressBar 的 PlayAnimation 方法</li>
</ul>
<p>创建 W_CraftingProgressBar 目录 _Main&#x2F;Widgets&#x2F;CraftingWidgets 下</p>
<ul>
<li>size box 宽度 470 高度 110 切换模式<ul>
<li>border Color:黑色0.5透明度<ul>
<li>垂直框<ul>
<li>水平框 垂直居中 水平居中<ul>
<li>Text Block Text:制作中… Size:24</li>
</ul>
</li>
<li>水平框 填充<ul>
<li>进度条 填充 P：10 15 10 25 Rename:CraftingProgressBar 是变量 Is<ul>
<li>增加动画 Track 增加轨道[CraftingProgressBar] 百分比[Percent] Rename:CraftItemAnimation<ul>
<li>关键帧 0s:0 3s:1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Event 构造方法<ul>
<li>CraftItemAnimation 的 Play Animation </li>
<li>CraftItemAnimation 的 Bind to Animation Finished<ul>
<li>Delegate &#x3D;&gt; 自定义事件<ul>
<li>RemoveWidget<ul>
<li>删除自己 Remove from Parent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>增加到屏幕中的方法<br>OPEN W_MainWidget</p>
<ul>
<li>增加 垂直框 CraftWindowBox 放入到 W_MainWidget 最下面</li>
<li>拖动 垂直框 放在左下角 锚点设置左下角 Rename:CraftWindowBox 是变量</li>
<li>大小至内容[Size to Content] 勾选<ul>
<li>下面自定义事件会将 W_CraftingProgressBar 放入到 CraftWindowBox 中</li>
</ul>
</li>
<li>创建 自定义事件 ShowCraftingBar<ul>
<li>Create Widget<ul>
<li>Class &#x3D;&gt; W_CraftingProgressBar</li>
<li>Craft Window Box -&gt; add Child<ul>
<li>Content &#x3D;&gt; W_CraftingProgressBar</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN SurvivalGamePC</p>
<ul>
<li>创建 自定义事件 ShowCraftingProgressBarOnClient<ul>
<li>MainWidgetRef -&gt; ShowCraftingBar</li>
</ul>
</li>
</ul>
<p>OPEN FirstPersonCharacter</p>
<ul>
<li>方法 CraftItemFunction 中 RemoveItems 后<ul>
<li>调用 Get Controller 的 Survival Game PC Ref 的 ShowCraftingProgressBarOnClient</li>
</ul>
</li>
</ul>
<h4 id="58-制作物品-4-修复BUG"><a href="#58-制作物品-4-修复BUG" class="headerlink" title="58 制作物品 4 修复BUG"></a>58 制作物品 4 修复BUG</h4><p>思路：</p>
<ul>
<li>将 制作状态 所有设置和判断 提取到外部 BP_FirstPersonCharacter 中 的 制作物品逻辑中设置</li>
<li>扣除材料方法 RemoveItems 如果 背包的某一个 item 数量为0，需要 ResetSlot 勾选，但还是 UpdateUI 内部逻辑中没有书写逻辑<ul>
<li>会导致 如果有 物品数量刚好是2个 则UI没有更新 在制作的时候图还在，但实际上Items中已经不存在了，拖动会变白色</li>
</ul>
</li>
</ul>
<h3 id="第六章"><a href="#第六章" class="headerlink" title="第六章"></a>第六章</h3><h4 id="59-统计控件介绍"><a href="#59-统计控件介绍" class="headerlink" title="59 统计控件介绍"></a>59 统计控件介绍</h4><p>统计数据<br>健康、食物、水、耐久度、经验值、等级</p>
<h4 id="60-统计控件UI"><a href="#60-统计控件UI" class="headerlink" title="60 统计控件UI"></a>60 统计控件UI</h4><p>下载资源文件 food&#x2F;stam&#x2F;water.TGA 到 _Main&#x2F;Widgets&#x2F;Textures 目录中</p>
<p>在 _Main&#x2F;Widgets 目录下 创建 文件夹 PlayerWidgets<br>在 _Main&#x2F;Widgets&#x2F;PlayerWidgets 目录下 创建 控件 W_PlayerStatsWindow</p>
<ul>
<li>Size box W300 H160 切换模式<ul>
<li>垂直框<ul>
<li>Size box H40<ul>
<li>水平框<ul>
<li>Overlay 填充<ul>
<li>Border 水平+垂直拉伸 透明0<ul>
<li>进度条 水平+垂直拉伸 填充颜色:FF0000FF Percent:1 Rename:HealthBar 是变量</li>
</ul>
</li>
<li>Text Block Padding:20 0 0 5 靠左 垂直居中 Text:+ Size:30 </li>
<li>Text Block Padding:0 0 30 0 靠右 垂直居中 Text:100 Size:24 Color:A0.8 Rename:HealthText 是变量</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Size box 可以复制上一个<ul>
<li>水平框<ul>
<li>Overlay Fill<ul>
<li>Border<ul>
<li>进度条 Rename:FoodBar 是变量 填充颜色:棕色 1C0E08FF</li>
</ul>
</li>
<li>Text Block Padding:20 0 0 5 靠左 Text:+ Size:30</li>
<li>Text Block Padding:0 0 30 0 靠右 垂直居中 Text:100 Size:24 Color:A0.8 Rename:FoodText 是变量</li>
<li>Image Padding:15 6 0 6 垂直居中 Image:food ImageSize:30x30</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Size box 可以复制上一个，记得要先创建Image<ul>
<li>水平框<ul>
<li>Overlay Fill<ul>
<li>Border<ul>
<li>进度条 Rename:WaterBar 是变量 填充颜色:棕色 蓝色 0088FFFF</li>
</ul>
</li>
<li>Text Block Padding:20 0 0 5 靠左 Text:+ Size:30</li>
<li>Text Block Padding:0 0 30 0 靠右 垂直居中 Text:100 Size:24 Color:A0.8 Rename:WaterText 是变量</li>
<li>Image Padding:15 6 0 6 垂直居中 Image:water ImageSize:30x30</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Size box 可以复制上一个<ul>
<li>水平框<ul>
<li>Overlay Fill<ul>
<li>Border<ul>
<li>进度条 Rename:StamBar 是变量 填充颜色:棕色 蓝色 00FF72FF</li>
</ul>
</li>
<li>Text Block Padding:20 0 0 5 靠左 Text:+ Size:30</li>
<li>Text Block Padding:0 0 30 0 靠右 垂直居中 Text:100 Size:24 Color:A0.8 Rename:StamText 是变量</li>
<li>Image Padding:15 6 0 6 垂直居中 Image:stam ImageSize:30x30</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN W_MainWidget</p>
<ul>
<li>将 W_PlayerStatsWindow <strong>拖进</strong> W_MainWidget 中，直接添加组件在层级中会尺寸不一</li>
<li>拖入右下角后，设置锚点也在右下角</li>
</ul>
<h4 id="61-统计控件结构文件，攻击其他玩家造成伤害"><a href="#61-统计控件结构文件，攻击其他玩家造成伤害" class="headerlink" title="61 统计控件结构文件，攻击其他玩家造成伤害"></a>61 统计控件结构文件，攻击其他玩家造成伤害</h4><p>创建 蓝图结构 S_PlayerStats</p>
<ul>
<li>CurrentHealth float</li>
<li>MaxHealth float</li>
<li>CurrentFood float</li>
<li>MaxFood float</li>
<li>CurrentWater float</li>
<li>MaxWater float</li>
<li>CurrentStamina float</li>
<li>MaxStamina float</li>
<li>CurrentLevel int</li>
<li>CurrentExp int</li>
<li>SkillPoints int</li>
</ul>
<p>创建 蓝图枚举 E_StatEnum</p>
<ul>
<li>Health 健康</li>
<li>Food 食物</li>
<li>Water 水</li>
<li>Stamina 耐力</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>增加 变量 PlayerStats S_PlayerStats<ul>
<li>默认值<ul>
<li>CurrentHealth 100</li>
<li>MaxHealth 100</li>
<li>CurrentFood 100</li>
<li>MaxFood 100</li>
<li>CurrentWater 100</li>
<li>MaxWater 100</li>
<li>CurrentStamina 100</li>
<li>MaxStamina 100</li>
<li>CurrentLevel 1</li>
<li>CurrentExp 0</li>
<li>SkillPoints 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Hatchet 增加 物品 对玩家的碰撞，对其伤害</p>
<ul>
<li>思路<ul>
<li>Apply Damage</li>
<li>Does Implement Interface 查看某个对象是否实现了 某个接口</li>
</ul>
</li>
<li>ServerOverlap 方法</li>
<li>碰撞 对象类型 增加 Pawn</li>
<li>循环 收货 方法<ul>
<li>循环体内 Does Implement Interface <ul>
<li>Interface &#x3D;&gt; BPI_LargeItem</li>
<li>判断 击中 玩家 print</li>
<li>Apply Damage<ul>
<li>Damage 固定 15</li>
<li>Damage Type Class &#x3D;&gt; DmgType_Type</li>
<li>Instigated By &#x3D;&gt; 发起者 为 CharRef 斧头拥有者 的 Get Controller</li>
<li>Damage Causer &#x3D;&gt; get a reference to self</li>
<li>Damage Event Class &#x3D;&gt; 伤害类型</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>BP_FirstPersonCharacter</p>
<ul>
<li>Event AnyDamage <code>这个事件是UE引擎自带的，要配合 Switch Has Authority 使用</code><ul>
<li>打印一下受到的伤害</li>
<li>设置玩家当前的血量</li>
</ul>
</li>
<li>增加 方法 ApplyDamageToPlayer<ul>
<li>Inputs<ul>
<li>Damage float</li>
<li>DamageCauser Actor</li>
</ul>
</li>
<li>根据 PlayerStats的值选取当前的血量</li>
<li>PlayerStats -&gt; Set Member In Struct<ul>
<li>CurrentHealth &#x3D;&gt; CurrentHealth</li>
</ul>
</li>
<li>判断当前血量是否小于等于0<ul>
<li>true<ul>
<li>print 死亡</li>
</ul>
</li>
<li>false<ul>
<li>print 受到伤害</li>
</ul>
</li>
</ul>
</li>
<li>更新 UI，调用 W_PlayerStatsWindow 的 UpdateBar 方法<ul>
<li>Get Controller 的 Survival Game PC Ref 的 PlayerControllerRef 下</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN W_PlayerStatsWindow</p>
<ul>
<li>新增 UpdateBar 方法<ul>
<li>Inputs<ul>
<li>stat &#x3D;&gt; E_StatEnum</li>
<li>Current float</li>
<li>max float</li>
</ul>
</li>
<li>修改进度条<ul>
<li>根据 stat 的类型，判断是哪个进度条<ul>
<li>Health</li>
<li>Food</li>
<li>Water</li>
<li>Stamina</li>
</ul>
</li>
<li>修改 进度条 的 进度 Set Percent</li>
</ul>
</li>
<li>修改进度条提示文本<ul>
<li>根据 stat 的类型，判断是哪个文本</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN SurvivalGamePC</p>
<ul>
<li>创建 自定义事件 UpdateStatBarOnClient<ul>
<li>Inputs<ul>
<li>stat E_StatEnum</li>
<li>Current float</li>
<li>max float</li>
</ul>
</li>
<li>调用 MainWidgetRef 的 Target W_PlayerStatsWindow 的 UpdateBar<ul>
<li>stat &#x3D;&gt; stat</li>
<li>Current &#x3D;&gt; Current</li>
<li>max &#x3D;&gt; max</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="62-食物和水的消耗"><a href="#62-食物和水的消耗" class="headerlink" title="62 食物和水的消耗"></a>62 食物和水的消耗</h4><p>思路：</p>
<ul>
<li>角色蓝图中 事件 Event BeginPlay 中 调用自定义事件 DecreaseStatsOverTimeOnServer</li>
<li>每隔一段时间循环执行</li>
<li>减少食物和水的值</li>
<li>更新客户端的UI</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 自定义事件 DecreaseStatsOverTimeOnServer 在服务器中 每隔一段时间循环执行</li>
<li>Set Timer by Event<ul>
<li>Event &#x3D;&gt; 创建 自定义事件 PassiveStatDrain<ul>
<li>创建方法 FoodWaterDrain</li>
</ul>
</li>
<li>Time 10s</li>
<li>Looping 勾选</li>
</ul>
</li>
<li>创建 方法 FoodWaterDrain<ul>
<li>DecreaseFloat 减少食物<ul>
<li>FloatToDecrease &#x3D;&gt; PlayerStats -&gt; CurrentFood</li>
<li>Percentage &#x3D;&gt; 0.02</li>
<li>Max &#x3D;&gt; PlayerStats -&gt; MaxFood</li>
</ul>
</li>
<li>判断是否饿死</li>
<li>DecreaseFloat 减少水<ul>
<li>FloatToDecrease &#x3D;&gt; PlayerStats -&gt; CurrentWater</li>
<li>Percentage &#x3D;&gt; 0.04</li>
<li>Max &#x3D;&gt; PlayerStats -&gt; MaxWater</li>
</ul>
</li>
<li>判断是否渴死</li>
<li>更新UI<ul>
<li>调用 W_PlayerStatsWindow 的 UpdateBar</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 DecreaseFloat <ul>
<li>Inputs<ul>
<li>FloatToDecrease float 当前的值</li>
<li>Percentage float 减少的百分比</li>
<li>Max float 最大值</li>
</ul>
</li>
<li>Outputs<ul>
<li>Return float</li>
</ul>
</li>
<li>Clamp(Float) : FloatToDecrease - Percentage * Max, 0, Max</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ul>
<li>是否正常衰减</li>
<li>衰减完的提示</li>
</ul>
<h4 id="63-自动扣减血量-饥饿和口渴，并且触发提示"><a href="#63-自动扣减血量-饥饿和口渴，并且触发提示" class="headerlink" title="63 自动扣减血量 &amp;&amp; 饥饿和口渴，并且触发提示"></a>63 自动扣减血量 &amp;&amp; 饥饿和口渴，并且触发提示</h4><p>OPEN BP_FirstPersonCharacter 降低血量逻辑</p>
<ul>
<li>创建 变量 isDead? bool</li>
<li>创建 变量 isStarving? bool 是否饿死</li>
<li>创建 变量 isDehydrated? bool 是否脱水</li>
<li>创建 自定义事件 DecreaseHealthOverTimeOnServer<ul>
<li>Set Timer by Event<ul>
<li>Event &#x3D;&gt; 自定义事件 DecreaseHealth<ul>
<li>创建方法 HealthDrain</li>
</ul>
</li>
<li>Time 10s</li>
<li>Looping 勾选</li>
<li>Return Value &#x3D;&gt; 设置 变量 HealthDecreaseTimerHandle</li>
</ul>
</li>
</ul>
</li>
<li>创建 自定义事件 DecreaseHealth<ul>
<li>判断是否死亡   <ul>
<li>true<ul>
<li>HealthDecreaseTimerHandle -&gt; Clear and Invalidate Timer by Handle</li>
</ul>
</li>
<li>false<ul>
<li>判断 and bool<ul>
<li>isStarving?</li>
<li>isDehydrated?</li>
<li>true<ul>
<li>RemoveHealth 每秒 加倍 掉血 4</li>
</ul>
</li>
<li>false<ul>
<li>RemoveHealth 每秒 基础 掉血 2</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 RemoveHealth<ul>
<li>Inputs<ul>
<li>Amount float</li>
</ul>
</li>
<li>Apply Damage<ul>
<li>Damage Actor &#x3D;&gt; self</li>
<li>Base Damage &#x3D;&gt; Amount</li>
<li>Damage Type Class &#x3D;&gt; 伤害类型</li>
<li>Instigated By &#x3D;&gt; 发起者 为 CharRef 斧头拥有者 的 Get Controller</li>
<li>Damage Causer &#x3D;&gt; get a reference to self</li>
</ul>
</li>
</ul>
</li>
<li>修改 方法 FoodWaterDrain<ul>
<li>判断是否饿死<ul>
<li>true<ul>
<li>isStarving? &#x3D;&gt; true</li>
<li>HealthDecreaseTimerHandle -&gt; Is Timer Active by Handle</li>
</ul>
</li>
<li>false<ul>
<li>isStarving? &#x3D;&gt; false</li>
</ul>
</li>
</ul>
</li>
<li>判断是否渴死<ul>
<li>true<ul>
<li>isDehydrated? &#x3D;&gt; true</li>
<li>HealthDecreaseTimerHandle -&gt; Is Timer Active by Handle</li>
</ul>
</li>
<li>false<ul>
<li>isDehydrated? &#x3D;&gt; false</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>方法 ApplyDamageToPlayer<ul>
<li>判断是否死亡<ul>
<li>true<ul>
<li>isDead? &#x3D;&gt; true</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>思路：</p>
<ul>
<li>控制扣减生命值执行 在 FoodWaterDrain 的方法中<ul>
<li>如果死亡则停止扣减</li>
</ul>
</li>
<li>扣减食物和水时，如果当前角色已死亡，则销毁定时器句柄</li>
</ul>
<p>创建 控件 S_StatNotificationWidget 在 _Main&#x2F;Widgets&#x2F;PlayerWidgets 目录下</p>
<ul>
<li>水平框<ul>
<li>Text Block 居中 Text:饥饿，请吃点东西 Size:45 Rename NotificationText 是变量<ul>
<li>增加动画 FadeinOutAnimation &#x3D;&gt; add Track  &#x3D;&gt; Render Opacity <ul>
<li>关键帧 0s:1 2s:0 4s:1</li>
</ul>
</li>
</ul>
</li>
<li>Image Image:food ImageSize:100x100 Rename StatImage 是变量</li>
</ul>
</li>
<li>事件图<ul>
<li>增加 变量 IsStarvingOrDehydrated? bool</li>
<li>构造事件<ul>
<li>FadeinOutAnimation 的 Play Animation<ul>
<li>Num Loops to Play &#x3D;&gt; 0</li>
</ul>
</li>
<li>判断是否 挨饿or脱水<ul>
<li>true<ul>
<li>IsStarvingOrDehydrated? &#x3D;&gt; true</li>
<li>NotificationText &#x3D;&gt; <ul>
<li>Set Text &#x3D;&gt; 饥饿，请吃点东西吧</li>
<li>Set Color and Opacity &#x3D;&gt; make slate color 红色 FF0500FF</li>
</ul>
</li>
<li>StatImage &#x3D;&gt; 使用纹理设置笔刷 Image:food</li>
</ul>
</li>
<li>false<ul>
<li>IsStarvingOrDehydrated? &#x3D;&gt; false</li>
<li>NotificationText &#x3D;&gt; <ul>
<li>Set Text &#x3D;&gt; 口渴，请喝点水吧</li>
<li>Set Color and Opacity &#x3D;&gt; make slate color 蓝色 0088FFFF (00FF72FF备用)</li>
</ul>
</li>
<li>StatImage &#x3D;&gt; 使用纹理设置笔刷 Image:water</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN W_Inventory</p>
<ul>
<li>新建 垂直框<ul>
<li>放入 S_StatNotificationWidget 控件 先看一下大致位置效果，然后删除</li>
<li>调整 垂直框<ul>
<li>size to Context</li>
<li>对齐 0.5 0，PositionY:70</li>
<li>Rename:NotificationBox 是变量</li>
</ul>
</li>
<li>删除 控件</li>
</ul>
</li>
<li>事件图 在Event中 将 S_StatNotificationWidget 放入 NotificationBox 中</li>
</ul>
<p>OPEN W_MainWidget</p>
<ul>
<li>创建 变量 存储通知 控件 StarvingWidget S_StatNotificationWidget 存储控件</li>
<li>创建 变量 存储通知 控件 DehydratedWidget S_StatNotificationWidget 存储控件</li>
<li>要根据 控件的 IsStarvingOrDehydrated? bool 来判断是 挨饿 还是 脱水</li>
<li>各个方法<ul>
<li>方法 ShowStarvingNotification 展示 挨饿通知，要获取无效的控件操作，如果存在则不需要创建</li>
<li>方法 RemoveStarvingNotification 移除 挨饿通知，要获取有效的控件操作，如果不存在则不需要移除</li>
<li>方法 ShowDehydratedNotification 展示 脱水通知，要获取无效的控件操作，如果存在则不需要创建</li>
<li>方法 RemoveDehydratedNotification 移除 脱水通知，要获取有效的控件操作，如果不存在则不需要移除</li>
</ul>
</li>
</ul>
<p>OPEN SurvivalGamePC</p>
<ul>
<li>创建 自定义事件 ShowOrHideStarvingOnClient</li>
<li>创建 自定义事件 ShowOrHideDehydratedOnClient</li>
<li>共同<ul>
<li>Inputs<ul>
<li>ShowOrHide? bool</li>
</ul>
</li>
<li>判断 ShowOrHide?<ul>
<li>Show</li>
<li>Hide</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="64-耐力消耗和恢复"><a href="#64-耐力消耗和恢复" class="headerlink" title="64 耐力消耗和恢复"></a>64 耐力消耗和恢复</h4><p>修复上一节课的bug</p>
<ul>
<li>在 FoodWaterDrain 方法中，获取控制器 UpdateStatBarOnClient 时，有可能部件正在创建，可能会获取不到，所以要判断是否有效<ul>
<li>增加判断<ul>
<li>判断 Get Controller 的 Return value 是否有效，有效则继续</li>
</ul>
</li>
</ul>
</li>
<li>自定义事件 DecreaseStatsOverTime 的 set Timer by Event 事件<ul>
<li>增加参数 Initial Start Delay 初始延迟时间 1s</li>
</ul>
</li>
</ul>
<p>目的：四处走动消耗耐力，停止行动恢复耐力<br>思路：</p>
<ol>
<li>获取用户当前的速度：角色移动 [Character Movement] -&gt; 获取组件当前的速度 [Get Velocity] -&gt; 获取向量长度 [Vector Length]</li>
</ol>
<p>OPEN_FirstPersonCharacter</p>
<ul>
<li><p>创建 变量 IsSprinting? bool</p>
</li>
<li><p>创建 变量 ShouldDrain? bool</p>
</li>
<li><p>事件 xx中</p>
</li>
<li><p>往后增加逻辑</p>
</li>
<li><p>如果 步行速度 如果大于 &gt; 100 则认为需要消耗耐力</p>
<ul>
<li>true<ul>
<li>执行 消耗耐力 方法 StartDrainStaminaOnServer</li>
</ul>
</li>
<li>false<ul>
<li>执行 恢复耐力 方法 StopDrainStaminaOnServer</li>
</ul>
</li>
</ul>
</li>
<li><p>增加 变量 ShouldDrain? bool</p>
</li>
<li><p>创建 自定义事件 StartDrainStaminaOnServer</p>
<ul>
<li>Do once</li>
<li>Set ShouldDrain? &#x3D;&gt; true</li>
<li>DrainStamina</li>
</ul>
</li>
<li><p>创建 自定义事件 StopDrainStamina</p>
<ul>
<li>Set ShouldDrain? &#x3D;&gt; false</li>
<li>执行方法 RegenStamina</li>
<li>转到 StartDrainStaminaOnServer 方法中的 Do once 的 Reset</li>
</ul>
</li>
<li><p>创建 自定义事件 DrainStamina 循环消耗耐力</p>
</li>
<li><p>创建 自定义事件 RegenStamina 回复耐力</p>
</li>
<li><p>创建 方法 RegenStaminaFunction</p>
</li>
<li><p>创建 方法 DrainStamFunction</p>
</li>
</ul>
<h4 id="65-Shift键-增加冲刺功能"><a href="#65-Shift键-增加冲刺功能" class="headerlink" title="65 Shift键 增加冲刺功能"></a>65 Shift键 增加冲刺功能</h4><p>思路：</p>
<ul>
<li>冲刺 消耗 耐力值</li>
<li>耐力值低下 则减少用户的速度</li>
<li>耐力值恢复 则恢复用户的速度</li>
<li>Character Movement -&gt; Set Max Walk Speed 设置最大行走速度</li>
</ul>
<p>OPEN FirstPersonCharacter 蓝图</p>
<ul>
<li>创建 变量 StamLow? bool</li>
<li>创建 自定义事件 SetWalkSpeedOnServer</li>
<li>创建 自定义事件 SetWalkSpeedNormalOnServer</li>
<li>创建 自定义事件 MulticastWalkSpeed</li>
<li>创建 自定义事件 SetStaminaOnClient</li>
<li>Shift键 Event</li>
</ul>
<p><img src="/blog/p/614a8811/DrainStamFunction_add%E8%80%90%E5%8A%9B%E5%80%BC%E6%94%B9%E5%8F%98%E9%80%9F%E5%BA%A6.png" alt="DrainStamFunction_add耐力值改变速度.png"></p>
<p><img src="/blog/p/614a8811/FirstPersonCharacter%E8%80%90%E5%8A%9B%E5%86%B2%E5%88%BA%E6%94%B9%E5%8F%98%E9%80%9F%E5%BA%A6.png" alt="FirstPersonCharacter耐力冲刺改变速度.png"></p>
<p><img src="/blog/p/614a8811/RegenStaminaFunction_add%E8%80%90%E5%8A%9B%E5%80%BC%E6%94%B9%E5%8F%98%E9%80%9F%E5%BA%A6.png" alt="RegenStaminaFunction_add耐力值改变速度.png"></p>
<h4 id="66-浆果等食物的恢复效果"><a href="#66-浆果等食物的恢复效果" class="headerlink" title="66 浆果等食物的恢复效果"></a>66 浆果等食物的恢复效果</h4><p>物品使用逻辑</p>
<ul>
<li>食物 找到对应属性 增加效果</li>
<li>删除食物</li>
<li>添加 音效</li>
</ul>
<ol>
<li>FirstPersonCharacter<ul>
<li>修改方法 UseHotbarFunction<ul>
<li>对于消耗品 执行 ConsumeItemFunction</li>
</ul>
</li>
<li>新增方法 ConsumeItemFunction <ul>
<li>执行 BPC_ItemsContainer 的 RemoveQuantity</li>
<li>找到对应消耗品的 消耗Info，循环执行 UpdateStatInstant 更新用户状态</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li>新增方法 UpdateStatInstant<ul>
<li>根据 stat 类型 <ul>
<li>计算出相加的值 Clamp</li>
<li>赋值<ul>
<li>Food 类型 处理 饥饿状态 以及饥饿UI ShowOrHideStarvingOnClient</li>
<li>Water 类型 处理 缺水状态 以及缺水UI ShowOrHideDehydratedOnClient</li>
</ul>
</li>
</ul>
</li>
<li>更新 UI UpdateStatBar 控制器 生存游戏 PCRef &#x3D;&gt; UpdateStatBar</li>
</ul>
</li>
</ul>
<ol start="2">
<li>BPC_ItemsContainer<ul>
<li>新增方法 RemoveQuantity<ul>
<li>考虑 <code>&lt;= 0</code></li>
<li>执行方法 UpdateItemQuantity</li>
</ul>
</li>
<li>新增方法 UpdateItemQuantity<ul>
<li>设置 Items 的 item</li>
<li>设置 Items Array</li>
<li>更新UI</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>选取的食物是浆果，ID 6</p>
<p>创建 蓝图结构文件 S_Consumable 在 _Main&#x2F;Blueprints&#x2F;Structures&#x2F;ConsumableStructs 目录下</p>
<ul>
<li>StatToModify E_StatEnum</li>
<li>InstantEffect? bool 是否即时增益</li>
<li>RestoreAmount Float</li>
<li>OverTime? bool 增益持续时间</li>
<li>OverTimeAmount Float 效果持续时间</li>
<li>OverTimeDuration Float 每段时间增益</li>
</ul>
<p>创建 蓝图结构文件 S_ConsumableInfo 在 _Main&#x2F;Blueprints&#x2F;Structures&#x2F;ConsumableStructs 目录下</p>
<ul>
<li>ItemName Text</li>
<li>StatsToUpdate S_Consumable array</li>
</ul>
<p>创建 其他-数据表 FROM S_ConsumableInfo 名字：DT_Consumables</p>
<ul>
<li>创建数据<ul>
<li>RowName 6</li>
<li>ItemName 浆果</li>
<li>StatsToUpdate<ul>
<li>0<ul>
<li>StatToModify 食物</li>
<li>InstantEffect? true</li>
<li>RestoreAmount 2</li>
<li>OverTime? false</li>
<li>OverTimeAmount 0</li>
<li>OverTimeDuration 0</li>
</ul>
</li>
<li>1      <ul>
<li>StatToModify 水</li>
<li>InstantEffect? true</li>
<li>RestoreAmount 4</li>
<li>OverTime? false</li>
<li>OverTimeAmount 0</li>
<li>OverTimeDuration 0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN FirstPersonCharacter</p>
<ul>
<li>创建 方法 ConsumeItemFunction<ul>
<li>Inputs<ul>
<li>ItemIndex int</li>
<li>ContainerType E_ContainerType</li>
</ul>
</li>
<li>设置 参数 为本地变量</li>
<li>消耗物品</li>
<li>根据物品找出消耗后的属性</li>
<li>BPC_PlayerInventory &#x3D;&gt; select &amp; BPC_PlayerHotbar</li>
<li>RemoveQuantity</li>
<li>UpdateStatInstant</li>
</ul>
</li>
<li>使用快捷栏物品 Event 触发<ul>
<li>ConsumeItemFunction</li>
</ul>
</li>
</ul>
<p>BPC_ItemsContainer 增加 更新物品数量的方法 UpdateItemQuantity</p>
<ul>
<li>Inputs<ul>
<li>Index</li>
<li>Quantity</li>
</ul>
</li>
<li>Params 都 设置本地</li>
<li>设置 S_ItemInfo Array Elem<ul>
<li><code>&lt;=0</code> 删除 执行 RemoveItemIndex</li>
<li><code>&gt;0</code> 更新UI</li>
</ul>
</li>
<li>Return Node<ul>
<li>RemoveOrUpdate?</li>
</ul>
</li>
</ul>
<p>BPC_ItemsContainer 增加方法 RemoveQuantity</p>
<ul>
<li>删除指定物品指定数量</li>
<li>Inputs<ul>
<li>Index</li>
<li>AmountToRemove</li>
</ul>
</li>
<li>Items &#x3D;&gt; Get Copy</li>
<li>UpdateItemQuantity</li>
<li>Return Node<ul>
<li>Removed?</li>
<li>RemovedAmount</li>
</ul>
</li>
</ul>
<p>OPEN FirstPersonCharacter 增加 更新状态 方法 UpdateStatInstant</p>
<ul>
<li>Inputs<ul>
<li>StatToChange E_Stat Enum</li>
<li>Amount float</li>
</ul>
</li>
<li>PlayerStats Break S_PlayerStats </li>
<li>根据 Stats 分别 进行增益</li>
<li>更新 hotbar 设置最大值</li>
</ul>
<p>浆果类型 设置为 消耗品 Consumable</p>
<h4 id="67-消耗品持续增益效果"><a href="#67-消耗品持续增益效果" class="headerlink" title="67 消耗品持续增益效果"></a>67 消耗品持续增益效果</h4><p>增加物品 DT_Items</p>
<ul>
<li>ID 8</li>
<li>Q 1</li>
<li>Icon Tex_meat_07_b</li>
<li>Name Cooked Meat</li>
<li>说明 Restores Food and Health Over Time</li>
<li>StackSize 30</li>
<li>Type 消耗品<br>增加 消耗品的增益信息 DT_Consumables</li>
<li>ID 2</li>
<li>Row Name 8 </li>
<li>Name Cooked Meat</li>
<li>增益 Health</li>
<li>OverTime? True</li>
<li>10</li>
<li>5</li>
</ul>
<ol>
<li>FirstPersonCharacter</li>
</ol>
<ul>
<li>增加 Event UpdateStatOverTime<ul>
<li>根据不同的 StatToChange E_Stat enum 定时执行不同的 Function （Set Timer by Function Name）</li>
<li>赋值<ul>
<li>对应状态的 xxAmount 变量</li>
<li>对应状态的 xxTimer 定时器句柄</li>
</ul>
</li>
</ul>
</li>
<li>增加 方法 <ul>
<li>HealthOverTimeFunction<ul>
<li>if 当前增益类型 Amount &lt;&#x3D;0 重置定时器句柄</li>
<li>修改 当前增益类型 Amount - 1</li>
<li>执行 StatOverTimeFunction</li>
</ul>
</li>
<li>FoodOverTimeFunction<ul>
<li>同上</li>
</ul>
</li>
<li>WaterOverTimeFunction<ul>
<li>同上</li>
</ul>
</li>
<li>StaminaOverTimeFunction<ul>
<li>同上</li>
</ul>
</li>
</ul>
</li>
<li>增加 方法 StatOverTimeFunction<ul>
<li>根据参数 计算出增益的值<ul>
<li>UpdateStatBar</li>
<li>设置 PlayerStats</li>
</ul>
</li>
</ul>
</li>
<li>修改 方法 ConsumeItemFunction <ul>
<li>对于 InstantEffect? false &amp; OverTime? true 的  执行 Event UpdateStatOverTime</li>
</ul>
</li>
</ul>
<p>UpdateStatOverTime</p>
<ul>
<li>Inputs<ul>
<li>StatToChange E_Stat enum</li>
<li>OverTimeAmount float</li>
<li>Duration float</li>
</ul>
</li>
<li>根据 StatToChange Switch<ul>
<li>LocalHealthAmount</li>
<li>LocalFoodAmount</li>
<li>LocalWatchAmount</li>
<li>LocalStaminaAmount</li>
<li>Set Timer by Event<ul>
<li>Time &#x3D; OverTimeAmount&#x2F;Duration</li>
<li>FunctionName &#x3D; HealthOverTime</li>
<li>LocalHealthTimer</li>
<li>LocalFoodTimer</li>
<li>LocalWatchTimer</li>
<li>LocalStaminaTimer</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>StatOverTimeFunction</p>
<ul>
<li>Inputs<ul>
<li>StatToChange E_Stat enum</li>
<li>Amount float</li>
</ul>
</li>
<li>转为本地变量</li>
<li>PlayerStats break</li>
<li>LocalStat Select</li>
<li><code>+</code> LocalAmount Clamp<ul>
<li>Max LocalStat Select</li>
</ul>
</li>
<li>Set LocalCurUpdatedAmount</li>
<li>UpdateStatBar 方法</li>
<li>LocalStat Switch</li>
<li>设置用户状态 PlayerStats Set members</li>
</ul>
<h4 id="68-玩家统计信息窗口部件（玩家等级信息）UI"><a href="#68-玩家统计信息窗口部件（玩家等级信息）UI" class="headerlink" title="68 玩家统计信息窗口部件（玩家等级信息）UI"></a>68 玩家统计信息窗口部件（玩家等级信息）UI</h4><p>导入纹理文件</p>
<p>创建部件 用户部件 部件蓝图 用户部件 W_PlayerStat</p>
<ul>
<li>添加变量<ul>
<li>StatName Text</li>
<li>Stat E_Stat Enum 可公开可编辑</li>
</ul>
</li>
<li>Size box 重写 WH：500 50<ul>
<li>水平框<ul>
<li>覆盖 Fill<ul>
<li>边框 全居中 笔刷颜色 透明度0<ul>
<li>进度条 padding 10 5 70 10 COLOR 009C73FF</li>
</ul>
</li>
<li>文本 padding:20 5 0 5 Text Health bind：StatName font-size:25 </li>
<li>文本 padding:0 0 90 0 水平右居 垂直中 Font:100&#x2F;100 Rename:StatText 是变量</li>
<li>尺寸框 水平右 垂直中 P:0 0 15 0 重写WD:40 40<ul>
<li>按钮 Rename:LevelStatButton 是变量 image:boxbutton 绘画成 图像 normal:color:FFFFFFFF 复制 Hovered、Pressed  Hovered：color:FFCE00FF Pressed:color:3FFF00FF<ul>
<li>文本 Text： + 文本对齐(Justfication):居中 padding 4 2 4 5</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建部件 用户接口 部件蓝图 W_PlayerInfoWindow</p>
<ul>
<li>SizeBox 重写WH:500 240<ul>
<li>垂直框 拉伸<ul>
<li>水平框 填充<ul>
<li>覆盖 填充<ul>
<li>Border 全居中 笔刷透明度0<ul>
<li>进度条 P:10 5 10 5 Color:00CE4AFF</li>
</ul>
</li>
<li>Text Rename:ExperienceText 是变量 垂直居中 P:20 5 0 5 size:15 Text:XP:1000&#x2F;5000</li>
<li>Text Rename:SkillPointsText 是变量 右居中 垂直居中 P:0 0 20 0 size:18 Text:技能点:0</li>
</ul>
</li>
</ul>
</li>
<li>部件 W_PlayerStat 修改默认值和名字 W_PlayerStatHealth stat:Health</li>
<li>部件 W_PlayerStat 修改默认值和名字 W_PlayerStatFood stat:Food</li>
<li>部件 W_PlayerStat 修改默认值和名字 W_PlayerStatWater stat:Water</li>
<li>部件 W_PlayerStat 修改默认值和名字 W_PlayerStatStamina stat:Stamina</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>修改部件 W_Inventory<br>中间Player name<br>的 VBV中增加水平盒子</p>
<ul>
<li>水平<ul>
<li>垂直</li>
<li>垂直</li>
</ul>
</li>
<li>水平<ul>
<li>垂直(头盔 护甲) 用于 <ul>
<li>间隔区 Spacer Size:90,30</li>
</ul>
</li>
<li>垂直 填充<ul>
<li>size box 重写WH:200 250 填充<ul>
<li>Overlay<ul>
<li>Border 居中 35 5 35 5 纹理：craftoverlay 拉伸</li>
</ul>
</li>
</ul>
</li>
<li>部件 W_PlayerInfoWindow</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>W_Inventory Player Name同级</p>
<ul>
<li>Size Box 重写WH:50 <ul>
<li>Border 纹理：testlvlicon<ul>
<li>TextBlock Rename PlayerLevelText 是变量 1 居中</li>
</ul>
</li>
</ul>
</li>
<li>Text Player Name 设置 Padding-left:40</li>
</ul>
<h4 id="69-玩家统计信息窗口部件（玩家等级信息）逻辑"><a href="#69-玩家统计信息窗口部件（玩家等级信息）逻辑" class="headerlink" title="69 玩家统计信息窗口部件（玩家等级信息）逻辑"></a>69 玩家统计信息窗口部件（玩家等级信息）逻辑</h4><p>W_PlayerStat 部件</p>
<ul>
<li>增加 Event UpdateStatWidget<ul>
<li>Inputs<ul>
<li>Current float</li>
<li>Max float</li>
</ul>
</li>
<li>Set Percent 设置 进度条 &#x3D; Current&#x2F;Max</li>
<li>SetText 变量 StatText &#x3D; format Text &#x3D;”{Current}&#x2F;{Max}”<ul>
<li>format Int</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>W_PlayerInfoWindow 部件</p>
<ul>
<li>增加 Event <ul>
<li>Inputs UpdateStat<ul>
<li>StatToUpdate E_Stat Enum</li>
<li>Current float</li>
<li>Max float</li>
</ul>
</li>
<li>根据 部件的参数 Stat 选择更改 对应的 Text 和 进度条 <ul>
<li>Return 部件对象</li>
</ul>
</li>
<li>执行 部件内部的 Update Stat Widget 方法</li>
</ul>
</li>
</ul>
<p>SurvivalGame_PC</p>
<ul>
<li>事件 UpdateStatBar 中 同时更新  UpdateStat</li>
</ul>
<h4 id="70-经验和升级-逻辑"><a href="#70-经验和升级-逻辑" class="headerlink" title="70 经验和升级 逻辑"></a>70 经验和升级 逻辑</h4><p>成功制作物品后，物品如果有经验设置，则增加玩家经验。调用First事件 -&gt; AddExpFun -&gt; Survival</p>
<p>创建文件夹 蓝图 结构 &gt; MiscStructures<br>创建蓝图结构 S_ExperienceStruct</p>
<ul>
<li>ExpNeeded Int<br>新建数据表 经验表 Pick S_ExperienceStruct Rename DT_ExperienceTable</li>
<li>1 1 15</li>
<li>2 2 34</li>
<li>3 3 57</li>
<li>4 4 92</li>
<li>5 5 135</li>
<li>6 6 372</li>
<li>7 7 560</li>
<li>8 8 840</li>
<li>9 9 1240</li>
<li>10 10 1716</li>
<li>… 可以google一个经验表</li>
</ul>
<p>BP_FirstPersonCharacter</p>
<ul>
<li>创建 方法 AddExpFunction 给玩家增加经验 <ul>
<li>思路<ul>
<li>通过增加经验 自动增加 Level</li>
<li>经验和等级在 PlayerStat 存储</li>
<li>通过当前等级 获取 当前所处的 Level</li>
<li>存储 未添加的经验，循环升级</li>
<li>提示用户增加经验 SurvivalGame_PC 的 UpdateExpUIOnClient</li>
</ul>
</li>
<li>Inputs<ul>
<li>Exp Int</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>设置 经验升级 进度条<br>W_PlayerInfoWindow</p>
<ul>
<li>创建 Event UpdateExp<ul>
<li>Inputs<ul>
<li>CurrentExp int</li>
<li>MaxExp int</li>
</ul>
</li>
<li>经验进度条百分比</li>
<li>经验进度条提示文本</li>
</ul>
</li>
</ul>
<p>BP_FirstPersonCharacter</p>
<ul>
<li>创建 Event AddExpOnServer<ul>
<li>执行 AddExpFunction</li>
</ul>
</li>
</ul>
<p>SurvivalGame_PC 增加 Event UpdateExpUIOnClient</p>
<ul>
<li>Inputs<ul>
<li>CurrentExp int</li>
<li>MaxExp int</li>
</ul>
</li>
<li>执行 W_PlayerStat 下的 Add方法</li>
</ul>
<p>设置物品制作成功后的经验值<br>设置PlayerStat的默认值 文字+百分比</p>
<h4 id="71-经验和-升级-增加通知"><a href="#71-经验和-升级-增加通知" class="headerlink" title="71 经验和 升级 增加通知"></a>71 经验和 升级 增加通知</h4><p>获取经验后，弹出获得经验通知：渐入渐出+变大变小，2s后消失。<br>升级后，弹出升级通知：渐入渐出+变大变小，2s后消失。并且更新Tab的当前等级数值</p>
<h5 id="添加经验通知"><a href="#添加经验通知" class="headerlink" title="添加经验通知"></a>添加经验通知</h5><p>创建用户接口 部件 W_ExperienceText in PlayerWidgets 目录</p>
<ul>
<li>创建 变量 Exp Int 可编辑可公开</li>
<li>水平框<ul>
<li>Text 紫色 文字：获得 x100 经验值 Bind 创建绑定 UpdateExpText Format Test 通过变量 Exp 更改<ul>
<li>为上面文字 增加动画 动画 + track Text 转换 关键帧 <ul>
<li>变大变小 &lt;1s</li>
<li>渐入渐出 0 1s 2s</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>构造函数<ul>
<li>Play Animation 播放动画</li>
<li>Bind to Animation Finished<ul>
<li>Delegate -&gt; 自定义事件 DestroySelf<ul>
<li>Remove from parent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>将部件 放在 W_MainWidget 中，与 NotificationBox 下</p>
<ul>
<li>增加 自定义事件 AddExpNotification<ul>
<li>Inputs<ul>
<li>ExpAmount</li>
</ul>
</li>
<li>创建 W_ExperienceText 部件</li>
<li>Add Child 到 Notification box</li>
</ul>
</li>
</ul>
<p>SurvivalGamePC</p>
<ul>
<li>创建 Event ExpNotifyOnClient<ul>
<li>Inputs<ul>
<li>Exp</li>
</ul>
</li>
<li>执行 MainWidgetRef 的 AddExpNotification</li>
</ul>
</li>
</ul>
<p>BP_FirstPersonCharacter</p>
<ul>
<li>AddExpFunction</li>
<li>UpdateExpUI 后 执行 ExpNotify</li>
</ul>
<h5 id="玩家升级通知"><a href="#玩家升级通知" class="headerlink" title="玩家升级通知"></a>玩家升级通知</h5><p>创建 升级 部件 W_LevelNotification</p>
<ul>
<li>垂直框<ul>
<li>text 等级提升！ 当前等级：1  填充 size:45 居中 粉色 FFB8C8FF  Rename:LevelUpText</li>
<li>text 新技能点可用！ 填充 size: 35 居中 绿色 C5FFBCFF Rename:SkillPointsText</li>
</ul>
</li>
<li>构建动画 Rename TextPopAnimation<ul>
<li>为 LevelUpText 增加 两个效果 同上</li>
</ul>
</li>
<li>构建动画 Rename SkillPointsAnimation<ul>
<li>为 LevelUpText 增加 两个效果 同上</li>
</ul>
</li>
<li>Graph<ul>
<li>构造函数 播放两个动画 不需要销毁自身</li>
</ul>
</li>
</ul>
<p>SurvivalGame_PC</p>
<ul>
<li>创建 Event UpdateLevelUIOnClient<ul>
<li>Inputs<ul>
<li>PlayerLevel</li>
</ul>
</li>
<li>执行 部件的 UpdatePlayerLevel</li>
</ul>
</li>
</ul>
<p>BP_FirstPersonCharacter</p>
<ul>
<li>AddExpFunction</li>
<li>ExpNotify 后 执行 UpdateLevelUIOnClient</li>
</ul>
<p>W_MainWidget</p>
<ul>
<li>创建 事件 ShowLevelUpNotification<ul>
<li>播放 等级提升通知</li>
<li>注意：这里需要创建 W_LevelNotification 控件，并且保存为变量</li>
<li>放入 NotificationBox 中(添加子项)</li>
</ul>
</li>
</ul>
<p>SurvivalGamePC</p>
<ul>
<li>创建 Event LevelNotifyOnClient<ul>
<li>Inputs<ul>
<li>Level</li>
</ul>
</li>
<li>执行 MainWidgetRef 的 ShowLevelUpNotification<br><img src="/blog/p/614a8811/SurvivalGamePC_LevelNotifyOnClient.png" alt="SurvivalGamePC_LevelNotifyOnClient.png"></li>
</ul>
</li>
</ul>
<p>修改W_Inventory控件的等级提示<br><img src="/blog/p/614a8811/%E4%BF%AE%E6%94%B9W_Inventory%E6%8E%A7%E4%BB%B6%E7%9A%84%E7%AD%89%E7%BA%A7%E6%8F%90%E7%A4%BA.png" alt="修改W_Inventory控件的等级提示.png"></p>
<h4 id="72-玩家统计数据-技能点"><a href="#72-玩家统计数据-技能点" class="headerlink" title="72 玩家统计数据 技能点"></a>72 玩家统计数据 技能点</h4><p>思路：</p>
<ol>
<li>玩家每次升级 增加 1 技能点</li>
<li>技能点用于 增加 Stat 比例 1:100</li>
<li>技能点是0，则需要关闭等级通知</li>
</ol>
<p>BP_FirstPersonCharacter</p>
<ul>
<li>创建 方法 UseLevelUpSkillPoint<ul>
<li>Inputs<ul>
<li>Stat</li>
</ul>
</li>
<li>如果当前技能点&gt;0,则可以增加对应的stat<ul>
<li>比例1:100</li>
</ul>
</li>
<li>更新 技能点 &amp; UI</li>
<li>更新 用户状态 &amp; UI</li>
</ul>
</li>
<li>创建 事件 ApplyUpLevelSkillPointOnServer<ul>
<li>Inputs<ul>
<li>Stat</li>
</ul>
</li>
<li>UseLevelUpSkillPoint</li>
</ul>
</li>
<li>AddExpFunction 后<ul>
<li>新增局部变量 SkillPoints</li>
<li>UpdateSkillPoints</li>
</ul>
</li>
</ul>
<p>W_PlayerInfoWindow</p>
<ul>
<li>增加 Event UpdateUpLevelSkillPoint<ul>
<li>Inputs<ul>
<li>SkillPoints</li>
</ul>
</li>
<li>修改对应的文字</li>
</ul>
</li>
</ul>
<p>SurvivalGamePC</p>
<ul>
<li>创建 Event UpdateUpLevelSkillPointOnClient<ul>
<li>UpdateUpLevelSkillPoint</li>
</ul>
</li>
<li>创建 Event RemoveLevelNotifyOnClient<ul>
<li>RemoveLevelUpNotification</li>
</ul>
</li>
</ul>
<p>W_MainWidget</p>
<ul>
<li>增加 Event RemoveLevelUpNotification</li>
<li>get is Valid</li>
<li>如果有效，则从父项移除</li>
</ul>
<p>W_PlayerStat</p>
<ul>
<li>LevelStatButton Click 事件<ul>
<li>Get Owning Player Pawn &#x3D;&gt; Get Survival Char Ref &#x3D;&gt; ApplyUpLevelSkillPointOnServer</li>
<li>执行 ApplyUpLevelSkillPointOnServer</li>
</ul>
</li>
</ul>
<h3 id="第七章"><a href="#第七章" class="headerlink" title="第七章"></a>第七章</h3><h4 id="73-盔甲装备"><a href="#73-盔甲装备" class="headerlink" title="73 盔甲装备"></a>73 盔甲装备</h4><h4 id="74-创建盔甲卡槽部件UI"><a href="#74-创建盔甲卡槽部件UI" class="headerlink" title="74 创建盔甲卡槽部件UI"></a>74 创建盔甲卡槽部件UI</h4><p>OPEN W_InventorySlot</p>
<ul>
<li>事件图<ul>
<li>增加变量 BackgroundImage Texture 2D<ul>
<li>设置 默认值 图片 Inventory_Slot_Background</li>
<li>可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
</ul>
</li>
<li>ArmorSlot? bool 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>ArmorType E_ArmorType 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
<li>SlotStyle 可编辑实例[Instance Editable]，完成时公开[Expose on Spawn]</li>
</ul>
</li>
<li>设计<ul>
<li>将其他信息隐藏，只剩的背景 就是想要的卡槽效果</li>
</ul>
</li>
<li>Event Construct 构造函数<ul>
<li>SlotStyle &#x3D;&gt; Set Brush From Texture 给背景增加图片<ul>
<li>Texture &#x3D;&gt; BackgroundImage</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN W_Inventory</p>
<ul>
<li>将 W_InventorySlot 放入到 W_Inventory 中（中间角色人物的左边垂直框）<ul>
<li>Spacer 的下面</li>
</ul>
</li>
<li>W_InventorySlot P:10 0 10 0</li>
<li>复制 Spacer + W_InventorySlot 生成四个框</li>
</ul>
<p>安装下载文件 CharacterWindow_Slot_xxx.TGA 四个文件 导入到 _Main&#x2F;Widgets&#x2F;Textures 目录中</p>
<ul>
<li>第1个框 Rename:HelmetSlot 背景图 CharacterWindow_Slot_Head  默认值ArmorSlot?true Helmet</li>
<li>第2个框 Rename:ChestSlot 背景图 CharacterWindow_Slot_Chest 默认值ArmorSlot?true Chest</li>
<li>第3个框 Rename:PantsSlot 背景图 CharacterWindow_Slot_Pants 默认值ArmorSlot?true Pants</li>
<li>第4个框 Rename:BootsSlot 背景图 CharacterWindow_Slot_Boots 默认值ArmorSlot?true Boots</li>
</ul>
<p>玩家人物背景图 Border</p>
<ul>
<li>Padding-left: 15</li>
</ul>
<h4 id="75-创建装甲物品类"><a href="#75-创建装甲物品类" class="headerlink" title="75 创建装甲物品类"></a>75 创建装甲物品类</h4><p>导入 材质包 _Main Widgets Textures ItemIcon 下</p>
<p>OPEN DT_Items 添加物品上面材质的物品</p>
<ul>
<li>鞋子<ul>
<li>ID 9</li>
<li>数量 1</li>
<li>说明 Leather Boots</li>
<li>Icon boots</li>
<li>ItemDamage 100</li>
<li>CurHP 100</li>
<li>MaxHP 100</li>
<li>Type Armor</li>
<li>ArmorType Boots</li>
<li>ClassRef BP_ArmorBoots 下面创建文件后再设置</li>
</ul>
</li>
<li>裤子<ul>
<li>ID 10</li>
<li>数量 1</li>
<li>说明 Pants</li>
<li>Icon pants</li>
<li>ItemDamage 100</li>
<li>CurHP 100</li>
<li>MaxHP 100</li>
<li>Type Armor</li>
<li>ArmorType Pants</li>
<li>ClassRef BP_ArmorPants</li>
</ul>
</li>
<li>衣服<ul>
<li>ID 11</li>
<li>数量 1</li>
<li>说明 Shirt</li>
<li>Icon Shirt</li>
<li>ItemDamage 100</li>
<li>CurHP 100</li>
<li>MaxHP 100</li>
<li>Type Armor</li>
<li>ArmorType Chest</li>
<li>ClassRef BP_ArmorChest</li>
</ul>
</li>
<li>面具<ul>
<li>ID 12</li>
<li>数量 1</li>
<li>说明 Leather Mask</li>
<li>Icon mask</li>
<li>ItemDamage 100</li>
<li>CurHP 100</li>
<li>MaxHP 100</li>
<li>Type Armor</li>
<li>ArmorType Helmet</li>
<li>ClassRef BP_ArmorHelmet</li>
</ul>
</li>
</ul>
<p>为 BP_ItemMaster 创建蓝图子类 BP_ArmorMaster<br>蓝图s Items 下 创建文件夹 Armor<br>OPEN BP_ArmorMaster</p>
<ul>
<li>创建 变量 ItemInfo S_ItemInfo</li>
</ul>
<p>为 BP_ArmorMaster 创建蓝图接口文件 BPI_ArmorItem</p>
<ul>
<li>创建 方法 GetArmorRef<ul>
<li>Outputs<ul>
<li>ArmorRef BP_ArmorMaster Object</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_ArmorMaster</p>
<ul>
<li>类设置<ul>
<li>增加 BPI_ArmorItem 接口</li>
<li>Return self</li>
</ul>
</li>
<li>增加 骨骼网格 子类实现</li>
</ul>
<p>为 BP_ArmorMaster 创建蓝图子类 BP_ArmorBoots 放入 蓝图s Items Armor下</p>
<ul>
<li>网格选择 SK_Man_Shoes</li>
<li>创建好文件后 设置DT_Items的ClassRef</li>
<li>类默认设置的ItemInfo，可以复制 DT_Items 的信息，然后对准 ItemInfo 粘贴</li>
</ul>
<p>为 BP_ArmorMaster 创建蓝图子类 BP_ArmorChest 放入 蓝图s Items Armor下</p>
<ul>
<li>网格选择 SK_Man_Pullover</li>
<li>创建好文件后 设置DT_Items的ClassRef</li>
<li>类默认设置的ItemInfo，可以复制 DT_Items 的信息，然后对准 ItemInfo 粘贴</li>
</ul>
<p>为 BP_ArmorMaster 创建蓝图子类 BP_ArmorHelmet 放入 蓝图s Items Armor下</p>
<ul>
<li>网格选择 SK_Man_Balaclava</li>
<li>创建好文件后 设置DT_Items的ClassRef</li>
<li>类默认设置的ItemInfo，可以复制 DT_Items 的信息，然后对准 ItemInfo 粘贴</li>
</ul>
<p>为 BP_ArmorMaster 创建蓝图子类 BP_ArmorPants 放入 蓝图s Items Armor下</p>
<ul>
<li>网格选择 SK_Man_Pants </li>
<li>创建好文件后 设置DT_Items的ClassRef</li>
<li>类默认设置的ItemInfo，可以复制 DT_Items 的信息，然后对准 ItemInfo 粘贴</li>
</ul>
<h4 id="76-设置装备装甲功能"><a href="#76-设置装备装甲功能" class="headerlink" title="76 设置装备装甲功能"></a>76 设置装备装甲功能</h4><p>思路：<br>如果 W_InventorySlot 中 拖动松开的位置是卡槽(ArmorSlot?)，则执行其他装备穿戴逻辑<br>增加的逻辑：生成物品后，需要将物品 需要多播 将物品附加到角色上，并且将动画复制过来，更新装备卡槽信息，删除背包的物品</p>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 Event EquipArmorOnServer<ul>
<li>Inputs<ul>
<li>FromContainer E_ContainerType</li>
<li>FromIndex Int</li>
<li>ArmorType E_ArmorType</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN W_InventorySlot</p>
<ul>
<li>编辑 OnDrop 逻辑</li>
<li>如果 拖动松开的位置是卡槽(ArmorSlot?) &amp;&amp; 物品类型是 Armor类型</li>
<li>执行 玩家角色 &#x3D;&gt; SurvivalGamePC 的 EquipArmorOnServer</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 变量 HelmetSlot BP_ItemMaster Object</li>
<li>创建 变量 ChestSlot BP_ItemMaster Object</li>
<li>创建 变量 PantsSlot BP_ItemMaster Object</li>
<li>创建 变量 BootsSlot BP_ItemMaster Object</li>
<li>编辑 EquipArmorOnServer<ul>
<li>调用 EquipArmor</li>
</ul>
</li>
<li>方法 EquipArmor<ul>
<li>只能从 PlayerInventory 中装备</li>
<li>当前 ArmorType select 来装进对应的 变量中，并且需要 Is Valid<ul>
<li>有效，则需要交换</li>
<li>无效，则直接装备上</li>
</ul>
</li>
<li>获取指定的物品，赋值变量 BPC_PlayerInventory Items 通过参数 Index<ul>
<li>只能装备 Armor 类型的物品</li>
<li>检测 正在装备的类型 &#x3D;&#x3D;&#x3D; 已经装备物品的类型 是否相等</li>
</ul>
</li>
<li>SpawnActor<ul>
<li>Class 选择 物品的 ClassRef</li>
<li>分割结构体引脚</li>
</ul>
</li>
<li>当前 ArmorType select 来装进对应的 变量</li>
<li>set Owner 为 self 目标是 SpawnActor 的 Return</li>
<li>PoseCompMulticast<ul>
<li>Target 是 SpawnActor 的 Return</li>
</ul>
</li>
<li>Get Armor Ref<ul>
<li>Target 是 SpawnActor 的 Return</li>
</ul>
</li>
<li>UpdateArmorUIOnClient<ul>
<li>Get Controller 的 SurvivalGamePC</li>
</ul>
</li>
<li>BPC_PlayerInventory RemoveItemAtIndex</li>
</ul>
</li>
<li>创建 Event PoseCompMulticast<ul>
<li>Inputs<ul>
<li>Target BP_ItemMaster</li>
</ul>
</li>
<li>is Valid </li>
<li>Attach Actor To Component<ul>
<li>Parent 是 第三人称网格</li>
<li>三个Rule 都是 Snap to Target</li>
</ul>
</li>
<li>Get Armor Ref</li>
<li>MasterPoseEventMulticast<ul>
<li>CharRef 选择 Self</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_ArmorMaster</p>
<ul>
<li>创建 Event MasterPoseEventMulticast 从第三人称网格 复制动画<ul>
<li>Inputs<ul>
<li>CharRef BP_FirstPersonCharacter</li>
</ul>
</li>
<li>设置 骨骼网格 &#x3D;&gt; 设置总姿势组件 Set Master Pose Component<ul>
<li>New Master Bone Component 选择 Get Survival Char Ref 的 第三人称网格</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN SurvivalGamePC</p>
<ul>
<li>创建 Event UpdateArmorUIOnClient 描述 更新装备部件UI<ul>
<li>Inputs<ul>
<li>ArmorType E_ArmorType</li>
<li>ItemInfo S_ItemInfo</li>
</ul>
</li>
<li>UpdateArmorSlot</li>
</ul>
</li>
</ul>
<p>OPEN W_Inventory</p>
<ul>
<li>创建 Event UpdateArmorSlot<ul>
<li>Inputs<ul>
<li>ArmorType E_ArmorType</li>
<li>ItemInfo S_ItemInfo</li>
</ul>
</li>
<li>通过 type 分别 更新物品 到指定的 变量(部件中)</li>
<li>UpdateSlot</li>
</ul>
</li>
</ul>
<p>测试逻辑：</p>
<ol>
<li>设置R键赋予的物品 id &#x3D; 11</li>
<li>运行时 设置两个玩家 预览</li>
</ol>
<p>测试 本人玩家是可以看到衣服的，需要设置 BP_ArmorMaster 的 OwnerNoSee &#x3D; true</p>
<h4 id="77-装备移动到背包"><a href="#77-装备移动到背包" class="headerlink" title="77 装备移动到背包"></a>77 装备移动到背包</h4><p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>修改 Event OnSlotDropOnServer<ul>
<li>如果是 装备类型 则执行 DequipArmor</li>
</ul>
</li>
<li>创建 Event DequipArmor<ul>
<li>Inputs <ul>
<li>ArmorType E_ArmorType</li>
</ul>
</li>
<li>DequipArmorFunction</li>
</ul>
</li>
<li>创建 方法 DequipArmorFunction<ul>
<li>Inputs <ul>
<li>ArmorType E_ArmorType</li>
</ul>
</li>
<li>获取对应的 Armor对象 </li>
<li>使用 Is Valid 获取</li>
<li>Get Armor Ref<ul>
<li>Target Armor对象</li>
</ul>
</li>
<li>将物品增加到 Inventory BPC_PlayerInventory 的 AddItemOnServer</li>
<li>Destroy Actor<ul>
<li>装备的物品</li>
</ul>
</li>
<li>将对应的装备变量设置为空</li>
<li>移除ArmorUI SurvivalGamePC 的 RemoveArmorUIOnClient</li>
</ul>
</li>
</ul>
<p>OPEN SurvivalGamePC</p>
<ul>
<li>创建 Event RemoveArmorUIOnClient<ul>
<li>Inputs<ul>
<li>ArmorType E_ArmorType</li>
</ul>
</li>
<li>W_Inventory 的 RemoveArmorSlot</li>
</ul>
</li>
</ul>
<p>OPEN W_Inventory</p>
<ul>
<li>创建 方法 RemoveArmorSlot<ul>
<li>Inputs<ul>
<li>ArmorType E_ArmorType</li>
</ul>
</li>
<li>对应槽的 ResetSlot Event <code>用来清除 卡槽内的物品 恢复之前的样子</code></li>
</ul>
</li>
</ul>
<p>测试发现 从装备栏中 无法获取 对应的 容器Type，所以需要在 W_InventorySlot 中 公开并且可修改</p>
<ul>
<li>在 W_Inventory 中 修改四个装备栏的 容器 Type</li>
</ul>
<h4 id="78-设置播放器窗口蓝图第-1-部分"><a href="#78-设置播放器窗口蓝图第-1-部分" class="headerlink" title="78 设置播放器窗口蓝图第 1 部分"></a>78 设置播放器窗口蓝图第 1 部分</h4><p>3D预览角色<br>思路：BP_FirstPersonCharacter 初始化时，执行一次 场景渲染</p>
<ul>
<li>场景渲染 生成 Actor BP_PlayerWindow 并且初始化</li>
<li>初始化过程中<ul>
<li>创建动态材质实例 设置纹理 &#x3D;&gt; 渲染 2D</li>
</ul>
</li>
<li>放入 Tab 的 PlayerImage 中(使用材质设置笔刷)</li>
<li>开启游戏后，按Tab可以看到对应的2D图像</li>
</ul>
<p>创建文件夹 蓝图s PlayerWindows<br>创建 纹理 渲染目标 PlayerRenderTarget In PlayerWindows</p>
<ul>
<li>size: 500 800</li>
</ul>
<p>创建 材质 M_PlayerMaterial In PlayerWindows</p>
<ul>
<li>材质 材质域(Domain):用户界面(UserInterface)</li>
<li>图示<ul>
<li>混合模式 Blend Mode 改为：半透明</li>
<li>创建 param 2d （纹理单一参数2D）<ul>
<li>RGB  &#x3D; Final Color</li>
<li>A 连接 1-(OneMinus) &#x3D; Opacity 透明度</li>
</ul>
</li>
</ul>
</li>
<li>Param 的材质 ：PlayerRenderTarget</li>
</ul>
<p>OPEN W_Inventory</p>
<ul>
<li>选择 动画区 Overlay<ul>
<li>增加 Image 放到 border 下方 全撑开 Padding:60 0 60 0 Rename：PlayerImage</li>
</ul>
</li>
</ul>
<p>PlayerWindows 文件夹下 创建 新蓝图类 Actor Rename:BP_PlayerWindow</p>
<ul>
<li>增加简单碰撞胶囊体[Capsule Collision] 变换 Scale：2.8 1.8 2.1<ul>
<li>增加 骨骼网格 材质:SK_Man_Full_01 调整物体 在 中心位置的 正上方</li>
<li>调整 胶囊体和骨骼网格的位置并且包裹起来</li>
<li>增加 场景捕获组件2D(在碰撞体内添加) 调整方向 正对角色  变换 位置：1.6 86 2 Rotation:0 -5 -90 抛射(Projection) 的 视场(FieldOfView) 设置 50<ul>
<li>General Show Flags 通用显示标志<ul>
<li>打开 骨骼网格 静态网格 和 Anti-aliasing(抗锯齿) 其他关闭</li>
</ul>
</li>
<li>Advanced Show Flags<ul>
<li>只打开 DeferredLighting 延迟光源</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建蓝图接口文件 BPI_PlayerWindow 在 蓝图s Interfaces</p>
<ul>
<li>GetPlayerWindowRef<ul>
<li>Outputs<ul>
<li>Ref BP_PLayerWindow</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_PlayerWindow</p>
<ul>
<li>类设置 继承 BPI_PlayerWindow</li>
<li>GetPlayerWindowRef ref 选择 self</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>构造函数 Switch Has Authority 的 Remote<ul>
<li>延迟 Delay 执行</li>
<li>SetupSceneRenderOnClient</li>
</ul>
</li>
<li>创建 Event SetupSceneRenderOnClient<ul>
<li>Do Once 触发一次</li>
<li>SpawnActor<ul>
<li>BP_PlayerWindow</li>
<li>右键拆分<ul>
<li>3000 110 1350</li>
</ul>
</li>
<li>尝试调整位置，但固定生成</li>
</ul>
</li>
<li>提升为变量 PlayerWindowRef</li>
<li>获取玩家控制器 SurvivalGamePCRef 的 InitializeWindowOnClient<ul>
<li>目标 PlayerWindowRef</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_PlayerWindow</p>
<ul>
<li>创建 Event InitializeWindowOnClient<ul>
<li>Inputs<ul>
<li>ControllerRef SurvivalGamePC</li>
</ul>
</li>
<li>Create Render Target 2D<ul>
<li>w 500</li>
<li>h 800</li>
</ul>
</li>
<li>变量 Scene Capture Component 2D &#x3D;&gt; 设置 Texture Target<ul>
<li>纹理目标是 Create Render Target 2D 的 Return</li>
</ul>
</li>
<li>Create Dynamic Material Instance<ul>
<li>父级资源 M_PlayerMaterial</li>
</ul>
</li>
<li>Set Texture Parameter Value<ul>
<li>目标是 上的 Return</li>
<li>Param</li>
<li>Value &#x3D; Create Render Target 2D 的 Return</li>
</ul>
</li>
<li>参数 ControllerRef Is Valid 如果控制器有效，则设置材质</li>
<li>参数 ControllerRef 的方法 SetRenderMaterialOnClient<ul>
<li>Mat 使用 Create Dynamic Material Instance 的 Return</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN SurvivalGamePC</p>
<ul>
<li>增加 Event SetRenderMaterialOnClient<ul>
<li>Inputs<ul>
<li>Mat Material Instance 材质实例</li>
</ul>
</li>
<li>Tab 的方法 SetPlayerTexture</li>
</ul>
</li>
</ul>
<p>W_Inventory</p>
<ul>
<li>增加 Event SetPlayerTexture<ul>
<li>Inputs<ul>
<li>Mat Material Instance 材质实例</li>
</ul>
</li>
<li>PlayerImage 使用材质设置笔刷 <ul>
<li>材质是 Event 的 参数</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="79-设置播放器窗口蓝图第-2-部分"><a href="#79-设置播放器窗口蓝图第-2-部分" class="headerlink" title="79 设置播放器窗口蓝图第 2 部分"></a>79 设置播放器窗口蓝图第 2 部分</h4><p>创建 动画蓝图 PlayerWindowAnimBP 选择 UE4_Mannequin_Skeleton IN PlayerWindow 目录</p>
<ul>
<li>new state Machine 对应 Output Pose<ul>
<li>增加状态 Idle&#x2F;Walk&#x2F;Run<ul>
<li>复制 ThirdPerson_AnimBP 的 new state Machine 的 Idle&#x2F;Walk&#x2F;Run 的</li>
<li>创建 Speed 变量</li>
<li>创建 EquippedItem 变量</li>
</ul>
</li>
</ul>
</li>
<li>默认 Event 事件蓝图更新动画 EventBluepointUpdateAnimation 更新装备武器状态<ul>
<li>Get Owning Actor 的 Is Valid</li>
<li>Is Valid 通过 Get Owning Actor 的 Get Player Window Ref<ul>
<li>Return 设置 EquippedState 参数 需要添加参数</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_PlayerWindow</p>
<ul>
<li>创建 变量 EquippedState（保存动画当前的持有状态） E_Equipable State 默认值 Default</li>
<li>骨骼网格 设置 动画类 PlayerWindowAnimBP</li>
<li>创建 Event EquipItemEvent<ul>
<li>Inputs <ul>
<li>Info S_Equipable Info</li>
</ul>
</li>
<li>break info &amp;&amp; set 参数 EquippedState</li>
<li>SpawnActor None<ul>
<li>class 选择 info break 的 第三人称 穿戴 Class</li>
<li>拆分</li>
</ul>
</li>
<li>set 变量 EquippedItemRef</li>
<li>Attach Actor To Component<ul>
<li>目标 EquippedItemRef</li>
<li>Parent 骨骼网格</li>
<li>SocketName Info break SocketName</li>
<li>三个参数都对齐到目标</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 Event EquipItemOnClient<ul>
<li>Inputs<ul>
<li>Info S_Equipable Info</li>
</ul>
</li>
<li>变量 PlayerWindowRef 的 Get Player Window Ref 的 EquipItemEvent</li>
</ul>
</li>
<li>编辑 Event SpawnEquipableThirdPerson<ul>
<li>最后 执行 EquipItemOnClient</li>
<li>Info 选择 EquipableInfo Target</li>
</ul>
</li>
</ul>
<p>给一把石斧 ID 2</p>
<p>OPEN BP_PlayerWindow</p>
<ul>
<li>创建 Event DequipItemEvent<ul>
<li>获取 EquippedItemRef 右键 转为有效的 get</li>
<li>Destroy Actor</li>
<li>设置 EquippedState 改成 Default</li>
</ul>
</li>
<li>调整摄像头的位置<ul>
<li>1.6 85 4</li>
<li>0 -5 -90</li>
<li>0.35 0.5 0.47</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>修改 事件 DequipWeaponFirstPerson </li>
<li>增加 PlayerWindowRef -&gt; DequipItemEvent</li>
</ul>
<h4 id="80-设置播放器窗口蓝图第-3-部分"><a href="#80-设置播放器窗口蓝图第-3-部分" class="headerlink" title="80 - 设置播放器窗口蓝图第 3 部分"></a>80 - 设置播放器窗口蓝图第 3 部分</h4><p>fix bug<br>多个玩家会看到全部的角色在同一个位置，</p>
<p>OPEN BP_PlayerWindow</p>
<ul>
<li>胶囊体碰撞 组件 设置 碰撞预设为 BlockAll</li>
<li>骨骼网络 Rendering 的 Visible In Scene Capture Only 勾选 仅在场景捕获中仅可见</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>修改 方法 SetupSceneRenderOnClient <ul>
<li>InitializeWindowOnClient 的 GetController 获取 index 0的用户，使用 获取控制器</li>
</ul>
</li>
</ul>
<p>增加功能，穿戴装备时，也要更新玩家2D动画</p>
<p>BP_PlayerWindow</p>
<ul>
<li>创建 变量 HelmetSlot E_ItemMaster</li>
<li>创建 变量 ChestSlot E_ItemMaster</li>
<li>创建 变量 PantsSlot E_ItemMaster</li>
<li>创建 变量 BootsSlot E_ItemMaster</li>
<li>创建 Event EquipArmorFunction<ul>
<li>Inputs<ul>
<li>ItemInfo S_ItemInfo</li>
</ul>
</li>
<li>Break<ul>
<li>设置本地变量 Armor</li>
</ul>
</li>
<li>SpawnActor<ul>
<li>Class Ref</li>
<li>拆分</li>
</ul>
</li>
<li>根据不同的Armor 赋值 不同的参数 Slot</li>
<li>Attach Actor To Component<ul>
<li>Target 是 Slot</li>
<li>Parent 是 骨骼网格</li>
<li>对齐到目标</li>
</ul>
</li>
<li>Slot(可以使用 LocalArmorType select) 的 Get Armor Ref 的 get 获取骨骼网格</li>
<li>set master pose Component<ul>
<li>new 骨骼网格</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 EquipArmor add Comment  装备到玩家窗口<ul>
<li>EquipArmorFunction</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 Event EquipArmorOnClient<ul>
<li>Inputs<ul>
<li>ItemInfo S_ItemInfo</li>
</ul>
</li>
<li>PlayerWindow 的 EquipArmor</li>
</ul>
</li>
<li>编辑 方法 EquipArmor<ul>
<li>判断 是否是 Armor 枚举类型 首先执行 EquipArmorOnClient</li>
</ul>
</li>
</ul>
<p>给盔甲ID11，玩家2 进行测试</p>
<p>卸下装备 也要更新玩家2D动画</p>
<p>BP_PlayerWindow</p>
<ul>
<li>增加 Event DequipArmor<ul>
<li>Inputs<ul>
<li>ArmorType E_ArmorType</li>
</ul>
</li>
<li>根据参数 Switch 获取 xxx 转为有效获取<ul>
<li>分别 Destroy Actor. 不能共用一个 Destroy Actor</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>增加 Event DequipArmorOnClient<ul>
<li>Inputs<ul>
<li>ArmorType E_ArmorType</li>
</ul>
</li>
<li>PlayerWindow 的 DequipArmor</li>
</ul>
</li>
<li>编辑 Event DequipArmor<ul>
<li>增加 DequipArmorOnClient</li>
</ul>
</li>
</ul>
<p>测试</p>
<h4 id="81-攻击时增加护甲属性-穿戴护甲后伤害减少"><a href="#81-攻击时增加护甲属性-穿戴护甲后伤害减少" class="headerlink" title="81 攻击时增加护甲属性 穿戴护甲后伤害减少"></a>81 攻击时增加护甲属性 穿戴护甲后伤害减少</h4><p>思路：</p>
<ol>
<li>造成的伤害 &#x3D; 所有的装备护甲累加-伤害</li>
<li>新增 计算 伤害的方法，放入之前的伤害逻辑中，之前是固定伤害值写法</li>
</ol>
<p>OPEN BPI_SurvivalCharacter</p>
<ul>
<li>创建 函数 GetTotalArmorPieces<ul>
<li>Outputs<ul>
<li>TotalArmorSlots Int</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>编辑 Interface 方法 GetTotalArmorPieces 获取全部护甲数额<ul>
<li>创建 局部 变量 ArmorPieces Int</li>
<li>逐个获取 四个装备Slot (转为有效获取)<ul>
<li>有效则 ++ ArmorPieces 伤害值，核心是从0一直累加，每有一个装备则增加1</li>
<li>无效则检查后续的装备 Slot</li>
</ul>
</li>
<li>最后 Return ArmorPieces</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Hatchet</p>
<ul>
<li>创建 方法 CalculateDamage 伤害&#x3D;物品伤害值x伤害倍数<ul>
<li>Inputs<ul>
<li>HitActor Actor</li>
<li>ItemBaseDamage 基础伤害 Float</li>
</ul>
</li>
<li>Outputs<ul>
<li>Damage</li>
</ul>
</li>
<li>创建 变量 DamageMultiplier(伤害倍数) 默认值 0.03</li>
<li>set LocalDamage(当前造成的伤害) &#x3D; 物品伤害值(参数) x 伤害倍数(变量)</li>
<li>参数 HitActor &#x3D;&gt; Does Implement Interface 是否实现接口 BPI_SurvivalCharacter<ul>
<li>Branch<ul>
<li>false 则不是角色<ul>
<li>LocalDamage x 4</li>
<li>Return</li>
</ul>
</li>
<li>True<ul>
<li>GetTotalArmorPieces</li>
<li>Switch On Int 增加 01234 引脚<ul>
<li>0 <ul>
<li>LocalDamage x 4</li>
<li>Return</li>
</ul>
</li>
<li>1<ul>
<li>LocalDamage x 3.5</li>
<li>Return</li>
</ul>
</li>
<li>2<ul>
<li>LocalDamage x 3</li>
<li>Return</li>
</ul>
</li>
<li>3<ul>
<li>LocalDamage x 2.5</li>
<li>Return</li>
</ul>
</li>
<li>4<ul>
<li>LocalDamage x 2</li>
<li>Return</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event ServerOverlap<ul>
<li>For Each Loop 后 CalculateDamage<ul>
<li>Array Element 给 HitActor</li>
<li>ItemInfo 内的伤害值 给 ItemBaseDamage  这里要保证 BP_EquipableMaster 中 有变量 ItemInfo，没有则需要添加</li>
<li>得出伤害值，传递给 <ul>
<li>方法 HarvestFoliage 的 Damage</li>
<li>方法 ApplyDamage 的 BaseDamage</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>上面设置了 ItemInfo，所以继承 BP_EquipableMaster 的所有子类都需要设置 类的 ItemInfo 才会有伤害<br>COPY DT_Items &amp;&amp; OPEN BP_TP_StoreHatchet</p>
<p>测试准备：</p>
<ol>
<li>玩家1攻击玩家2，玩家2受到有伤害</li>
<li>玩家2穿上衣服，玩家1攻击玩家2，玩家2受到的伤害会减少</li>
<li>玩家2穿上头盔，玩家1攻击玩家2，玩家2受到的伤害会减少更多</li>
</ol>
<p>测试：增加斧头和衣服，玩家2个，ID 2 11 12</p>
<p>测试成功！</p>
<h4 id="82-添加-装备耐用性和更新物品槽部件UI"><a href="#82-添加-装备耐用性和更新物品槽部件UI" class="headerlink" title="82 添加 装备耐用性和更新物品槽部件UI"></a>82 添加 装备耐用性和更新物品槽部件UI</h4><p>OPEN W_InventorySlot</p>
<ul>
<li>编辑 Event UpdateSlot<ul>
<li>设置 物品Icon<ul>
<li>Set Brush From Texture<ul>
<li>Texture 是 ItemInfo 的 Icon</li>
</ul>
</li>
<li>Set Visibility<ul>
<li>Visible</li>
</ul>
</li>
</ul>
</li>
<li>根据 物品的类型 Switch 执行不同的更新逻辑<ul>
<li>Resource 资源物品：只需要展示 数量<ul>
<li>Set QuantityText<ul>
<li>Text 是 ItemInfo 的 QuantityText</li>
<li>Visibility 是 Visible</li>
</ul>
</li>
<li>Set TopText<ul>
<li>Visibility 是 Hidden</li>
</ul>
</li>
<li>Set BottomText<ul>
<li>Visibility 是 Hidden</li>
</ul>
</li>
<li>Set ItemHp<ul>
<li>Visibility 是 Hidden</li>
</ul>
</li>
</ul>
</li>
<li>Equipable 可持有物品：<ul>
<li>Set Top Text<ul>
<li>Text 是 ItemInfo 的 ItemDamage TextFormat：DMG {Amount} %</li>
<li>Visibility 是 Visible</li>
</ul>
</li>
<li>Set QuantityText<ul>
<li>Visibility 是 Hidden</li>
</ul>
</li>
<li>Set ItemHp<ul>
<li>Visibility 是 Visible</li>
<li>Set Percent<ul>
<li>Percent 是 ItemInfo 的 CurHP &#x2F; MaxHP</li>
</ul>
</li>
</ul>
</li>
<li>判断 ItemInfo 的 UseAmmo? 是否为真<ul>
<li>True<ul>
<li>Set BottomText<ul>
<li>Visibility 是 Visible</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>Set BottomText<ul>
<li>Visibility 是 Hidden</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Armor<ul>
<li>Set TopText<ul>
<li>Text 是 ItemInfo 的 ItemDamage TextFormat：{ArmorAmount} Armor</li>
<li>Visibility 是 Visible</li>
</ul>
</li>
<li>Set QuantityText<ul>
<li>Visibility 是 Hidden</li>
</ul>
</li>
<li>Set BottomText<ul>
<li>Visibility 是 Hidden</li>
</ul>
</li>
<li>Set ItemHp<ul>
<li>Visibility 是 Visible</li>
<li>Set Percent<ul>
<li>Percent 是 ItemInfo 的 CurHP &#x2F; MaxHP</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Consumable 消耗品<ul>
<li>Set QuantityText<ul>
<li>Text 是 ItemInfo 的 QuantityText TextFormat：x{Quantity}</li>
<li>Visibility 是 Visible</li>
</ul>
</li>
<li>Set TopText<ul>
<li>Visibility 是 Hidden</li>
</ul>
</li>
<li>Set BottomText<ul>
<li>Visibility 是 Hidden</li>
</ul>
</li>
<li>Set ItemHp<ul>
<li>Visibility 是 Hidden</li>
<li>Set Percent<ul>
<li>Percent 是 ItemInfo 的 CurHP &#x2F; MaxHP</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Buildable 建筑物：和资源类型一样</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Comment：根据项目类型设置项目槽部件UI</p>
<p>更新 BP_ArmorHelmet、BP_ArmorChest、BP_ArmorPants、BP_ArmorBoots 的 ItemInfo 信息。</p>
<p>测试内容：</p>
<ol>
<li>玩家1</li>
<li>给予物品ID：2 11 12</li>
<li>石镐敲击石头、敲击数目，查看物品的UI情况</li>
</ol>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 方法 ArmorDurabilityDamageMele 作用：减少装备的耐久度<ul>
<li>Inputs<ul>
<li>Damage Float</li>
</ul>
</li>
<li>GetTotalArmorPieces 含义：获取此次攻击给装备造成的伤害</li>
<li>参数 Damage 除以 GetTotalArmorPieces 的 Return 除以 2 设置 局部变量 LocalArmorDamage</li>
<li>逐个获取 四个装备Slot (转为有效获取)<ul>
<li>有效则执行 ArmorTypeDamage<ul>
<li>ArmorTypeDamage<ul>
<li>ArmorRef 是 Slot 的 Get Armor Ref</li>
<li>ArmorType 是 Slot 的 ArmorType</li>
<li>DurabilityDamage 是 LocalArmorDamage</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 ArmorTypeDamage 作用：根据装备类型减少耐久度<ul>
<li>Inputs<ul>
<li>ArmorRef Object</li>
<li>ArmorType E_ArmorType</li>
<li>DurabilityDamage Float</li>
</ul>
</li>
<li>设置必要的 局部变量<ul>
<li>LocalArmorType E_ArmorType</li>
<li>LocalDurabilityDamage Float</li>
</ul>
</li>
<li>ArmorRef 的 GetArmorRef 的 Get Item Info</li>
<li>设置 ItemInfo 的 CurHP - DurabilityDamage &#x3D; LocalNewDurability</li>
<li><h2 id="Branch-判断-LocalNewDurability-是否小于等于0-True-设置-ItemInfo-的-CurHP-0-装备破碎"><a href="#Branch-判断-LocalNewDurability-是否小于等于0-True-设置-ItemInfo-的-CurHP-0-装备破碎" class="headerlink" title="Branch 判断 LocalNewDurability 是否小于等于0- True  - 设置 ItemInfo 的 CurHP &#x3D; 0 装备破碎"></a>Branch 判断 LocalNewDurability 是否小于等于0<br>- True<br>  - 设置 ItemInfo 的 CurHP &#x3D; 0 装备破碎</h2><ul>
<li>False<ul>
<li>设置 ItemInfo 的 CurHP &#x3D; LocalNewDurability </li>
<li>更新 装备栏的 UI 通过 Get Controller 的 SurvivalGamePC 的 UpdateArmorUIOnClient</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 ApplyDamageToPlayer<ul>
<li>在判断 用户是否死亡，如果没有死亡<ul>
<li>ArmorDurabilityDamageMele</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试内容：</p>
<ol>
<li>给予物品ID：2 11 12</li>
<li>玩家1 攻击 玩家2 掉血</li>
<li>玩家2 穿上衣服，玩家1 攻击 玩家2 装备掉耐久</li>
<li>玩家2 穿上衣服+头盔，玩家1 攻击 玩家2 2个装备掉耐久</li>
</ol>
<p>完善装备破碎的逻辑<br>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 方法 ArmorBreakFunction 和 DequipArmorFunction 逻辑相似，可以copy<ul>
<li>Inputs<ul>
<li>ArmorType E_ArmorType</li>
</ul>
</li>
<li>设置必要的 局部变量<ul>
<li>LocalArmorType E_ArmorType</li>
</ul>
</li>
<li>将 Copy 的 AddItemOnServer 删除，直接 Destroy Actor</li>
</ul>
</li>
<li>编辑 方法 ArmorTypeDamage<ul>
<li>在 Branch True 中执行 ArmorBreakFunction</li>
<li>最后 调用 DequipArmorOnClient</li>
</ul>
</li>
</ul>
<p>测试内容：</p>
<ol>
<li>给予物品ID：2 11 12，设置 衣服 CurHP &#x3D; 10，In DT_Items、BP_ArmorChest</li>
<li>玩家1 攻击 玩家2 掉血</li>
<li>玩家2 穿上衣服，玩家1 攻击 玩家2 装备掉耐久</li>
<li>玩家2 穿上衣服+头盔，玩家1 攻击 玩家2 2个装备掉耐久</li>
</ol>
<p>设置回来 衣服 CurHP &#x3D; 100，In DT_Items、BP_ArmorChest</p>
<p>测试成功！</p>
<h4 id="83-修复-拖动部件时的UI展示"><a href="#83-修复-拖动部件时的UI展示" class="headerlink" title="83 修复 拖动部件时的UI展示"></a>83 修复 拖动部件时的UI展示</h4><p>COPY W_InventorySlot 的 Event UpdateSLot 的 Switch on E_ItemType 以及之后的 代码 到 W_DraggedItem</p>
<p>OPEN W_DraggedItem</p>
<ul>
<li>Quantity 连接 Quantity</li>
<li>TextTop 连接 Amount</li>
<li>CurrHP 连接 CurrHP</li>
<li>MaxHP 连接 MaxHP</li>
<li>TextTop 连接 ArmorAmount</li>
<li>UseAmmo 连接 UseAmmo</li>
</ul>
<h3 id="第八章"><a href="#第八章" class="headerlink" title="第八章"></a>第八章</h3><h4 id="84-建筑系统简介"><a href="#84-建筑系统简介" class="headerlink" title="84 建筑系统简介"></a>84 建筑系统简介</h4><p>需要的库资源： Easy Building System V版本</p>
<p>BP_BuildableMaster</p>
<h4 id="85-建筑系统基础文件"><a href="#85-建筑系统基础文件" class="headerlink" title="85 建筑系统基础文件"></a>85 建筑系统基础文件</h4><p>安装 Easy Building System 到项目</p>
<ul>
<li>将 All&#x2F;Content&#x2F;EasyBuildingSystem&#x2F;Meshes&#x2F;Structures 下的 Stylized 文件夹 右键 迁移到项目的 Content 文件夹下</li>
</ul>
<p>创建 建造系统 数据结构文件 S_BuildableInfo In _Main&#x2F;Blueprints&#x2F;Structures</p>
<ul>
<li>TraceChannel ETraceTypeQuery</li>
<li>CanPlaceOnGround? bool 是否可以放置在地面上</li>
<li>UseCustomOverlap? bool 是否使用自定义重叠</li>
<li>DoFloatCheck? bool 是否可以漂浮</li>
<li>CanPlaceOnFoundation? bool 是否可以放置在基础上</li>
<li>DoCeilingCheck? bool 是否可以检查天花板</li>
</ul>
<p>创建 建造系统 相关的文件夹 _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<p>In BuildingSystem<br>创建 蓝图类 Actor BP_BuildableMaster</p>
<ul>
<li>类设置 <ul>
<li>Replicates 勾选 含义：允许复制</li>
<li>Start with Tick Enabled 取消勾选 含义：开始时不启用Tick</li>
</ul>
</li>
<li>增加 静态网格 组件</li>
<li>增加变量 BuildableInfo S_BuildableInfo</li>
</ul>
<p>创建 蓝图接口文件 BPI_BuildInterface In _Main&#x2F;Blueprints&#x2F;Interfaces</p>
<ul>
<li>创建 方法 GetBuildMasterRef<ul>
<li>Outputs<ul>
<li>Ref BP_BuildableMaster</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_BuildableMaster</p>
<ul>
<li>类设置 继承 BPI_BuildInterface</li>
<li>创建 Event GetBuildMasterRef<ul>
<li>Outputs<ul>
<li>Ref BP_BuildableMaster</li>
</ul>
</li>
<li>Return Self</li>
</ul>
</li>
</ul>
<p>创建 建造子类 BP_FoundationMaster 继承于 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>设置 静态网格 组件<ul>
<li>静态网格 设置为 SM_Stylized_Wood_Foundation</li>
</ul>
</li>
</ul>
<h4 id="86-创建建筑系统组件-和-键盘B键预览建筑物功能"><a href="#86-创建建筑系统组件-和-键盘B键预览建筑物功能" class="headerlink" title="86 创建建筑系统组件 和 键盘B键预览建筑物功能"></a>86 创建建筑系统组件 和 键盘B键预览建筑物功能</h4><p>思路：</p>
<ol>
<li>按下B键，生成一个预览建筑物<ul>
<li>根据玩家的摄像头角度，生成一个预览建筑物</li>
<li>按通道进行线条追踪运算逻辑：<ul>
<li>Start &#x3D; 玩家的世界位置 + 玩家的向前向量 * 建造结束距离 350</li>
<li>End &#x3D; 玩家的世界位置 + 玩家的向前向量 * 建造结束距离 1000</li>
</ul>
</li>
</ul>
</li>
<li>建造蓝图类需要 同时在客户端和服务端生成</li>
</ol>
<p>创建 建造蓝图类 Actor Component Rename:BPC_BuildingComponent In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<p>OPEN FirstPersonCharacter</p>
<ul>
<li>增加 组件 建造蓝图类 BPC Building Component</li>
</ul>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>创建 变量 IsBuildModeEnabled? bool 是否开启建造模式</li>
<li>创建 变量 BuildPreview BP_BuildableMaster Object 预览建筑物</li>
<li>创建 方法 BuildModeClient<ul>
<li>Inputs<ul>
<li>StructureID Int</li>
</ul>
</li>
<li>创建局部变量 BuildDistanceClose Int 默认值 350</li>
<li>创建局部变量 BuildDistanceFar Int 默认值 1000</li>
<li>Get Owner -&gt; Get Survival Char Ref 的 Get First Person Camera<ul>
<li>Line Trace By Channel 的 Start<ul>
<li>目标 的 Get World Location + 目标 的 GetForwardVector X BuildDistanceClose</li>
</ul>
</li>
<li>Line Trace By Channel 的 End<ul>
<li>目标 的 Get World Location + 目标 的 GetForwardVector X BuildDistanceFar</li>
</ul>
</li>
</ul>
</li>
<li>BuildPreview 有效获取<ul>
<li>无效则 SpawnBuildPreview<ul>
<li>参数 StructureID 选择 Event 的 StructureID</li>
</ul>
</li>
<li>BuildPreview 有效获取</li>
</ul>
</li>
<li>Line Trace By Channel<ul>
<li>Start 在上</li>
<li>End 在上</li>
<li>Actors to Ignore 是 Make Array<ul>
<li>在 SpawnBuildPreview 的 Return 后的 BuildPreview 有效 的 Return Line Trace By Channel，并且 传递给 Make Array ，</li>
</ul>
</li>
<li>Return 进行一次 Branch<ul>
<li>True<ul>
<li>Set 变量 BuildTransform 拆分后的  <ul>
<li>Rotation &#x3D; Get Owner -&gt; Get Survival Char Ref 的 FirstPersonCamera 的 Get World Rotation 右键拆分，Z轴 + 90 进行一次 Make Rotator 右键拆分 连接z</li>
<li>Location &#x3D; Line Trace By Channel 的 Hit Location 的 Impact Point</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>Set 变量 BuildTransform 拆分后的<ul>
<li>同上</li>
<li>Location &#x3D; Line Trace By Channel 的 Hit Location 的 Trace End(跟踪结束位置)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>BuildPreview Is Valid<ul>
<li>is Valid<ul>
<li>BuildPreview 的 DefaultSceneRoot 的 Set World Transform<ul>
<li>New Transform &#x3D; BuildTransform</li>
</ul>
</li>
</ul>
</li>
<li>Is Not Valid<ul>
<li>SpawnBuildPreview</li>
</ul>
</li>
</ul>
</li>
<li>BuildLoop</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event LaunchBuildModeOnClient<ul>
<li>Inputs<ul>
<li>StructureID Int</li>
</ul>
</li>
<li>branch IsBuildModeEnabled<ul>
<li>False<ul>
<li>Set IsBuildModeEnabled &#x3D; True</li>
<li>BuildModeClient</li>
</ul>
</li>
<li>Ture<ul>
<li>StopBuildLoop</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event BuildLoop 循环执行 BuildModeClient<ul>
<li>Branch IsBuildModeEnabled<ul>
<li>True<ul>
<li>Delay 0.05</li>
<li>BuildModeClient</li>
</ul>
</li>
<li>False</li>
<li>下面逻辑 创建一个 Event StopBuildLoop </li>
<li>Set IsBuildModeEnabled &#x3D; False</li>
<li>BuildPreview Is Valid<ul>
<li>True<ul>
<li>则 Destroy Actor</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 SpawnBuildPreview<ul>
<li>Inputs<ul>
<li>StructureID Int</li>
</ul>
</li>
<li>SpawnActorFromClass<ul>
<li>BP_FoundationMaster</li>
<li>变换 提升为 变量 BuildTransform</li>
</ul>
</li>
<li>设置 BuildPreview</li>
<li>BuildPreview 的 获取Static Mesh 的 Set Collision Enabled<ul>
<li>NoCollision</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN FirstPersonCharacter</p>
<ul>
<li>创建 B 键 的Event<ul>
<li>按下<ul>
<li>BPC_BuildingComponent 的 LaunchBuildModeOnClient<ul>
<li>StructureID &#x3D; 0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="87-设置预览颜色-以及鼠标左键点击后-可以创建建造物"><a href="#87-设置预览颜色-以及鼠标左键点击后-可以创建建造物" class="headerlink" title="87 设置预览颜色 以及鼠标左键点击后 可以创建建造物"></a>87 设置预览颜色 以及鼠标左键点击后 可以创建建造物</h4><p>创建 建造蓝图材质文件夹 _Main&#x2F;Blueprints&#x2F;BuildingSystem&#x2F;Materials<br>创建 建造材质文件 M_Green In Materials<br>OPEN M_Green</p>
<ul>
<li>Base Color &#x3D;&gt; Vector Parameter<ul>
<li>Color: 54FF0000</li>
</ul>
</li>
<li>混合模式 Blend Mode &#x3D;&gt; 半透明 Translucent</li>
<li>不透明度 &#x3D;&gt; Constant<ul>
<li>0.5</li>
</ul>
</li>
</ul>
<p>COPY M_Green Rename:M_Red</p>
<ul>
<li>Base Color &#x3D;&gt; Vector Parameter<ul>
<li>Color: FF230000</li>
</ul>
</li>
</ul>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>创建 方法 SetPreviewColor<ul>
<li>Inputs<ul>
<li>IsGreen? bool</li>
</ul>
</li>
<li>设置局部变量 IsGreen? &#x3D; LocalCanPlace? bool</li>
<li>BuildPreview 的 Get Components By Class<ul>
<li>Components Class 是 Static Mesh Component</li>
</ul>
</li>
<li>For Each 循环<ul>
<li>Array 是 Get Components By Class 的 Return</li>
</ul>
</li>
<li>For Loop<ul>
<li>Last Index &#x3D; For Each 循环 的 Array Element 的 Get Num Materials - 1</li>
<li>Body<ul>
<li>Branch LocalCanPlace?<ul>
<li>True<ul>
<li>For Each 循环 的 Array Element 的 Set Material<ul>
<li>Material 是 M_Green</li>
<li>Element Index 是 For Loop 的 Index</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>Set Material<ul>
<li>Material 是 M_Red</li>
<li>Element Index 是 For Loop 的 Index</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Completed<ul>
<li>BuildPreview 的 Default Scene Root 的 Set World Transform<ul>
<li>New Transform 是 BuildTransform</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 BuildModeClient<ul>
<li>判断 BuildPreview 是否有效<ul>
<li>有效则 SetPreviewColor</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 SpawnBuildable<ul>
<li>Inputs<ul>
<li>Transform Transform</li>
</ul>
</li>
<li>SpawnActorFromClass<ul>
<li>BP_FoundationMaster</li>
<li>Transform</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event SpawnBuildOnServer<ul>
<li>Inputs<ul>
<li>Transform Transform</li>
<li>ClientCameraVector Vector</li>
<li>ClientCameraRotation Rotator</li>
</ul>
</li>
<li>SpawnBuildable</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 Event PlaceBuildableOnClient<ul>
<li>Branch BPC_BuildingComponent 的 IsBuildModeEnabled <ul>
<li>True<ul>
<li>BPC_BuildingComponent 的 SpawnBuildOnServer<ul>
<li>Transform 是 BPC_BuildingComponent 的 BuildTransform</li>
<li>ClientCameraVector 是 组件 Get First Person Camera 的 Get Forward Vector</li>
<li>ClientCameraRotation 是 组件 Get First Person Camera 的 Get World Rotation</li>
</ul>
</li>
<li>BPC_BuildingComponent 的 Set IsBuildModeEnabled &#x3D; False</li>
</ul>
</li>
<li>False</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event LeftMouseOnServer <ul>
<li>有效获取 失败 执行 PlaceBuildableOnClient</li>
</ul>
</li>
</ul>
<h4 id="88-检查建造物是否重叠-客户端-服务端"><a href="#88-检查建造物是否重叠-客户端-服务端" class="headerlink" title="88 检查建造物是否重叠 客户端+服务端"></a>88 检查建造物是否重叠 客户端+服务端</h4><p>OPEN BP_BuildableMaster</p>
<ul>
<li>BuildableInfo 的 UseCustomOverlap? 是 True</li>
<li>增加 组件 Box Collision Rename:OverlayBoxSize<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
</ul>
</li>
<li>调整 组件的位置 包裹住整个建筑物<ul>
<li>位置 0 0 77</li>
<li>缩放 4.6 4.6 0.2</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>创建 方法 CheckForOverlap 检查是否重叠<ul>
<li>创建 局部变量 HalfSize Float Default:1.2</li>
<li>Outputs<ul>
<li>Overlapping? Bool</li>
</ul>
</li>
<li>Box Trace By Channel<ul>
<li>Start 进行 Select(select 不是 选择旋转体)<ul>
<li>Options 0 BuildPreview 的 获取 Static Mesh 的 Get Component Bounds 的 Origin</li>
<li>True &#x3D; BuildPreview 的 获取 Overlay Box Size 的 Get Component Bounds 的 Origin</li>
<li>Index &#x3D; BuildPreview 获取 BuildableInfo 拆分 的 BuildableInfoUseCustomOverlap?</li>
</ul>
</li>
<li>End 同上</li>
<li>HalfSize用的<ul>
<li>Options 0 BuildPreview 的 获取 Static Mesh 的 Get Component Bounds 的 Box Extent</li>
<li>Options 1 BuildPreview 的 获取 Overlay Box Size 的 Get Component Bounds 的 Box Extent</li>
<li>Index &#x3D; BuildPreview 获取 BuildableInfo 拆分 的 BuildableInfoUseCustomOverlap?</li>
</ul>
</li>
<li>HalfSize &#x3D; 第二个 End 进行 Select(select 不是 选择旋转体) 的 Return Value &#x2F; HalfSize</li>
<li>Orientation &#x3D; Make Rotator 的 z 连接 (BuildPreview 的 获取 Root Component 的 Get World Rotation 拆分 的 Z 轴 + 90)</li>
<li>Actors to Ignore 是 Make Array<ul>
<li>BuildPreview</li>
</ul>
</li>
<li>Draw Debug Type 是 For Duration 持续</li>
</ul>
</li>
<li>Return Node 连接 Box Trace By Channel 的 Return Value</li>
</ul>
</li>
<li>编辑 方法 BuildModeClient<ul>
<li>删除两个分支 并且是 Set Transform 后的所有逻辑</li>
<li>分支1<ul>
<li>BuildPreview Is Valid<ul>
<li>True<ul>
<li>CheckForOverlap</li>
<li>SetPreviewColor<ul>
<li>IsGreen? &#x3D; CheckForOverlap 的 Return Value 进行 <code>not bool</code></li>
</ul>
</li>
<li>BuildLoop</li>
</ul>
</li>
<li>False<ul>
<li>SpawnBuildPreview</li>
<li>BuildLoop</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>分支2<ul>
<li>BuildPreview Is Valid<ul>
<li>True<ul>
<li>SetPreviewColor<ul>
<li>IsGreen? &#x3D; false</li>
</ul>
</li>
<li>BuildLoop</li>
</ul>
</li>
<li>False<ul>
<li>SpawnBuildPreview</li>
<li>BuildLoop</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试完之后 需要 将 <code>BPC_BuildingComponent</code> 的 方法 <code>CheckForOverlap</code> 的 方法 <code>Box Trace By Channel</code> 的 <code>Draw Debug Type</code> 是 <code>For Duration 持续</code> 改成 None 不显示</p>
<p>服务端也需要检查</p>
<p>OPEN BP_BuildingComponent</p>
<ul>
<li>新增 变量 HitActor Actor</li>
<li>新增 变量 HitComponent Primitive Component</li>
<li>创建 方法 BuildPlacementCheck<ul>
<li>Inputs<ul>
<li>StructureID Int</li>
<li>ClientCameraVector Vector</li>
<li>ClientCameraRotation Rotator</li>
</ul>
</li>
<li>Outputs<ul>
<li>CanBuild? bool</li>
</ul>
</li>
<li>创建 局部变量 LocalCameraRotation Rotator</li>
<li>创建 局部变量 BuildDistanceClose Int 默认值 350</li>
<li>创建 局部变量 BuildDistanceFar Int 默认值 1000</li>
<li>设置 局部变量 LocalCameraRotation &#x3D; ClientCameraRotation</li>
<li>设置 局部变量 LocalClientCameraVector &#x3D; ClientCameraVector</li>
<li>SpawnBuildPreview</li>
<li>BuildPreview 有效获取</li>
<li>Get Owner -&gt; Get Survival Char Ref 的 Get First Person Camera</li>
<li>Line Trace By Channel<ul>
<li>Start 目标 的 Get World Location + 参数 ClientCameraVector X BuildDistanceClose</li>
<li>End 目标 的 Get World Location + 参数 ClientCameraVector X BuildDistanceFar</li>
<li>Actors to Ignore 是 Make Array<ul>
<li>BuildPreview</li>
</ul>
</li>
<li>判断 Line Trace By Channel 的 Return Value <ul>
<li>有效 <ul>
<li>Set 变量 HitActor &#x3D; Hit Actor</li>
<li>Set 变量 HitComponent &#x3D; Hit Component</li>
<li>Set Transform<ul>
<li>Location 是 Line Trace By Channel 的 Hit Location 的 Impact Normal</li>
<li>Rotation &#x3D; Make Rotator 的 z 连接 (ClientCameraRotation Break 的 Z 轴 + 90)</li>
</ul>
</li>
<li>BuildPreview Is Valid<ul>
<li>有效<ul>
<li>CheckForOverlap<ul>
<li>Return Value 进行 <code>not bool</code> 连接 CanBuild? 返回</li>
</ul>
</li>
</ul>
</li>
<li>无效<ul>
<li>返回</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>无效 <ul>
<li>Set Transform<ul>
<li>Location 是 Line Trace By Channel 的 Hit Location 的 Trace End</li>
<li>Rotation &#x3D; Make Rotator 的 z 连接 (ClientCameraRotation 拆分 的 Z 轴 + 90)</li>
</ul>
</li>
<li>Is Valid<ul>
<li>有效<ul>
<li>返回</li>
</ul>
</li>
<li>无效<ul>
<li>返回</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>编辑 方法 SpawnBuildOnServer 执行最前面需要 BuildPlacementCheck 的 Return Value 进行 Branch<ul>
<li>这里必须 设置 变量 BuildTransform</li>
<li>Branch CanBuild?<ul>
<li>True<ul>
<li>SpawnBuildable 参数 Transform 需要 用参数的 Transform 不然会有影响</li>
</ul>
</li>
<li>False<ul>
<li>BuildPreview 有效获取<ul>
<li>有效则 Destroy Actor</li>
</ul>
</li>
<li>Print String “没法建造在这里”</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>B键生成建筑物，鼠标左键点击生成建筑物</li>
<li>检查是否重叠，重叠时显示红色，不重叠时显示绿色，重叠则不能生成。</li>
</ol>
<h4 id="89-实现网格捕捉-能够优化放置建筑物的位置"><a href="#89-实现网格捕捉-能够优化放置建筑物的位置" class="headerlink" title="89 实现网格捕捉 能够优化放置建筑物的位置"></a>89 实现网格捕捉 能够优化放置建筑物的位置</h4><p>含义：检测建造物是否重叠的时候，检测当前位置是否位于网格上，如果位于网格上，则给网格的位置。</p>
<p>项目设置</p>
<ul>
<li>Project Setting<ul>
<li>引擎<ul>
<li>碰撞<ul>
<li>Trace Channel 用于捕捉网格<ul>
<li>FoundationTrace</li>
<li>FloorTrace</li>
<li>StairsTrace</li>
<li>TriangleTrace</li>
<li>TriangleCeilingTrace</li>
<li>RoofTrace</li>
<li>RoofSmallTrace</li>
<li>DoorTrace</li>
<li>WindowTrace</li>
<li>LandscapeTrace</li>
<li>FoundationPlacement</li>
<li>TorchTrace</li>
<li>WallTrace</li>
<li>RampTrace Ignore</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BPI_BuildInterface</p>
<ul>
<li>创建 方法 ReturnBoxes<ul>
<li>Outputs<ul>
<li>Boxes Box Collision Array</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_BuildableMaster</p>
<ul>
<li>在 静态网格 建造物 下 增加 4个 Box Collision 组件<ul>
<li>1 Rename:Foundation<ul>
<li>Box Extent 150 150 85</li>
<li>Location 0 300 0</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>FoundationTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
<li>Copy 2 Rename:Foundation1<ul>
<li>Location 0 -300 0</li>
</ul>
</li>
<li>Copy 3 Rename:Foundation2<ul>
<li>Location 300 0 0</li>
</ul>
</li>
<li>Copy 3 Rename:Foundation3<ul>
<li>Location -300 0 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FoundationMaster</p>
<ul>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 返回 4个 Box Collision 组件</li>
</ul>
</li>
<li>默认类设置<ul>
<li>Trace Channel 是 FoundationPlacement</li>
</ul>
</li>
</ul>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>编辑 方法 BuildModeClient<ul>
<li><code>Line Trace By Channel</code> 的 <code>Return Value</code> <code>Branch</code> 后<ul>
<li>将 Break Hit Result 的<ul>
<li><code>Hit Actor</code> 设置变量 <code>HitActor</code></li>
<li><code>Hit Component</code> 设置变量 <code>HitComponent</code></li>
</ul>
</li>
</ul>
</li>
<li>后续继续连接起来</li>
<li>设置线路追踪<ul>
<li><code>Line Trace By Channel</code> 之前的 转为有效的 BuildPreview 的 Get BuildableInfo 进行 break<ul>
<li>BuildableInfoTraceChannel 传入 <code>Line Trace By Channel</code> 的 Trace Channel</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 GetSnappingPoints<ul>
<li>创建 局部变量 LocalFound? bool</li>
<li>Outputs<ul>
<li>Found? bool</li>
<li>Location Vector</li>
</ul>
</li>
<li>HitActor 的 ReturnBoxes<ul>
<li>For Each Loop with Break<ul>
<li>LoopBody<ul>
<li>Branch HitComponent 有效获取 &#x3D;&#x3D; Item 的 ArrayElement<ul>
<li>Set LocalFound? &#x3D; true 并且 Break</li>
</ul>
</li>
</ul>
</li>
<li>Completed<ul>
<li>HitComponent 有效获取<ul>
<li>True<ul>
<li>Return<ul>
<li>LocalFound? 连接 Found?</li>
<li>Location 连接 HitComponent 的 获取世界变换</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>Return</li>
<li>LocalFound? 连接 Found?</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 BuildModeClient<ul>
<li><code>Set 变量 Transform</code> 后的 BuildPreview Is Valid 后(分支1)</li>
<li>GetSnappingPoints<ul>
<li>Branch Found?<ul>
<li>True 位于 更合适的 建造位置<ul>
<li>Set 变量 Transform &#x3D; Location</li>
<li>后续一样</li>
</ul>
</li>
<li>False 后续一样</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 BuildPlacementCheck<ul>
<li><code>Set 变量 Transform</code> 后的 BuildPreview Is Valid<ul>
<li>True<ul>
<li>GetSnappingPoints<ul>
<li>Branch Found?<ul>
<li>True<ul>
<li>Set 变量 Transform &#x3D; Location</li>
<li>后续一样</li>
</ul>
</li>
<li>False<ul>
<li>后续一样</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>设置线路追踪<ul>
<li><code>Line Trace By Channel</code> 之前的 转为有效的BuildPreview 进行 break<ul>
<li>BuildableInfoTraceChannel 传入 <code>Line Trace By Channel</code> 的 Trace Channel</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="90-添加墙壁以及开关可构建调试"><a href="#90-添加墙壁以及开关可构建调试" class="headerlink" title="90 添加墙壁以及开关可构建调试"></a>90 添加墙壁以及开关可构建调试</h4><p>思路：</p>
<ol>
<li>鼠标滑轮滚动，切换可构建类型</li>
</ol>
<p>添加 墙壁蓝图子类 BP_WallMaster 继承于 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<p>OPEN BP_WallMaster</p>
<ul>
<li>设置 BuildableInfo<ul>
<li>TraceChannel 是 WallTrace</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
<li>静态网格 <ul>
<li>材质 SM_Stylized_Wood_Wall</li>
</ul>
</li>
</ul>
<p>OPEN BP_FoundationMaster 增加 Box Collision 组件</p>
<ul>
<li>设置一下 OverlayBoxSize<ul>
<li>变换<ul>
<li>0 0 52</li>
</ul>
</li>
</ul>
</li>
<li>DefaultSceneRoot<ul>
<li>静态网格<ul>
<li>增加 静态网格 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Wall</li>
<li>调整 位置 放在桌子上 四面朝外</li>
<li>变换<ul>
<li>0 150 234.9</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>依次复制 1<ul>
<li>变换<ul>
<li>0 -150 234.9</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>依次复制 2<ul>
<li>变换<ul>
<li>150 0 234.9</li>
<li>0 0 -90</li>
</ul>
</li>
</ul>
</li>
<li>依次复制 3<ul>
<li>变换<ul>
<li>-150 0 234.9</li>
<li>0 0 90</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Wall<ul>
<li>Box Extent 150 20 150 调整位置跟随上面的静态网格</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>WallTrace BlockAll</li>
</ul>
</li>
<li>变换<ul>
<li>复制 静态网格</li>
</ul>
</li>
</ul>
</li>
<li>依次复制 1<ul>
<li>变换<ul>
<li>复制 静态网格</li>
</ul>
</li>
</ul>
</li>
<li>依次复制 2<ul>
<li>变换<ul>
<li>复制 静态网格</li>
</ul>
</li>
</ul>
</li>
<li>依次复制 3<ul>
<li>变换<ul>
<li>复制 静态网格</li>
</ul>
</li>
</ul>
</li>
<li>删除 四个 静态网格 组件</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 4个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>现在 编辑 数据表 并且 为 玩家赋予 循环浏览不同的可构建对象的能力</p>
<p>创建 建造杂项文件夹 _Main&#x2F;Blueprints&#x2F;BuildingSystem&#x2F;Misc<br>创建 建造蓝图结构文件 S_BuildTableInfo In _Main&#x2F;Blueprints&#x2F;BuildingSystem&#x2F;Misc</p>
<p>OPEN S_BuildTableInfo</p>
<ul>
<li>增加 BuildableClass BP_BuildableMaster 类引用</li>
</ul>
<p>创建 建造杂项数据表文件 DT_Structures Select S_BuildTableInfo In _Main&#x2F;Blueprints&#x2F;BuildingSystem&#x2F;Misc</p>
<ul>
<li>ID 1<ul>
<li>BuildableClass BP_FoundationMaster</li>
</ul>
</li>
<li>ID 2<ul>
<li>BuildableClass BP_WallMaster</li>
</ul>
</li>
</ul>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>编辑 方法 SpawnBuildPreview<ul>
<li>Get Data Table Row By 参数 StructureID<ul>
<li>Table Name 是 DT_Structures</li>
</ul>
</li>
<li>SpawnActor 改为 通过查询表到的 Row 结构的 BuildClass 生成 Actor</li>
<li>测试时，创建 变量 StructureIDDebug Int 默认值 1</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 Keyboard <code>Mouse Wheel Up</code> 的 Event<ul>
<li>Get Data Table Row By Name 获取数据表行名称<ul>
<li>Table Name 是 DT_Structures</li>
</ul>
</li>
<li>Clamp Int<ul>
<li>Value &#x3D; BPC Building Component 的 StructureIDDebug + 1</li>
<li>Min &#x3D; 1</li>
<li>Max &#x3D; 表Res 进行 Length</li>
</ul>
</li>
<li>Set BPC Building Component 的 StructureIDDebug &#x3D; Clamp Int 的 Return Value</li>
<li>BPC_BuildingComponent 的 BuildPreview 有效获取<ul>
<li>True<ul>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Keyboard <code>Mouse Wheel Down</code> 的 Event<ul>
<li>Get Data Table Row By Name<ul>
<li>Table Name 是 DT_Structures</li>
</ul>
</li>
<li>Clamp Int<ul>
<li>Value &#x3D; BPC Building Component 的 StructureIDDebug - 1</li>
<li>Min &#x3D; 1</li>
<li>Max &#x3D; 表Res 进行 Length</li>
</ul>
</li>
<li>Set BPC Building Component 的 StructureIDDebug &#x3D; Clamp Int 的 Return Value</li>
<li>BPC_BuildingComponent 的 BuildPreview 有效获取<ul>
<li>True<ul>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Add 上述 Comment “切换建造物 Debug” 增加 Color &#x3D; Yellow</li>
</ul>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>编辑 事件 SpawnBuildable<ul>
<li>Inputs<ul>
<li>增加 StructureIDTemp Int</li>
<li>设置 变量 StructureID &#x3D; StructureIDTemp</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>编辑 方法 PlaceBuildableOnClient<ul>
<li>将 组件 BPC_BuildingComponent 的 StructureIDDebug 传入 SpawnBuildOnServer 的 StructureID</li>
</ul>
</li>
</ul>
<p>测试：可以切换 可以放置桌子和墙壁</p>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>编辑 方法 PlaceBuildableOnClient<ul>
<li>将 组件 BPC_BuildingComponent 的 StructureIDDebug 传入 SpawnBuildOnServer 的 StructureIDTmp</li>
</ul>
</li>
</ul>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>编辑 方法 SpawnBuildPreview<ul>
<li>将参数的 StructureID 传入 Get Data Table Row 的 Row Name</li>
</ul>
</li>
<li>编辑 事件 LaunchBuildModeOnClient<ul>
<li>将 StructureIDDebug 传入 LaunchBuildModeOnClient 的 StructureID</li>
</ul>
</li>
<li>编辑 方法 SpawnBuildable<ul>
<li>Inputs<ul>
<li>增加 StructureIDTemp Int</li>
<li>将 参数 StructureIDTemp 进行 Get Data Table Row 的 Out Row 的 Build Class 传入 SpawnActor 的 Class</li>
</ul>
</li>
</ul>
</li>
<li>编辑 事件 SpawnBuildOnServer<ul>
<li>连接 SpawnBuildable 的 StructureIDTemp 是 事件 参数 StructureID</li>
<li>增加开关 事件第一件事 Switch Has Authority<ul>
<li>True<ul>
<li>往后执行</li>
</ul>
</li>
<li>False</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>进行测试：可以切换 可以放置桌子和墙壁 墙壁碰撞生效</p>
<h4 id="91-修复BUG-添加天花板"><a href="#91-修复BUG-添加天花板" class="headerlink" title="91 修复BUG 添加天花板"></a>91 修复BUG 添加天花板</h4><p>OPEN BPC_BuildingComponent</p>
<ul>
<li>创建 方法 ChangeBuildStructure<ul>
<li>BuildPreview 有效获取<ul>
<li>True<ul>
<li>Destroy Actor</li>
</ul>
</li>
<li>False</li>
</ul>
</li>
<li>SpawnBuildPreview<ul>
<li>StructureID &#x3D; 变量 StructureIDDebug</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>编辑 Keyboard <code>Mouse Wheel Up</code> 的 Event<ul>
<li>将最后的 BPC_BuildingComponent 的 BuildPreview 有效获取<ul>
<li>True<ul>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
</li>
<li>换成 ChangeBuildStructure</li>
</ul>
</li>
</ul>
<p>为 BP_BuildableMaster 创建 蓝图子类 BP_CeilingMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem<br>OPEN BP_CeilingMaster</p>
<ul>
<li>设置 网格组件<ul>
<li>设置 材质 SM_Stylized_Wood_Ceiling</li>
<li>TraceChannel 是 FloorTrace</li>
</ul>
</li>
<li>类设置 BuildableInfo<ul>
<li>UseCustomOverlap? 是 True 使用自定义重叠</li>
</ul>
</li>
<li>调整 OverlapBoxSize 的大小 比 建造物小一些 <ul>
<li>位置<ul>
<li>0 0 2</li>
</ul>
</li>
<li>缩放<ul>
<li>3 3 0.3</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_WallMaster</p>
<ul>
<li>在 已有材质的 静态网格体组件 下<ul>
<li>增加 静态网格体组件<ul>
<li>设置 材质 SM_Stylized_Wood_Ceiling</li>
<li>增加 Box Collision 组件 Rename:Ceiling1<ul>
<li>Box Extent 150 150 10</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>FloorTrace BlockAll</li>
</ul>
</li>
<li>调整 位置<ul>
<li>0 150 150</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>复制 Rename:Ceiling2<ul>
<li>变换<ul>
<li>复制 静态网格</li>
</ul>
</li>
</ul>
</li>
<li>删除 两个 静态网格体组件</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 2个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>OPEN DT_Structures</p>
<ul>
<li>增加 ID 3<ul>
<li>BuildableClass BP_CeilingMaster</li>
</ul>
</li>
</ul>
<p>OPEN BP_CeilingMaster 增加天花板 四个方位的 捕捉位置</p>
<ul>
<li>增加 Box Collision 组件 <ul>
<li>Rename:Ceiling1<ul>
<li>Box Extent 30 30 30 </li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>FloorTrace BlockAll</li>
</ul>
</li>
<li>变换<ul>
<li>0 300 0</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Ceiling2<ul>
<li>变换<ul>
<li>0 -300 0</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Ceiling3<ul>
<li>变换<ul>
<li>300 0 0</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Ceiling4<ul>
<li>变换<ul>
<li>-300 0 0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 4个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>测试：可以切换 可以放置桌子、墙壁和天花板，但是天花板上方无法放置建造物</p>
<p>OPEN BP_CeilingMaster 增加天花板上方的捕捉位置</p>
<ul>
<li>DefaultSceneRoot<ul>
<li>静态网格体 组件<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Wall</li>
<li>调整 位置<ul>
<li>0 150 155</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Wall1<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>WallTrace BlockAll</li>
</ul>
</li>
<li>Box Extent 150 10 150</li>
<li>变换<ul>
<li>复制 静态网格</li>
</ul>
</li>
</ul>
</li>
<li>复制<ul>
<li>变换<ul>
<li>复制 静态网格体 组件</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Wall2<ul>
<li>Box Extent 10 150 150</li>
<li>变换<ul>
<li>复制 静态网格体 组件</li>
</ul>
</li>
</ul>
</li>
<li>复制<ul>
<li>变换<ul>
<li>复制 静态网格体 组件</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Wall3<ul>
<li>Box Extent 10 150 150</li>
<li>变换<ul>
<li>复制 静态网格体 组件</li>
</ul>
</li>
</ul>
</li>
<li>复制<ul>
<li>变换<ul>
<li>复制 静态网格体 组件</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Wall4<ul>
<li>Box Extent 10 150 150</li>
<li>变换<ul>
<li>复制 静态网格体 组件</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 4个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>测试：可以切换 可以放置桌子、墙壁和天花板，天花板上方可以放置建造物</p>
<p>备注：<br>如果放置不了建造物，可能影响的因素：</p>
<ul>
<li>Trace 没设置对</li>
<li>旁边有其他建造物 很重要</li>
</ul>
<h4 id="92-增加浮动检查，天花板不需要检查，桌子需要检查"><a href="#92-增加浮动检查，天花板不需要检查，桌子需要检查" class="headerlink" title="92 增加浮动检查，天花板不需要检查，桌子需要检查"></a>92 增加浮动检查，天花板不需要检查，桌子需要检查</h4><ol>
<li>满足预览绿色 以及 可以放置的条件<ul>
<li>不能是重叠的</li>
<li>不能是浮动的</li>
</ul>
</li>
<li>桌子需要浮动检查，天花板不需要浮动检查</li>
</ol>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>创建 方法 IsBuildFloating?<ul>
<li>Outputs<ul>
<li>DidHit? bool</li>
</ul>
</li>
<li>Line Trace By Channel<ul>
<li>Start 是 变量 BuildTransform 右键拆分 的 Location</li>
<li>End 是 变量 BuildTransform 右键拆分 的 Location - Z 50</li>
<li>Actors to Ignore 是 Make Array<ul>
<li>BuildPreview</li>
</ul>
</li>
<li>Draw Debug Type 是 For Duration 持续</li>
<li>Return Value 连接 Return Node 的 DidHit?</li>
</ul>
</li>
</ul>
</li>
<li>编辑方法 BuildModeClient<ul>
<li><code>Get Snaping Points</code> 后的 Branch<ul>
<li>False<ul>
<li><code>IsBuildFloating?</code><ul>
<li>Return 的 <code>DidHit?</code> 和 <code>CheckForOverlap 的 Return Value 的 Not</code> 进行 <code>And</code></li>
<li>传递给 方法 SetPreviewColor 的 IsGreen?</li>
</ul>
</li>
</ul>
</li>
<li>True 修改 true 后 Set BuildTransform 后面的逻辑<ul>
<li>原来的逻辑 Set BuildTransform 后面增加逻辑</li>
<li>Branch <code>变量 BuildPreview Get BuildableInfo</code> break <code>BuildableInfoDoFloatCheck?</code> 是否需要进行浮动检查<ul>
<li>True<ul>
<li>执行 <code>Get Snaping Points</code> 后的 Branch 为 False 后的所有逻辑</li>
</ul>
</li>
<li>False<ul>
<li>执行 原来逻辑</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FoundationMaster</p>
<ul>
<li>类默认设置<ul>
<li>BuildableInfoDoFloatCheck? 是 True</li>
</ul>
</li>
</ul>
<p>测试：可以检测是否浮动，如果浮动则提示无法放置，但是可以放置，因为服务器没有验证</p>
<p>开始设置服务器的逻辑</p>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>编辑 方法 BuildPlacementCheck<ul>
<li><code>Set 变量 Transform</code> 后的 Branch<ul>
<li>False<ul>
<li><code>IsBuildFloating?</code><ul>
<li>Return 的 <code>DidHit?</code> 和 <code>CheckForOverlap 的 Return Value 的 Not</code> 进行 <code>And</code></li>
<li>传递给 方法 SetPreviewColor 的 IsGreen?</li>
</ul>
</li>
</ul>
</li>
<li>True<ul>
<li>原来的逻辑 Set BuildTransform 后面增加逻辑</li>
<li>Branch <code>变量 BuildPreview</code> break <code>BuildableInfoDoFloatCheck?</code> 是否需要进行浮动检查<ul>
<li>True<ul>
<li>执行 <code>Get Snaping Points</code> 后的 Branch 为 False 后的所有逻辑</li>
</ul>
</li>
<li>False<ul>
<li>执行 原来逻辑</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Line Trace By Channel 后 没有像Client那样 存储 HitActor 和 HitComponent，需要添加设置<ul>
<li>HitActor &#x3D; Hit Actor</li>
<li>HitComponent &#x3D; Hit Component</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：可以检测是否浮动，如果浮动则不能放置建造物</p>
<h4 id="93-添加门窗和门的开关"><a href="#93-添加门窗和门的开关" class="headerlink" title="93 添加门窗和门的开关"></a>93 添加门窗和门的开关</h4><p>In All&#x2F;Content&#x2F;EasyBuildingSystem&#x2F;Meshes&#x2F;Structures&#x2F;Stylized&#x2F;<br>将 课件 中的 SM_Stylized_Wood_Door 复制并且替换到 项目中的 SM_Stylized_Wood_Door Wood文件夹 点击 Done<br>将 课件 中的 SM_Stylized_Stone_Door 复制并且替换到 项目中的 SM_Stylized_Wood_Door Stone文件夹 点击 Done<br>将 课件 中的 SM_Stylized_Metal_Door 复制并且替换到 项目中的 SM_Stylized_Wood_Door Metal文件夹 点击 Done</p>
<p>创建 蓝图子类 BP_DoorFrame 继承 BP_WallMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem<br>OPEN BP_DoorFrame</p>
<ul>
<li>类设置 BuildableInfo<ul>
<li>TraceChannel 是 WallTrace</li>
</ul>
</li>
<li>设置 静态网格 <ul>
<li>材质 SM_Stylized_Wood_DoorFrame<ul>
<li>变换<ul>
<li>0 0 150</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:DoorBox<ul>
<li>变换<ul>
<li>60 0 -150</li>
<li>0 0 -180</li>
</ul>
</li>
<li>Box Extent 100 10 200</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>DoorTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 3个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>创建 蓝图子类 BP_DoorMaster 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem<br>OPEN BP_DoorMaster</p>
<ul>
<li>类设置 BuildableInfo<ul>
<li>TraceChannel 是 DoorTrace</li>
<li>其他不设置</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Door</li>
</ul>
</li>
</ul>
<p>创建 蓝图子类 BP_WindowFrame 继承 BP_WallMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>类设置 BuildableInfo<ul>
<li>TraceChannel 是 WallMaster</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Windowframe</li>
<li>增加 Box Collision 组件 Rename:WindowFrameBox<ul>
<li>变换<ul>
<li>0 0 0</li>
</ul>
</li>
<li>Box Extent 80 20 60</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>WindowTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 3个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>创建 蓝图子类 BP_WindowMaster 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem<br>OPEN BP_WindowMaster</p>
<ul>
<li>类设置 BuildableInfo<ul>
<li>TraceChannel 是 WindowTrace</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Window</li>
</ul>
</li>
<li>类设置 BuildableInfo<ul>
<li>TraceChannel 是 WindowTrace</li>
</ul>
</li>
</ul>
<p>OPEN DT_Structures</p>
<ul>
<li>增加 ID 4<ul>
<li>BuildableClass BP_DoorFrame</li>
</ul>
</li>
<li>增加 ID 5<ul>
<li>BuildableClass BP_DoorMaster</li>
</ul>
</li>
<li>增加 ID 6<ul>
<li>BuildableClass BP_WindowFrame</li>
</ul>
</li>
<li>增加 ID 7<ul>
<li>BuildableClass BP_WindowMaster</li>
</ul>
</li>
</ul>
<p>测试:<br>可以放置 门框、门、窗、窗框</p>
<p>设置门互动<br>思路：角色的摄像头旋转视角 和 门</p>
<p>创建 蓝图接口文件 BPI_Intractable In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>添加方法 InteractEvent<ul>
<li>Inputs<ul>
<li>CharRef BP_FirstPersonCharacter</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>之前的 E 键逻辑是收获物品，需要在没有收获到物品后 增加一条射线检测门的逻辑</li>
<li>new Var CameraLocation Vector</li>
<li>new Var CameraRotation Rotator</li>
<li>new Event LineTraceStorageBoxOnServer<ul>
<li>LineTraceFunction<ul>
<li>Interface &#x3D; BPI_Intractable</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 LineTraceFunction<ul>
<li>创建 局部变量 InteractDistance Float Default:280</li>
<li>Inputs<ul>
<li>Interface 类引用(通过 Does Implement Interface 参数 移动到 方法名添加)</li>
</ul>
</li>
<li>Outputs<ul>
<li>HitActor Actor</li>
<li>ImplementsInterface? bool</li>
</ul>
</li>
<li>参数 Interface 设置 局部变量 LocalInterface</li>
<li>GEt First Person Camera 的 Get World Location 设置 变量 CameraLocation</li>
<li>Line Trace By Channel<ul>
<li>Start 是 CameraLocation</li>
<li>End 是 CameraRotation 的 Get Forward Vector * InteractDistance + CameraLocation</li>
<li>Trace Channel 是 Camera</li>
</ul>
</li>
<li>Branch 结果<ul>
<li>True<ul>
<li>Does Implement Interface? 连接 HitActor<ul>
<li>Class &#x3D; LocalInterface</li>
</ul>
</li>
<li>Branch 结果<ul>
<li>True<ul>
<li>Set HitActor &#x3D; Hit Actor</li>
<li>Set ImplementsInterface? &#x3D; true</li>
</ul>
</li>
<li>False<ul>
<li>Set ImplementsInterface? &#x3D; false</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>HitActor &#x3D; None</li>
<li>ImplementsInterface? &#x3D; false</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event LineTraceStorageBoxOnServer<ul>
<li>LineTraceFunction 后</li>
<li>判断<ul>
<li>True<ul>
<li>InteractEvent<ul>
<li>CharRef 传入 Self</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑方法 E按键 Event <ul>
<li>First Person Camera 的 Get World Rotation 连接 CameraRotation</li>
</ul>
</li>
<li>编辑 方法 InteractOnServer<ul>
<li>Inputs<ul>
<li>CameraRotator Rotator</li>
<li>首先 设置一下 CameraRotation</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event OverlapGroundItems<ul>
<li>在 绘制调试球体 的 Branch 为 False 的 Set Harvesting? 后</li>
<li>LineTraceStorageBox</li>
</ul>
</li>
</ul>
<p>OPEN BP_DoorMaster</p>
<ul>
<li>类设置<ul>
<li>Add BPI_Intractable</li>
</ul>
</li>
<li>编辑 Interfaces InteractEvent<ul>
<li>Print String “门被互动了”</li>
</ul>
</li>
</ul>
<p>Fix 按E键 之前收获逻辑播放动画的问题<br>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>编辑 Event OverlapGroundItems GET OutActors 的 get 后<ul>
<li>Does Implement Interface<ul>
<li>Class &#x3D; BPI_GroundItem</li>
</ul>
</li>
<li>Branch<ul>
<li>True<ul>
<li>执行后续</li>
</ul>
</li>
<li>False<ul>
<li>执行 No Hit</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：放置门后，按E键 提示 门被互动了</p>
<p>OPEN BP_DoorMaster</p>
<ul>
<li>new var IsDoorOpen? bool 设置 Replication &#x3D; RepNotify 含义：当变量改变时，会触发 RepNotify，此时会多一个方法 OnRep_IsDoorOpen?</li>
<li>编辑 Interfaces InteractEvent<ul>
<li>Branch IsDoorOpen?<ul>
<li>True<ul>
<li>Set IsDoorOpen? &#x3D; false</li>
</ul>
</li>
<li>False<ul>
<li>Set IsDoorOpen? &#x3D; true</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>new Event SetDoorRotationOnMulticast<ul>
<li>Inputs<ul>
<li>OpenerClose? bool</li>
</ul>
</li>
<li>Branch OpenerClose?<ul>
<li>True<ul>
<li>Timeline 的 Play From Start<ul>
<li>add Float Track<ul>
<li>0 0</li>
<li>1 -90</li>
<li>点击垂直 右键 Auto</li>
<li><code>长度设置从5 设置到1</code></li>
</ul>
</li>
<li>Update<ul>
<li>门 静态网格体 组件 Set Relative Rotation<ul>
<li>Make Rotation 的 Z &#x3D; Timeline 的 轨道Return</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>False 连接 Timeline 的 Reverse from End</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 OnRep_IsDoorOpen?<ul>
<li>Set Door Rotation On Multicast<ul>
<li>OpenerClose? &#x3D; 参数 IsDoorOpen?</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：放置门后，按E键 门会打开和关闭，但是开启后还是会存在一个多的门</p>
<p>FIX</p>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>编辑 Event SpawnBuildOnServer<ul>
<li>SpawnBuildable 后 依然需要 Destroy Actor</li>
</ul>
</li>
</ul>
<p>测试成功！</p>
<p>TODO 遗留的问题：</p>
<ol>
<li>建造门的时候 门创建的位置不太合适，创建不流畅</li>
<li>门的方向不对 应该朝外</li>
</ol>
<h4 id="94-添加三角形基础"><a href="#94-添加三角形基础" class="headerlink" title="94 添加三角形基础"></a>94 添加三角形基础</h4><p>创建 BP_TriangleFoundation 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>类设置 BuildableInfo<ul>
<li>TraceChannel 是 TriangleTrace</li>
<li>CanPlaceOnGroup? 是 True</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
<li>OverlapBoxSize<ul>
<li>0 7 45 </li>
<li>0 0 0 </li>
<li>2 1.1 1</li>
</ul>
</li>
<li>编辑 静态网格<ul>
<li>材质 SM_Stylized_Wood_Triangle_Foundation</li>
<li>增加地板<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Foundation</li>
<li>变换<ul>
<li>0 237 0</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Foundation1<ul>
<li>变换<ul>
<li>0 237 0</li>
</ul>
</li>
<li>Box Extent 150 150 85</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>FoundationTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Foundation2<ul>
<li>变换<ul>
<li>205 -118.3 0</li>
<li>0 0 -30</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Foundation3<ul>
<li>变换<ul>
<li>-205 -118.4 0</li>
<li>0 0 -60</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>增加三角台<ul>
<li>编辑 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Triangle_Foundation</li>
<li>变换<ul>
<li>0 173 0</li>
<li>0 0 60</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:TriangleFoundation1<ul>
<li>变换<ul>
<li>150 -87 0</li>
<li>0 0 -60</li>
</ul>
</li>
<li>Box Extent 150 150 85</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:TriangleFoundation2<ul>
<li>变换<ul>
<li>-149.803415 -86.591622 0</li>
<li>0 0 -60</li>
</ul>
</li>
</ul>
</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>TriangleTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
<li>增加墙壁<ul>
<li>编辑 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Wall</li>
<li>变换<ul>
<li>0 89 234.8</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Wall1<ul>
<li>变换<ul>
<li>0 89 234.8</li>
</ul>
</li>
<li>Box Extent 150 10 150</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Wall2<ul>
<li>变换<ul>
<li>77.095519 -44.922601 234.8</li>
<li>0 0 -120</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Wall2<ul>
<li>变换<ul>
<li>-76.814355 -44.388824 234.8</li>
<li>0 0 -240</li>
</ul>
</li>
</ul>
</li>
<li>Box Collision 碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>WallTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 9个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>OPEN DT_Structures</p>
<ul>
<li>增加 ID 8<ul>
<li>BuildableClass BP_TriangleFoundation</li>
</ul>
</li>
</ul>
<p>测试：可以放置三角形基础，多放几个</p>
<p>给基础木台设置三角台的捕捉位置</p>
<p>OPEN BP_FoundationMaster</p>
<ul>
<li>静态网格组件<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Triangle_Foundation</li>
<li>变换<ul>
<li>0 235 0</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:TriangleFoundation1<ul>
<li>Box Extent 150 150 85</li>
<li>变换<ul>
<li>0 235 0</li>
<li>0 0 -60</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:TriangleFoundation2<ul>
<li>变换<ul>
<li>-236 0 0</li>
<li>0 0 30</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:TriangleFoundation3<ul>
<li>变换<ul>
<li>236 0 0</li>
<li>0 0 -30</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:TriangleFoundation4<ul>
<li>变换<ul>
<li>0 -236 0</li>
<li>0 0 0<br>Box Collision 碰撞预设 自定义</li>
</ul>
</li>
<li>全部 Ignore</li>
<li>TriangleTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 4个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>注意：</p>
<ol>
<li>确保所有的建造物的 StaticMesh 碰撞预设都是 BlockAllDynamic</li>
<li>确保所有的建造物的 OverlayBoxSize 碰撞预设都是 Ignore</li>
<li>添加 Box Collision 组件 时，需要添加 静态网格体 组件，调整好位置之后，复制变换给 Box Collision 组件，然后删除 静态网格体 组件</li>
</ol>
<h4 id="95-添加坡道和围栏-的建造物"><a href="#95-添加坡道和围栏-的建造物" class="headerlink" title="95 添加坡道和围栏 的建造物"></a>95 添加坡道和围栏 的建造物</h4><p>创建 蓝图子类 BP_FenceMaster 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>类默认设置 BuildableInfo<ul>
<li>TraceChannel 是 WallTrace</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Fence</li>
</ul>
</li>
</ul>
<p>创建 蓝图子类 BP_RampMaster 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>类默认设置 BuildableInfo<ul>
<li>TraceChannel 是 RampTrace</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
<li>设置 OverlapBoxSize<ul>
<li>0 -70 50</li>
<li>0 0 0</li>
<li>1.3 1 1</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Ramp</li>
</ul>
</li>
</ul>
<p>OPEN DT_Structures</p>
<ul>
<li>增加 ID 9<ul>
<li>BuildableClass BP_FenceMaster</li>
</ul>
</li>
<li>增加 ID 10<ul>
<li>BuildableClass BP_RampMaster</li>
</ul>
</li>
</ul>
<p>为 基础木台 增加 坡道捕捉位置<br>OPEN BP_FoundationMaster</p>
<ul>
<li>静态网格组件<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Ramp</li>
<li>变换<ul>
<li>0 300 0</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Ramp1<ul>
<li>Box Extent 150 150 85</li>
<li>变换<ul>
<li>0 300 0</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Ramp2<ul>
<li>变换<ul>
<li>0 300 0</li>
<li>0 0 -90</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Ramp2<ul>
<li>变换<ul>
<li>-300 0 0</li>
<li>0 0 90</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Ramp2<ul>
<li>变换<ul>
<li>0 -300 0</li>
<li>0 0 180<br>Box Collision 碰撞预设 自定义</li>
</ul>
</li>
<li>全部 Ignore</li>
<li>RampTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>为 三角建造物 增加 坡道捕捉位置<br>OPEN BP_FoundationMaster</p>
<ul>
<li>静态网格组件<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Ramp</li>
<li>变换<ul>
<li>0 235 0</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Ramp1<ul>
<li>Box Extent 150 150 85</li>
<li>变换<ul>
<li>0 257 0</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Ramp2<ul>
<li>变换<ul>
<li>-205 -118.3 0</li>
<li>0 0 -240</li>
</ul>
</li>
</ul>
</li>
<li>复制 Box Collision 组件 Rename:Ramp2<ul>
<li>变换<ul>
<li>0 -300 0</li>
<li>0 0 180<br>Box Collision 碰撞预设 自定义</li>
</ul>
</li>
<li>全部 Ignore</li>
<li>RampTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="96-三角形天花板"><a href="#96-三角形天花板" class="headerlink" title="96 三角形天花板"></a>96 三角形天花板</h4><p>创建 蓝图子类 BP_TriangleCeiling 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>类默认设置 BuildableInfo<ul>
<li>TraceChannel 是 TriangleCeilingTrace</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
<li>设置 OverlapBoxSize</li>
<li>增加 正方体天花板<ul>
<li>创建 静态网格体 组件<ul>
<li>材质 SM_Stylized_Wood_Ceiling</li>
<li>变换<ul>
<li>0 236.5 0</li>
</ul>
</li>
</ul>
</li>
<li>创建 Box Collision 组件 Rename:Ceiling1<ul>
<li>Box Extent 150 150 10</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>调整 静态网格体 组件<ul>
<li>变换<ul>
<li>204.725551 -118.203589 0</li>
<li>0 0 -119.99999</li>
</ul>
</li>
</ul>
</li>
<li>创建 Box Collision 组件 Rename:Ceiling2<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>调整 静态网格体 组件<ul>
<li>变换<ul>
<li>-205.019206 -118.250957 0</li>
<li>0 0 30</li>
</ul>
</li>
</ul>
</li>
<li>创建 Box Collision 组件 Rename:Ceiling3<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>FloorTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>增加 三角形天花板<ul>
<li>创建 静态网格体 组件<ul>
<li>材质 SM_Stylized_Wood_Triangle_Ceiling</li>
<li>变换<ul>
<li>0 173.5 0</li>
<li>0 0 -60</li>
</ul>
</li>
</ul>
</li>
<li>创建 Box Collision 组件 Rename:Triangle1<ul>
<li>Box Extent 150 150 10</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>150 -86.5 0</li>
<li>0 0 -60</li>
</ul>
</li>
</ul>
</li>
<li>创建 Box Collision 组件 Rename:Triangle2<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>-150 -86.5 0</li>
<li>0 0 -60</li>
</ul>
</li>
</ul>
</li>
<li>创建 Box Collision 组件 Rename:Triangle3<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>TriangleCeilingTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>增加 正方形墙面<ul>
<li>创建 静态网格体 组件<ul>
<li>材质 SM_Stylized_Wood_Wall</li>
<li>变换<ul>
<li>0 89 157.5</li>
</ul>
</li>
</ul>
</li>
<li>创建 Box Collision 组件 Rename:Wall1<ul>
<li>Box Extent 150 10 150</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>76.922911 -43.847995 157.499999</li>
<li>0 0 -120</li>
</ul>
</li>
</ul>
</li>
<li>创建 Box Collision 组件 Rename:Wall2<ul>
<li>Box Extent 150 10 150</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>-76.922911 -43.847995 157.499999</li>
<li>0 0 -240</li>
</ul>
</li>
</ul>
</li>
<li>创建 Box Collision 组件 Rename:Wall3<ul>
<li>Box Extent 150 10 150</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>WallTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 9个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>为 正方形墙面 增加 三角形天花板 捕捉位置<br>OPEN BP_WallMaster</p>
<ul>
<li>静态网格组件<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Triangle_Ceiling</li>
<li>变换<ul>
<li>0 -88.904786 151.911246</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:TriangleCeiling1<ul>
<li>Box Extent 150 150 10</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>84.434931 151.911246</li>
<li>0 0 -60</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:TriangleCeiling1<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>TriangleCeilingTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>增加 三角形天花板的数据表<br>OPEN DT_Structures</p>
<ul>
<li>增加 ID 11<ul>
<li>BuildableClass BP_TriangleCeiling</li>
</ul>
</li>
</ul>
<p>测试</p>
<p>为 正方形天花板 增加捕捉位置 OPEN BP_CeilingMaster</p>
<ul>
<li>静态网格组件<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Triangle_Ceiling</li>
<li>变换<ul>
<li>0 236.5 0 </li>
<li>0 0 -60</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:TriangleCeiling1<ul>
<li>Box Extent 150 150 10</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>236.5 0 0</li>
<li>0 0 -30</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Copy<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>0 -236.5 0</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Copy<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>-236.5 0 0</li>
<li>0 0 30</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Copy<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>TriangleCeilingTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试</p>
<p>待补充：<br>为 正方形门墙 增加捕捉位置<br>为 正方形窗墙 增加捕捉位置</p>
<h4 id="97-添加可交互的火炬"><a href="#97-添加可交互的火炬" class="headerlink" title="97 添加可交互的火炬"></a>97 添加可交互的火炬</h4><p>选择资源文件夹</p>
<ul>
<li>EasyBuildingSystem&#x2F;Meshes&#x2F;Props&#x2F;Stylized </li>
<li>选中 床 和 火炬 SM_Stylized_Bed 和 SM_Stylized_Torch</li>
<li>右键 迁移[Migrate] 弹出资源报告</li>
<li>选择当前项目路径的 ${项目路径}&#x2F;Content 是否重写 点击全部重写</li>
</ul>
<p>创建 蓝图子类 BP_Torch 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>类 默认 <ul>
<li>BuildableInfo<ul>
<li>TraceChannel 是 TorchTrace</li>
</ul>
</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Torch</li>
</ul>
</li>
</ul>
<p>增加火源，市场 Realistic Starter VFX Pack Vol 2<br>OPEN P_Fire_Small 只用一个粒子效果<br>创建 粒子文件 P_TorchFire Copy P_Fire_Small</p>
<p>OPEN P_TorchFire</p>
<ul>
<li>删除其他的 只留 smoke_a fire_small_a light_a</li>
<li>删除 右键 发射器 删除</li>
</ul>
<p>OPEN BP_Torch</p>
<ul>
<li>增加 粒子系统组件 Particle System 组件<ul>
<li>调整位置<ul>
<li>-30 -44 57</li>
</ul>
</li>
<li>设置 粒子效果 模板 P_TorchFire<ul>
<li>增加交互<ul>
<li>详情的 Visible 改为 False 默认隐藏</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 变量 IsTorchLit? bool RepNotify 修改后触发</li>
<li>类设置<ul>
<li>增加 API接口 BPI_Intractable</li>
</ul>
</li>
<li>编辑 接口 EventInteractEvent 用来控制 火源是否显示<ul>
<li>判断火源是否显示<ul>
<li>false<ul>
<li>显示</li>
</ul>
</li>
<li>true<ul>
<li>不显示</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 OnRep_IsTorchLit?</li>
<li>Set 火焰粒子 Set Visibility<ul>
<li>new Visible &#x3D; 变量 IsTorchLit?</li>
</ul>
</li>
</ul>
<p>为 墙壁增加 火炬捕捉位置<br>OPEN BP_WallMaster</p>
<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Torch</li>
<li>变换<ul>
<li>0 10 0</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Torch1<ul>
<li>Box Extent 60 10 60</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>0 -10 0</li>
<li>0 0 -180</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Copy<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>TorchTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 2个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>增加 火炬的数据表<br>OPEN DT_Structures</p>
<ul>
<li>增加 ID 12<ul>
<li>BuildableClass BP_Torch</li>
</ul>
</li>
</ul>
<p>测试:</p>
<ol>
<li>在正方形墙壁上放置火炬</li>
<li>按E键 火炬会显示和隐藏</li>
</ol>
<p>设置门框左右的捕捉位置<br>OPEN BP_DoorFrame</p>
<ul>
<li>编辑 TorchBox1<ul>
<li>变换<ul>
<li>-100 10 0</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>编辑 TorchBox2<ul>
<li>变换<ul>
<li>100 10 0</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="98-添加楼梯和床"><a href="#98-添加楼梯和床" class="headerlink" title="98 添加楼梯和床"></a>98 添加楼梯和床</h4><p>添加楼梯</p>
<p>创建 蓝图子类 BP_StairsMaster 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>类 默认 <ul>
<li>BuildableInfo<ul>
<li>TraceChannel 是 StairsTrace</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Stairs</li>
</ul>
</li>
</ul>
<p>为 基础木台 增加 楼梯捕捉位置<br>OPEN BP_FoundationMaster</p>
<ul>
<li>静态网格组件<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Stairs</li>
<li>变换<ul>
<li>0 -14 242</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Stairs1<ul>
<li>Box Extent 180 180 180 </li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>StairsTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 1个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>增加 楼梯的数据表<br>OPEN DT_Structures</p>
<ul>
<li>增加 ID 13<ul>
<li>BuildableClass BP_StairsMaster</li>
</ul>
</li>
</ul>
<p>测试</p>
<p>为 基础天花板 增加 楼梯捕捉位置<br>OPEN BP_CeilingMaster</p>
<ul>
<li>同上 高度是242</li>
</ul>
<p>创建 蓝图子类 BP_Bed 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem</p>
<ul>
<li>类 默认 <ul>
<li>BuildableInfo<ul>
<li>CanPlaceOnFoundation? 是 True</li>
</ul>
</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Bed</li>
</ul>
</li>
</ul>
<p>增加 检测 是否可以放置在基础木台上<br>OPEN BPC_BuildingComponent</p>
<ul>
<li>创建 Event BuildOnFoundation?<ul>
<li>Outputs<ul>
<li>CanFoundation? bool</li>
</ul>
</li>
<li>Line Trace By Channel<ul>
<li>Start 是 变量 BuildPreview 的 静态网格体 的 世界位置</li>
<li>End 是 变量 BuildPreview 的 静态网格体 的 世界位置 - (0 0 50)</li>
<li>Actors To Ignore 是 Make Array 变量 BuildPreview</li>
</ul>
</li>
<li>Branch<ul>
<li>True<ul>
<li>Break Out Hit 的 HitActor 进行 Actor Has Tag(判断是否有标签)<ul>
<li>Tag &#x3D; Foundation</li>
</ul>
</li>
<li>Return Node<ul>
<li>CanFoundation? &#x3D; Actor Has Tag 的 Return Value</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>Return Node<ul>
<li>CanFoundation? &#x3D; false</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 BuildModeClient<ul>
<li>GetSnappingPoints &#x3D;&#x3D; false 后<ul>
<li>再增加一个 Branch 判断 CanPlaceOnGround? true 则原逻辑，false往下</li>
<li>Branch CanPlaceOnFoundation?<ul>
<li>True<ul>
<li>BuildOnFoundation?</li>
<li>根据参数检测，检测完后，后续逻辑一样</li>
</ul>
</li>
<li>False<ul>
<li>Set PreviewColor …</li>
</ul>
</li>
</ul>
</li>
<li>还有一种情况 逻辑上，建造物如果不能放在地面上，还需要检测是否能放在基础木台上<ul>
<li>判断 CanPlaceOnGround? true 后 但是整体都是 false，这时候需要重新 Branch CanPlaceOnFoundation?一下</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 BuildPlacementCheck<ul>
<li>一样的修改</li>
</ul>
</li>
</ul>
<p>OPEN BP_FoundationMaster</p>
<ul>
<li>CanPlaceOnGroup? 是 True</li>
<li>UseCustomOverlap? 是 True</li>
<li>DoFloatCheck? 是 True</li>
<li>增加标签 详情 Tags Array item &#x3D;&gt; Foundation</li>
</ul>
<p>OPEN BP_TriangleFoundation</p>
<ul>
<li>CanPlaceOnGroup? 是 True</li>
<li>UseCustomOverlap? 是 True</li>
<li>增加标签 详情 Tags Array item &#x3D;&gt; Foundation</li>
</ul>
<p>增加 床的数据表<br>OPEN DT_Structures</p>
<ul>
<li>增加 ID 14<ul>
<li>BuildableClass BP_Bed</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>床不能地面上，可以放在基础木台、和三角形基础木台上</li>
</ol>
<h4 id="99-添加-左右三角形墙壁和屋顶"><a href="#99-添加-左右三角形墙壁和屋顶" class="headerlink" title="99 添加 左右三角形墙壁和屋顶"></a>99 添加 左右三角形墙壁和屋顶</h4><p>创建 蓝图子类 BP_RoofLeftMaster 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem<br>OPEN BP_RoofLeftMaster</p>
<ul>
<li>类 默认 <ul>
<li>BuildableInfo<ul>
<li>TraceChannel 是 WallTrace</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Sloped_Wall_Left</li>
</ul>
</li>
<li>为 三角形墙壁 增加 屋顶的捕捉位置<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Roof</li>
<li>变换<ul>
<li>0 -143.342 0</li>
<li>0 0 180</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:RoofBox1<ul>
<li>Box Extent 150 150 150</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>RoofTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 1个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>Copy 蓝图子类 BP_RoofRightMaster TO BP_RoofLeftMaster<br>OPEN BP_RoofRightMaster</p>
<ul>
<li>类 默认<ul>
<li>BuildableInfo<ul>
<li>TraceChannel 是 WallTrace</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Sloped_Wall_Right</li>
</ul>
</li>
<li>为 三角形墙壁 增加 屋顶的捕捉位置<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Roof</li>
<li>变换<ul>
<li>0 143.342 0</li>
<li>0 0 0</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:RoofBox1<ul>
<li>Box Extent 150 150 150</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>RoofTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 1个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>创建 蓝图子类 BP_RoofLargeMaster 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem<br>OPEN BP_RoofLargeMaster</p>
<ul>
<li>类 默认<ul>
<li>BuildableInfo<ul>
<li>TraceChannel 是 RoofTrace</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Roof</li>
</ul>
</li>
<li>设置 OverlapBoxSize<ul>
<li>6.5 0 8</li>
<li>0 50 0</li>
<li>1 2.6 3.1</li>
</ul>
</li>
<li>为 屋顶 增加 屋顶的捕捉位置<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Roof</li>
<li>变换<ul>
<li>0 300 0</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:RoofBox1<ul>
<li>Box Extent 150 150 150</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>0 -300 0</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>RoofTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 2个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>增加 三个建造物的数据表<br>OPEN DT_Structures</p>
<ul>
<li>增加 ID 15<ul>
<li>BuildableClass BP_RoofLeftMaster</li>
</ul>
</li>
<li>增加 ID 16<ul>
<li>BuildableClass BP_RoofRightMaster</li>
</ul>
</li>
<li>增加 ID 17<ul>
<li>BuildableClass BP_RoofLargeMaster</li>
</ul>
</li>
</ul>
<p>为 基础墙壁 增加 向上的基础墙壁的捕捉位置<br>OPEN BP_WallMaster</p>
<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Wall</li>
<li>变换<ul>
<li>0 0 300</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Wall1<ul>
<li>Box Extent 150 10 150</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>WallTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 1个 Box Collision 组件</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>为 门框 增加 向上的基础墙壁的捕捉位置</p>
<ul>
<li>Copy BP_WallMaster 的 Wall1 到 BP_DoorFrame</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 1个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>为 窗框 增加 向上的基础墙壁的捕捉位置</p>
<ul>
<li>Copy BP_WallMaster 的 Wall1 到 BP_WindowFrame</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 1个 Box Collision 组件</li>
</ul>
</li>
</ul>
<h4 id="100-添加-三角形墙壁建造物"><a href="#100-添加-三角形墙壁建造物" class="headerlink" title="100 添加 三角形墙壁建造物"></a>100 添加 三角形墙壁建造物</h4><p>创建 蓝图子类 BP_RoofTriangleMaster 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem<br>OPEN BP_RoofTriangleMaster</p>
<ul>
<li>类 默认<ul>
<li>BuildableInfo<ul>
<li>TraceChannel 是 WallTrace</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Triangle_Wall</li>
</ul>
</li>
<li>设置 屋顶 捕捉位置<ul>
<li>增加 静态网格体 组件<ul>
<li>设置 材质 SM_Stylized_Wood_Half_Roof</li>
<li>变换<ul>
<li>0 -142 0</li>
<li>0 0 0</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:RoofBox1<ul>
<li>Box Extent 130 150 50</li>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>修改 静态网格体 组件<ul>
<li>变换<ul>
<li>0 -142 0</li>
<li>0 0 180</li>
</ul>
</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:Copy<ul>
<li>复制 静态网格体的 变换</li>
</ul>
</li>
<li>选中 所有 Box Collision 组件<ul>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>RoofSmallTrace BlockAll</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 API方法 ReturnBoxes<ul>
<li>Make Array 增加返回 2个 Box Collision 组件</li>
</ul>
</li>
</ul>
<p>创建 蓝图子类 BP_RoofSmallMaster 继承 BP_BuildableMaster In _Main&#x2F;Blueprints&#x2F;BuildingSystem<br>OPEN BP_RoofSmallMaster</p>
<ul>
<li>类 默认<ul>
<li>BuildableInfo<ul>
<li>TraceChannel 是 RoofSmallTrace</li>
<li>UseCustomOverlap? 是 True</li>
</ul>
</li>
</ul>
</li>
<li>设置 静态网格<ul>
<li>材质 SM_Stylized_Wood_Half_Roof</li>
</ul>
</li>
<li>设置 OverlapBoxSize<ul>
<li>81 0 -65</li>
<li>0 -40 0</li>
<li>1.78 2.322 0.68</li>
</ul>
</li>
<li>为 屋顶 增加 屋顶的捕捉位置</li>
</ul>
<p>增加 2个建造物的数据表<br>OPEN DT_Structures</p>
<ul>
<li>增加 ID 18<ul>
<li>BuildableClass BP_RoofTriangleMaster</li>
</ul>
</li>
<li>增加 ID 19<ul>
<li>BuildableClass BP_RoofSmallMaster</li>
</ul>
</li>
</ul>
<p>修复遗留的问题：</p>
<ul>
<li>门墙的顶部的墙面捕捉位置无效</li>
<li>窗墙的顶部的墙面捕捉位置无效</li>
</ul>
<p>OPEN BP_DoorFrame 和 BP_WindowFrame</p>
<ul>
<li>需要 ReturnBoxes 方法中增加返回 Wall1 组件</li>
</ul>
<p><img src="/blog/p/614a8811/%E4%B8%89%E8%A7%92%E5%BD%A2%E5%A2%99%E5%A3%81%E5%BB%BA%E9%80%A0%E7%89%A9.png" alt="三角形墙壁建造物.png"></p>
<h4 id="101-为建造物增加损坏和破坏效果"><a href="#101-为建造物增加损坏和破坏效果" class="headerlink" title="101 为建造物增加损坏和破坏效果"></a>101 为建造物增加损坏和破坏效果</h4><p>创建 蓝图枚举 伤害类型文件 E_StructureDamageType In _Main&#x2F;Blueprints&#x2F;Enums</p>
<ul>
<li>增加<ul>
<li>Wood</li>
<li>Stone</li>
<li>Metal</li>
<li>None</li>
</ul>
</li>
</ul>
<p>创建蓝图结构 S_DamageTiers In _Main&#x2F;Blueprints&#x2F;Structures</p>
<ul>
<li>CanDamageType E_StructureDamageType Array</li>
</ul>
<p>OPEN BP_ThirdPersonEquipable</p>
<ul>
<li>创建 变量 StructureDamageTier S_DamageTiers</li>
</ul>
<p>OPEN BP_TP_StoneHatchet</p>
<ul>
<li>详情<ul>
<li>StructureDamageTier 增加 <ul>
<li>Wood</li>
<li>Metal</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建 蓝图接口文件 BPI_StructureDamage In _Main&#x2F;Blueprints&#x2F;Interfaces</p>
<ul>
<li>增加 API接口<ul>
<li>Event GetCanDamage<ul>
<li>Outputs<ul>
<li>DamageTiers S_DamageTiers</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_ThirdPersonEquipable</p>
<ul>
<li>继承 API BPI_StructureDamage</li>
<li>实现 Event GetCanDamage<ul>
<li>返回 变量 StructureDamageTier</li>
</ul>
</li>
</ul>
<p>OPEN BP_BuildableMaster</p>
<ul>
<li>创建 变量 CurrentHP float Default：10 </li>
<li>创建 变量 MaxHP float</li>
<li>实现内置Event AnyDamage 对于这个actor 有任何的损坏 则执行<ul>
<li>Branch Does Implement Interface<ul>
<li>测试对象：伤害的 Causer</li>
<li>接口：BPI_StructureDamage</li>
</ul>
</li>
<li>True<ul>
<li>Branch 方法 CanDamageStructure? 参数连接 DamageCauser<ul>
<li>True<ul>
<li>测试对象：伤害的 Causer</li>
<li>返回值：CanDamage?</li>
<li>Branch CanDamage?</li>
<li>True<ul>
<li>设置 CurrentHP &#x3D; CurrentHP - 受到的伤害</li>
<li>Branch CurrentHP &lt;&#x3D;0</li>
<li>True<ul>
<li>print string “建筑物被摧毁”</li>
<li>执行 建造物本身的 StructureDestroyEvent 事件</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 变量 StructureTier E_StructureDamageType Default:Wood</li>
<li>创建 方法 CanDamageStructure?<ul>
<li>Inputs<ul>
<li>Instigator Object</li>
</ul>
</li>
<li>Outputs<ul>
<li>CanApplyDamage? bool</li>
</ul>
</li>
<li>创建 局部变量 CanDamage? Bool</li>
<li>参数 Instigator &#x3D;&gt; Is Valid</li>
<li>参数 Instigator 的 Get Can Damage 对结果 break 的 数组 进行 For Each Loop With Break<ul>
<li>Branch Array Element &#x3D;&#x3D;(Enum 相等) StructureTier<ul>
<li>True<ul>
<li>设置 CanDamage? 为 True Break</li>
</ul>
</li>
<li>False<ul>
<li>循环执行</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>返回 CanDamage?</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_StoneHatchet</p>
<ul>
<li>编辑 方法 ServerOverlap 是否重叠 的 SphereOverlapActors 增加一个 Structure<ul>
<li>变成两个<ul>
<li>Structure</li>
<li>Pawn</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_BuildableMaster</p>
<ul>
<li>编辑 静态网格体 的 碰撞预设设置<ul>
<li>ObjectType &#x3D; Structure</li>
</ul>
</li>
</ul>
<p>但是 继承 BP_BuildableMaster 的 子类的 静态网格体 的 碰撞预设设置 不会被自动修改，需要手动修改<br>OPEN BP_FoundationMaster</p>
<ul>
<li>编辑 静态网格体 的 碰撞预设设置<ul>
<li>ObjectType &#x3D; Structure</li>
</ul>
</li>
</ul>
<p>OPEN BPI_BuildInterface</p>
<ul>
<li>增加 API接口<ul>
<li>Event StructureDestroyEvent</li>
</ul>
</li>
</ul>
<p>OPEN BP_BuildableMaster</p>
<ul>
<li>实现 StructureDestroyEvent</li>
</ul>
<p>为 建造物 创建 破坏效果<br>创建文件夹 _Main&#x2F;Meshes&#x2F;DestructableMeshes&#x2F;Wood</p>
<p>OPEN FirstPersonMap 和 EasyBuildingSystem&#x2F;Meshes&#x2F;Props&#x2F;Stylized&#x2F;Wood&#x2F;SM_Stylized_Wood_Foundation</p>
<ul>
<li>将 上面文件夹内的基础木台 放进地图中</li>
<li>进入 破裂 Fracture 模式<ul>
<li>New </li>
<li>选择 Wood 文件夹</li>
<li>Rename DW_WoodFoundationForce</li>
<li>确认 创建 几何集合</li>
<li>Uniform<ul>
<li>20 x 20 确认</li>
</ul>
</li>
</ul>
</li>
<li>从地图中删除 基础木台</li>
</ul>
<p>OPEN BP_BuildableMaster</p>
<ul>
<li>增加 几何体 组件 Rename:DestructableMesh<ul>
<li>设置 几何体 DW_WoodFoundationForce</li>
<li>设置 隐藏</li>
</ul>
</li>
<li>编辑 StructureDestroyEvent<ul>
<li>执行 MulticastDestruction</li>
</ul>
</li>
<li>创建 Event MulticastDestruction<ul>
<li>设置 静态网格体 的 碰撞状态  Static Mesh &#x3D;&gt; Set Collision Enabled<ul>
<li>New Type &#x3D; No Collision</li>
</ul>
</li>
<li>设置 静态网格体 的 显示状态  Static Mesh &#x3D;&gt; Set Visibility<ul>
<li>New Visibility &#x3D; false</li>
</ul>
</li>
<li>设置 几何体 的 显示状态  DestructableMesh &#x3D;&gt; Set Visibility<ul>
<li>New Visibility &#x3D; True</li>
</ul>
</li>
<li>设置 几何体 的 显示状态  DestructableMesh &#x3D;&gt; Set Simulate Physics<ul>
<li>Simulate &#x3D; True</li>
</ul>
</li>
<li>Spawn Actor from Class<ul>
<li>Class &#x3D; BP_DestructionForce</li>
<li>变换 拆分引脚<ul>
<li>位置 &#x3D; Actor 的 Get Actor Location</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试，用斧头敲击，建筑物会被摧毁，但是碎片会卡住角色。</p>
<p>OPEN BP_BuildableMaster</p>
<ul>
<li>修改 DestructableMesh 的 碰撞预设设置<ul>
<li>Pawn 为重叠</li>
</ul>
</li>
<li>修改 物理<ul>
<li>Simulate Physics 为 False 含义：不受物理影响</li>
</ul>
</li>
</ul>
<p>遗留问题:碎片弹出范围很大，需要调整</p>
<h4 id="102-添加附加伤害-1"><a href="#102-添加附加伤害-1" class="headerlink" title="102 添加附加伤害 1"></a>102 添加附加伤害 1</h4><p>如果某个建造物被摧毁，那么与之相连的建造物也会受到伤害 通过Tag：AboveFoundation 来实现<br>逻辑写在 建造物父类 BP_BuildableMaster 中</p>
<p>OPEN BP_BuildableMaster</p>
<ul>
<li>创建 变量 IsDestroyed? bool</li>
</ul>
<p>OPEN BP_FoundationMaster</p>
<ul>
<li>增加 Box Collision 组件 Rename:CheckWallsTrace<ul>
<li>变换 <ul>
<li>0 0 212</li>
<li>0 0 0 </li>
<li>4.8 4.8 3</li>
</ul>
</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>WorldStatic 和 WorldDynamic 和 Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent<ul>
<li>右键 Event 右键 添加对父函数的调用</li>
<li>Branch IsDestroyed?<ul>
<li>True</li>
<li>False<ul>
<li>设置 IsDestroyed? 为 True</li>
<li>父函数：StructureDestroyEvent</li>
<li>执行 DestroySnappedStructures</li>
<li>Delay 3S</li>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 DestroySnappedStructures<ul>
<li>创建 局部变量 CheckWallsTrace -&gt; Get Overlapping Actors 给 OverlappingActors Array</li>
<li>branch OverlappingActors -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>Array &#x3D; OverlappingActors</li>
<li>Break Array Element</li>
<li>Branch Array Element -&gt; Actor Has Tag<ul>
<li>Tag &#x3D; AboveFoundation</li>
<li>True<ul>
<li>执行 循环体 Array Element 的 StructureDestroyEvent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_WallMaster</p>
<ul>
<li>增加 Tag<ul>
<li>AboveFoundation</li>
</ul>
</li>
<li>查看 材质 点击按钮后找到 材质的位置 拖入 FirstPersonMap 中</li>
</ul>
<p>OPEN FirstPersonMap</p>
<ul>
<li>进入 破裂 Fracture 模式<ul>
<li>New</li>
<li>选择 Wood 文件夹</li>
<li>Rename DW_WoodWall</li>
<li>确认 创建 几何集合</li>
<li>Uniform<ul>
<li>20 x 20 确认</li>
</ul>
</li>
<li>调整一下碎片的大小 然后恢复乘0</li>
</ul>
</li>
<li>从地图中删除 基础木台</li>
</ul>
<p>OPEN BP_WallMaster</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_WoodWall</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 一面墙</li>
<li>用斧头敲击 基础木台，墙会被摧毁</li>
</ol>
<p>增加 环境<br>OPEN FirstPersonMap</p>
<ul>
<li>选择模式 Landscape 地形<ul>
<li>位置 0 0 -25</li>
<li>创建</li>
</ul>
</li>
</ul>
<p>测试</p>
<p>增加 对 墙壁的损坏效果 和 附加伤害，墙壁除了被摧毁，还会对其他物品比如火炬造成伤害<br>OPEN BP_WallMaster</p>
<ul>
<li>创建 Box Collision 组件 Rename:DemoCeiling<ul>
<li>Box Extent</li>
<li>变换<ul>
<li>0 0 122</li>
</ul>
</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>WorldStatic 和 WorldDynamic 和 Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容 一直到 添加对父函数的调用<ul>
<li>DestroySnappedStructures</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
<li>创建 方法 DestroySnappedStructures<ul>
<li>创建 局部变量 DemoCeiling -&gt; Get Overlapping Actors 给 OverlappingActors Array<ul>
<li>Class Filter &#x3D; BP_BuildableMaster</li>
</ul>
</li>
<li>DemoCeiling Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>Array &#x3D; OverlappingActors</li>
<li>Break Array Element</li>
<li>Branch （Array Element -&gt; Actor Has Tag AboveWall）or（Array Element -&gt; Actor Has Tag AboveFoundation）<ul>
<li>True<ul>
<li>执行 StructureDestroyEvent</li>
</ul>
</li>
<li>False</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>False 或者 循环完后<ul>
<li>Overlap Box Size -&gt; Get Overlapping Actors -&gt; 设置局部变量 OverlappingCeilings</li>
<li>OverlappingCeilings -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>Array &#x3D; OverlappingCeilings</li>
<li>Break Array Element</li>
<li>Branch Array Element -&gt; StructureDestroyEvent</li>
<li>Completed<ul>
<li>Return Node</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>设置 OverlapBoxSize<ul>
<li>碰撞预设 自定义<ul>
<li>Structure 重叠</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>给 天花板 设置 Tag<br>OPEN BP_CeilingMaster</p>
<ul>
<li>增加 Tag<ul>
<li>AboveWall</li>
</ul>
</li>
<li>增加 Box Collision 组件 Rename:CheckWallsTrace<ul>
<li>变换<ul>
<li>0 0 153</li>
<li>4.8 4.8 3</li>
</ul>
</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>WorldStatic 和 WorldDynamic 和 Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容 一直到 添加对父函数的调用<ul>
<li>DestroySnappedStructures</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
<li>创建 方法 DestroySnappedStructures<ul>
<li>CheckWallsTrace -&gt; Get Overlapping Actors -&gt; 设置局部变量 OnCeilingBuildables<ul>
<li>Class Filter &#x3D; BP_BuildableMaster</li>
</ul>
</li>
<li>Branch OnCeilingBuildables -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>Array &#x3D; OnCeilingBuildables</li>
<li>Break Array Element</li>
<li>Branch Array Element -&gt; Actor Has Tag<ul>
<li>Tag &#x3D; AboveFoundation</li>
<li>True<ul>
<li>执行 StructureDestroyEvent</li>
</ul>
</li>
<li>False</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>为 天花板 创建 破坏效果</p>
<p>OPEN BP_CeilingMaster</p>
<ul>
<li>查看 材质 点击按钮后找到 材质的位置 拖入 FirstPersonMap 中</li>
</ul>
<p>OPEN FirstPersonMap</p>
<ul>
<li>进入 破裂 Fracture 模式<ul>
<li>New</li>
<li>选择 Wood 文件夹</li>
<li>Rename DW_WoodCeiling</li>
<li>确认 创建 几何集合</li>
<li>Uniform<ul>
<li>20 x 20 确认</li>
</ul>
</li>
<li>调整一下碎片的大小 然后恢复乘0</li>
</ul>
</li>
</ul>
<p>OPEN BP_CeilingMaster</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_WoodCeiling</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 一面墙 和 一面天花板</li>
<li>放置 基础木台 和 2面墙 和 2面天花板</li>
<li>用斧头敲击 基础木台、墙和天花板会被摧毁</li>
</ol>
<h4 id="103-添加附加伤害-2"><a href="#103-添加附加伤害-2" class="headerlink" title="103 添加附加伤害 2"></a>103 添加附加伤害 2</h4><p>OPEN BP_FoundationMaster</p>
<ul>
<li>查看 方法 DestroySnappedStructures<ul>
<li>针对 Tag 是：AboveFoundation 的建造物，会被摧毁</li>
</ul>
</li>
</ul>
<p>所以 针对 基础木台上的想要一并摧毁的建造物，需要设置 Tag 是：AboveFoundation</p>
<h5 id="Bed"><a href="#Bed" class="headerlink" title="Bed"></a>Bed</h5><p>OPEN BP_Bed</p>
<ul>
<li>增加 Tag<ul>
<li>AboveFoundation</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容<ul>
<li>对父函数的调用</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
<p>为 床 添加 破坏效果<br>OPEN BP_Bed</p>
<ul>
<li>查看 材质 点击按钮后找到 材质的位置 拖入 FirstPersonMap 中</li>
</ul>
<p>OPEN FirstPersonMap</p>
<ul>
<li>进入 破裂 Fracture 模式<ul>
<li>New</li>
<li>选择 Wood 文件夹</li>
<li>Rename DW_Bed</li>
<li>确认 创建 几何集合</li>
<li>Uniform<ul>
<li>20 x 20 确认</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_Bed</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_Bed</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 一面墙 和 一面天花板 和 一张床</li>
<li>用斧头敲击 基础木台、墙、天花板和床会被摧毁</li>
</ol>
<h5 id="DoorFrame-和-DoorMaster-和-Torch"><a href="#DoorFrame-和-DoorMaster-和-Torch" class="headerlink" title="DoorFrame 和 DoorMaster 和 Torch"></a>DoorFrame 和 DoorMaster 和 Torch</h5><p>OPEN BP_DoorFrame</p>
<ul>
<li>增加 Tag<ul>
<li>AboveFoundation</li>
</ul>
</li>
<li>对 DoorBox 和 Torch1 和 Torch2 修改 碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>Structure 重叠</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容<ul>
<li>对父函数的调用</li>
<li>DestroyDoorStructure</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
<li>创建 方法 DestroyDoorStructure<ul>
<li>DoorBox -&gt; Get Overlapping Actors -&gt; 设置局部变量 OverlappingActors<ul>
<li>Class Filter &#x3D; BP_DoorMaster</li>
</ul>
</li>
<li>Branch OverlappingActors -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>Array &#x3D; OverlappingActors<ul>
<li>执行 StructureDestroyEvent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>摧毁火炬 Torch1 -&gt; Get Overlapping Actors -&gt; 设置局部变量 OverlappingActors<ul>
<li>Class Filter &#x3D; BP_Torch</li>
<li>Branch OverlappingActors -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>Array &#x3D; OverlappingActors<ul>
<li>执行 StructureDestroyEvent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>摧毁火炬 Torch2 同上</li>
</ul>
</li>
</ul>
<p>OPEN BP_Torch 和 BP_DoorMaster</p>
<ul>
<li>实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容<ul>
<li>对父函数的调用</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
<p>为 门墙、门、火炬 添加 破坏效果<br>OPEN BP_DoorFrame 和 BP_DoorMaster 和 BP_TorchMaster</p>
<ul>
<li>查看 材质 点击按钮后找到 材质的位置 拖入 FirstPersonMap 中</li>
</ul>
<p>OPEN FirstPersonMap</p>
<ul>
<li>进入 破裂 Fracture 模式<ul>
<li>New</li>
<li>选择 Wood 文件夹</li>
<li>Rename DW_WoodDoorFrame 和 DW_WoodDoor 和 DW_Torch</li>
<li>确认 创建 几何集合</li>
<li>Uniform<ul>
<li>20 x 20 火炬改成 5 x 5 确认</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_DoorFrame</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_WoodDoorFrame</li>
</ul>
<p>OPEN BP_DoorMaster</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_WoodDoor</li>
</ul>
<p>OPEN BP_TorchMaster</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_Torch</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 一个门墙 和 门 以及火炬</li>
<li>用斧头敲击 基础木台、门墙、门、火炬和床会被摧毁</li>
</ol>
<p>测试结果：门没有被摧毁</p>
<p>OPEN BP_DoorFrame</p>
<ul>
<li>编辑 Event StructureDestroyEvent<ul>
<li>执行 父函数</li>
<li>DestroyDoorStructure</li>
</ul>
</li>
</ul>
<h5 id="FenceMaster"><a href="#FenceMaster" class="headerlink" title="FenceMaster"></a>FenceMaster</h5><p>OPEN BP_FenceMaster</p>
<ul>
<li>增加 Tag<ul>
<li>AboveFoundation</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容<ul>
<li>对父函数的调用</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
<p>添加 破坏效果<br>OPEN BP_FenceMaster</p>
<ul>
<li>查看 材质 点击按钮后找到 材质的位置 拖入 FirstPersonMap 中</li>
</ul>
<p>OPEN FirstPersonMap</p>
<ul>
<li>进入 破裂 Fracture 模式<ul>
<li>New</li>
<li>选择 Wood 文件夹</li>
<li>Rename DW_Fence</li>
<li>确认 创建 几何集合</li>
<li>Uniform<ul>
<li>10 x 10 确认</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FenceMaster</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_Fence</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 一面栅栏</li>
<li>用斧头敲击 基础木台、栅栏会被摧毁</li>
</ol>
<h5 id="RampMaster"><a href="#RampMaster" class="headerlink" title="RampMaster"></a>RampMaster</h5><p>OPEN BP_RampMaster</p>
<ul>
<li>增加 Tag<ul>
<li>AboveFoundation</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容<ul>
<li>对父函数的调用</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
<p>添加 破坏效果<br>OPEN BP_RampMaster</p>
<ul>
<li>查看 材质 点击按钮后找到 材质的位置 拖入 FirstPersonMap 中</li>
</ul>
<p>OPEN FirstPersonMap</p>
<ul>
<li>进入 破裂 Fracture 模式<ul>
<li>New</li>
<li>选择 Wood 文件夹</li>
<li>Rename DW_WoodRamp</li>
<li>确认 创建 几何集合</li>
<li>Uniform<ul>
<li>15 x 15 确认</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_RampMaster</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_WoodRamp</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 一面斜坡</li>
<li>用斧头敲击 斜坡 会被摧毁，注意这里这是敲击<code>斜坡</code></li>
</ol>
<h5 id="RoofLeftMaster-和-RoofRightMaster"><a href="#RoofLeftMaster-和-RoofRightMaster" class="headerlink" title="RoofLeftMaster 和 RoofRightMaster"></a>RoofLeftMaster 和 RoofRightMaster</h5><p>OPEN BP_RoofLeftMaster</p>
<ul>
<li>设置 RoofBox<ul>
<li>碰撞预设 自定义<ul>
<li>Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>增加 Tag<ul>
<li>AboveFoundation</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容<ul>
<li>对父函数的调用</li>
<li>DestroySnappedRoof</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
<li>创建 Event DestroySnappedRoof<ul>
<li>创建 局部变量 LocalRoof -&gt; Get Overlapping Actors 给 OverlappingActors Array<ul>
<li>Class Filter &#x3D; BP_RoofLargeMaster</li>
</ul>
</li>
<li>Branch OverlappingActors -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>执行 StructureDestroyEvent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_RoofRightMaster</p>
<ul>
<li>同上操作</li>
</ul>
<h5 id="RoofLargeMaster"><a href="#RoofLargeMaster" class="headerlink" title="RoofLargeMaster"></a>RoofLargeMaster</h5><p>OPEN BP_RoofLargeMaster</p>
<ul>
<li>设置 RoofBox1<ul>
<li>碰撞预设 自定义<ul>
<li>Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>增加 Tag<ul>
<li>AboveFoundation</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容<ul>
<li>对父函数的调用</li>
<li>DestroySnappedRoof</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
<li>创建 Event DestroySnappedRoof<ul>
<li>创建 局部变量 LocalRoof -&gt; Get Overlapping Actors 给 OverlappingActors Array<ul>
<li>Class Filter &#x3D; BP_RoofLargeMaster</li>
</ul>
</li>
<li>Branch OverlappingActors -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>执行 StructureDestroyEvent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>添加 破坏效果<br>OPEN BP_RoofLeftMaster 和 BP_RoofRightMaster 和 BP_RoofLargeMaster</p>
<ul>
<li>查看 材质 点击按钮后找到 材质的位置 拖入 FirstPersonMap 中</li>
</ul>
<p>OPEN FirstPersonMap</p>
<ul>
<li>进入 破裂 Fracture 模式<ul>
<li>New</li>
<li>选择 Wood 文件夹</li>
<li>Rename DW_WoodRoofLeft 和 DW_WoodRoofRight 和 DW_WoodRoofLarge</li>
<li>确认 创建 几何集合</li>
<li>Uniform<ul>
<li>15 x 15 确认</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_RoofLeftMaster</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_WoodRoofLeft</li>
</ul>
<p>OPEN BP_RoofRightMaster</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_WoodRoofRight</li>
</ul>
<p>OPEN BP_RoofLargeMaster</p>
<ul>
<li>设置 DestructableMesh 的 几何体 DW_WoodRoofLarge</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 墙壁 和 一面屋顶</li>
<li>用斧头敲击 基础木台、墙壁、屋顶会被摧毁</li>
</ol>
<h4 id="104-添加附加伤害-3-将所有剩下的物品都增加破坏效果"><a href="#104-添加附加伤害-3-将所有剩下的物品都增加破坏效果" class="headerlink" title="104 添加附加伤害 3 将所有剩下的物品都增加破坏效果"></a>104 添加附加伤害 3 将所有剩下的物品都增加破坏效果</h4><p>小屋顶 和 三角形墙壁 和 楼梯 和 三角形天花板 和 三角形基础墙壁 和 窗框 和 窗户</p>
<p>OPEN BP_RoofSmallMaster BP_RoofTriangleMaster BP_StairsMaster BP_TriangleCeiling BP_TriangleFoundation BP_WindowMaster BP_WindowFrame</p>
<ul>
<li>增加 Tag<ul>
<li>BP_RoofSmallMaster AboveFoundation ？</li>
<li>BP_RoofTriangleMaster AboveFoundation</li>
<li>BP_StairsMaster AboveFoundation</li>
<li>BP_TriangleCeiling AboveWall 因为父级 BP_CeilingMaster 是 AboveWall</li>
<li>BP_TriangleFoundation Foundation</li>
<li>BP_WindowMaster 不设置</li>
<li>BP_WindowFrame AboveFoundation</li>
</ul>
</li>
<li>TODO:实现 Event StructureDestroyEvent 复制 BP_FoundationMaster 的内容<ul>
<li>对父函数的调用</li>
<li>Delay 3.0</li>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
<p>OPEN 上面所有的文件</p>
<ul>
<li>查看 材质 点击按钮后找到 材质的位置 拖入 FirstPersonMap 中</li>
</ul>
<p>OPEN FirstPersonMap</p>
<ul>
<li>进入 破裂 Fracture 模式<ul>
<li>New</li>
<li>选择 Wood 文件夹</li>
<li>Rename DW_WoodRoofSmall DW_TriangleWallTop DW_WoodStairs DW_TriangleCeiling DW_TriangleFoundation DW_WoodWindow DW_WoodWindowFrame</li>
<li>确认 创建 几何集合</li>
<li>Uniform<ul>
<li>15 x 15 确认  </li>
<li>DW_WoodStairs DW_TriangleCeiling DW_TriangleFoundation 20 x 20</li>
<li>DW_WoodWindow 10 x 10</li>
<li>DW_WoodWindowFrame 20 x 20</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN 上面所有的文件</p>
<ul>
<li>设置 DestructableMesh 的 几何体 分别设置 DW文件</li>
</ul>
<p>OPEN BP_RoofTriangleMaster</p>
<ul>
<li>设置 RoofBox1 RoofBox2<ul>
<li>碰撞预设 自定义<ul>
<li>Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>编辑 事件 StructureDestroyEvent<ul>
<li>执行 父函数 后</li>
<li>执行 DestroySnappedRoof</li>
</ul>
</li>
<li>创建 Event DestroySnappedRoof<ul>
<li>RoofBox1 -&gt; Get Overlapping Actors -&gt; 设置局部变量 OverlappingActors<ul>
<li>Class Filter &#x3D; BP_RoofSmallMaster</li>
</ul>
</li>
<li>Branch OverlappingActors -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>执行 StructureDestroyEvent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 墙壁 和 一面三角形墙壁 和 一面屋顶</li>
<li>用斧头敲击 基础木台、墙壁、三角形墙壁、屋顶会被摧毁</li>
<li>放置 基础木台 和 楼梯</li>
<li>用斧头敲击 基础木台、楼梯会被摧毁</li>
</ol>
<p>OPEN BP_TriangleCeiling</p>
<ul>
<li>创建 Box Collision 组件 Rename:DestroyBox<ul>
<li>变换<ul>
<li>0 13.329 82</li>
<li>0 0 0 </li>
<li>2 2.2 2.56</li>
</ul>
</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>编辑 事件 StructureDestroyEvent<ul>
<li>执行 父函数 后</li>
<li>执行 DestroySnappedStructures</li>
</ul>
</li>
<li>创建 Event DestroySnappedStructures<ul>
<li>DestroyBox -&gt; Get Overlapping Actors -&gt; 设置局部变量 OverlappingActors<ul>
<li>Class Filter &#x3D; <code>BP_BuildableMaster</code></li>
</ul>
</li>
<li>Branch OverlappingActors -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>Array &#x3D; OverlappingActors</li>
<li>Break Array Element</li>
<li>Branch Array Element -&gt; Actor Has Tag<ul>
<li>Tag &#x3D; <code>AboveFoundation</code></li>
<li>True<ul>
<li>执行 StructureDestroyEvent</li>
</ul>
</li>
<li>False</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 墙壁 和 一面三角形天花板</li>
<li>用斧头敲击 基础木台、墙壁、三角形墙壁、屋顶、楼梯、三角形天花板会被摧毁</li>
</ol>
<p>OPEN BP_TriangleFoundation</p>
<ul>
<li>复制 BP_TriangleCeiling 的 DestroyBox 组件 到 BP_TriangleFoundation</li>
<li>变换<ul>
<li>0 13.329 158</li>
<li>0 0 0</li>
<li>2 2.2 2.56</li>
</ul>
</li>
<li>碰撞预设 自定义<ul>
<li>Structure 重叠</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 复制 BP_TriangleCeiling 的内容</li>
<li>实现 方法 DestroySnappedStructures 复制 BP_TriangleCeiling 的内容</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 三角形建造物 和 墙壁</li>
<li>用斧头敲击 三角形建造物、墙壁会被摧毁</li>
</ol>
<p>OPEN BP_WindowFrame</p>
<ul>
<li>WindowFrameBox 组件<ul>
<li>碰撞预设 自定义<ul>
<li>Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>实现 Event StructureDestroyEvent 跟之前的不一样 Event 就执行了两个步骤<ul>
<li>对父函数的调用</li>
<li>DestroyWindow</li>
</ul>
</li>
<li>实现 方法 DestroyWindow 复制 BP_TriangleCeiling 的内容<ul>
<li><code>WindowFrameBox</code> -&gt; Get Overlapping Actors -&gt; 设置局部变量 OverlappingActors<ul>
<li>Class Filter &#x3D; <code>BP_WindowMaster</code></li>
</ul>
</li>
<li>Branch OverlappingActors -&gt; Length &gt; 0<ul>
<li>True<ul>
<li>For Each Loop With Break<ul>
<li>执行 StructureDestroyEvent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 墙壁 和 一面窗户框</li>
<li>用斧头敲击 基础木台、墙壁、窗户框会被摧毁</li>
</ol>
<h4 id="105-修复浮动天花板"><a href="#105-修复浮动天花板" class="headerlink" title="105 修复浮动天花板"></a>105 修复浮动天花板</h4><p>为天花板添加一个检测，检测天花板下面的所有Wall属性(墙)的建造物，如果没有有墙壁，则不允许放置天花板</p>
<p>OPEN BPI_BuildInterface</p>
<ul>
<li>增加 API接口<ul>
<li>Event CanPlaceCeiling?<ul>
<li>Outputs<ul>
<li>CanPlace? bool</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>检测天花板下面的所有Wall(墙)的建造物<br>OPEN BP_CeilingMaster</p>
<ul>
<li>创建 Box Collision 组件 Rename:WallBelowBox<ul>
<li>变换<ul>
<li>0 0 -195</li>
<li>0 0 0</li>
<li>4.59 4.59 0.5</li>
</ul>
</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>实现 API CanPlaceCeiling?<ul>
<li>Return Node CanPlace? &#x3D; <code>WallBelowBox</code> -&gt; Get Overlapping Actors -&gt; Length &gt; 0<ul>
<li>Class Filter &#x3D; <code>BP_WallMaster</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BPC_BuildingComponent</p>
<ul>
<li>编辑 方法 BuildModeClient<ul>
<li>Branch GetSnappingPoints 为 True<ul>
<li>Branch BuildableInfo 的 DoFloatCheck? 为false<ul>
<li>增加 Branch BuildableInfo 的 DoCeilingCheck?<ul>
<li>True<ul>
<li>执行 BuildPreview 的 CanPlaceCeiling?（消息） 结果和另一个进行AND</li>
</ul>
</li>
<li>False<ul>
<li>执行 原逻辑</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 BuildPlacementCheck<ul>
<li>和上面相同修改</li>
</ul>
</li>
</ul>
<p>OPEN BP_CeilingMaster</p>
<ul>
<li>类默认值<ul>
<li>DoCeilingCheck? &#x3D; true</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 基础木台 和 墙壁</li>
<li>放置 三角形天花板 查看是否可以放置</li>
</ol>
<p>为三角形天花板也增加相应逻辑<br>OPEN BP_TriangleCeiling</p>
<ul>
<li>类默认值<ul>
<li>DoCeilingCheck? &#x3D; true</li>
</ul>
</li>
<li>复制 BP_CeilingMaster 的 WallBelowBox 组件 到 BP_TriangleCeiling Rename：DetectWallsBox<ul>
<li>变换<ul>
<li>0 13 -121</li>
<li>0 0 0</li>
<li>4.59 4.59 0.5</li>
</ul>
</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>Structure 重叠</li>
</ul>
</li>
</ul>
</li>
<li>实现 API CanPlaceCeiling?<ul>
<li>Return Node CanPlace? &#x3D; <code>DetectWallsBox</code> -&gt; Get Overlapping Actors -&gt; Length &gt; 0<ul>
<li>Class Filter &#x3D; <code>BP_TriangleWallTop</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>放置 三角形建造物 和 墙壁</li>
<li>放置 三角形天花板 查看是否可以放置</li>
</ol>
<h4 id="106-添加构建物的提示的信息部件"><a href="#106-添加构建物的提示的信息部件" class="headerlink" title="106 添加构建物的提示的信息部件"></a>106 添加构建物的提示的信息部件</h4><p>OPEN BPI_SurvivalCharacter</p>
<ul>
<li>将方法名 GetSurvivalCharacterRef 修改为 GetSurvivalCharRef<ul>
<li>Outputs<ul>
<li>SurvivalCharacterRef 改成了 SurvivalCharRef</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建 建造部件文件夹 _Main&#x2F;Widgets&#x2F;BuildableWidgets<br>创建 用户接口 部件蓝图  用户部件 W_InteractText</p>
<ul>
<li>垂直框 Rename:InteractBox 是变量 <code>并且先隐藏</code><ul>
<li>文本 字体大小30 内容 Press [E] to Interact Color:00BAFFFF Outline Size:2 文本对齐方式：居中 Rename:InteractText 是变量</li>
<li>文本 Copy 修改： 内容 Hold [X] to Demolish Color:FFFFFFFF Rename:OptionsText 是变量</li>
<li>文本 Copy 修改： 内容 Wood Foundation Interact Color:00FF43FF Rename:NameAndHPText 是变量</li>
<li>文本 Copy 修改： 内容 拥有者:玩家名称 Color:FFA1E4FF Rename:OwnerText 是变量</li>
</ul>
</li>
<li>创建 Event SetInteractShowOrHide<ul>
<li>Inputs<ul>
<li>IsVisible ESlate Visibility</li>
<li>StructureName Text</li>
<li>CurrentHP Float</li>
<li>MaxHP Float</li>
<li>OwnerName Text</li>
<li>ShowInteractText? Bool</li>
<li>ShowOptionsText? Bool</li>
</ul>
</li>
<li>InteractBox &#x3D;&gt; Set Visibility<ul>
<li>New Visibility &#x3D; IsVisible</li>
</ul>
</li>
<li>InteractText &#x3D;&gt; Set Visibility<ul>
<li>New Visibility &#x3D; 参数 ShowInteractText? Select True:Visible Select False:Collapsed</li>
</ul>
</li>
<li>OptionsText &#x3D;&gt; Set Visibility<ul>
<li>New Visibility &#x3D; 参数 ShowOptionsText? Select True:Visible Select False:Collapsed</li>
</ul>
</li>
<li>OwnerText &#x3D;&gt; Set Text<ul>
<li>Text &#x3D; Format 拥有者：{OwnerName}</li>
</ul>
</li>
<li>NameAndHPText &#x3D;&gt; Set Text<ul>
<li>Text &#x3D; Format {StructureName}:{CurrentHP}&#x2F;{MaxHP}</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_BuildableMaster</p>
<ul>
<li>创建 Widget 组件 Rename:BuildableInfoWidget<ul>
<li>Space 屏幕</li>
<li>用户界面 WidgetClass &#x3D; W_InteractText</li>
<li>Draw size:100 100</li>
</ul>
</li>
<li>创建 Sphere Collision 组件 Rename:TextInfoSphere<ul>
<li>变换<ul>
<li>0 0 0</li>
<li>0 0 0</li>
<li>5 5 5</li>
</ul>
</li>
<li>碰撞预设 自定义<ul>
<li>全部 Ignore</li>
<li>Pawn 重叠</li>
</ul>
</li>
<li>点击 Events 的 On Component Begin Overlap<ul>
<li>Switch Has Authority<ul>
<li>True<ul>
<li>Branch Event参数 OtherActor &#x3D;&gt; Actor Has Tag (Player)<ul>
<li>True<ul>
<li>Event参数 OtherActor 的 Get SurvivalChar Ref 的 ShowOrHideInfoOnClient<ul>
<li>BuildableRef &#x3D; <code>self</code></li>
<li>IsVisible &#x3D; true</li>
<li>StructureName &#x3D; StructureName 右键创建变量 Default:基础木台</li>
<li>CurrentHP &#x3D; CurrentHP</li>
<li>MaxHP &#x3D; MaxHP</li>
<li>OwnerName &#x3D; OwnerName 右键创建变量 Default:玩家名称</li>
<li>ShowInteractText? &#x3D; ShowInteractText? 右键创建变量</li>
<li>ShowOptionsText? &#x3D; true</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>点击 Events 的 On Component End Overlap<ul>
<li>Switch Has Authority<ul>
<li>True<ul>
<li>Branch Event参数 OtherActor &#x3D;&gt; Actor Has Tag (Player)<ul>
<li>True<ul>
<li>Event参数 OtherActor 的 Get SurvivalChar Ref 的 ShowOrHideInfoOnClient<ul>
<li>IsVisible &#x3D; false</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event ShowTextOnClient<ul>
<li>Inputs<ul>
<li>根据调用 BuildableInfoWidget 的 SetInteractShowOrHide 参数 添加所需参数</li>
</ul>
</li>
<li>BuildableInfoWidget 的 Get User Widget Object &#x3D;&gt; Cast To W_InteractText &#x3D;&gt; Set InteractShowOrHide<ul>
<li>BuildableRef &#x3D; <code>self</code></li>
<li>IsVisible &#x3D; Visible</li>
<li>StructureName &#x3D; StructureName</li>
<li>CurrentHP &#x3D; CurrentHP</li>
<li>MaxHP &#x3D; MaxHP</li>
<li>OwnerName &#x3D; OwnerName</li>
<li>ShowInteractText? &#x3D; ShowInteractText?</li>
<li>ShowOptionsText? &#x3D; ShowOptionsText?</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>增加 Tag<ul>
<li>Player</li>
</ul>
</li>
<li>创建 Event ShowOrHideInfoOnClient Comment:DOTO<ul>
<li>Inputs<ul>
<li>BuildableRef BP_BuildableMaster</li>
<li>根据调用 ShowTextOnClient 参数 添加所需参数</li>
</ul>
</li>
<li>BuildableRef IsValid<ul>
<li>True<ul>
<li>BuildableRef 的 GetBuildMasterRef 的 ShowTextOnClient<ul>
<li>ShowTextOnClient</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>为 门墙 和 窗墙 改变一下 Sphere Collision 的位置，不能挡住门和窗户<br>OPEN BP_DoorFrame 和 BP_WindowFrame</p>
<ul>
<li>修改 Sphere Collision 组件<ul>
<li>变换<ul>
<li>100 0 0</li>
</ul>
</li>
</ul>
</li>
<li>类默认设置<ul>
<li>BP_DoorFrame 的 StructureName &#x3D; 门墙</li>
<li>BP_WindowFrame 的 StructureName &#x3D; 门窗</li>
<li>OPEN BP_DoorMaster<ul>
<li>ShowInteractText? &#x3D; true</li>
<li>StructureName &#x3D; 门窗</li>
</ul>
</li>
<li>OPEN BP_Torch<ul>
<li>ShowInteractText? &#x3D; true</li>
<li>StructureName &#x3D; 火炬</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>改变门的显示位置<br>OPEN BP_DoorMaster</p>
<ul>
<li>修改 BuildableInfoWidget 和 TextInfoSphere 的位置<ul>
<li>60 0 100</li>
</ul>
</li>
</ul>
<p>注意：</p>
<ol>
<li>继承于 建造基类BP_BuildableMaster的所有建筑物，都不能重写 GetBuildMasterRef 方法，否则会导致无法显示交互信息，重写了就要删除，一个个检查</li>
</ol>
<p>测试：</p>
<ol>
<li>放置 建造物 后 走进去看看是否有交互信息</li>
</ol>
<h4 id="107-添加拆除建造物的功能"><a href="#107-添加拆除建造物的功能" class="headerlink" title="107 添加拆除建造物的功能"></a>107 添加拆除建造物的功能</h4><p>创建 材质文件夹 Materials _Main&#x2F;Materials<br>创建 材质文件 M_ProgressCircle</p>
<ul>
<li>主节点<ul>
<li>材质类型 Material Domain &#x3D; User Interface</li>
<li>混合模式 Blend Mode &#x3D; 遮罩</li>
</ul>
</li>
<li>创建 Vector parameter Rename:Color Color:#FFFFFF00<ul>
<li>白色 连接 最终颜色</li>
</ul>
</li>
<li>创建 Texture Coordinate - A,B(0.5) &#x3D;&gt; Multiply A,B(-2.2) &#x3D;&gt; VectorToRadialValue<ul>
<li>Vector Converted to Angle -&gt; Add A,B(Constant 右键转换为参数 Rename:Percent Default:0.5)</li>
<li>Floor</li>
<li>Multiply A,B(下面) &#x3D;&gt; 不透明遮罩  <ul>
<li>Subtract<ul>
<li>A:RadialGradientExponential 的 Return Value<ul>
<li>Redius &#x3D; 0.5</li>
<li>Density &#x3D; 5000</li>
</ul>
</li>
<li>B:RadialGradientExponential 的 Return Value<ul>
<li>Redius &#x3D; 0.45</li>
<li>Density &#x3D; 5000</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建 材质文件实例 M_ProgressCircle_Inst 继承于 M_ProgressCircle</p>
<p>OPEN W_MainWidget</p>
<ul>
<li>Canvas Panel<ul>
<li>图像 Rename:ProgressCircle 是变量<ul>
<li>锚点居中 重置 PX,PY 对齐：0.5 0.5 Size:100 100 Image: M_ProgressCircle_Inst <code>默认隐藏</code>并且 创建绑定<ul>
<li>绑定方法 Rename：GetProgressCircleVisibility<ul>
<li>Get Owning Player Pawn &#x3D;&gt; Get Survival Char Ref &#x3D;&gt; Is Valid</li>
<li>Branch Get Survival Char Ref 的 InProgress?<ul>
<li>True<ul>
<li>ProgressCircle 的 Get Dynamic Material &#x3D;&gt; Set Scalar Parameter Value<ul>
<li>Parameter Name &#x3D; Percent</li>
<li>Value &#x3D; Get Survival Char Ref 的 ProgressValue</li>
</ul>
</li>
<li>Return Node 显示</li>
</ul>
</li>
<li>False<ul>
<li>Return Node Collapse</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 变量 InProgress? bool</li>
<li>创建 变量 ProgressValue float Default:0.0</li>
<li>创建 Event StartDemolishTimerOnServer<ul>
<li>Inputs<ul>
<li>Rotation Rotator 旋转体</li>
</ul>
</li>
<li>根据 参数 设置 变量 CameraRotation</li>
<li>Set Timer by Event<ul>
<li>5.0s</li>
<li>Return Value &#x3D;&gt; 设置变量 DemolishTimerHandle</li>
<li>Event &#x3D;&gt; 创建 Event DemolishBuild 方法内部就执行了 DemolishFunction</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 DemolishFunction<ul>
<li>Line Trace Function<ul>
<li>Interface &#x3D; BPI_BuildInterface</li>
</ul>
</li>
<li>Branch Line Trace Function 的 结果<ul>
<li>True<ul>
<li>命中 Actor 的 DemolishStructure</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event StopDemolishTimerOnServer<ul>
<li>清除定时器 DemolishTimerHandle</li>
</ul>
</li>
<li>创建 E键 Key 按键触发事件<ul>
<li>按下<ul>
<li>StartDemolishTimerOnServer<ul>
<li>Rotate &#x3D; FirstPersonCamera 的 Get World Rotation</li>
</ul>
</li>
<li>StartDemolishBarOnClient</li>
</ul>
</li>
<li>松开<ul>
<li>StopDemolishTimerOnServer</li>
<li>StopDemolishBarOnClient</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event StartDemolishBarOnClient<ul>
<li>设置变量 InProgress? &#x3D; true</li>
<li>Branch InProgress? -&gt; False<ul>
<li>True<ul>
<li>ProgressValue + 0.01 &#x3D;&gt; Clamp 的 Value &#x3D;&gt; 设置 变量 ProgressValue</li>
<li>ProgressValue &lt; 1<ul>
<li>True<ul>
<li>Delay 0.05</li>
<li>重复调用 Branch InProgress?</li>
</ul>
</li>
<li>False<ul>
<li>设置变量 InProgress? &#x3D; false</li>
<li>设置变量 ProgressValue &#x3D; 0</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event StopDemolishBarOnClient<ul>
<li>设置变量 InProgress? &#x3D; false</li>
<li>设置变量 ProgressValue &#x3D; 0</li>
</ul>
</li>
</ul>
<p>OPEN BPI_BuildInterface</p>
<ul>
<li>增加 API 方法 DemolishStructure</li>
</ul>
<p>OPEN W_MainWidget</p>
<ul>
<li>修改一下层级关系<ul>
<li>W_Inventory ZOrder &#x3D; 1</li>
<li>ProgressCircle ZOrder &#x3D; 0</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>按X会出现拆除进度条</li>
<li>放置基础木台，按E会出现圈圈，持续5秒，然后建造物被摧毁</li>
</ol>
<h4 id="108-将建造系统和库存系统连接起来"><a href="#108-将建造系统和库存系统连接起来" class="headerlink" title="108 将建造系统和库存系统连接起来"></a>108 将建造系统和库存系统连接起来</h4><p>将 B 键开启预建造模式 改为 使用 Hotbar 的物品 并且是 建造物时 才开启预建造模式</p>
<p>选择资源文件夹</p>
<ul>
<li>EasyBuildingSystem&#x2F;Textures&#x2F;Icons&#x2F;</li>
<li>选中 Stylized 文件夹</li>
<li>右键 迁移[Migrate] 弹出资源报告</li>
<li>选择当前项目路径的 ${项目路径}&#x2F;Content 是否重写 点击全部重写</li>
</ul>
<p>OPEN DT_Items 添加物品上面材质的物品</p>
<ul>
<li>基础木台<ul>
<li>ID 13</li>
<li>数量 1</li>
<li>说明 基础木台</li>
<li>Icon T_Icon_Stylized_Wood_Foundation</li>
<li>IsStackable True</li>
<li>StackSize 100</li>
<li>ItemType Buildable</li>
<li>ItemDamage </li>
<li>CurHP </li>
<li>MaxHP </li>
<li>Type </li>
<li>ArmorType </li>
<li>ClassRef</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>增加 变量 StructureId int</li>
<li>编辑 方法 PlaceBuildableOnClient<ul>
<li>SpawnBuildOnServer<ul>
<li>删除了参数 StructureIDDebugID</li>
<li>Transform &#x3D; BPC BuildingComponent 的 BuildTransform</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 UseHotbarFunction<ul>
<li>Switch on E_ItemType <ul>
<li>增加 Buildable 的逻辑<ul>
<li>设置变量 StructureId &#x3D; BPC_PlayerHotbar 的 Items -&gt; get by HotbarIndex -&gt; Break 的 ItemID</li>
<li>BPC_BuildingComponent 的 LaunchBuildMode<ul>
<li>BuildableID &#x3D; StructureId</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BPC_BuildingComponent 检查所有用到 StructureIDDebugID 的地方 都要替换成 BuildableID</p>
<ul>
<li>编辑 Event LaunchBuildMode&#x2F;BuildModeClient<ul>
<li>替换成 BuildableID</li>
</ul>
</li>
<li>编辑 Event TODO:PlaceBuildable<ul>
<li>删除 StructureIDDebugID</li>
</ul>
</li>
<li>编辑 Event SpawnBuildOnServer<ul>
<li>Inputs<ul>
<li>删除 StructureIDDebugID</li>
</ul>
</li>
<li><code>Set BuildTransform 后</code></li>
<li>Get Owner 的 Get Survival Char Ref 的 get BPC Player Hotbar 的 Container Items<ul>
<li>Items &#x3D; Make array &lt;&#x3D; Get Survival Char Ref 的 StructureId 进行一个 Make S_ItemStruct</li>
</ul>
</li>
<li>Branch ContainsItems 的 结果<ul>
<li>True<ul>
<li>继续逻辑 然后在 <code>方法 Build Placement Check 结果为 True 后</code> 执行 BPC_PlayerHotbar 的 RemoveQuantity<ul>
<li>HotbarIndex &#x3D; Get Survival Char Ref 的 HotbarIndex</li>
<li>Quantity &#x3D; 1</li>
</ul>
</li>
<li>Branch 结果<ul>
<li>True<ul>
<li>继续逻辑</li>
<li>并且修改后续的所有用到的 StructureIDDebugID StructureId</li>
</ul>
</li>
<li>False</li>
</ul>
</li>
</ul>
</li>
<li>False 找不到物品则不触发</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN DT_Structures</p>
<ul>
<li>修改 Row13 改为 50</li>
<li>修改 Row1 改为 13</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>编辑 Event R键<ul>
<li>给物品 Row 13 给到 Hotbar</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>按R键将物品放到热键栏，按1进入预建造模式</li>
<li>鼠标左键放置建筑物</li>
<li>物品消失</li>
</ol>
<h4 id="109-添加所有可构建项目和类"><a href="#109-添加所有可构建项目和类" class="headerlink" title="109 添加所有可构建项目和类"></a>109 添加所有可构建项目和类</h4><p>创建文件夹 Tiers _Main&#x2F;Blueprints&#x2F;BuildingSystem<br>创建文件夹 Wood _Main&#x2F;Blueprints&#x2F;BuildingSystem&#x2F;Tiers 木制<br>创建文件夹 Stone _Main&#x2F;Blueprints&#x2F;BuildingSystem&#x2F;Tiers 石制<br>创建文件夹 Metal _Main&#x2F;Blueprints&#x2F;BuildingSystem&#x2F;Tiers 金属制</p>
<p>为每一个蓝图建造物 除了 火炬和床 都创建一个子类，共17个<br>创建 蓝图子类 BP_Wooden_Ceiling 从 BP_CeilingMaster 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_DoorFrame 从 BP_DoorFrame 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_DoorMaster 从 BP_DoorMaster 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_Fence 从 BP_Fence 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_Foundation 从 BP_Foundation 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_Ramp 从 BP_Ramp 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_RoofLarge 从 BP_RoofLarge 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_RoofLeft 从 BP_RoofLeft 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_RoofRight 从 BP_RoofRight 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_MallRoof 从 BP_MallRoof 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_Stairs 从 BP_Stairs 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_TriangleCeiling 从 BP_TriangleCeiling 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_TriangleFoundation 从 BP_TriangleFoundation 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_TriangleRoof 从 BP_RoofTriangle 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_Wall 从 BP_Wall 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_Window 从 BP_Window 继承 放入 In Tier&#x2F;Wood 文件夹中<br>创建 蓝图子类 BP_Wooden_WindowFrame 从 BP_WindowFrame 继承 放入 In Tier&#x2F;Wood 文件夹中 </p>
<p>考虑完善每一个 蓝图建造物子类的信息</p>
<ul>
<li>StructureTier &#x3D; Wood</li>
<li>CurrentHP 根据情况设置</li>
<li>MaxHP 根据情况设置</li>
<li>提示建造物相关的信息<ul>
<li>是否显示</li>
<li>显示的信息等</li>
</ul>
</li>
</ul>
<p>COPY Wood 下所有的文件 到 Stone 文件夹中</p>
<ul>
<li>修改名字 Wood 替换成 BP_Stone_</li>
<li>OPEN 所有的<ul>
<li>修改 材质</li>
<li>修改 类默认值<ul>
<li>StructureTier &#x3D; Stone</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>COPY Stone 下所有的文件 到 Metal 文件夹中</p>
<ul>
<li>修改名字 Wood 替换成 BP_Metal_</li>
<li>OPEN 所有的<ul>
<li>修改 材质</li>
<li>修改 类默认值<ul>
<li>StructureTier &#x3D; Metal</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>金属制的门的材质 偏宽一些，所以需要修改<br>OPEN BP_MetalDoor</p>
<ul>
<li>找到材质<ul>
<li>点击材质的位置 SM_Stylized_Metal_Door 并且 OPEN<ul>
<li>增加 Box Simplified Collision</li>
<li>增加 Box Simplified Collision<ul>
<li>变换<ul>
<li>调小一些 门厚度的2&#x2F;3</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>为 每个 Stone 的文件添加 破坏效果</p>
<ul>
<li>选中所有文件 全部拖入到 FirstPersonMap 中</li>
</ul>
<p>破坏文件 放入 <em>Main&#x2F;Meshes&#x2F;DestructableMeshes&#x2F;Stone GM</em> 开头<br>破坏文件 放入 <em>Main&#x2F;Meshes&#x2F;DestructableMeshes&#x2F;Metal GC</em> 开头</p>
<p>将所有建造物添加到 DT_Items</p>
<p>OPEN DT_Items</p>
<ul>
<li>复制 ID 13</li>
<li>从 13 - 29 是 Wood<ul>
<li>13 T_Icon_Stylized_Wood_Foundation</li>
<li>14 T_Icon_Stylized_Wood_Ceiling</li>
<li>15 T_Icon_Stylized_Wood_Door</li>
<li>16 T_Icon_Stylized_Wood_DoorFrame</li>
<li>17 T_Icon_Stylized_Wood_Fence</li>
<li>18 T_Icon_Stylized_Wood_Ramp</li>
<li>19 T_Icon_Stylized_Wood_Roof</li>
<li>20 T_Icon_Stylized_Wood_WallLeft Wood_Tri_Left_Wall</li>
<li>21 T_Icon_Stylized_Wood_WallRight Wood_Tri_Right_Wall</li>
<li>22 T_Icon_Stylized_Wood_RoofSmall Wood_Half_Roof</li>
<li>23 T_Icon_Stylized_Wood_Stairs</li>
<li>24 T_Icon_Stylized_Wood_TriangleCeiling Wood_Tri_Ceiling</li>
<li>25 T_Icon_Stylized_Wood_TriangleFoundation Wood_Tri_Foundation</li>
<li>26 T_Icon_Stylized_Wood_TriangleWall Wood_Tri_Wall</li>
<li>27 T_Icon_Stylized_Wood_Wall</li>
<li>28 T_Icon_Stylized_Wood_Window</li>
<li>29 T_Icon_Stylized_Wood_WindowFrame</li>
</ul>
</li>
<li>从 30 - 46 是 Stone<ul>
<li>30 T_Icon_Stylized_Stone_Foundation</li>
<li>31 T_Icon_Stylized_Stone_Ceiling</li>
<li>32 T_Icon_Stylized_Stone_Door</li>
<li>33 T_Icon_Stylized_Stone_DoorFrame</li>
<li>34 T_Icon_Stylized_Stone_Fence</li>
<li>35 T_Icon_Stylized_Stone_Ramp</li>
<li>36 T_Icon_Stylized_Stone_Roof</li>
<li>37 T_Icon_Stylized_Stone_WallLeft Stone_Tri_Left_Wall</li>
<li>38 T_Icon_Stylized_Stone_WallRight Stone_Tri_Right_Wall</li>
<li>39 T_Icon_Stylized_Stone_RoofSmall Stone_Half_Roof</li>
<li>40 T_Icon_Stylized_Stone_Stairs</li>
<li>41 T_Icon_Stylized_Stone_TriangleCeiling Stone_Tri_Ceiling</li>
<li>42 T_Icon_Stylized_Stone_TriangleFoundation Stone_Tri_Foundation</li>
<li>43 T_Icon_Stylized_Stone_TriangleWall Stone_Tri_Wall</li>
<li>44 T_Icon_Stylized_Stone_Wall</li>
<li>45 T_Icon_Stylized_Stone_Window</li>
<li>46 T_Icon_Stylized_Stone_WindowFrame</li>
</ul>
</li>
<li>从 47 - 63 是 Metal <ul>
<li>47 T_Icon_Stylized_Metal_Foundation</li>
<li>48 T_Icon_Stylized_Metal_Ceiling</li>
<li>49 T_Icon_Stylized_Metal_Door</li>
<li>50 T_Icon_Stylized_Metal_DoorFrame</li>
<li>51 T_Icon_Stylized_Metal_Fence</li>
<li>52 T_Icon_Stylized_Metal_Ramp</li>
<li>53 T_Icon_Stylized_Metal_Roof</li>
<li>54 T_Icon_Stylized_Metal_WallLeft Metal_Tri_Left_Wall</li>
<li>55 T_Icon_Stylized_Metal_WallRight Metal_Tri_Right_Wall</li>
<li>56 T_Icon_Stylized_Metal_RoofSmall Metal_Half_Roof</li>
<li>57 T_Icon_Stylized_Metal_Stairs</li>
<li>58 T_Icon_Stylized_Metal_TriangleCeiling Metal_Tri_Ceiling</li>
<li>59 T_Icon_Stylized_Metal_TriangleFoundation Metal_Tri_Foundation</li>
<li>60 T_Icon_Stylized_Metal_TriangleWall Metal_Tri_Wall</li>
<li>61 T_Icon_Stylized_Metal_Wall</li>
<li>62 T_Icon_Stylized_Metal_Window</li>
<li>63 T_Icon_Stylized_Metal_WindowFrame</li>
</ul>
</li>
</ul>
<p>OPEN DT_Structures</p>
<ul>
<li>删除所有的数据</li>
<li>RowName 从 13 - 29 是 Wood<ul>
<li>13 BP_Wooden_Foundation</li>
<li>14 BP_Wooden_Ceiling</li>
<li>15 BP_Wooden_Door</li>
<li>16 BP_Wooden_DoorFrame</li>
<li>17 BP_Wooden_Fence</li>
<li>18 BP_Wooden_Ramp</li>
<li>19 BP_Wooden_Roof</li>
<li>20 BP_Wooden_WallLeft Wood_Tri_Left_Wall BP_Wooden_RoofLeft</li>
<li>21 BP_Wooden_WallRight Wood_Tri_Right_Wall BP_Wooden_RoofRight</li>
<li>22 BP_Wooden_RoofSmall Wood_Half_Roof BP_Wooden_MallRoof</li>
<li>23 BP_Wooden_Stairs</li>
<li>24 BP_Wooden_TriangleCeiling Wood_Tri_Ceiling</li>
<li>25 BP_Wooden_TriangleFoundation Wood_Tri_Foundation</li>
<li>26 BP_Wooden_TriangleWall Wood_Tri_Wall BP_Wooden_TriangleRoof</li>
<li>27 BP_Wooden_Wall</li>
<li>28 BP_Wooden_Window</li>
<li>29 BP_Wooden_WindowFrame</li>
</ul>
</li>
<li>RowName 从 30 - 46 是 Stone <ul>
<li>30 BP_Stone_Foundation</li>
<li>31 BP_Stone_Ceiling</li>
<li>32 BP_Stone_Door</li>
<li>33 BP_Stone_DoorFrame</li>
<li>34 BP_Stone_Fence</li>
<li>35 BP_Stone_Ramp</li>
<li>36 BP_Stone_Roof</li>
<li>37 BP_Stone_WallLeft Stone_Tri_Left_Wall BP_Stone_RoofLeft</li>
<li>38 BP_Stone_WallRight Stone_Tri_Right_Wall BP_Stone_RoofRight</li>
<li>39 BP_Stone_RoofSmall Stone_Half_Roof BP_Stone_MallRoof</li>
<li>40 BP_Stone_Stairs</li>
<li>41 BP_Stone_TriangleCeiling Stone_Tri_Ceiling</li>
<li>42 BP_Stone_TriangleFoundation Stone_Tri_Foundation</li>
<li>43 BP_Stone_TriangleWall Stone_Tri_Wall BP_Stone_TriangleRoof</li>
<li>44 BP_Stone_Wall</li>
<li>45 BP_Stone_Window</li>
<li>46 BP_Stone_WindowFrame</li>
</ul>
</li>
<li>RowName 从 47 - 63 是 Metal<ul>
<li>47 BP_Metal_Foundation</li>
<li>48 BP_Metal_Ceiling</li>
<li>49 BP_Metal_Door</li>
<li>50 BP_Metal_DoorFrame</li>
<li>51 BP_Metal_Fence</li>
<li>52 BP_Metal_Ramp</li>
<li>53 BP_Metal_Roof</li>
<li>54 BP_Metal_WallLeft Metal_Tri_Left_Wall BP_Metal_RoofLeft</li>
<li>55 BP_Metal_WallRight Metal_Tri_Right_Wall BP_Metal_RoofRight</li>
<li>56 BP_Metal_RoofSmall Metal_Half_Roof BP_Metal_MallRoof</li>
<li>57 BP_Metal_Stairs</li>
<li>58 BP_Metal_TriangleCeiling Metal_Tri_Ceiling</li>
<li>59 BP_Metal_TriangleFoundation Metal_Tri_Foundation</li>
<li>60 BP_Metal_TriangleWall Metal_Tri_Wall BP_Metal_TriangleRoof</li>
<li>61 BP_Metal_Wall</li>
<li>62 BP_Metal_Window</li>
<li>63 BP_Metal_WindowFrame</li>
</ul>
</li>
</ul>
<p>添加建造物 配方 OPEN DT_PlayerItemRecipes</p>
<ul>
<li>RowName 13 <ul>
<li>木质台</li>
<li>ID 13</li>
<li>Level 1</li>
<li>Icon 复制 DT_Items 的</li>
<li>RequiredItems<ul>
<li>1<ul>
<li>ID 1</li>
<li>Quantity 50</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>RowName 14<ul>
<li>木质台</li>
<li>ID 14</li>
<li>Level 1</li>
<li>Icon 复制 DT_Items 的</li>
<li>RequiredItems<ul>
<li>1<ul>
<li>ID 1</li>
<li>Quantity 50</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>RowName 15<ul>
<li>木质台</li>
<li>ID 15</li>
<li>Level 1</li>
<li>Icon 复制 DT_Items 的</li>
<li>RequiredItems<ul>
<li>1<ul>
<li>ID 1</li>
<li>Quantity 50</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>…. 剩下不补充</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>R键 赋予的物品ID 改为:47 49 50</li>
</ul>
<p>测试：</p>
<ol>
<li>按R键将物品放到热键栏，按1进入预建造模式</li>
<li>鼠标左键放置 三个 建筑物</li>
<li>按X键拆除建筑物</li>
</ol>
<h4 id="110-修复建造系统的bug"><a href="#110-修复建造系统的bug" class="headerlink" title="110 修复建造系统的bug"></a>110 修复建造系统的bug</h4><p>OPEN BPC_BuildingComponent</p>
<ul>
<li>编辑 Event SpawnBuildOnServer<ul>
<li>Remove Quantity 后 无论结果无语 都 SpawnBuildable</li>
</ul>
</li>
<li>编辑 方法 CheckForOverlap<ul>
<li>Box Trace By Channel<ul>
<li>Draw Debug Type &#x3D; For Duration</li>
</ul>
</li>
<li>修改 Start &#x3D; BuildPreview 的 OverlapBoxSize 的 Get Component Bounds 的 Origin</li>
<li>修改 End &#x3D; 同上</li>
<li>修改 HalfSize &#x3D; BuildPreview 的 OverlapBoxSize 的 BoxExtent <code>注意不是 Get Component Bounds</code></li>
<li>修改 Orientation &#x3D; BuildPreview 的 RootComponent 的 Get World Rotation 拆分z &#x3D;&gt; Make Rotator 的 z</li>
</ul>
</li>
</ul>
<p>OPEN BP_WallMaster</p>
<ul>
<li>类默认设置<ul>
<li>BuildableInfo<ul>
<li>检测全不开</li>
</ul>
</li>
</ul>
</li>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 140 10 140</li>
</ul>
</li>
</ul>
<p>其他的BP蓝图也都需要修改<br>OPEN WindowMaster</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 70 10 40</li>
</ul>
</li>
</ul>
<p>OPEN BP_WindowFrame</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 140 10 140</li>
</ul>
</li>
</ul>
<p>OPEN BP_TriangleFoundation</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 32 32 32</li>
</ul>
</li>
</ul>
<p>OPEN BP_TriangleCeiling</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 50 80 10</li>
</ul>
</li>
</ul>
<p>OPEN BP_Torch</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 10 10 40</li>
</ul>
</li>
<li>变换<ul>
<li>0 20 17.58</li>
</ul>
</li>
</ul>
<p>OPEN BP_StairsMaster</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 100 120 120</li>
</ul>
</li>
</ul>
<p>OPEN RoofTriangleMaster</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 35 10 35</li>
</ul>
</li>
<li>变换<ul>
<li>0 0 -90</li>
</ul>
</li>
</ul>
<p>OPEN BP_RoofSmallMaster</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 80 120 20</li>
</ul>
</li>
<li>变换<ul>
<li>85 0 -65</li>
<li>0 -40 0</li>
<li>1 1 1</li>
</ul>
</li>
</ul>
<p>OPEN BP_RoofRightMaster</p>
<ul>
<li>编辑 OverlapBoxSize<ul>
<li>Box Extent &#x3D; 60 10 60</li>
</ul>
</li>
<li>变换<ul>
<li>-73 0 -60</li>
</ul>
</li>
</ul>
<p>OPEN BP_RoofLeftMaster</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 60 10 60</li>
</ul>
</li>
<li>变换<ul>
<li>68 0 -60</li>
</ul>
</li>
</ul>
<p>OPEN BP_RoofLargeMaster</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 20 120 140</li>
</ul>
</li>
<li>变换<ul>
<li>6.7 0 8</li>
<li>0 50 0</li>
<li>1 1 1</li>
</ul>
</li>
</ul>
<p>OPEN BP_RampMaster</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 100 32 32</li>
</ul>
</li>
<li>变换<ul>
<li>0 -90 50</li>
<li>0 0 0</li>
<li>1 1 1</li>
</ul>
</li>
</ul>
<p>OPEN BP_FoundationMaster</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 140 140 32</li>
</ul>
</li>
</ul>
<p>OPEN BP_FenceMaster</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 140 10 35</li>
</ul>
</li>
<li>变换<ul>
<li>0 0 -102</li>
</ul>
</li>
</ul>
<p>OPEN BP_DoorMaster 坐标原点在中间</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 50 10 90</li>
</ul>
</li>
<li>变换<ul>
<li>62 0 114</li>
</ul>
</li>
</ul>
<p>OPEN BP_DoorFrame</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 140 10 140</li>
</ul>
</li>
</ul>
<p>OPEN BP_Bed</p>
<ul>
<li>编辑 OverlapBoxSize  <ul>
<li>Box Extent &#x3D; 40 100 32</li>
</ul>
</li>
<li>变换<ul>
<li>0 0 45</li>
</ul>
</li>
</ul>
<p>注意：</p>
<ol>
<li>正方形的建造物 如果 Box Extent 设置 150 会导致无法放置，因为检测的范围太大了 需要设置140</li>
</ol>
<p>测试：</p>
<ol>
<li>按R键将物品放到热键栏，按1进入预建造模式</li>
<li>鼠标左键放置 三个 建筑物</li>
</ol>
<h3 id="第九章"><a href="#第九章" class="headerlink" title="第九章"></a>第九章</h3><p>玩家存储容器</p>
<h3 id="第10章"><a href="#第10章" class="headerlink" title="第10章"></a>第10章</h3><p>创建所有项目</p>
<h4 id="126-简介"><a href="#126-简介" class="headerlink" title="126 简介"></a>126 简介</h4><h4 id="127-设置步枪动画和物品类别"><a href="#127-设置步枪动画和物品类别" class="headerlink" title="127 设置步枪动画和物品类别"></a>127 设置步枪动画和物品类别</h4><p>将 课件文件夹 Icons 的所有文件 放入 _Main&#x2F;Widgets&#x2F;Textures&#x2F;ItemIcons 中<br>将 课件文件夹 以外 的所有文件 放入 Man&#x2F;Animations 中</p>
<ul>
<li>网格体 选择 UE4_Mannequin_Skeleton</li>
</ul>
<p>创建 动画 混合控件 网格体 选择 UE4_Mannequin_Skeleton Rename：FP_RifleBS<br>OPEN FP_RifleBS</p>
<ul>
<li>详情<ul>
<li>水平 Axis<ul>
<li>Name：Speed</li>
<li>Max Axis Value: 800</li>
</ul>
</li>
</ul>
</li>
<li>FPRifleIdle 拖入动画<ul>
<li>0 0</li>
</ul>
</li>
<li>Rifle_Run 拖入 动画<ul>
<li>600 0</li>
</ul>
</li>
<li>RifleSprint 拖入 动画<ul>
<li>800 0</li>
</ul>
</li>
</ul>
<p>OPEN FirstPerson_AnimBP</p>
<ul>
<li>进入 Machine 的 Idle<ul>
<li>根据枚举器 选择不同的动画</li>
<li>右键 Blend Poses 增加 元素引脚 Rifle<ul>
<li>拖入 FP_RifleBS<ul>
<li>Speed 使用 参数 Speed</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN ThirdPerson_AnimBP</p>
<ul>
<li>预览网格体 使用 SK_Man_Full_01</li>
<li>进入 Machine 的 Idle<ul>
<li>根据枚举器 选择不同的动画</li>
<li>右键 Blend Poses 增加 元素引脚 Rifle<ul>
<li>拖入 FP_RifleBS<ul>
<li>Speed 使用 参数 Speed</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建文件夹 WeaponRanged In _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipable<br>创建文件夹 Rifle In _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipable&#x2F;WeaponsRanged<br>创建蓝图类 BP_TP_Rifle 继承于 BP_ThirdPersonEquipable 放入 Rifle 文件夹中<br>创建蓝图类 BP_FP_Rifle 继承于 BP_FirstPersonEquipable 放入 Rifle 文件夹中</p>
<p>下载UE引擎资源</p>
<ul>
<li>打开引擎市场</li>
<li>search<ul>
<li>military weapons Dark</li>
</ul>
</li>
<li>安装 如果不兼容 则安装4.27</li>
</ul>
<p>OPEN BP_TP_Rifle</p>
<ul>
<li>增加 骨骼网格体 组件 Rename:Rifle<ul>
<li>骨骼网格体 Static Mesh &#x3D; Assault_Rifle_B</li>
</ul>
</li>
</ul>
<p>OPEN BP_FP_Rifle</p>
<ul>
<li>增加 骨骼网格体 组件 Rename:Rifle<ul>
<li>骨骼网格体 Static Mesh &#x3D; Assault_Rifle_B</li>
</ul>
</li>
</ul>
<p>绑定套接字  为了让枪在手上<br>OPEN SK_Man_Full_01</p>
<ul>
<li>预览网格体 选择 FPRifleIdle BP_TP_Rifle</li>
<li>找到骨骼 ToolSocket<ul>
<li>删除下面的绑定 预览</li>
</ul>
</li>
<li>找到骨骼 hand_r<ul>
<li>创建 Socket Rename:RifleSocket<ul>
<li>增加预览资产 Assault_Rifle_B</li>
<li>变换 如果没有详情窗口就点击Window打开<ul>
<li>-9.9 3.9 -1.5</li>
<li>10.79 15.74 65.24</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Rifle</p>
<ul>
<li>类默认设置<ul>
<li>EquipableInfo<ul>
<li>SocketName &#x3D; RifleSocket</li>
<li>AnimationState &#x3D; Rifle</li>
<li>FirstPersonEquipClass &#x3D; BP_FP_Rifle</li>
</ul>
</li>
</ul>
</li>
<li>Rifle<ul>
<li>Owner No See &#x3D; true</li>
</ul>
</li>
</ul>
<p>OPEN DT_Items</p>
<ul>
<li>增加 <ul>
<li>74<ul>
<li>Icon Rifle</li>
<li>突击步枪</li>
<li>伤害 100</li>
<li>Uncommon</li>
<li>HP 100 100</li>
<li>ItemType Equipable</li>
<li>ItemClassRef BP_TP_Rifle</li>
<li>UseAmmo? True</li>
<li>MaxAmmo 30</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>修改 R 键<ul>
<li>ID 74</li>
</ul>
</li>
</ul>
<p>玩家数量设置2</p>
<p>测试：</p>
<h4 id="128-设置步枪射击-1"><a href="#128-设置步枪射击-1" class="headerlink" title="128 设置步枪射击 1"></a>128 设置步枪射击 1</h4><p>创建 动画蒙太奇 继承于 FPRifleIdleFire Rename:FPRifleIdleFire_Montage In Man&#x2F;Animations</p>
<p>OPEN Fire_Rifle_W</p>
<ul>
<li>删除 声音 RifleB_Fire_Cue 后面调用生成，就可以设置声音的范围等参数</li>
</ul>
<p>OPEN BPI_EquipableItem</p>
<ul>
<li>创建 方法 StopLeftMouseLoop</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 Event StopLeftMouseOnServer<ul>
<li>ThirdPersonEquippedItem 有效获取<ul>
<li>True<ul>
<li>BPI 的 StopLeftMouseLoop</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 鼠标左键按钮 Event 松开<ul>
<li>StopLeftMouseOnServer</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Rifle</p>
<ul>
<li>创建 变量 IsReloading? Boolean</li>
<li>实现 UseItemInterface<ul>
<li>设置 变量 CharRef &#x3D; 参数 CharRef</li>
<li>Branch IsReloading? 结果<ul>
<li>False<ul>
<li>Branch CharRef 的 Get BPC Player Hotbar &#x3D;&gt; Items By Index(CharRef 的 HotbarIndex) Get &#x3D;&gt; Break &#x3D;&gt; CurrAmmo &gt;&#x3D; 1<ul>
<li>True<ul>
<li>StartFire</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event StartFire(On Server)<ul>
<li>Set Timer By Event<ul>
<li>0.2</li>
<li>Set RifleFireTimerHandle &#x3D; Return Value</li>
<li>Event &#x3D; FireEvent</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event FireEvent<ul>
<li>Branch CharRef 的 Get BPC Player Hotbar &#x3D;&gt; Items By Index(CharRef 的 HotbarIndex) Get &#x3D;&gt; Break &#x3D;&gt; CurrAmmo &gt;&#x3D; 1<ul>
<li>True<ul>
<li>CharRef 的 GetCameraRotation</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event GetCameraRotation(On Client)<ul>
<li>Inputs<ul>
<li>Target BP_FirstPersonCharacter</li>
</ul>
</li>
<li>FireRifleOnServer<ul>
<li>Rotation &#x3D; Target 的 Get First Person Camera 的 Get World Rotation</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event FireRifleOnServer<ul>
<li>Inputs<ul>
<li>Rotation</li>
</ul>
</li>
<li>Set 变量 PlayerCameraRotation<ul>
<li>Rotation</li>
</ul>
</li>
<li>CharRef 的 FirstPersonMontage<ul>
<li>FPRifleIdleFire</li>
</ul>
</li>
<li>CharRef 的 ThirdPersonMontage<ul>
<li>FPRifleIdleFire</li>
</ul>
</li>
<li>Multicast</li>
<li>FireFirstPersonEquippedItemAnim</li>
</ul>
</li>
<li>创建 Event Multicast<ul>
<li>组件 Rifle 的 Play Animation<ul>
<li>Fire_Rifle_W</li>
</ul>
</li>
<li>Rifle 的 Spawn Sound Attached<ul>
<li>RifleB_Fire_Cue</li>
<li>Attenuation Setting &#x3D; WeaponShot_att 衰减</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event FireFirstPersonEquippedItemAnim(On Client)<ul>
<li>Inputs<ul>
<li>CharRef BP_FirstPersonCharacter</li>
</ul>
</li>
<li>CharRef 的 Get First Person Equipped Item &#x3D;&gt; <code>Cast To BP_FP_Rifle 的 Rifle</code> 的 Play Animation<ul>
<li>Fire_Rifle_W</li>
</ul>
</li>
</ul>
</li>
<li>实现 API Event StopLeftMouseLoop<ul>
<li>Clear Timer By Handle<ul>
<li>RifleFireTimerHandle</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN DT_Items</p>
<ul>
<li>修改 74<ul>
<li>UseAmmo? True</li>
<li>CurrentAmmo 30</li>
<li>MaxAmmo 30</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>可以开枪，并且有声音和特效</li>
</ol>
<h4 id="129-设置步枪射击-2"><a href="#129-设置步枪射击-2" class="headerlink" title="129 设置步枪射击 2"></a>129 设置步枪射击 2</h4><p>通过玩家摄像头射线判断命中Player的Actor，根据不同部位造成不同伤害，根据玩家装备的护甲减免伤害。</p>
<p>OPEN BP_TP_Rifle</p>
<ul>
<li>创建 变量 BulletDistance float Default 10000</li>
<li>创建 方法 LineTrace<ul>
<li>Inputs<ul>
<li>PlayerCamera Rotation</li>
</ul>
</li>
<li>Outputs<ul>
<li>OutHit Hit Result</li>
<li>Hit? Bool</li>
</ul>
</li>
<li>CharRef 的 Get First Person Camera 的 Get World Location 设置 局部变量 CameraLocation</li>
<li>Line Trace By Channel<ul>
<li>Start &#x3D; CameraLocation</li>
<li>End &#x3D; CameraLocation + (PlayerCamera 的 Get Forward Vector * BulletDistance)</li>
<li>Channel &#x3D; 摄像机</li>
<li>Trace Complex &#x3D; true</li>
<li>Actors To Ignore &#x3D; Make Array &#x3D;&gt; Self and CharRef</li>
<li>Draw Debug Type &#x3D; 持久</li>
</ul>
</li>
<li>Branch 结果<ul>
<li>Return Node<ul>
<li>OutHit &#x3D; OutHit</li>
<li>Hit? &#x3D; Return Value</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event FireRifleOnServer 最后<ul>
<li>LineTrace<ul>
<li>PlayerCameraRotation</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>开枪射击 可以看到射线</li>
</ol>
<p>项目设置</p>
<ul>
<li>Project Setting<ul>
<li>Physics Surface<ul>
<li>SurfaceType1 Head</li>
<li>SurfaceType2 Chest</li>
<li>SurfaceType3 Legs</li>
<li>SurfaceType4 Boots</li>
<li>SurfaceType5 Limb</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建文件夹 Man&#x2F;Mesh&#x2F;Full&#x2F;PhysicalSurfaces<br>创建 物理材质 PhysicalMaterial Rename:PM_Head</p>
<ul>
<li>Surface Type &#x3D; Head</li>
</ul>
<p>COPY PM_Chest</p>
<ul>
<li>Surface Type &#x3D; Chest</li>
</ul>
<p>COPY PM_Legs</p>
<ul>
<li>Surface Type &#x3D; Legs</li>
</ul>
<p>COPY PM_Boots</p>
<ul>
<li>Surface Type &#x3D; Boots</li>
</ul>
<p>COPY PM_Limb</p>
<ul>
<li>Surface Type &#x3D; Limb</li>
</ul>
<p>OPEN SK_Man_Full_01_PhysicsAsset</p>
<ul>
<li>点击 骨骼 头部 1个部位<ul>
<li>材质重写 Physical Material &#x3D; PM_Head</li>
</ul>
</li>
<li>点击 骨骼 胸部 五个部位<ul>
<li>材质重写 Physical Material &#x3D; PM_Chest</li>
</ul>
</li>
<li>点击 骨骼 手臂 四个部位<ul>
<li>材质重写 Physical Material &#x3D; PM_Limb</li>
</ul>
</li>
<li>点击 骨骼 大腿小腿 四个部位 + 腹部<ul>
<li>材质重写 Physical Material &#x3D; PM_Legs</li>
</ul>
</li>
<li>点击 骨骼 脚 2个部位<ul>
<li>材质重写 Physical Material &#x3D; PM_Boots</li>
</ul>
</li>
</ul>
<p>OPEN BPI_SurvivalCharacter</p>
<ul>
<li>创建 方法 HasArmorInSlot?<ul>
<li>Inputs<ul>
<li>Surface EPhysicalSurface</li>
</ul>
</li>
<li>Outputs<ul>
<li>HasArmor? Boolean</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 WeaponRangedDamage<ul>
<li>Inputs<ul>
<li>Damage float</li>
<li>InstigatorController Controller</li>
<li>WeaponCauser Actor</li>
<li>SurfaceHit EPhysicalSurface</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Rifle</p>
<ul>
<li>创建 变量 DamageMultiplier float Default 0.05</li>
<li>创建 方法 ApplyDamages<ul>
<li>Inputs<ul>
<li>DamagedActor Actor</li>
<li>HitInfo HitResult</li>
<li>Condition? Bool</li>
<li>SurfaceHit EPhysicalSurface</li>
</ul>
</li>
<li>设置 局部变量 PSurfaceHit 并且打印 print String</li>
<li>设置 局部变量 LocalDamagedActor</li>
<li>Branch Condition?<ul>
<li>True<ul>
<li>设置 局部变量 LocalDamage &#x3D; ItemInfo Break &#x3D;&gt; ItemDamage * DamageMultiplier</li>
<li>Branch DamagedActor &#x3D;&gt; Actor Has Tag(Player)<ul>
<li>True<ul>
<li>SurfaceHit 进行 select 不同位置不同伤害<ul>
<li>Default &#x3D; LocalDamage * 1</li>
<li>Head &#x3D; LocalDamage * 8</li>
<li>Chest &#x3D; LocalDamage * 5</li>
<li>Legs &#x3D; LocalDamage * 3</li>
<li>Boots &#x3D; LocalDamage * 1</li>
<li>Limb &#x3D; LocalDamage * 1</li>
<li>设置 LocalDamage &#x3D; select 的 Return Value</li>
<li>Branch DamagedActor 的方法 HasArmorInSlot? 参数 SurfaceHit Comment：装备伤害减免<ul>
<li>True<ul>
<li>设置 LocalDamage &#x3D; LocalDamage - (LocalDamage * 0.25)</li>
</ul>
</li>
<li>False</li>
<li>WeaponRangedDamage (无论是否装备伤害减免 都执行)<ul>
<li>Damage &#x3D; LocalDamage</li>
<li>InstigatorController &#x3D; CharRef 的 Get Controller</li>
<li>WeaponCauser &#x3D; Self</li>
<li>SurfaceHit &#x3D; PSurfaceHit</li>
</ul>
</li>
<li>print string LocalDamage</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>False <ul>
<li>ApplyDamage Comment:对AI或者除玩家之外的任何东西造成伤害<ul>
<li>DamagedActor &#x3D; DamagedActor</li>
<li>BaseDamage &#x3D; LocalDamage * 4</li>
<li>Event Instigator &#x3D; CharRef 的 Get Controller</li>
<li>Damage Causer &#x3D; Self</li>
<li>Damage Type Class &#x3D; DamageType</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event FireRifleOnServer 最后<ul>
<li>LineTrace<ul>
<li>PlayerCameraRotation</li>
</ul>
</li>
<li>Branch Hit?<ul>
<li>True<ul>
<li>ApplyDamages<ul>
<li>DamagedActor &#x3D; OutHit Break 的 Hit Actor</li>
<li>HitInfo &#x3D; OutHit</li>
<li>Condition &#x3D; OutHit Break 的 Hit Actor &#x3D;&gt; Actor Has Tag(Damageable)</li>
<li>SurfaceHit &#x3D; OutHit Break 的 Phys Mat 的 SurfaceType</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>增加 Tag Damageable</li>
<li>实现 API 方法 HasArmorInSlot?<ul>
<li>Inputs<ul>
<li>Surface EPhysicalSurface</li>
</ul>
</li>
<li>Surface Switch<ul>
<li>Default Return Value &#x3D; false</li>
<li>Head &#x3D;&gt; HelmetSlot Is Valid 的结果 bool 给 &#x3D;&gt; Return Node</li>
<li>Chest &#x3D;&gt; ChestSlot Is Valid 的结果 bool 给 &#x3D;&gt; Return Node</li>
<li>Legs &#x3D;&gt; PantsSlot Is Valid 的结果 bool 给 &#x3D;&gt; Return Node</li>
<li>Boots &#x3D;&gt; BootsSlot Is Valid 的结果 bool 给 &#x3D;&gt; Return Node</li>
<li>Limb Return Value &#x3D; false</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 ApplyDamageToPlayer<ul>
<li>Inputs<ul>
<li>Damage float</li>
<li>DamageCauser Actor</li>
<li>SurfaceHit EPhysicalSurface</li>
<li>MeleorPointDMG Boolean 近远战</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 Event AnyDamage<ul>
<li>调用 ApplyDamageToPlayer 时 参数 MeleorPointDMG &#x3D; true</li>
</ul>
</li>
<li>实现 API 方法 WeaponRangedDamage 放在 Event AnyDamage 旁<ul>
<li>Switch Has Authority<ul>
<li>True<ul>
<li>ApplyDamageToPlayer</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 ApplyDamageToPlayer<ul>
<li>判断 用户没有死亡后</li>
<li>判断 MeleorPointDMG 近远战<ul>
<li>True<ul>
<li>判断 DamageCauser !&#x3D; Self<ul>
<li>True<ul>
<li>Armor Durability Damage Mele</li>
<li>继续后续逻辑(Set 变量 LocalCurHealth)</li>
</ul>
</li>
<li>False 继续后续逻辑(Set 变量 LocalCurHealth)</li>
</ul>
</li>
</ul>
</li>
<li>False 远战<ul>
<li>ArmorDurabilityPointDamage<ul>
<li>Damage &#x3D; Damage</li>
<li>ArmorSlots &#x3D; SurfaceHit</li>
</ul>
</li>
<li>继续后续逻辑(Set 变量 LocalCurHealth)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 ArmorDurabilityPointDamage<ul>
<li>Inputs<ul>
<li>Damage float</li>
<li>ArmorSlots EPhysicalSurface</li>
</ul>
</li>
<li>设置 局部变量 LocalArmorDamage &#x3D; Damage &#x2F; 3</li>
<li>ArmorSlots Switch<ul>
<li>Head<ul>
<li>HeadSlot 右键转为有效获取</li>
</ul>
</li>
<li>Chest<ul>
<li>ChestSlot 右键转为有效获取</li>
</ul>
</li>
<li>Legs<ul>
<li>LegsSlot 右键转为有效获取</li>
</ul>
</li>
<li>Boots<ul>
<li>BootsSlot 右键转为有效获取</li>
</ul>
</li>
</ul>
</li>
<li><code>装备变量 例如 HeadSlot</code> 的 ArmorTypeDamage 传入参数</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Rifle</p>
<ul>
<li>方法 ApplyDamages 调用了 ItemInfo 的 伤害值，需要设置才有伤害</li>
<li>类默认设置<ul>
<li>ItemInfo<ul>
<li>ItemDamage &#x3D; 100</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>第三人称网格体<ul>
<li>物理资产重写 SK_Man_Full_01_PhysicsAsset</li>
</ul>
</li>
<li>Capsule Component 设置<ul>
<li>碰撞预设体<ul>
<li>Camera 重叠，这样可以让枪的射线不会被自己的碰撞体挡住</li>
</ul>
</li>
</ul>
</li>
<li>ThirdPersonMesh<ul>
<li>碰撞预设<ul>
<li>对象类型 Pawn</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试准备：</p>
<ol>
<li>两个玩家</li>
<li>命令行：show Collision 可以看到碰撞</li>
<li>给予的物品ID 74 11 13</li>
</ol>
<p>测试：,</p>
<ol>
<li>玩家1开枪射击玩家2，玩家2受伤，分别射击不同部位，受伤不同</li>
<li>玩家2开枪射击玩家1，玩家1受伤</li>
<li>玩家2穿上装备，玩家1开枪射击玩家2，玩家2受伤减少，分别射击不同部位，受伤不同</li>
</ol>
<h4 id="130-设置-步枪装弹和弹药"><a href="#130-设置-步枪装弹和弹药" class="headerlink" title="130 设置 步枪装弹和弹药"></a>130 设置 步枪装弹和弹药</h4><p>减少弹药</p>
<ul>
<li>容量检查</li>
<li>更新数据</li>
<li>更新UI</li>
</ul>
<p>OPEN 部件 W_InventorySlot</p>
<ul>
<li>编辑 方法 UpdateSlot<ul>
<li>类型 是 Equipment 并且 UseAmmo 是 True<ul>
<li>True<ul>
<li>逻辑最后</li>
<li>BottomText 的 Set Text<ul>
<li>ItemInfo Break 的 CurrAmmo + MaxAmmo Format:{CurrAmmo}&#x2F;{MaxAmmo}</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Rifle</p>
<ul>
<li>创建 方法 SubtractAmmo<ul>
<li>Inputs<ul>
<li>Amount int Default 1</li>
</ul>
</li>
<li>设置 局部变量 LocalItemInfo &#x3D; CharRef 的 Get Survival Char Ref 的 Get BPC Player Hotbar &#x3D;&gt; Items By Index(CharRef 的 HotbarIndex) Get</li>
<li>判断 LocalItemInfo &#x3D;&gt; Break &#x3D;&gt; CurrAmmo &gt;&#x3D; Amount<ul>
<li>True<ul>
<li>LocalItemInfo 的 Set Members 的 Set array Elem &#x3D;&gt; CurrAmmo - Amount</li>
<li>CharRef 的 Get Controller from Char &#x3D;&gt; UpdateItemSlot</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 方法 FireRifleOnServer<ul>
<li>最后 增加 SubtractAmmo 无论是否命中都减少弹药</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>开枪射击，弹药减少</li>
</ol>
<p>OPEN DT_Items</p>
<ul>
<li>增加 75<ul>
<li>75</li>
<li>1</li>
<li>Icon RifleAmmo</li>
<li>Rifle Ammo</li>
<li>…</li>
<li>UnCommon</li>
<li>IsStackable? True</li>
<li>StackSize 100</li>
</ul>
</li>
</ul>
<p>OPEN BPI_EquipableItem</p>
<ul>
<li>创建 方法 ReloadItemEvent<ul>
<li>Inputs<ul>
<li>CharRef BP_FirstPersonCharacter</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>给予按键 改成 T</li>
<li>给予物品 ID 75 数量：100</li>
<li>创建 Event ReloadItemOnServer<ul>
<li>ThirdPersonEquippedItem 右键 有效获取 的 方法 ReloadItemEvent<ul>
<li>self</li>
</ul>
</li>
</ul>
</li>
<li>R键<ul>
<li>ReloadItemOnServer</li>
</ul>
</li>
</ul>
<p>OPEN BPC_ItemsContainer</p>
<ul>
<li>创建 方法 FindItem<ul>
<li>创建 局部变量 FoundIndex int</li>
<li>创建 局部变量 FoundItem? Boolean</li>
<li>Inputs<ul>
<li>ItemToFind int</li>
</ul>
</li>
<li>Outputs<ul>
<li>Index int</li>
<li>ItemInfo S_ItemInfo</li>
<li>HasItem? Boolean</li>
</ul>
</li>
<li>设置 局部变量 LocalItemID &#x3D; ItemToFind</li>
<li>Items 的 For Each Loop With Break<ul>
<li>Branch LocalItemID &#x3D; Items 的 Break 的 ItemID<ul>
<li>True<ul>
<li>设置 FoundIndex &#x3D; Array Index</li>
<li>设置 FoundItem &#x3D; true</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Break and Completed<ul>
<li>Return Node<ul>
<li>Index &#x3D; FoundIndex</li>
<li>ItemInfo &#x3D; Items By Index(FoundIndex) Get</li>
<li>HasItem? &#x3D; FoundItem</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>搜索 RifleReload</p>
<ul>
<li>右键 创建动画蒙太奇<ul>
<li>重命名 RifleReload_Montage</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Rifle</p>
<ul>
<li>创建 变量 IsReloading? Boolean</li>
<li>创建 变量 AmmoIndex int</li>
<li>创建 变量 TotalAmmo int</li>
<li>实现 API Event ReloadItemEvent<ul>
<li>Branch IsReloading?<ul>
<li>False<ul>
<li>设置 变量 CurrAmmo &#x3D; CurrAmmo</li>
<li>判断 <code>Event参数的 CharRef</code> 的 GetSurvivalCharRef 的 Get BPC Player Hotbar &#x3D;&gt; Items By Index(CharRef 的 HotbarIndex) Get &#x3D;&gt; Break &#x3D;&gt; CurrAmmo &lt; MaxAmmo<ul>
<li>True<ul>
<li><code>变量的 CharRef</code> 右键 有效获取 的 方法 GetSurvivalCharRef 的 Get BPC Player Inventory &#x3D;&gt; FindItem<ul>
<li>ItemToFind &#x3D; 75</li>
<li>Branch HasItem?<ul>
<li>True<ul>
<li>设置 变量 AmmoIndex &#x3D; Index</li>
<li>设置 变量 TotalAmmo &#x3D; ItemInfo Break &#x3D;&gt; ItemQuantity</li>
<li>Set IsReloading? &#x3D; true</li>
<li>播放 装弹 动画 <ul>
<li><code>变量的 CharRef</code> 的 FirstPersonMontage<ul>
<li>RifleReload_Montage</li>
</ul>
</li>
<li><code>变量的 CharRef</code> 的 ThirdPersonMontage<ul>
<li>RifleReload_Montage</li>
</ul>
</li>
<li><code>变量的 CharRef</code> 的 ReloadWeaponOnClient</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event ReloadWeaponOnClient<ul>
<li>Inputs<ul>
<li>CharRef BP_FirstPersonCharacter</li>
</ul>
</li>
<li>get First Person Equipped Item &#x3D;&gt; Cast To BP_FP_Rifle &#x3D;&gt; 骨骼网格体 Rifle 的 Play Animation<ul>
<li>Reload_Rifle_Hip_W</li>
</ul>
</li>
</ul>
</li>
<li>创建 变量 MaxClipSize Int Default:30</li>
<li>创建 变量 AmmoToRemove Int </li>
<li>实现 API Event EndAnimation<ul>
<li>Branch IsReloading?</li>
<li>看图</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>开枪射击，弹药减少，按键装弹，装弹完成</li>
<li>子弹数量给10个，开枪所有子弹射完，装弹，装弹完成，子弹消失</li>
</ol>
<p><img src="/blog/p/614a8811/130%E8%A3%85%E5%BC%B9.png" alt="130装弹.png"></p>
<p><img src="/blog/p/614a8811/%E5%8A%A8%E7%94%BB%E7%BB%93%E6%9D%9F%E5%90%8E%E8%A3%85%E4%B8%8A%E5%BC%B9%E8%8D%AF%E5%B9%B6%E6%89%A3%E9%99%A4_%E6%92%AD%E6%94%BEUI.png" alt="动画结束后装上弹药并扣除_播放UI.png"></p>
<h4 id="131-步枪-每次使用后减少耐久度"><a href="#131-步枪-每次使用后减少耐久度" class="headerlink" title="131 步枪 每次使用后减少耐久度"></a>131 步枪 每次使用后减少耐久度</h4><p>OPEN PlayerWindowAnimBP</p>
<ul>
<li>New State Machine<ul>
<li>Idle<ul>
<li>右键 增加 Blend Poses 增加 Rifle Pose<ul>
<li>FP_RifleBS<ul>
<li>Speed</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>创建 Event SetItemDurabilityOnServer<ul>
<li>Inputs<ul>
<li>AmountToSubtract int</li>
</ul>
</li>
<li>SetItemDurabilityFunction</li>
</ul>
</li>
<li>创建 方法 SetItemDurabilityFunction<ul>
<li>Inputs<ul>
<li>AmountToSubtract int</li>
</ul>
</li>
<li>设置 局部变量 LocalSubtract &#x3D; AmountToSubtract</li>
<li>ThirdPersonEquippedItem 右键 有效获取</li>
<li>设置 局部变量 LocalAmount &#x3D; BPC Player Hotbar 的 Items By Index(CharRef 的 HotbarIndex) Get &#x3D;&gt; Break &#x3D;&gt; ItemCurrentHP - LocalSubtract</li>
<li>判断 LocalAmount &lt;&#x3D; 0<ul>
<li>True<ul>
<li>BPC Player Hotbar 的 RemoveItemByIndex<ul>
<li>Index &#x3D; HotbarIndex</li>
</ul>
</li>
<li>DequipCurrentItem<ul>
<li>HotbarIndex</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>BPC Player Hotbar 的 Items By Index(CharRef 的 HotbarIndex) Get &#x3D;&gt; Set Members<ul>
<li>ItemCurrentHP &#x3D; LocalAmount</li>
</ul>
</li>
<li>Items &#x3D;&gt; Set Array Elem<ul>
<li>Index &#x3D; HotbarIndex</li>
<li>Item &#x3D; Struct Out</li>
</ul>
</li>
<li>Get Controller 的 SurvivalGamePCRef 的 UpdateItemSlot<ul>
<li>PlayerHotbar</li>
<li>HotbarIndex</li>
<li>Struct Out</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Rifle</p>
<ul>
<li>编辑 API Event EndAnimation<ul>
<li>最后 增加 CharRef 的 SetItemDurabilityOnServer<ul>
<li>AmountToSubtract &#x3D; 10</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>开枪射击，丢失耐久度</li>
</ol>
<h4 id="132-火箭发射器"><a href="#132-火箭发射器" class="headerlink" title="132 火箭发射器"></a>132 火箭发射器</h4><p>导入课件资源<br>ICON 文件夹 导入到 Man&#x2F;Animations</p>
<ul>
<li>选择 UE4_Mannequin_Skeleton</li>
</ul>
<p>创建 动画 混合空间 Rename:FP_RocketBS</p>
<ul>
<li>选择 UE4_Mannequin_Skeleton</li>
<li>详情<ul>
<li>水平 Axis<ul>
<li>Name:Speed</li>
<li>Max Axis Value: 800</li>
</ul>
</li>
</ul>
</li>
<li>FPRocketIdle 拖入动画<ul>
<li>0 0</li>
</ul>
</li>
<li>FPRocketWalk 拖入动画<ul>
<li>600 0</li>
</ul>
</li>
<li>FPRocketRun 拖入动画<ul>
<li>800 0</li>
</ul>
</li>
<li>骨骼 添加套接字 预览动画 FPRocketIdle<ul>
<li>选中 pinky_02_l 移除所有附加资产</li>
<li>选中 hand_r 增加套接字 RocketSocket<ul>
<li>预览资产 Rocket_Launcher_B 火箭</li>
<li>变换<ul>
<li>-10.1 3.41 -0.57</li>
<li>14.5 -4.31 71.6</li>
<li>1 1 1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN 三个文件 相同修改 FirstPerson_AnimBP&#x2F;ThirdPerson_AnimBP&#x2F;PlayerWindowAnimBP</p>
<ul>
<li>new State Machine<ul>
<li>Idle<ul>
<li>右键 增加 Blend Poses 增加 RocketLauncher Pose<ul>
<li>FP_RocketBS<ul>
<li>Speed</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建文件夹 RocketLauncher In _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipable&#x2F;WeaponRanged<br>创建 子蓝图 BP_TP_RocketLauncher 继承于 BP_ThirdPersonEquipable 放入 RocketLauncher 文件夹中<br>创建 子蓝图 BP_FP_RocketLauncher 继承于 BP_FirstPersonEquipable 放入 RocketLauncher 文件夹中</p>
<p>OPEN BP_TP_RocketLauncher</p>
<ul>
<li>创建 骨骼网格体 组件 Rename:RocketLauncherMesh<ul>
<li>骨骼网格体 Static Mesh &#x3D; Rocket_launcher_B</li>
</ul>
</li>
<li>类默认设置<ul>
<li>EquipableInfo<ul>
<li>SocketName &#x3D; RocketSocket</li>
<li>AnimationState &#x3D; RocketLauncher</li>
<li>FirstPersonEquipClass &#x3D; BP_FP_RocketLauncher</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FP_RocketLauncher</p>
<ul>
<li>创建 骨骼网格体 组件 Rename:RocketLauncherMesh<ul>
<li>骨骼网格体 Static Mesh &#x3D; Rocket_launcher_B</li>
</ul>
</li>
</ul>
<p>OPEN DT_Items</p>
<ul>
<li>增加 76<ul>
<li>76</li>
<li>1</li>
<li>Icon RocketLauncher</li>
<li>Rocket Launcher</li>
<li>…</li>
<li>ItemRarity Rare</li>
<li>HP 100 100</li>
<li>ItemType Equipable</li>
<li>ItemClassRef BP_TP_RocketLauncher</li>
<li>UseAmmo? true</li>
<li>MaxAmmo 1</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>修改 R 键<ul>
<li>ID 76</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>T键，获得火箭发射器，但是在背包移动中 状态下 提示的文字错误</li>
<li>按1持枪，可以看到火箭发射器，但是第一人称和第三人称持枪动作冲突</li>
<li>持枪后下肢没有动作</li>
</ol>
<p>OPEN BP_TP_RocketLauncher</p>
<ul>
<li>编辑 骨骼网格体<ul>
<li>Owner No See &#x3D; true</li>
</ul>
</li>
</ul>
<p>OPEN ThirdPerson_AnimBP</p>
<ul>
<li>预览网格体 SK_Man_Full_01</li>
<li>new State Machine<ul>
<li>Idle<ul>
<li>RocketLauncher Pose 改为<ul>
<li>Layered blend per bone 注意顺序<ul>
<li>ThirdPersonBS<ul>
<li>Speed</li>
</ul>
</li>
<li>FP_RocketBS<ul>
<li>Speed</li>
</ul>
</li>
<li>并且设置 详情的 层设置 LayerSetup 增加成员<ul>
<li>0<ul>
<li>Bone Name:spine_01</li>
<li>Bone Depth:1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN W_InventorySlot</p>
<ul>
<li>编辑 方法 UpdateSlot<ul>
<li>类型 是 Equipment 并且 UseAmmo 是 True<ul>
<li>True<ul>
<li>逻辑最后</li>
<li>BottomText 的 Set Text<ul>
<li>ItemInfo Break 的 CurrAmmo + MaxAmmo</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>复制 W_InventorySlot 的 方法 UpdateSlot 类型 是 Equipment 并且 UseAmmo 是 True 的 </p>
<ul>
<li>BottomText 的 Set Text<ul>
<li>ItemInfo Break 的 CurrAmmo + MaxAmmo</li>
</ul>
</li>
</ul>
<p>OPEN W_DraggedItem</p>
<ul>
<li>复制给 方法 UpdateSlot 类型 是 Equipment 并且 UseAmmo 是 True 的最后</li>
</ul>
<p>测试：<br>解决上述问题。</p>
<h4 id="133-火箭发射器发射-1"><a href="#133-火箭发射器发射-1" class="headerlink" title="133 火箭发射器发射 1"></a>133 火箭发射器发射 1</h4><p>创建 动画-蒙太奇 继承于 FPRocketFire Rename:FPRocketFire_Montage In</p>
<p>火箭发射器 粒子效果 文件：P_RocketLauncher_Trail_01</p>
<p>创建 蓝图类 Actor类型 BP_RocketProjectile 放入 _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipable&#x2F;WeaponsRanged&#x2F;RocketLauncher</p>
<ul>
<li>类默认设置<ul>
<li>可复制</li>
</ul>
</li>
<li>增加 发射物移动 Projectile Movement 组件 Rename:ProjectileMovement<ul>
<li>InitialSPeed: 3000 含义：初始速度</li>
<li>MaxSpeed: 3000 含义：最大速度</li>
<li>ProjectileGravityScale: 0 含义：发射物重力范围</li>
<li>Velocity: 3000 0 0 含义：速度</li>
</ul>
</li>
<li>增加 Sphere 组件 Rename：Sphere<ul>
<li>Radius：16</li>
<li>增加 静态网格体 组件 Rename:<ul>
<li>Static Mesh &#x3D; RocketLauncherB_Ammo</li>
<li>变换<ul>
<li>缩放 2 2 2</li>
</ul>
</li>
<li>增加 粒子效果 组件 P_RocketLauncher_Trail_01<ul>
<li>变换<ul>
<li>-12.2 0 0</li>
<li>0 0 -180</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_RocketLauncher</p>
<ul>
<li>增加 变量 IsFiring? Boolean</li>
<li>增加 变量 IsReloading? Boolean</li>
<li>实现 API Event UseItemInterface<ul>
<li>设置 变量 CharRef &#x3D; 参数 CharRef</li>
<li>Branch IsFiring?<ul>
<li>False<ul>
<li>Branch IsReloading?</li>
<li>False<ul>
<li>Branch CharRef 的 Get BPC Player Hotbar &#x3D;&gt; Items By Index(CharRef 的 HotbarIndex) Get &#x3D;&gt; Break &#x3D;&gt; CurrAmmo &gt;&#x3D; 1<ul>
<li>True<ul>
<li>Set IsFiring? &#x3D; true</li>
<li>GetCameraRotationOnClient</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event GetCameraRotationOnClient<ul>
<li>Inputs<ul>
<li>Target BP_FirstPersonCharacter</li>
</ul>
</li>
<li>FireRocketOnServer<ul>
<li>Rotation &#x3D; Target 的 Get First Person Camera 的 Get World Rotation</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event FireRocketOnServer<ul>
<li>Inputs<ul>
<li>Rotation</li>
</ul>
</li>
<li>CharRef 的 FirstPersonMontage<ul>
<li>FPRocketFire_Montage</li>
</ul>
</li>
<li>CharRef 的 ThirdPersonMontage<ul>
<li>FPRocketFire_Montage</li>
</ul>
</li>
<li>MulticastProjectile<ul>
<li>SpawnTransformRotation &#x3D; Rotation</li>
<li>CharRef &#x3D; CharRef</li>
</ul>
</li>
<li>Set IsFiring? &#x3D; false</li>
</ul>
</li>
<li>创建 Event MulticastProjectile<ul>
<li>Inputs<ul>
<li>SpawnTransformRotation Rotation</li>
<li>CharRef BP_FirstPersonCharacter</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_RocketLauncher</p>
<ul>
<li>在 骨骼网格体 组件内<ul>
<li>增加 箭头 Arrow 组件 Rename:Arrow<ul>
<li>变换<ul>
<li>0 64 10.62 这里注意，如果位置太接近角色则会炸到自己</li>
<li>0 0 90</li>
<li>1 1 1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event MulticastProjectile<ul>
<li>SpawnActor BP_RocketProjectile<ul>
<li>Transform<ul>
<li>Location &#x3D; Arrow 的 Get World Location</li>
<li>Rotation &#x3D; SpawnTransformRotation</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN DT_Items</p>
<ul>
<li>修改 76<ul>
<li>UseAmmo? True</li>
<li>CurrAMmo 1</li>
<li>MaxAmmo 1</li>
</ul>
</li>
</ul>
<p>给火箭发射器子弹限制生命周期<br>OPEN BP_RocketProjectile</p>
<ul>
<li>类默认设置<ul>
<li>Initial life span 5</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>按T获得火箭发射器，按1持枪，按鼠标左键发射火箭</li>
<li>火箭发射器子弹限制生命周期，5S后消失</li>
</ol>
<h4 id="134-火箭发射器发射-2"><a href="#134-火箭发射器发射-2" class="headerlink" title="134 火箭发射器发射 2"></a>134 火箭发射器发射 2</h4><ol>
<li>装弹扣减</li>
<li>使用耐久度扣减</li>
<li>增加火箭发射器开火声音、粒子效果</li>
</ol>
<p>OPEN Fire_RocketLauncher_W</p>
<ul>
<li>删除 声音 RocketLauncherB_Fire_Cue 后面调用生成，就可以设置声音的范围等参数</li>
</ul>
<p>OPEN BP_TP_RocketLauncher</p>
<ul>
<li>创建 方法 SubtractAmmo<ul>
<li>Inputs<ul>
<li>Amount int Default 1</li>
</ul>
</li>
<li>设置 局部变量 LocalItemInfo &#x3D; CharRef 的 Get Survival Char Ref 的 Get BPC Player Hotbar &#x3D;&gt; Items By Index(CharRef 的 HotbarIndex) Get</li>
<li>判断 LocalItemInfo &#x3D;&gt; Break &#x3D;&gt; CurrAmmo &gt;&#x3D; Amount<ul>
<li>True<ul>
<li>LocalItemInfo 的 Set Members 的 Set array Elem &#x3D;&gt; CurrAmmo - Amount</li>
<li>CharRef 的 Get Controller from Char &#x3D;&gt; UpdateItemSlot</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event MulticastProjectile<ul>
<li>增加 逻辑</li>
<li>RocketLauncherMesh 的 Spawn Sound Attached<ul>
<li>RocketLauncherB_Fire_Cue</li>
<li>Attenuation Setting &#x3D; WeaponShot_att 衰减</li>
</ul>
</li>
<li>RocketLauncherMesh 的 Play Animation<ul>
<li>Fire_RocketLauncher_W</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event FireRockerOnClient<ul>
<li>Inputs<ul>
<li>CharRef BP_FirstPersonCharacter</li>
</ul>
</li>
<li>CharRef 的 Get First Person Equipped Item &#x3D;&gt; Cast To BP_FP_RocketLauncher 的 RocketLauncherMesh 的 Play Animation<ul>
<li>Fire_RocketLauncher_W</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event FireRocketOnServer<ul>
<li>设置 开火结束变量前<ul>
<li>增加 SetItemDurabilityOnServer 减少耐久度</li>
<li>增加 SubtractAmmo 减少弹药</li>
<li>增加 FireRockerOnClient 播放动画</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="135-火箭发射器-遇到物体爆炸"><a href="#135-火箭发射器-遇到物体爆炸" class="headerlink" title="135 火箭发射器 遇到物体爆炸"></a>135 火箭发射器 遇到物体爆炸</h4><p>OPEN BP_RocketProjectile</p>
<ul>
<li>类设置<ul>
<li>继承 BPI_StructureDamage 用于实现对结构的伤害</li>
</ul>
</li>
<li>Sphere<ul>
<li>确保 组件 Sphere 在 BP 的最外层</li>
<li>碰撞预设<ul>
<li>BlockAll 然后设置 自定义<ul>
<li>Structure 阻止</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 变量 CharRef BP_FirstPersonCharacter<ul>
<li>公开 </li>
<li>可编辑实例</li>
</ul>
</li>
<li>创建 内置 EventHit <ul>
<li>Switch Has Authority<ul>
<li>True<ul>
<li>RocketHitMulticast<ul>
<li>Location &#x3D; 参数 Hit Location</li>
</ul>
</li>
<li>Sphere Overlap Actors<ul>
<li>Location &#x3D; 参数 Hit Location</li>
<li>Object Type &#x3D; Make Array &#x3D;&gt; Pawn + Structure</li>
<li>Radius &#x3D; 100</li>
<li>Actors To Ignore &#x3D; Make Array &#x3D;&gt; Self</li>
</ul>
</li>
<li>Draw Debug Sphere<ul>
<li>Location &#x3D; 参数 Hit Location</li>
<li>Radius &#x3D; 100</li>
<li>Duration &#x3D; 30</li>
</ul>
</li>
<li>Branch 结果<ul>
<li>True<ul>
<li>For Each Loop<ul>
<li>ApplyDamage<ul>
<li>DamagedActor &#x3D; Array Element</li>
<li>BaseDamage &#x3D; 100</li>
<li>Event Instigator &#x3D; CharRef 的 Get Controller</li>
<li>Damage Causer &#x3D; Self</li>
<li>Damage Type Class &#x3D; DamageType</li>
</ul>
</li>
</ul>
</li>
<li>Completed<ul>
<li>Delay 0.2</li>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>False<ul>
<li>Delay 0.2  这里延迟是为了让客户端解决一些问题 无法穿过物体等</li>
<li>Destroy Actor</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event RocketHitMulticast<ul>
<li>Inputs<ul>
<li>HitLocation Vector</li>
</ul>
</li>
<li>Spawn Emitter At Location<ul>
<li>EmitterTemplate &#x3D; P_RocketLauncher_Explosion_01</li>
<li>HitLocation</li>
</ul>
</li>
<li>Spawn Sound at Location<ul>
<li>Sound RocketLauncher_Explosion_Cue</li>
<li>HitLocation</li>
<li>Attenuation Setting &#x3D; Explosion_att</li>
</ul>
</li>
<li>StaticMesh 的 Set Visibility<ul>
<li>false</li>
</ul>
</li>
</ul>
</li>
<li>创建 变量 DamageTiers S_DamageTiers<ul>
<li>默认值<ul>
<li>0 Metal</li>
<li>1 Stone</li>
<li>2 Wood</li>
</ul>
</li>
</ul>
</li>
<li>实现 API 方法 GetCanDamage<ul>
<li>DamageTiers &#x3D; 变量 DamageTiers</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_RocketLauncher</p>
<ul>
<li>创建 Event SpawnProjectileOnServer<ul>
<li>Inputs<ul>
<li>SpawnRotation Rotator</li>
</ul>
</li>
<li>将 MulticastProjectile Event 的 SpawnActor BP_RocketProjectile 逻辑移动到这里<ul>
<li>CharRef &#x3D; CharRef</li>
<li>Rotation &#x3D; 箭头 Arrow 的 Get World Rotation</li>
</ul>
</li>
</ul>
</li>
<li>编辑 Event SpawnProjectileOnServer<ul>
<li>调用 SpawnActor BP_RocketProjectile 传入 CharRef &#x3D; 变量 CharRef</li>
</ul>
</li>
</ul>
<h4 id="136-火箭发射器-装弹"><a href="#136-火箭发射器-装弹" class="headerlink" title="136 火箭发射器 装弹"></a>136 火箭发射器 装弹</h4><p>OPEN DT_Items</p>
<ul>
<li>编辑 76<ul>
<li>CurrAmmo 1</li>
<li>MaxAmmo 1</li>
</ul>
</li>
<li>增加 77<ul>
<li>77</li>
<li>1</li>
<li>ICON RocketsAmmo</li>
<li>Uncommon</li>
<li>IsStackable? true</li>
<li>100</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_RocketLauncher</p>
<ul>
<li>实现 API Event ReloadItemEvent 和 BP_TP_Rifle 的一样<ul>
<li>设置 变量 CharRef</li>
<li>Branch IsReloading?<ul>
<li>False<ul>
<li>设置 变量 CurrAmmo &#x3D; CurrAmmo</li>
<li>判断 <code>Event参数的 CharRef</code> 的 GetSurvivalCharRef 的 Get BPC Player Hotbar &#x3D;&gt; Items By Index(CharRef 的 HotbarIndex) Get &#x3D;&gt; Break &#x3D;&gt; CurrAmmo &lt; MaxAmmo<ul>
<li>True<ul>
<li><code>变量的 CharRef</code> 右键 有效获取 的 方法 GetSurvivalCharRef 的 Get BPC Player Inventory &#x3D;&gt; FindItem<ul>
<li>ItemToFind &#x3D; 75</li>
<li>Branch HasItem?<ul>
<li>True<ul>
<li>设置 变量 AmmoIndex &#x3D; Index</li>
<li>设置 变量 TotalAmmo &#x3D; ItemInfo Break &#x3D;&gt; ItemQuantity</li>
<li>Set IsReloading? &#x3D; true</li>
<li>播放 装弹 动画<ul>
<li><code>变量的 CharRef</code> 的 FirstPersonMontage<ul>
<li>RifleReload_Montage</li>
</ul>
</li>
<li><code>变量的 CharRef</code> 的 ThirdPersonMontage<ul>
<li>RifleReload_Montage</li>
</ul>
</li>
<li><code>变量的 CharRef</code> 的 ReloadWeaponOnClient</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>实现 API Event EndAnimation 和 BP_TP_Rifle 的一样<ul>
<li>Branch IsReloading?<ul>
<li>True<ul>
<li>Set IsReloading? &#x3D; false</li>
<li>SubtractAmmo<ul>
<li>Amount &#x3D; 1</li>
</ul>
</li>
<li>SetItemDurabilityOnServer<ul>
<li>AmountToSubtract &#x3D; 10</li>
</ul>
</li>
<li>Get Controller 的 SurvivalGamePCRef 的 UpdateItemSlot<ul>
<li>PlayerHotbar</li>
<li>HotbarIndex</li>
<li>Struct Out</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>T 键<ul>
<li>ID 77 76 13 11</li>
<li>数量都是 1</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>按T获得火箭发射器，按1持枪，按鼠标左键发射火箭</li>
<li>按 R 键装弹，装弹完成</li>
<li>没有弹药 无法装弹</li>
</ol>
<h4 id="137-增加弓"><a href="#137-增加弓" class="headerlink" title="137 增加弓"></a>137 增加弓</h4><p>导入课件资源</p>
<p>创建 弓资源文件夹 In _Main&#x2F;Meshes&#x2F;Equipable&#x2F;Bow  进入 Bow<br>导入 SK_Bow.FBX 不选择网格<br>删除文件 SK_Box_Anim<br>导入 BowAnim.FBX 选择网格 SK_Bow_Skeleton<br>导入 SK_Arrow.fbx 不用设置<br>创建 弓材质文件夹 Materials In <em>Main&#x2F;Meshes&#x2F;Equipable&#x2F;Bow<br>导入 四个 T</em> 开头的材质文件 In Materials</p>
<p>创建 材质文件 M_Bow<br>OPEN M_Bow</p>
<ul>
<li>拖入 四个 T_ 开头的材质文件<ul>
<li>上下排列<ul>
<li>T_Centaur_Gear_BaseColor<ul>
<li>RGB 连接 材质的 Base Color 含义：基础颜色</li>
</ul>
</li>
<li>T_Centaur_Gear_Specular<ul>
<li>RGB 连接 材质的 Specular 含义：高光</li>
</ul>
</li>
<li>T_Centaur_Gear_OcclusionRoughnessMetallic<ul>
<li>R 连接 材质的 Ambient Occlusion 含义：环境光遮蔽</li>
<li>G 连接 材质的 Roughness 含义：粗糙度</li>
<li>B 连接 材质的 Metallic 含义：金属度</li>
</ul>
</li>
<li>T_Centaur_Gear_nml<ul>
<li>RGB 连接 材质的 Normal</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN SK_Bow</p>
<ul>
<li>设置 材质槽<ul>
<li>选择 M_Bow</li>
</ul>
</li>
</ul>
<p>OPEN SM_Arrow</p>
<ul>
<li>设置 材质槽<ul>
<li>选择 M_Bow</li>
</ul>
</li>
</ul>
<p>创建 动画 混合空间 Rename:FP_BowBS In Man&#x2F;Animations 选择 UE4_Mannequin_Skeleton</p>
<ul>
<li>详情<ul>
<li>水平 Axis<ul>
<li>Name:Speed</li>
<li>Max Axis Value: 800</li>
</ul>
</li>
</ul>
</li>
<li>Bow_Idle 拖入动画<ul>
<li>0 0</li>
</ul>
</li>
<li>Bow_Walk 拖入动画<ul>
<li>600 0</li>
</ul>
</li>
<li>Bow_Run 拖入动画<ul>
<li>800 0</li>
</ul>
</li>
</ul>
<p>OPEN UE4_Mannequin_Skeleton</p>
<ul>
<li>创建 套接字<ul>
<li>选中 thumb_01_r</li>
<li>移除所有附加资产</li>
<li>预览动画 Bow_Idle</li>
<li>选中 hand_l<ul>
<li>增加套接字<ul>
<li>BowSocket</li>
<li>预览资产 SK_Bow</li>
<li>变换<ul>
<li>9.75 -3.4 -0.33</li>
<li>-110 -0.86 -109.29</li>
<li>1 1 1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN FirstPerson_AnimBP</p>
<ul>
<li>new State Machine<ul>
<li>Idle 可以复制 Rifle Pose<ul>
<li>右键 增加 Blend Poses 增加 Bow Pose <ul>
<li>FP_BowBS<ul>
<li>Speed</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN ThirdPerson_AnimBP</p>
<ul>
<li>new State Machine<ul>
<li>Idle 可以复制 Rifle Pose<ul>
<li>右键 增加 Blend Poses 增加 Bow Pose<ul>
<li>FP_BowBS<ul>
<li>Speed</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN PlayerWindowAnimBP</p>
<ul>
<li>new State Machine<ul>
<li>Idle 可以复制 Rifle Pose<ul>
<li>右键 增加 Blend Poses 增加 Bow Pose<ul>
<li>FP_BowBS<ul>
<li>Speed</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建文件夹 Bow In _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipable&#x2F;WeaponRanged</p>
<p>进入文件夹 _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipable</p>
<ul>
<li>创建 子蓝图 BP_TP_Bow 继承于 BP_ThirdPersonEquipable 放入 Bow 文件夹中</li>
<li>创建 子蓝图 BP_FP_Bow 继承于 BP_FirstPersonEquipable 放入 Bow 文件夹中</li>
</ul>
<p>OPEN BP_TP_Bow</p>
<ul>
<li>类默认设置<ul>
<li>EquipableInfo<ul>
<li>SocketName &#x3D; BowSocket</li>
<li>AnimationState &#x3D; Bow</li>
<li>FirstPersonEquipClass &#x3D; BP_FP_Bow</li>
</ul>
</li>
</ul>
</li>
<li>增加 骨骼网格体 组件 Rename:BowMesh<ul>
<li>骨骼网格体 Static Mesh &#x3D; SK_Bow</li>
<li>OwnerNoSee</li>
</ul>
</li>
</ul>
<p>OPEN BP_FP_Bow</p>
<ul>
<li>增加 骨骼网格体 组件 Rename:BowMesh<ul>
<li>骨骼网格体 Static Mesh &#x3D; SK_Bow</li>
</ul>
</li>
</ul>
<p>OPEN DT_Items</p>
<ul>
<li>增加 78<ul>
<li>78</li>
<li>1</li>
<li>ICON Bow</li>
<li>Bow</li>
<li>…</li>
<li>ItemRarity Rare</li>
<li>HP 100 100</li>
<li>ItemType Equipable</li>
<li>ItemClassRef BP_TP_Bow</li>
<li>UseAmmo? True</li>
<li>MaxAmmo 1</li>
<li>CurrAmmo 1</li>
</ul>
</li>
</ul>
<p>OPEN BP_FirstPersonCharacter</p>
<ul>
<li>T 键<ul>
<li>ID 78</li>
<li>数量 1</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>按T获得弓</li>
<li>玩家2能看到玩家1拿着弓，并且角色走动正常</li>
</ol>
<h4 id="138-弓射击"><a href="#138-弓射击" class="headerlink" title="138 弓射击"></a>138 弓射击</h4><p>OPEN SK_Bow</p>
<ul>
<li>选择 Bone_002<ul>
<li>增加 套接字<ul>
<li>ArrowSocket<ul>
<li>预览资产 SM_Arrow</li>
<li>变换<ul>
<li>-2.5 22.39 -9.52</li>
<li>0 0 10</li>
<li>1 1 1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建 拉弓动画蒙太奇 Rename:Bow_Draw_Montage By Bow_Draw</p>
<ul>
<li>选择 Default 行 右键 新增 蒙太奇片段 End 移动到最后<ul>
<li>点击 Clear <ul>
<li>将 片段 End 的 下个片段 设置成 End</li>
<li>将 片段 Default 的 下个片段 设置成 End</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>创建 拉弓动画蒙太奇 Rename:Bow_Shoot_Montage By Bow_Shoot</p>
<p>创建蓝图类 Actor Rename：BP_ArrowProjectile Bow In _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipable&#x2F;WeaponRanged&#x2F;Bow</p>
<ul>
<li>类默认设置<ul>
<li>可复制</li>
</ul>
</li>
<li>创建 Sphere Collision 组件 Rename:Sphere 并且将 Sphere 放到最外层<ul>
<li>碰撞预设 <ul>
<li>自定义<ul>
<li>Object Type &#x3D; Projectile</li>
<li>Structure 阻止</li>
</ul>
</li>
</ul>
</li>
<li>创建 静态网格体 组件 Rename:ArrowMesh<ul>
<li>静态网格体 Static Mesh &#x3D; SM_Arrow</li>
<li>变换<ul>
<li>旋转 0 0 -90</li>
</ul>
</li>
<li>碰撞预设<ul>
<li>NoCollision</li>
</ul>
</li>
</ul>
</li>
<li>创建 发射物移动 Projectile Movement 组件 Rename:ProjectileMovement<ul>
<li>Initial Speed 4000</li>
<li>Max Speed 4000</li>
<li>Projectile Gravity Scale 0.3</li>
<li>Velocity 4000 0 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Bow 和 BP_FP_Bow</p>
<ul>
<li>骨骼网格体<ul>
<li>增加 静态网格体 组件 Rename:GongJianMesh<ul>
<li>静态网格 SM_Arrow</li>
<li>父 Socket &#x3D; ArrowSocket</li>
<li>碰撞预设<ul>
<li>NoCollision</li>
</ul>
</li>
<li>Owner No See &#x3D; true</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_FP_Bow</p>
<ul>
<li>创建 Event HideArrow 隐藏箭<ul>
<li>Inputs<ul>
<li>NewVisibility Boolean</li>
</ul>
</li>
<li>静态网格 GongJianMesh 的 Set Visibility<ul>
<li>NewVisibility</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Bow</p>
<ul>
<li>实现 API Event StopLeftMouseLoop<ul>
<li>判断 IsFiring?<ul>
<li>True<ul>
<li>CharRef 的 CameraOnClient</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>实现 API Event UseItemInterface 可以复制 BP_TP_Rifle 的<ul>
<li>CharRef 的 FireFirstPersonEquippedItemAnim</li>
</ul>
</li>
<li>创建 Event GetCameraRotationOnClient 可以复制 BP_TP_Rifle 的 GetCameraRotation<ul>
<li>FireOnServer</li>
</ul>
</li>
<li>创建 Event FireOnServer 他这里 扣减了 Slot<ul>
<li>Inputs<ul>
<li>Rotation</li>
</ul>
</li>
<li>设置 变量 PlayerCameraRotation &#x3D; Rotation</li>
<li>FireOnClient</li>
<li>CharRef 的 First Person Montage<ul>
<li>Bow_Shoot_Montage</li>
</ul>
</li>
<li>CharRef 的 Third Person Montage<ul>
<li>Bow_Shoot_Montage</li>
</ul>
</li>
<li>DrawMultiCast</li>
<li>SpawnActor BP_ArrowProjectile<ul>
<li>Transform<ul>
<li>Location &#x3D; GongJianMesh 的 Get World Location</li>
</ul>
</li>
<li>CharRef &#x3D; 参数 CharRef</li>
</ul>
</li>
<li>Set IsFiring? &#x3D; false</li>
</ul>
</li>
<li>创建 Event FireFirstPersonEquippedItemAnim 可以复制 BP_TP_Rifle 的<ul>
<li>cast BP_FP_Bow 的 BowMesh 的 Play Animation<ul>
<li>Bow_Draw</li>
</ul>
</li>
<li>文件 BowAnim</li>
<li>武器的 HideArrow 方法<ul>
<li>NewVisibility &#x3D; True</li>
</ul>
</li>
</ul>
</li>
<li>创建 Event DrawMultiCast<ul>
<li>BowMesh 的 Play Animation<ul>
<li>BowAnim</li>
</ul>
</li>
<li>GongJianMesh 的 Set Visibility<ul>
<li>true</li>
</ul>
</li>
</ul>
</li>
<li>FireOnClient<ul>
<li>Inputs<ul>
<li>CharRef BP_FirstPersonCharacter</li>
</ul>
</li>
<li>参数 CharRef 的 Get First Person Equipped Item &#x3D;&gt; Cast To BP_FP_Bow 的 BowMesh 的 Player Animation<ul>
<li>BowAnim</li>
</ul>
</li>
<li>参数 CharRef 的 Get First Person Equipped Item &#x3D;&gt; Cast To BP_FP_Bow 的 BowMesh 的 HiddArrow<ul>
<li>true</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>测试：</p>
<ol>
<li>按T获得弓，按1持枪，按鼠标左键发射箭</li>
<li>弓发射出去后卡住，碰撞体有问题</li>
</ol>
<p>OPEN BP_ArrowProjectile</p>
<ul>
<li>Sphere<ul>
<li>缩放 0.5 0.5 0.5</li>
<li>Radius 16</li>
</ul>
</li>
<li>ArrowMesh<ul>
<li>缩放 3 1.5 3</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Bow</p>
<ul>
<li>SpawnActor BP_ArrowProjectile<ul>
<li>Transform<ul>
<li>Location &#x3D; 改为：ArrowMesh 的 Get World Location &#x3D;&gt; Break Vector &#x3D;&gt; X Y 都加 50 然后 Make Vector</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="139-设置弓-碰撞物体产生伤害"><a href="#139-设置弓-碰撞物体产生伤害" class="headerlink" title="139 设置弓 碰撞物体产生伤害"></a>139 设置弓 碰撞物体产生伤害</h4><p>OPEN BP_ArrowProjectile</p>
<ul>
<li>类默认设置 <ul>
<li>Actor<ul>
<li>Initial Life Span 5 含义：初始生命周期</li>
</ul>
</li>
</ul>
</li>
<li>设置 变量 CharRef BP_FirstPersonCharacter<ul>
<li>公开</li>
<li>可编辑实例</li>
</ul>
</li>
<li>创建 内置 EventHit<ul>
<li>Do Once</li>
<li>参数 Other &#x3D;&gt; Actor Has Tag<ul>
<li>Tag &#x3D; Damageable</li>
<li>Branch 结果<ul>
<li>True<ul>
<li>Attach Actor to Actor<ul>
<li>Target &#x3D; Self</li>
<li>ParentActor &#x3D; Other</li>
<li>Location Rule &#x3D; Keep World 含义：位置规则&#x3D;保持世界</li>
<li>Rotation Rule &#x3D; Keep World</li>
<li>Scale Rule &#x3D; Keep World</li>
<li>Weld Simulated Bodies &#x3D; true</li>
</ul>
</li>
<li>Sphere 的 Set Collision Response To Channel<ul>
<li>Channel &#x3D; Pawn</li>
<li>New Response &#x3D; Overlap</li>
</ul>
</li>
<li>设置 变量 ArrowLocation &#x3D; Arrow 的 Get World Location</li>
<li>Line Trace By Channel<ul>
<li>创建 变量 TraceDistance float Default 100</li>
<li>Start &#x3D; ArrowLocation</li>
<li>End &#x3D; ArrowLocation + (Get Actor Forward Vector * 变量 TraceDistance)</li>
<li>Channel &#x3D; 摄像头</li>
<li>TraceComplex &#x3D; True</li>
<li>Draw Debug Type &#x3D; 持久</li>
<li>Actors To Ignore &#x3D; Make Array &#x3D;&gt; Self</li>
<li>Branch 结果<ul>
<li>True<ul>
<li>Branch 结果 的 Break Hit Actor &#x3D;&gt; Actor Has Tag<ul>
<li>Tag &#x3D; Damageable<ul>
<li>方法 ApplyDamage<ul>
<li>DamagedActor &#x3D; HitActor</li>
<li>HitInfo &#x3D; OutHit</li>
<li>SurfaceHit &#x3D; PhysMat 的 SurfaceType</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>创建 方法 ApplyDamage 和 BP_TP_Rifle 的一样<ul>
<li>不同点：<ul>
<li>这个方法用的 ApplyPointDamage 而不是 ApplyDamage<ul>
<li>Hit from Direction &#x3D; ArrowLocation - Other</li>
</ul>
</li>
</ul>
</li>
<li>Inputs<ul>
<li>DamagedActor Actor</li>
<li>HitInfo HitResult</li>
<li>SurfaceHit EPhysicalSurface</li>
</ul>
</li>
<li>创建 变量 DamageMultiplier(伤害倍数) 默认值 0.03</li>
<li>创建 变量 ItemDamage(伤害) 默认值 100</li>
<li>设置 局部变量 PSurfaceHit 并且打印 print String</li>
<li>设置 局部变量 LocalDamagedActor</li>
<li>设置 局部变量 LocalDamage &#x3D; ItemDamage * DamageMultiplier</li>
<li>Branch DamagedActor &#x3D;&gt; Actor Has Tag(Player)<ul>
<li>True<ul>
<li>…</li>
</ul>
</li>
<li>False<ul>
<li>ApplyPointDamage Comment:对AI或者除玩家之外的任何东西造成伤害<ul>
<li>DamagedActor &#x3D; LocalDamagedActor</li>
<li>BaseDamage &#x3D; LocalDamage</li>
<li>Hit from Direction &#x3D; ArrowLocation</li>
<li>HitInfo &#x3D; 参数 HitInfo</li>
<li>Event Instigator &#x3D; null 不需要</li>
<li>Damage Causer &#x3D; Self</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_TP_Bow</p>
<ul>
<li>编辑 内置 FireOnServer<ul>
<li>SpawnActor BP_ArrowProjectile<ul>
<li>CharRef &#x3D; CharRef</li>
<li>Location 修改成 CharRef 的 Get Arrow1 的 Get World Location</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>粒子效果<br>创建文件夹 _Main&#x2F;Blueprints&#x2F;Items&#x2F;Equipable&#x2F;WeaponRanged&#x2F;Bow&#x2F;BowTrail<br>创建 材质 Rename:M_Trail</p>
<ul>
<li>Blend Model &#x3D; Translucent 含义：混合模式&#x3D;半透明</li>
<li>Shading Model &#x3D; Unlit 含义：着色模型&#x3D;未照明</li>
<li>Texture Coordinate<ul>
<li>UTiling 0.1  U平铺</li>
<li>Panner<ul>
<li>Speed -1</li>
</ul>
</li>
<li>Texture Sample<ul>
<li>Texture &#x3D; T_Noise01</li>
<li>RGB 连接 Multiply 的 A</li>
</ul>
</li>
</ul>
</li>
<li>RadialGradientExponential<ul>
<li>Return 连接 Multiply 的 B</li>
</ul>
</li>
<li>Power(X,2)<ul>
<li>Base &#x3D; Multiply</li>
</ul>
</li>
<li>Multiply 连接 Opacity<ul>
<li>A &#x3D; Particle Color 粒子</li>
<li>B &#x3D; Power</li>
</ul>
</li>
<li>Particle Color <ul>
<li>第一个 连接 自发光颜色</li>
<li>最后一个 连接 Multiply 的 A</li>
</ul>
</li>
</ul>
<p><img src="/blog/p/614a8811/M_Trail.png" alt="M_Trail.png"></p>
<p>创建 Niagara 系统 添加 Simple Sprite Burst 含义：简单精灵爆发 Rename:NS_BowTrail</p>
<ul>
<li>详情<ul>
<li>LiftCycle<ul>
<li>Loop Behavior &#x3D; Infinite 含义：循环行为&#x3D;无限</li>
<li>Loop Duration &#x3D; 10 含义：循环持续时间</li>
</ul>
</li>
<li>Spawn Burst Instantaneous<ul>
<li>Count &#x3D; 100 含义：数量</li>
<li>Spawn Rate &#x3D; 0 含义：生成速率</li>
</ul>
</li>
<li>Sprite Rendering 精灵渲染<ul>
<li>Material &#x3D; M_Trail</li>
</ul>
</li>
<li>Ribbon Attributes 条带属性<ul>
<li>Ribbon Width Mode &#x3D; Direct Set</li>
<li>Ribbon Width &#x3D; 20</li>
</ul>
</li>
</ul>
</li>
<li>SimpleSpriteBurst 图表<ul>
<li>发射器 Emitter Update +<ul>
<li>Spawn Rate<ul>
<li>Spawn Rate &#x3D; 100</li>
</ul>
</li>
</ul>
</li>
<li>Particle Spawn 粒子生成<ul>
<li>Point Attributes<ul>
<li>Initial Mode<ul>
<li>Lifttime &#x3D; 1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>渲染 Renderer <ul>
<li>删除 Sprite Renderer</li>
<li>增加<ul>
<li>Ribbon Renderer 条带渲染器<ul>
<li>Material &#x3D; M_Trail</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>OPEN BP_ArrowProjectile</p>
<ul>
<li>增加 Niagara Particle System 组件 Rename:NS_BowTrail<ul>
<li>System &#x3D; NS_BowTrail</li>
<li>变换<ul>
<li>-24.869 0 0</li>
<li>0 0 90</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="140-弓-装弹"><a href="#140-弓-装弹" class="headerlink" title="140 弓 装弹"></a>140 弓 装弹</h4><p>OPEN DT_Items</p>
<ul>
<li>增加 79<ul>
<li>79</li>
<li>1</li>
<li>ICON arrow</li>
<li>Arrow</li>
<li>…</li>
<li>ItemRarity Common</li>
<li>HP 100 100</li>
<li>ItemType Equipable</li>
<li>ItemClassRef BP_ArrowProjectile</li>
<li>UseAmmo? True</li>
<li>MaxAmmo 1</li>
<li>CurrAmmo 1</li>
</ul>
</li>
</ul>
<p>遗留的问题：</p>
<ol>
<li>按1持枪 某些情况下 取消持枪后，再次持枪提示已经持枪</li>
</ol>
<h3 id="第11章"><a href="#第11章" class="headerlink" title="第11章"></a>第11章</h3><p>创建部落&#x2F;氏族系统</p>
<h3 id="第12章-创建社会系统"><a href="#第12章-创建社会系统" class="headerlink" title="第12章 创建社会系统"></a>第12章 创建社会系统</h3><h3 id="第13章-创建开放世界地图"><a href="#第13章-创建开放世界地图" class="headerlink" title="第13章 创建开放世界地图"></a>第13章 创建开放世界地图</h3><h4 id="将项目从-5-0-更新到-5-2"><a href="#将项目从-5-0-更新到-5-2" class="headerlink" title="将项目从 5.0 更新到 5.2"></a>将项目从 5.0 更新到 5.2</h4><p>需要更新 Plugins&#x2F;AdvanceSessions </p>
<ul>
<li>去官网下载 vreue4.com&#x2F;advanced-sessions-binaries</li>
<li>选择 5-2-0版本 下载地址是：drive.google.com 开头的地址</li>
</ul>
<p>删除原来的，导入新的文件到 Plugins&#x2F;AdvanceSessions 目录中</p>
<p>编辑 SurvivalCraft.uproject 右键 Switch Unreal Engine version … 选择 5.2.0</p>
<ul>
<li>可以双击打开了</li>
<li>如果有提示，则需要解决 提示文件不同版本的问题</li>
</ul>
<p>问题1：Project Setting 搜索 sm6 勾选，重启<br>如果有其他问题，依次解决</p>
<h3 id="第14章-多生物群落-程序树叶"><a href="#第14章-多生物群落-程序树叶" class="headerlink" title="第14章 多生物群落&#x2F;程序树叶"></a>第14章 多生物群落&#x2F;程序树叶</h3><h3 id="第15章-人工智能系统"><a href="#第15章-人工智能系统" class="headerlink" title="第15章 人工智能系统"></a>第15章 人工智能系统</h3><h3 id="第16章-程序区"><a href="#第16章-程序区" class="headerlink" title="第16章 程序区"></a>第16章 程序区</h3><h3 id="第17章-玩家小地图"><a href="#第17章-玩家小地图" class="headerlink" title="第17章 玩家小地图"></a>第17章 玩家小地图</h3><h3 id="第18章-保存-加载系统"><a href="#第18章-保存-加载系统" class="headerlink" title="第18章 保存&#x2F;加载系统"></a>第18章 保存&#x2F;加载系统</h3><h3 id="第19章-Steam-会话-前端小控件"><a href="#第19章-Steam-会话-前端小控件" class="headerlink" title="第19章 Steam 会话&#x2F;前端小控件"></a>第19章 Steam 会话&#x2F;前端小控件</h3><h3 id="第20章-专用服务器设置和托管"><a href="#第20章-专用服务器设置和托管" class="headerlink" title="第20章 专用服务器设置和托管"></a>第20章 专用服务器设置和托管</h3><h4 id="232"><a href="#232" class="headerlink" title="232"></a>232</h4><p>修复bug，先不处理</p>
<h4 id="233-加载播放器错误修复"><a href="#233-加载播放器错误修复" class="headerlink" title="233 加载播放器错误修复"></a>233 加载播放器错误修复</h4><h4 id="234-游戏实例和主机会话"><a href="#234-游戏实例和主机会话" class="headerlink" title="234 游戏实例和主机会话"></a>234 游戏实例和主机会话</h4><p>关闭UE4Editor.exe</p>
<p>打开目录</p>
<p>文档连接 docs.unrealengine.com&#x2F;4.26&#x2F;zh-CN&#x2F;ProgrammingAndScripting&#x2F;Online&#x2F;Steam&#x2F;<br>找到 专用服务器设置和托管设置 Finished Settings 的 DefaultEngine.ini<br>OPEN DefaultEngine.ini，最下方添加</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[/Script/Engine.GameEngine]</span><br><span class="line">+NetDriverDefinitions=(<span class="attribute">DefName</span>=<span class="string">&quot;GameNetDriver&quot;</span>,DriverClassName=&quot;OnlineSubsystemSteam.SteamNetDriver&quot;,DriverClassNameFallback=&quot;OnlineSubsystemUtils.IpNetDriver&quot;)</span><br><span class="line"></span><br><span class="line">[OnlineSubsystem]</span><br><span class="line"><span class="attribute">DefaultPlatformService</span>=Steam</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将源文件上方的OnlineSubsystemSteam删掉</span></span><br><span class="line">[OnlineSubsystemSteam]</span><br><span class="line"><span class="attribute">bEnabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attribute">SteamDevAppId</span>=480 # 测试APPID</span><br><span class="line"><span class="attribute">bHasVoiceEnabled</span>=<span class="literal">true</span> # 复制上方的 开启语音</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将源文件的内容复制到这</span></span><br><span class="line">[Voice]</span><br><span class="line"><span class="attribute">bEnabled</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[/Script/OnlineSubsystemSteam.SteamNetDriver]</span><br><span class="line"><span class="attribute">NetConnectionClassName</span>=<span class="string">&quot;OnlineSubsystemSteam.SteamNetConnection&quot;</span></span><br></pre></td></tr></table></figure>
<p>启动项目</p>
<p>File -&gt; Recent Levels -&gt; MainMenu</p>
<p>以独立模式运行网络模式<br>Run -&gt; Net Mode -&gt; Play Standalone</p>
<p>运行后可以查看到 MainMenu，但是没有Steam窗口叠加</p>
<p>打开 Steam, 创建新账户</p>
<p>Run -&gt; Standalone Game 新的编辑窗口运行独立游戏<br>运行后 可以看到 Steam 窗口叠加</p>
<h5 id="设置-托管逻辑"><a href="#设置-托管逻辑" class="headerlink" title="设置 托管逻辑"></a>设置 托管逻辑</h5><p>创建 蓝图类 游戏实例类[SurvivalGameInstance] 在 _Main&#x2F;Blueprints&#x2F;GameModels,搜索 GameInstance<br>这个实例，会在游戏启动的时候一直加载，直到游戏结束，并且项目中只有一个实例</p>
<p>在项目设置中 搜索 游戏实例 选择 SurvivalGameInstance</p>
<p>OPEN SurvivalGameInstance</p>
<ul>
<li>创建 会话逻辑</li>
<li>创建 事件 Event Init<ul>
<li>Delay 2S</li>
<li>Create Advanced Session<ul>
<li>额外设置 Extra Setting &#x3D;&gt; Make Array<ul>
<li>Make Literal Session Property String<ul>
<li>Key &#x3D;&gt; “ServerName”</li>
<li>Value &#x3D;&gt; “生存游戏 959554xxx房间”</li>
<li>这里回到 W_ServerBrowser 中的 W_ServerSlot 的 展示了 ServerName</li>
<li>OPEN W_ServerSlot<ul>
<li>Event Construct<ul>
<li>ServerName &#x3D;&gt; Set Text &#x3D;&gt; ServerName</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Make Literal Session Property String<ul>
<li>Key &#x3D;&gt; “ServerMap”</li>
<li>Value &#x3D;&gt; 在前面调用 Get Current Level Name 的 Return Value 连接 Value</li>
</ul>
</li>
</ul>
</li>
<li>公共连接数 &#x3D;&gt; 100</li>
<li>私有连接数 &#x3D;&gt; 0</li>
<li>允许邀请</li>
<li>Is Dedicated Server &#x3D;&gt; true</li>
<li>Use Presence &#x3D;&gt; false 专用服务器不需要</li>
<li>其他 默认值</li>
</ul>
</li>
</ul>
</li>
<li>设置 托管服务器</li>
</ul>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>创建快捷方式 在开发模式下 运行，使用端口转发</p>
<ul>
<li>将 Steam 的端口 转发给 服务器</li>
</ul>
<h3 id="第21章"><a href="#第21章" class="headerlink" title="第21章"></a>第21章</h3><p>其他</p>
<h3 id="结构补充"><a href="#结构补充" class="headerlink" title="结构补充"></a>结构补充</h3><p>BPI_SurvivalGamePC</p>
<ul>
<li>GetSurvivalGamePCRef 留给子类实现</li>
</ul>
<p>SurvivalGamePC 继承了 BPI_SurvivalGamePC</p>
<ul>
<li>GetSurvivalGamePCRef 返回了自己</li>
<li>构造函数<ul>
<li>服务端 print 输出 Authority [当前角色拥有网络所有权（通常是服务器角色）]</li>
<li>客户端 创建 W_MainWidget 控件，添加到游戏窗口</li>
</ul>
</li>
</ul>
<p>重点：</p>
<ul>
<li>BP_FirstPersonCharacter 可以通过 <code>获取控制器 (目标是Pawn)</code> &#x3D;&gt; <code>SurvivalGamePC Ref (目标是BPI_SurvivalGamePC)</code> 控件的 Event.</li>
<li>BP_FirstPersonCharacter 可以通过 <code>获取玩家控制器</code> &#x3D;&gt; <code>SurvivalGamePC Ref (目标是Survival_GamePC)</code> 控件的 Event.</li>
<li>控件 可以通过 <code>获取拥有玩家pawn</code> &#x3D;&gt; <code>Get Survival Character Ref</code> 调用 SurvivalGamePC 的 Event.</li>
<li>控件 可以通过 <code>获取拥有玩家角色</code> &#x3D;&gt; <code>Get Survival Character Ref</code> 调用 BP_FirstPersonCharacter 的 Event.</li>
</ul>
<h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><p>单词：<br>Actor<br>Inventory 背包<br>widget 小控件<br>Hotbar 快捷栏<br>Hatchet 斧头<br>Harvest 收获<br>Specific 特定的<br>Harvestable 可收获的<br>Large 大的</p>
<ul>
<li>树</li>
<li>石头<br>Ground 地面</li>
<li>草</li>
<li>灌木<br>Damage 伤害</li>
</ul>
<p>Overlap 重叠</p>
<p>对象使用 Break 拆分<br>枚举使用 Switch on Enum 判断<br>控件 的 方法体中 中 获取父级组件的方法 通过</p>
<ul>
<li>Get Owning Player -&gt; Survival Game PCRef -&gt; MainWidgetRef -&gt;  W_Inventory -&gt; W_CraftingWindow<br>但是在 W_CraftingWindow 中 … 这一行可以删除</li>
</ul>
<p>用户控件 滚动框 增加子控件 用 <code>Add Child</code></p>
<h2 id="设计一款游戏"><a href="#设计一款游戏" class="headerlink" title="设计一款游戏"></a>设计一款游戏</h2><h3 id="Common"><a href="#Common" class="headerlink" title="Common"></a>Common</h3><p>登录界面</p>
<ul>
<li>登录方式<ul>
<li>微信</li>
<li>Steam</li>
<li>账号密码</li>
<li>手机号</li>
<li>游客</li>
<li>邮箱</li>
</ul>
</li>
</ul>
<p>物品</p>
<ul>
<li>装备</li>
<li>武器</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/p/c8a4b253/" rel="prev" title="Unity">
                  <i class="fa fa-chevron-left"></i> Unity
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/p/614a8113/" rel="next" title="AI大模型">
                  AI大模型 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿尤</span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/blog/js/third-party/search/local-search.js"></script>





  





</body>
</html>
