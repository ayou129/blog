<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#42b983"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog/public/index.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/public/index.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/public/index.ico">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#42b983">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ayou129.github.io","root":"/blog/","images":"/blog/images","scheme":"Muse","darkmode":false,"version":"8.14.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":"flat","style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/blog/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog/js/config.js"></script>

    <meta name="description" content="学习Mysql">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql">
<meta property="og:url" content="https://ayou129.github.io/blog/p/e4d2e8fb/index.html">
<meta property="og:site_name" content="阿尤">
<meta property="og:description" content="学习Mysql">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/rpm%E5%8D%B8%E8%BD%BDmariadb.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/mysql_safe_error.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/Mysql%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/Mysql%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/Mysql%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%B8%B8%E7%94%A8%E5%AD%97%E7%AC%A6%E5%8C%B9%E9%85%8D%E5%88%97%E8%A1%A8.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/mysql%E5%AD%97%E7%AC%A6%E9%9B%86.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5%E6%98%AF%E5%90%A6%E5%B7%B2%E6%9C%80%E4%BC%98explain.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/sql%E6%94%B9%E5%86%99join.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/sql%E6%94%B9%E5%86%99join-2.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/sql%E6%94%B9%E5%86%99%E5%88%86%E9%A1%B5%E7%BB%9F%E8%AE%A1.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/sql%E6%94%B9%E5%86%99%E5%88%86%E9%A1%B5%E7%BB%9F%E8%AE%A1-2.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E9%94%81%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%81%9ADDL%E6%97%B6%E6%98%AF%E5%90%A6%E4%BC%9A%E9%94%81%E8%A1%A8.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E7%9A%84%E4%BD%BF%E7%94%A8%E7%9A%84%E8%A7%84%E8%8C%83%E5%92%8C%E5%BB%BA%E8%AE%AE-01.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E7%9A%84%E4%BD%BF%E7%94%A8%E7%9A%84%E8%A7%84%E8%8C%83%E5%92%8C%E5%BB%BA%E8%AE%AE-02.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E4%BC%98%E5%8C%96%E7%9B%AE%E6%A0%87%EF%BC%9A%E9%92%88%E5%AF%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B5%84%E6%BA%90%E5%8E%BB%E8%A7%A3%E5%86%B3.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E4%BC%98%E5%8C%96%E6%89%8B%E6%AE%B5.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/set_profiling_1.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/show_profiles.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/show_profile_for_query.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/explain_and_desc.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/B+Tree%E7%B4%A2%E5%BC%95.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/InnodbTable.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E7%B4%A2%E5%BC%95%E6%A3%80%E7%B4%A2%E8%BF%87%E7%A8%8B.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E7%A4%BA%E4%BE%8B.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92explain.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E4%BC%98%E5%8C%96%E5%99%A8%E5%BC%80%E5%85%B3show_variables.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/Condition_Or_And.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/Nested-Loop.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%85%B3%E8%81%94%E5%AD%97%E6%AE%B5%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7-%E6%A1%88%E4%BE%8B.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%85%B3%E8%81%94%E5%AD%97%E6%AE%B5%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7-%E6%A1%88%E4%BE%8B02.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%8E%9F%E5%88%99-%E6%A1%88%E4%BE%8B03.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%8E%9F%E5%88%992.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%8E%9F%E5%88%993.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/MGR%E7%A4%BA%E4%BE%8B.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%8D%95%E4%B8%BB%E6%A8%A1%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%8E%9F%E7%90%86%E6%B5%81%E7%A8%8B%E5%9B%BE.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%A4%9A%E4%B8%BB%E6%A8%A1%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%8E%9F%E7%90%86%E6%B5%81%E7%A8%8B%E5%9B%BE.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E4%B8%A2%E5%A4%B1%E4%BF%AE%E6%94%B9.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E8%AF%BB%E8%84%8F%E6%95%B0%E6%8D%AE.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%B9%BB%E8%AF%BB.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E9%94%81%E7%9A%84%E5%85%BC%E5%AE%B9%E5%85%B3%E7%B3%BB.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/%E5%90%84%E7%A7%8D%E9%94%81%E7%9A%84%E5%85%BC%E5%AE%B9%E5%85%B3%E7%B3%BB.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/zhucongfuzhi.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/duxiefenliproxy.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/Mysql%E5%BC%80%E5%90%AF%E5%8F%8C%E4%B8%BB%E7%83%AD%E5%A4%87.png">
<meta property="og:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/Mysql%E5%BC%80%E5%90%AF%E5%8F%8C%E4%B8%BB%E7%83%AD%E5%A4%87_%E4%BA%92%E4%B8%BA%E4%B8%BB%E4%BB%8E.png">
<meta property="article:published_time" content="2018-06-02T09:01:31.000Z">
<meta property="article:modified_time" content="2022-10-14T16:58:05.000Z">
<meta property="article:author" content="阿尤">
<meta property="article:tag" content="Mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ayou129.github.io/blog/p/e4d2e8fb/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F.png">


<link rel="canonical" href="https://ayou129.github.io/blog/p/e4d2e8fb/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://ayou129.github.io/blog/p/e4d2e8fb/","path":"p/e4d2e8fb/","title":"Mysql"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Mysql | 阿尤</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<link rel="alternate" href="/blog/atom.xml" title="阿尤" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">
      <img class="custom-logo-image" src="/blog/uploads/%E9%98%BF%E5%B0%A4%E5%8A%A8%E6%BC%AB%E5%A4%B4.jpeg" alt="阿尤">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">阿尤</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">40</span></a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">2</span></a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">72</span></a></li><li class="menu-item menu-item-sitemap"><a href="/blog/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">1.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80"><span class="nav-number">1.1.</span> <span class="nav-text">数据库基础</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.1.1.</span> <span class="nav-text">什么是数据库?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E9%94%AE"><span class="nav-number">1.1.2.</span> <span class="nav-text">主键</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%80%E6%9C%AF%E6%9E%84%E6%88%90"><span class="nav-number">1.2.</span> <span class="nav-text">数据库技术构成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.2.1.</span> <span class="nav-text">数据库系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL%E8%AF%AD%E8%A8%80"><span class="nav-number">1.2.2.</span> <span class="nav-text">SQL语言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.2.3.</span> <span class="nav-text">数据库访问接口</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFMysql"><span class="nav-number">1.3.</span> <span class="nav-text">什么是Mysql</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mysql%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-number">1.3.1.</span> <span class="nav-text">Mysql的优势</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql-8-0%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7%E7%AE%80%E8%BF%B0"><span class="nav-number">1.4.</span> <span class="nav-text">Mysql 8.0的新特性简述</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">安装与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux-Centos7-%E5%AE%89%E8%A3%85Mysql"><span class="nav-number">2.1.</span> <span class="nav-text">Linux(Centos7)安装Mysql</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%89%8D%E9%A2%84%E5%87%86%E5%A4%87"><span class="nav-number">2.1.1.</span> <span class="nav-text">安装前预准备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85mysql%EF%BC%88%E4%B8%8B%E8%BD%BD%E6%BA%90%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%EF%BC%89"><span class="nav-number">2.1.2.</span> <span class="nav-text">安装mysql（下载源代码编译安装）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD"><span class="nav-number">2.1.3.</span> <span class="nav-text">数据库备份</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="nav-number">2.1.4.</span> <span class="nav-text">设置开机自启</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">2.1.5.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8MySQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.1.6.</span> <span class="nav-text">启动MySQL数据库</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%9B%BE%E5%BD%A2%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="nav-number">2.2.</span> <span class="nav-text">常用图形管理工具</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">3.</span> <span class="nav-text">数据库基本操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">4.</span> <span class="nav-text">数据表基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-number">4.1.</span> <span class="nav-text">字符集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">5.</span> <span class="nav-text">数据类型和运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.1.</span> <span class="nav-text">数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.1.1.</span> <span class="nav-text">整数类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">5.1.2.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.1.3.</span> <span class="nav-text">枚举类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.1.4.</span> <span class="nav-text">日期类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.1.5.</span> <span class="nav-text">如何选择数据类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">5.2.</span> <span class="nav-text">运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">5.2.1.</span> <span class="nav-text">算术运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">5.2.2.</span> <span class="nav-text">比较运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">5.2.3.</span> <span class="nav-text">逻辑运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BD%8D"><span class="nav-number">5.2.4.</span> <span class="nav-text">位运算符位</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">5.2.5.</span> <span class="nav-text">运算符的优先级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">5.2.6.</span> <span class="nav-text">运算符的基本使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">6.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="nav-number">6.1.</span> <span class="nav-text">数学函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-number">6.2.</span> <span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="nav-number">6.3.</span> <span class="nav-text">日期和时间函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E5%87%BD%E6%95%B0"><span class="nav-number">6.4.</span> <span class="nav-text">条件判断函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF%E5%87%BD%E6%95%B0"><span class="nav-number">6.5.</span> <span class="nav-text">系统信息函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="nav-number">6.6.</span> <span class="nav-text">其他函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="nav-number">7.</span> <span class="nav-text">查询数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="nav-number">7.1.</span> <span class="nav-text">基本查询语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.2.</span> <span class="nav-text">单表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E7%BB%84"><span class="nav-number">7.2.1.</span> <span class="nav-text">分组</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E5%90%88%E5%87%BD%E6%95%B0%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.3.</span> <span class="nav-text">集合函数查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#COUNT"><span class="nav-number">7.3.1.</span> <span class="nav-text">COUNT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SUM"><span class="nav-number">7.3.2.</span> <span class="nav-text">SUM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AVG"><span class="nav-number">7.3.3.</span> <span class="nav-text">AVG</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MAX"><span class="nav-number">7.3.4.</span> <span class="nav-text">MAX</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MIN"><span class="nav-number">7.3.5.</span> <span class="nav-text">MIN</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.4.</span> <span class="nav-text">连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5-%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5-INNER-JOIN"><span class="nav-number">7.4.1.</span> <span class="nav-text">内连接(等值连接) INNER JOIN</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="nav-number">7.4.2.</span> <span class="nav-text">外连接</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B7%A6%E8%BF%9E%E6%8E%A5-left-outer-join"><span class="nav-number">7.4.2.1.</span> <span class="nav-text">左连接(left (outer) join)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%B3%E8%BF%9E%E6%8E%A5-right-join"><span class="nav-number">7.4.2.2.</span> <span class="nav-text">右连接(right join)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%8D%E5%90%88%E6%9D%A1%E4%BB%B6%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.4.3.</span> <span class="nav-text">复合条件连接查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.</span> <span class="nav-text">子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%A6ANY%E3%80%81SOME%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.1.</span> <span class="nav-text">带ANY、SOME关键字的子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%A6ALL%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.2.</span> <span class="nav-text">带ALL关键字的子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%A6EXISTS%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.3.</span> <span class="nav-text">带EXISTS关键字的子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%A6IN%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.4.</span> <span class="nav-text">带IN关键字的子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%A6%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.5.</span> <span class="nav-text">带比较运算符的子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C"><span class="nav-number">7.5.6.</span> <span class="nav-text">合并查询结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="nav-number">7.5.7.</span> <span class="nav-text">使用正则表达式查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E4%BB%A5%E7%89%B9%E5%AE%9A%E5%AD%97%E7%AC%A6%E6%88%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BC%80%E5%A4%B4%E7%9A%84%E8%AE%B0%E5%BD%95%E5%AD%97%E7%AC%A6"><span class="nav-number">7.5.7.1.</span> <span class="nav-text">查询以特定字符或字符串开头的记录字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E4%BB%A5%E7%89%B9%E5%AE%9A%E5%AD%97%E7%AC%A6%E6%88%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BB%93%E5%B0%BE%E7%9A%84%E8%AE%B0%E5%BD%95%E5%AD%97%E7%AC%A6"><span class="nav-number">7.5.7.2.</span> <span class="nav-text">查询以特定字符或字符串结尾的记录字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%A8%E7%AC%A6%E5%8F%B7%E2%80%9D-%E2%80%9D%E6%9D%A5%E6%9B%BF%E4%BB%A3%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E4%BB%BB%E6%84%8F%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E5%AD%97%E7%AC%A6"><span class="nav-number">7.5.7.3.</span> <span class="nav-text">用符号”.”来替代字符串中的任意一个字符字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E2%80%9D-%E2%80%9D%E5%92%8C%E2%80%9D-%E2%80%9D%E6%9D%A5%E5%8C%B9%E9%85%8D%E5%A4%9A%E4%B8%AA%E5%AD%97%E7%AC%A6%E6%98%9F%E5%8F%B7"><span class="nav-number">7.5.7.4.</span> <span class="nav-text">使用”*”和”+”来匹配多个字符星号</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E6%8C%87%E5%AE%9A%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">7.5.7.5.</span> <span class="nav-text">匹配指定字符串</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E6%8C%87%E5%AE%9A%E5%AD%97%E7%AC%A6%E4%B8%AD%E7%9A%84%E4%BB%BB%E6%84%8F%E4%B8%80%E4%B8%AA%E6%96%B9%E6%8B%AC%E5%8F%B7"><span class="nav-number">7.5.7.6.</span> <span class="nav-text">匹配指定字符中的任意一个方括号</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E6%8C%87%E5%AE%9A%E5%AD%97%E7%AC%A6%E4%BB%A5%E5%A4%96%E7%9A%84%E5%AD%97%E7%AC%A6"><span class="nav-number">7.5.7.7.</span> <span class="nav-text">匹配指定字符以外的字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-n-%E6%88%96%E8%80%85-n-m-%E6%9D%A5%E6%8C%87%E5%AE%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E7%BB%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="nav-number">7.5.7.8.</span> <span class="nav-text">使用{n,}或者{n,m}来指定字符串连续出现的次数</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E3%80%81%E6%9B%B4%E6%96%B0%E3%80%81%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">8.</span> <span class="nav-text">插入、更新、删除数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">9.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B"><span class="nav-number">9.1.</span> <span class="nav-text">索引类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95-%E5%92%8C-%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95"><span class="nav-number">9.1.1.</span> <span class="nav-text">普通索引 和 唯一索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E5%88%97%E7%B4%A2%E5%BC%95-%E5%92%8C-%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95-%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95"><span class="nav-number">9.1.2.</span> <span class="nav-text">单列索引 和 组合索引(联合索引)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95"><span class="nav-number">9.1.3.</span> <span class="nav-text">全文索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A9%BA%E9%97%B4%E7%B4%A2%E5%BC%95"><span class="nav-number">9.1.4.</span> <span class="nav-text">空间索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="nav-number">9.2.</span> <span class="nav-text">索引的设计原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%AE%80%E4%BB%8B"><span class="nav-number">9.3.</span> <span class="nav-text">索引简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E8%A1%A5%E5%85%85"><span class="nav-number">9.4.</span> <span class="nav-text">索引补充</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0"><span class="nav-number">10.</span> <span class="nav-text">存储过程和函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE"><span class="nav-number">11.</span> <span class="nav-text">视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="nav-number">12.</span> <span class="nav-text">触发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E4%B8%8E%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86"><span class="nav-number">13.</span> <span class="nav-text">权限与安全管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E8%A1%A8"><span class="nav-number">13.1.</span> <span class="nav-text">权限表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%A6%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-number">13.2.</span> <span class="nav-text">账户管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-number">13.3.</span> <span class="nav-text">权限管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-number">13.4.</span> <span class="nav-text">访问控制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="nav-number">14.</span> <span class="nav-text">数据备份与恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%881-MySQLdump%E5%91%BD%E4%BB%A4"><span class="nav-number">14.1.</span> <span class="nav-text">方案1 MySQLdump命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%882-%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%E6%95%B4%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%AE%E5%BD%95"><span class="nav-number">14.2.</span> <span class="nav-text">方案2 直接复制整个数据库目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%883-MySQLhotcopy%E5%B7%A5%E5%85%B7"><span class="nav-number">14.3.</span> <span class="nav-text">方案3 MySQLhotcopy工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="nav-number">14.4.</span> <span class="nav-text">数据恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%A1%881-Mysql%E5%91%BD%E4%BB%A4%E6%81%A2%E5%A4%8D"><span class="nav-number">14.4.1.</span> <span class="nav-text">方案1 Mysql命令恢复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%A1%882-Mysql%E6%9C%8D%E5%8A%A1%E5%99%A8-source"><span class="nav-number">14.4.2.</span> <span class="nav-text">方案2 Mysql服务器 source</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="nav-number">14.5.</span> <span class="nav-text">数据库迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E7%9A%84%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA"><span class="nav-number">14.6.</span> <span class="nav-text">表的导入和导出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97"><span class="nav-number">15.</span> <span class="nav-text">数据库日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E7%AE%80%E4%BB%8B"><span class="nav-number">15.1.</span> <span class="nav-text">日志简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="nav-number">15.2.</span> <span class="nav-text">二进制日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="nav-number">15.3.</span> <span class="nav-text">错误日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="nav-number">15.4.</span> <span class="nav-text">通用查询日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="nav-number">15.5.</span> <span class="nav-text">慢查询日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">16.</span> <span class="nav-text">性能优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E7%AE%80%E4%BB%8B"><span class="nav-number">17.</span> <span class="nav-text">优化简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E6%9F%A5%E8%AF%A2"><span class="nav-number">17.1.</span> <span class="nav-text">优化查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84"><span class="nav-number">17.2.</span> <span class="nav-text">优化数据库结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96Mysql%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">17.3.</span> <span class="nav-text">优化Mysql服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E8%A1%A8%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">17.4.</span> <span class="nav-text">临时表性能优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AF%AD%E5%8F%A5%E8%B6%85%E6%97%B6%E5%A4%84%E7%90%86"><span class="nav-number">17.5.</span> <span class="nav-text">服务器语句超时处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%85%A8%E5%B1%80%E9%80%9A%E7%94%A8%E8%A1%A8%E7%A9%BA%E9%97%B4"><span class="nav-number">17.6.</span> <span class="nav-text">创建全局通用表空间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mysql%E5%A4%8D%E5%88%B6"><span class="nav-number">18.</span> <span class="nav-text">Mysql复制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E7%AE%80%E4%BB%8B"><span class="nav-number">18.1.</span> <span class="nav-text">复制简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">18.2.</span> <span class="nav-text">主从复制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%B8%B8%E7%AE%A1%E7%90%86%E5%92%8C%E7%BB%B4%E6%8A%A4"><span class="nav-number">18.3.</span> <span class="nav-text">日常管理和维护</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E4%B8%BB%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">18.4.</span> <span class="nav-text">切换主从服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E6%BA%90%E5%A4%8D%E5%88%B6%E7%9A%84%E6%94%B9%E8%BF%9B"><span class="nav-number">18.5.</span> <span class="nav-text">多源复制的改进</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Workbench"><span class="nav-number">19.</span> <span class="nav-text">Workbench</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Workbench%E7%AE%80%E8%BF%B0"><span class="nav-number">19.1.</span> <span class="nav-text">Workbench简述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-Development%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">19.2.</span> <span class="nav-text">SQL Development的基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Data-Modeling%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">19.3.</span> <span class="nav-text">Data Modeling的基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Server-Administration%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">19.4.</span> <span class="nav-text">Server Administration的基本操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E7%A5%9E%E5%99%A8-Mysql-Utilities"><span class="nav-number">20.</span> <span class="nav-text">管理神器 Mysql Utilities</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E8%BF%B0"><span class="nav-number">20.1.</span> <span class="nav-text">简述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE-1"><span class="nav-number">20.2.</span> <span class="nav-text">安装与配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E4%B8%8E%E7%BB%B4%E6%8A%A4"><span class="nav-number">20.3.</span> <span class="nav-text">管理与维护</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E7%A5%9E%E5%99%A8-Mysql-Proxy"><span class="nav-number">21.</span> <span class="nav-text">读写分离神器 Mysql Proxy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E8%BF%B0-1"><span class="nav-number">21.1.</span> <span class="nav-text">简述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE-2"><span class="nav-number">21.2.</span> <span class="nav-text">安装与配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E4%B8%8E%E7%BB%B4%E6%8A%A4-1"><span class="nav-number">21.3.</span> <span class="nav-text">管理与维护</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8"><span class="nav-number">22.</span> <span class="nav-text">实战应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83"><span class="nav-number">22.1.</span> <span class="nav-text">开发规范</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86-1"><span class="nav-number">22.1.1.</span> <span class="nav-text">字符集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5"><span class="nav-number">22.1.2.</span> <span class="nav-text">字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95-1"><span class="nav-number">22.1.3.</span> <span class="nav-text">索引</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E8%AF%AD%E5%8F%A5%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83"><span class="nav-number">22.2.</span> <span class="nav-text">SQL语句编写规范</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80-%E8%A7%84%E8%8C%83%E8%AF%AD%E6%B3%95"><span class="nav-number">22.2.1.</span> <span class="nav-text">(一)规范语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C-%E5%88%AB%E5%90%8D"><span class="nav-number">22.2.2.</span> <span class="nav-text">(二)别名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89-%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-number">22.2.3.</span> <span class="nav-text">(三)执行顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9B-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5%E6%98%AF%E5%90%A6%E5%B7%B2%E6%9C%80%E4%BC%98explain"><span class="nav-number">22.2.4.</span> <span class="nav-text">(四)如何判断语句是否已最优explain</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%94-%E7%A6%81%E6%AD%A2%E4%B8%8E%E5%BB%BA%E8%AE%AE"><span class="nav-number">22.2.5.</span> <span class="nav-text">(五)禁止与建议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%AD-%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%80%9D%E7%BB%B4%E8%80%83%E8%99%91SQL"><span class="nav-number">22.2.6.</span> <span class="nav-text">(六)用数据库的思维考虑SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%83-SQL%E6%94%B9%E5%86%99"><span class="nav-number">22.2.7.</span> <span class="nav-text">(七)SQL改写</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="nav-number">22.3.</span> <span class="nav-text">事务的使用与优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80-%E4%BA%8B%E5%8A%A1%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">22.3.1.</span> <span class="nav-text">(一)事务是什么?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C-%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">22.3.2.</span> <span class="nav-text">(二)事务的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89-%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D"><span class="nav-number">22.3.3.</span> <span class="nav-text">(三)事务问题定位</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">22.4.</span> <span class="nav-text">其他最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80-%E5%88%86%E9%A1%B5%E9%97%AE%E9%A2%98"><span class="nav-number">22.4.1.</span> <span class="nav-text">(一)分页问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C-%E5%A4%A7%E8%A1%A8%E6%95%B0%E6%8D%AE%E6%B8%85%E7%90%86"><span class="nav-number">22.4.2.</span> <span class="nav-text">(二)大表数据清理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89-%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2%E9%97%AE%E9%A2%98"><span class="nav-number">22.4.3.</span> <span class="nav-text">(三)隐式转换问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9B-%E5%BE%AA%E7%8E%AF"><span class="nav-number">22.4.4.</span> <span class="nav-text">(四)循环</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%94-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="nav-number">22.4.5.</span> <span class="nav-text">(五)存储过程中的事务处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%AD-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-number">22.4.6.</span> <span class="nav-text">(六)常见问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E5%92%8C%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98"><span class="nav-number">22.4.7.</span> <span class="nav-text">表和索引优化实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E7%9A%84%E4%BD%BF%E7%94%A8%E7%9A%84%E8%A7%84%E8%8C%83%E5%92%8C%E5%BB%BA%E8%AE%AE"><span class="nav-number">22.4.8.</span> <span class="nav-text">日常运维开发的使用的规范和建议</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql%E4%BC%98%E5%8C%96"><span class="nav-number">22.5.</span> <span class="nav-text">Mysql优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="nav-number">22.5.1.</span> <span class="nav-text">查询优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E7%9B%AE%E7%9A%84"><span class="nav-number">22.5.1.1.</span> <span class="nav-text">优化目的</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96"><span class="nav-number">22.5.1.2.</span> <span class="nav-text">如何优化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E5%89%8D%E5%87%86%E5%A4%87"><span class="nav-number">22.5.1.3.</span> <span class="nav-text">优化前准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E5%89%8D%E5%87%86%E5%A4%87%EF%BC%9A%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90"><span class="nav-number">22.5.1.4.</span> <span class="nav-text">优化前准备：原理剖析</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%80-B-Tree-index"><span class="nav-number">22.5.1.4.1.</span> <span class="nav-text">(一)B+ Tree index</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BA%8C-Innodb-Table"><span class="nav-number">22.5.1.4.2.</span> <span class="nav-text">(二)Innodb Table</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%89-%E7%B4%A2%E5%BC%95%E6%A3%80%E7%B4%A2%E8%BF%87%E7%A8%8B"><span class="nav-number">22.5.1.4.3.</span> <span class="nav-text">(三)索引检索过程</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#MySQL%E7%9A%84%E8%A1%8C%E4%B8%BA"><span class="nav-number">22.5.1.4.4.</span> <span class="nav-text">MySQL的行为</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="nav-number">22.5.1.5.</span> <span class="nav-text">常规优化策略</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%80-Select%E4%BC%98%E5%8C%96"><span class="nav-number">22.5.1.5.1.</span> <span class="nav-text">(一)Select优化</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BA%8C-Join%E4%BC%98%E5%8C%96"><span class="nav-number">22.5.1.5.2.</span> <span class="nav-text">(二)Join优化</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%89-Insert%E4%BC%98%E5%8C%96"><span class="nav-number">22.5.1.5.3.</span> <span class="nav-text">(三)Insert优化</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">22.5.1.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%98%E7%BD%91%E6%96%87%E6%A1%A3%EF%BC%8C%E5%BE%85%E6%95%B4%E7%90%86"><span class="nav-number">22.5.2.</span> <span class="nav-text">官网文档，待整理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%98%E5%8C%96SQL%E8%AF%AD%E5%8F%A5"><span class="nav-number">22.5.2.1.</span> <span class="nav-text">优化SQL语句</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%98%E5%8C%96InnoDB%E7%BC%93%E5%86%B2%E6%B1%A0"><span class="nav-number">22.5.2.2.</span> <span class="nav-text">优化InnoDB缓冲池</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-where%E5%AD%90%E5%8F%A5"><span class="nav-number">22.5.2.3.</span> <span class="nav-text">优化 where子句</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="nav-number">22.6.</span> <span class="nav-text">Mysql高可用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%881%EF%BC%89%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%98%AF%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6"><span class="nav-number">22.6.1.</span> <span class="nav-text">（1）主从复制是异步复制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6"><span class="nav-number">22.6.2.</span> <span class="nav-text">（2）半同步复制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%883%EF%BC%89%E7%BB%84%E5%A4%8D%E5%88%B6-MGR"><span class="nav-number">22.6.3.</span> <span class="nav-text">（3）组复制 MGR</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83"><span class="nav-number">22.6.4.</span> <span class="nav-text">核心</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="nav-number">22.6.5.</span> <span class="nav-text">集群架构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8D%95%E4%B8%BB%E6%A8%A1%E5%BC%8F"><span class="nav-number">22.6.5.1.</span> <span class="nav-text">单主模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%9A%E4%B8%BB%E6%A8%A1%E5%BC%8F"><span class="nav-number">22.6.5.2.</span> <span class="nav-text">多主模式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7"><span class="nav-number">22.7.</span> <span class="nav-text">Mysql数据一致性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5"><span class="nav-number">22.8.</span> <span class="nav-text">计算字段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="nav-number">22.8.1.</span> <span class="nav-text">自连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E7%84%B6%E8%BF%9E%E6%8E%A5"><span class="nav-number">22.8.2.</span> <span class="nav-text">自然连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E8%81%94%E6%9B%B4%E6%96%B0"><span class="nav-number">22.9.</span> <span class="nav-text">关联更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">22.10.</span> <span class="nav-text">组合查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-number">22.11.</span> <span class="nav-text">存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#InnoDB%E8%A1%A5%E5%85%85"><span class="nav-number">22.11.1.</span> <span class="nav-text">InnoDB补充</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">22.12.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5"><span class="nav-number">22.12.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ACID"><span class="nav-number">22.12.2.</span> <span class="nav-text">ACID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AUTOCOMMIT"><span class="nav-number">22.12.3.</span> <span class="nav-text">AUTOCOMMIT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">22.12.4.</span> <span class="nav-text">并发一致性的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%A2%E5%A4%B1%E4%BF%AE%E6%94%B9"><span class="nav-number">22.12.4.1.</span> <span class="nav-text">丢失修改</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%BB%E8%84%8F%E6%95%B0%E6%8D%AE"><span class="nav-number">22.12.4.2.</span> <span class="nav-text">读脏数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="nav-number">22.12.4.3.</span> <span class="nav-text">不可重复读</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B9%BB%E8%AF%BB"><span class="nav-number">22.12.4.4.</span> <span class="nav-text">幻读</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%81%E9%94%81"><span class="nav-number">22.12.5.</span> <span class="nav-text">封锁</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B0%81%E9%94%81%E7%B2%92%E5%BA%A6"><span class="nav-number">22.12.5.1.</span> <span class="nav-text">封锁粒度</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B0%81%E9%94%81%E7%B1%BB%E5%9E%8B"><span class="nav-number">22.12.5.2.</span> <span class="nav-text">封锁类型</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">22.12.6.</span> <span class="nav-text">隔离级别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="nav-number">22.12.7.</span> <span class="nav-text">多版本并发控制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%B9%BB%E8%AF%BB"><span class="nav-number">22.12.8.</span> <span class="nav-text">解决幻读</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql%E5%88%86%E5%8C%BA%E3%80%81%E5%88%86%E8%A1%A8%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-number">22.13.</span> <span class="nav-text">Mysql分区、分表、负载均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E5%8C%BA"><span class="nav-number">22.13.1.</span> <span class="nav-text">分区</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%80%E8%BF%B0-2"><span class="nav-number">22.13.1.1.</span> <span class="nav-text">简述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">22.13.1.2.</span> <span class="nav-text">工作原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8"><span class="nav-number">22.13.1.3.</span> <span class="nav-text">作用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9"><span class="nav-number">22.13.1.4.</span> <span class="nav-text">缺点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">22.13.1.5.</span> <span class="nav-text">使用场景</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E8%A1%A8"><span class="nav-number">22.13.2.</span> <span class="nav-text">分表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-1"><span class="nav-number">22.13.2.1.</span> <span class="nav-text">工作原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E8%A1%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">22.13.2.2.</span> <span class="nav-text">分表方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-%E5%92%8C-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-number">22.13.3.</span> <span class="nav-text">主从复制 和 负载均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5-1"><span class="nav-number">22.13.3.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">22.13.3.2.</span> <span class="nav-text">解决的问题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF%EF%BC%9A"><span class="nav-number">22.13.3.3.</span> <span class="nav-text">解题思路：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9C%9F%E9%A2%98%EF%BC%9A"><span class="nav-number">22.13.3.4.</span> <span class="nav-text">真题：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql%E5%AE%89%E5%85%A8%E6%80%A7"><span class="nav-number">22.14.</span> <span class="nav-text">Mysql安全性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL%E5%AE%89%E5%85%A8"><span class="nav-number">22.14.1.</span> <span class="nav-text">SQL安全</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%AE%89%E5%85%A8%E8%AE%BE%E7%BD%AE"><span class="nav-number">22.14.2.</span> <span class="nav-text">其他安全设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9C%9F%E9%A2%98"><span class="nav-number">22.14.3.</span> <span class="nav-text">真题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PDO%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-number">22.14.4.</span> <span class="nav-text">PDO使用方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-1"><span class="nav-number">22.15.</span> <span class="nav-text">主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="nav-number">22.15.1.</span> <span class="nav-text">实现思路</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="nav-number">22.16.</span> <span class="nav-text">读写分离</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E6%93%8D"><span class="nav-number">22.16.1.</span> <span class="nav-text">实操</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">22.16.1.1.</span> <span class="nav-text">主服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">22.16.1.2.</span> <span class="nav-text">从服务器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql-%E5%8F%8C%E4%B8%BB%E7%83%AD%E5%A4%87"><span class="nav-number">22.17.</span> <span class="nav-text">Mysql 双主热备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql%E4%B8%AD%E9%97%B4%E4%BB%B6-Mycat-%E4%BB%A3%E7%90%86"><span class="nav-number">22.18.</span> <span class="nav-text">Mysql中间件 Mycat 代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E6%A3%80%E6%9F%A5"><span class="nav-number">22.19.</span> <span class="nav-text">并发检查</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E8%A1%A5%E5%85%85"><span class="nav-number">23.</span> <span class="nav-text">其他补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%A4%A7%E9%87%8F%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="nav-number">23.1.</span> <span class="nav-text">生成大量测试数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">23.2.</span> <span class="nav-text">常用命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E7%9B%B8%E5%85%B3"><span class="nav-number">24.</span> <span class="nav-text">面试相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80"><span class="nav-number">24.1.</span> <span class="nav-text">基础</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-1"><span class="nav-number">24.1.1.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Server%E6%9E%B6%E6%9E%84"><span class="nav-number">24.1.2.</span> <span class="nav-text">Server架构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%9F%E9%A2%98-1"><span class="nav-number">24.2.</span> <span class="nav-text">真题</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">阿尤</p>
  <div class="site-description" itemprop="description">成长就是不断发现自己是SB的过程！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">72</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ayou129.github.io/blog/p/e4d2e8fb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="阿尤">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="阿尤">
      <meta itemprop="description" content="成长就是不断发现自己是SB的过程！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Mysql | 阿尤">
      <meta itemprop="description" content="学习Mysql">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Mysql
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-06-02 17:01:31" itemprop="dateCreated datePublished" datetime="2018-06-02T17:01:31+08:00">2018-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-15 00:58:05" itemprop="dateModified" datetime="2022-10-15T00:58:05+08:00">2022-10-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">学习Mysql</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Mysql基础知识+生产环境所遇到的问题的总结，由于不同版本不断迭代，慢慢补充…</p>
<span id="more"></span>

<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><blockquote>
<p><a href="https://weread.qq.com/web/reader/45b32df07195029145b66f4k7ef321f02967ef605fc8aef" target="_blank" rel="noopener">https://weread.qq.com/web/reader/45b32df07195029145b66f4k7ef321f02967ef605fc8aef</a></p>
</blockquote>
<h3 id="数据库基础"><a href="#数据库基础" class="headerlink" title="数据库基础"></a>数据库基础</h3><h4 id="什么是数据库"><a href="#什么是数据库" class="headerlink" title="什么是数据库?"></a>什么是数据库?</h4><blockquote>
<p>一个按数据结构来存储和管理数据的计算机软件系统。</p>
</blockquote>
<p>数据库包含两层含义：</p>
<ul>
<li>保管数据的“仓库”，</li>
<li>数据管理的方法和技术。</li>
</ul>
<p>数据库的特点是：</p>
<ul>
<li>实现数据共享，减少数据冗余；</li>
<li>采用特定的数据类型；</li>
<li>具有较高的数据独立性；</li>
<li>具有统一的数据控制功能。</li>
</ul>
<h4 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h4><blockquote>
<p>主键（Primary Key）又称主码，用于唯一地标识表中的每一条记录。</p>
</blockquote>
<p>可以定义表中的一列或多列为主键，主键列上既不能有两行相同的值，也不能为空值。</p>
<h3 id="数据库技术构成"><a href="#数据库技术构成" class="headerlink" title="数据库技术构成"></a>数据库技术构成</h3><h4 id="数据库系统"><a href="#数据库系统" class="headerlink" title="数据库系统"></a>数据库系统</h4><p>数据库系统有3个主要的组成部分：</p>
<ul>
<li>数据库：用于存储数据的地方。</li>
<li>数据库管理系统：用于管理数据库的软件。</li>
<li>数据库应用程序：为了提高数据库系统的处理能力所使用的管理数据库的软件补充。</li>
</ul>
<p>数据库系统（Database System）提供了一个存储空间，用以存储各种数据，可以将数据库视为一个存储数据的容器。一个数据库可能包含许多文件，一个数据库系统中通常包含许多数据库。</p>
<p>数据库管理系统（DataBase Management System，DBMS）是用户创建、管理和维护数据库时所使用的软件，位于用户与操作系统之间，对数据库进行统一管理。DBMS能定义数据存储结构，提供数据的操作机制，维护数据库的安全性、完整性和可靠性。</p>
<p>数据库应用程序（DataBase Application）虽然已经有了DBMS，但是在很多情况下，DBMS无法满足对数据管理的要求。数据库应用程序的使用可以满足对数据管理的更高要求，还可以使数据管理过程更加直观和友好。数据库应用程序负责与DBMS进行通信，访问和管理DBMS中存储的数据，允许用户插入、修改、删除DB中的数据。</p>
<img src="/blog/p/e4d2e8fb/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F.png" class="" title="mysql数据库系统">

<h4 id="SQL语言"><a href="#SQL语言" class="headerlink" title="SQL语言"></a>SQL语言</h4><blockquote>
<p>对数据库进行查询和修改操作的语言叫作SQL。SQL的含义是结构化查询语言（Structured Query Language）。</p>
</blockquote>
<p>SQL语言包含以下4部分。<br>（1）数据定义语言（DDL）：DROP、CREATE、ALTER等语句。<br>（2）数据操作语言（DML）：INSERT（插入）、UPDATE（修改）、DELETE（删除）语句。<br>（3）数据查询语言（DQL）：SELECT语句。<br>（4）数据控制语言（DCL）：GRANT、REVOKE、COMMIT、ROLLBACK等语句。</p>
<h4 id="数据库访问接口"><a href="#数据库访问接口" class="headerlink" title="数据库访问接口"></a>数据库访问接口</h4><blockquote>
<p>不同的程序设计语言会有各自不同的数据库访问接口，程序语言通过这些接口执行SQL语句，进行数据库管理。主要的数据库访问接口有ODBC、JDBC、ADO.NET和PDO。</p>
</blockquote>
<p><strong>1．ODBCODBC（Open Database Connectivity，开放数据库连接）</strong><br>    技术为访问不同的SQL数据库提供了一个共同的接口。ODBC使用SQL作为访问数据的标准。这一接口提供了最大限度的互操作性：一个应用程序可以通过共同的一组代码访问不同的SQL数据库管理系统（DBMS）。一个基于ODBC的应用程序对数据库的操作不依赖任何DBMS，不直接与DBMS打交道，所有的数据库操作由对应的DBMS的ODBC驱动程序完成。也就是说，不论是Access、MySQL还是Oracle数据库，均可用ODBC API进行访问。由此可见，ODBC的最大优点是能以统一的方式处理所有的数据库。<br><strong>2．JDBCJDBC（Java Data Base Connectivity，Java数据库连接）</strong><br>    用于Java应用程序连接数据库的标准方法，是一种用于执行SQL语句的Java API，可以为多种关系数据库提供统一访问，由一组用Java语言编写的类和接口组成。<br><strong>3．ADO.NETADO.NET是微软在.NET框架下开发设计的一组用于和数据源进行交互的面向对象类库。</strong><br>    ADO.NET提供了对关系数据、XML和应用程序数据的访问，允许和不同类型的数据源以及数据库进行交互。<br><strong>4．PDOPDO（PHP Data Object）</strong><br>    为PHP访问数据库定义了一个轻量级的、一致性的接口，提供了一个数据访问抽象层。这样，无论使用什么数据库，都可以通过一致的函数执行查询和获取数据。针对不同的程序语言，在MySQL提供了不同数据库访问连接驱动，读者可以在下载页面（<a href="http://dev.mysql.com/downloads/%EF%BC%89%E4%B8%8B%E8%BD%BD%E7%9B%B8%E5%85%B3%E9%A9%B1%E5%8A%A8%E3%80%82" target="_blank" rel="noopener">http://dev.MySQL.com/downloads/）下载相关驱动。</a></p>
<h3 id="什么是Mysql"><a href="#什么是Mysql" class="headerlink" title="什么是Mysql"></a>什么是Mysql</h3><p>MySQL是一个小型关系数据库管理系统。与其他大型数据库管理系统（例如Oracle、DB2、SQL Server等）相比，MySQL规模小、功能有限，但是它体积小、速度快、成本低，并且提供的功能对稍微复杂的应用来说已经够用，这些特性使得MySQL成为世界上最受欢迎的开放源代码数据库。</p>
<h4 id="Mysql的优势"><a href="#Mysql的优势" class="headerlink" title="Mysql的优势"></a>Mysql的优势</h4><p>（1）速度：运行速度快。<br>（2）价格：MySQL对多数个人来说是免费的。<br>（3）容易使用：与其他大型数据库的设置和管理相比，其复杂程度较低，易于学习。<br>（4）可移植性：能够工作在众多不同的系统平台上，例如Windows、Linux、UNIX、Mac OS等。<br>（5）丰富的接口：提供了用于C、C++、Eiffel、Java、Perl、PHP、Python、Ruby和Tcl等语言的API。<br>（6）支持查询语言：MySQL可以利用标准SQL语法和支持ODBC的应用程序。<br>（7）安全性和连接性：十分灵活和安全的权限和密码系统，允许基于主机的验证。连接到服务器时，所有的密码传输均采用加密形式，从而保证了密码安全。由于MySQL是网络化的，因此可以在因特网上的任何地方访问，提高数据共享的效率。</p>
<h3 id="Mysql-8-0的新特性简述"><a href="#Mysql-8-0的新特性简述" class="headerlink" title="Mysql 8.0的新特性简述"></a>Mysql 8.0的新特性简述</h3><blockquote>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html?tdsourcetag=s_pctim_aiomsg%E3%80%82" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html?tdsourcetag=s_pctim_aiomsg。</a></p>
</blockquote>
<p>和MySQL 5.7相比，MySQL 8.0的新特性主要包括以下几个方面:</p>
<ol>
<li>数据字典MySQL 8.0包含一个事务数据字典，用于存储有关数据库对象的信息。<br> 在MySQL 8.0之前的版本中，字典数据存储在元数据文件和非事务表中。</li>
<li>原子数据定义语句MySQL 8.0支持原子数据定义语言（DDL）语句。<br> 此功能称为原子DDL。原子DDL语句将与DDL操作关联的数据字典更新，存储引擎操作和二进制日志写入组合到单个原子事务中。即使服务器在操作期间暂停，也会提交事务，并将适用的更改保留到数据字典、存储引擎和二进制日志，或者回滚事务。通过在MySQL 8.0中引入MySQL数据字典，可以实现原子DDL。在早期的MySQL版本中，元数据存储在元数据文件、非事务性表和存储引擎特定的字典中，需要中间提交。MySQL数据字典提供的集中式事务元数据存储消除了这一障碍，使得将DDL语句操作重组为原子事务成为可能。</li>
<li>安全和账户管理MySQL 8.0通过以下功能增强数据库的安全性，并在账户管理中实现更高的DBA灵活性。<br> MySQL数据库的授权表统一为InnoDB（事务性）表。每个语句都是事务性的，并且对所有创建的用户都是成功或者回滚，发生任何错误都无效。如果成功，就将语句写入二进制日志；如果失败则不写入，发生回滚并且不进行任何更改。MySQL 8.0开始支持角色，角色可以看成是一些权限的集合，为用户赋予统一的角色，权限的修改直接通过角色来进行，无须为每个用户单独授权。管理员可以创建和删除角色。MySQL 8.0开始维护有关密码历史的信息，从而限制了以前密码的重用。管理员可以在全局以及每个账户的基础上建立密码重用策略，从而在密码更改时限制使用以前使用过的密码。MySQL 8.0允许账户具有双密码，从而在多服务器系统中无缝地执行分阶段密码更改，无须停机。</li>
<li>资源管理MySQL现在支持资源组的创建和管理，并允许将服务器内运行的线程分配给特定的资源组。<br> 资源组属性可以控制其资源，以启用或限制资源组中线程的资源消耗。数据库管理员可以根据不同的工作负载修改这些属性。</li>
<li>InnoDB增强功能MySQL 8.0增强了InnoDB的功能，主要表现如下：<br> （1）MySQL 8.0将自增主键的计数器持久化到重做日志中。每次计数器发生改变，都会将其写入重做日志中。如果数据库重启，InnoDB会根据重做日志中的信息来初始化计数器的内存值。为了尽量减小对系统性能的影响，计数器写入重做日志时，并不会马上刷新数据库系统。<br> （2）如果索引损坏，InnoDB将索引损坏标志写入重做日志，从而使得损坏标志安全。InnoDB还将内存中损坏标志数据写入每个检查点上的引擎专用系统表。在恢复期间，InnoDB从两个位置读取损坏标志并在将内存表和索引对象标记为损坏之前合并结果。<br> （3）新的动态变量innodb_deadlock_detect可用于禁用死锁检测。在高并发系统上，当许多线程等待同一个锁时，死锁检测会导致速度减慢，此时禁用死锁检测可能更有效。</li>
<li>字符集支持默认字符集已经更改latin1为utf8mb4。<br> 该utf8mb4字符集有几个新的排序规则，其中包括utf8mb4_ja_0900_as_cs。</li>
<li>增强JSON功能MySQL增强JSON功能主要表现在以下几个方面：<br> （1）添加了-&gt;&gt;运算符，相当于调用JSON_UNQUOTE()的结果。<br> （2）添加了两个JSON聚合函数JSON_ARRAYAGG()和JSON_OBJECTAGG()。JSON_ARRAYAGG()将列或表达式作为其参数，并将结果聚合为单个JSON数组。JSON_OBJECTAGG()取两个列或表达式，将其解释为键和值，并将结果作为单个JSON对象返回。<br> （3）添加了JSON实用程序功能JSON_PRETTY()，JSON以易于阅读的格式输出现有值；每个JSON对象成员或数组值都打印在一个单独的行上，子对象或数组相对于其父对象是2个空格。<br> （4）添加的JSON_MERGE_PATCH()可以合并符合RFC 7396标准的JSON。在两个JSON对象上使用时，可以将它们合并为单个JSON对象。</li>
<li>数据类型的支持MySQL 8.0支持将表达式用作数据类型的默认值，包括BLOB、TEXT、GEOMETRY和JSON数据类型，在以前的版本中是根本不会被分配默认值的。</li>
<li>查询的优化MySQL 8.0在查询方面的优化表现如下：<br> （1）MySQL 8.0开始支持不可见索引。优化器根本不使用不可见索引，但会以其他方式正常维护。默认情况下，索引是可见的。通过不可见索引，数据库管理员可以检测索引对查询性能的影响，而不会进行破坏性的更改。<br> （2）MySQL8.0开始支持降序索引。DESC在索引定义中不再被忽略，而且会降序存储索引字段。</li>
<li>公用表表达式MySQL现在支持非递归和递归的公用表表达式。公用表表达式允许使用命名的临时结果集，通过允许WITH语句之前的子句SELECT和某些其他语句来实现。</li>
<li>窗口函数在MySQL 8.0版本中，新增了一个窗口函数，用它可以实现很多新的查询方式。窗口函数类似于SUM()、COUNT()那样的集合函数，但它并不会将多行查询结果合并为一行，而是将结果放回多行当中。</li>
<li>统计直方图MySQL 8.0实现了统计直方图。利用直方图，用户可以对一张表的一列做数据分布的统计，特别是针对没有索引的字段。这可以帮助查询优化器找到更优的执行计划。</li>
<li>备份锁新类型的备份锁在联机备份期间允许DML，同时防止可能导致快照不一致的操作。新的备份锁由LOCK INSTANCE FOR BACKUP和UNLOCK INSTANCE语法支持。管理员拥有BACKUP_ADMIN权限才能使用这些语句。</li>
<li>函数-加密函数<ul>
<li>MD5(str)</li>
<li>SHA(str)</li>
<li>SHA2(str)</li>
</ul>
</li>
<li>GROUP BY不再隐式排序，如果确实需要排序，必须加上ORDER BY子句。</li>
<li>通用表表达式简称为CTE（Common Table Expressions）。CTE是命名的临时结果集，作用范围是当前语句。CTE可以理解成一个可以复用的子查询，当然跟子查询还是有点区别的，CTE可以引用其他CTE，但子查询不能引用其他子查询。</li>
</ol>
<h2 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h2><blockquote>
<p><a href="https://dev.mysql.com/downloads/installer/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/installer/</a></p>
</blockquote>
<h3 id="Linux-Centos7-安装Mysql"><a href="#Linux-Centos7-安装Mysql" class="headerlink" title="Linux(Centos7)安装Mysql"></a>Linux(Centos7)安装Mysql</h3><h4 id="安装前预准备"><a href="#安装前预准备" class="headerlink" title="安装前预准备"></a>安装前预准备</h4><p>首先检查系统中是否存在使用rpm安装的mysql或者mariadb，如果有需要先删除后再编译安装。<br>卸载完以后用 <code>rpm -qa|grep mariadb</code> 或者 <code>rpm -qa|grep mysql</code> 查看结果。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm -<span class="keyword">qa</span> | <span class="keyword">grep</span> mysql</span><br><span class="line">rpm -<span class="keyword">qa</span> | <span class="keyword">grep</span> mariadb</span><br><span class="line"></span><br><span class="line">#如果存在则卸载</span><br><span class="line">rpm -<span class="keyword">e</span> --nodeps XXXX</span><br></pre></td></tr></table></figure>
<img src="/blog/p/e4d2e8fb/rpm%E5%8D%B8%E8%BD%BDmariadb.png" class="" title="rpm卸载mariadb">

<h4 id="安装mysql（下载源代码编译安装）"><a href="#安装mysql（下载源代码编译安装）" class="headerlink" title="安装mysql（下载源代码编译安装）"></a>安装mysql（下载源代码编译安装）</h4><blockquote>
<p><a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noopener">https://downloads.mysql.com/archives/community/</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装相关依赖包</span></span><br><span class="line">yum install -y libaio-* cmake boost bison m4 libtirpc libtirpc-devel</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载boost 59文件</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src</span><br><span class="line">wget https://newcontinuum.dl.sourceforge.net/project/boost/boost/1.59.0/boost_1_59_0.tar.gz</span><br><span class="line">tar zxvf boost_1_59_0.tar.gz</span><br><span class="line"><span class="built_in">mv</span> boost_1_59_0 ../</span><br><span class="line"></span><br><span class="line"><span class="comment">#预配置设置</span></span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql -s /bin/false mysql</span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/mysql</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开始源代码构建</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src</span><br><span class="line">wget https://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.28.tar.gz</span><br><span class="line">tar -xzvf mysql-5.7.xxxxx.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mysql-5.7.xxx</span><br><span class="line"><span class="built_in">mkdir</span> bld</span><br><span class="line"><span class="built_in">cd</span> bld</span><br><span class="line"></span><br><span class="line"><span class="comment">#cmake</span></span><br><span class="line">cmake .. \</span><br><span class="line">-DBUILD_CONFIG=mysql_release \</span><br><span class="line">-DDOWNLOAD_BOOST=1 \</span><br><span class="line">-DWITH_BOOST=/usr/local/boost_1_59_0 \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \</span><br><span class="line">-SYSTEMD_PID_DIR=/usr/local/mysql/systemd \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DSYSCONFDIR=/usr/local/mysql/conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#编译</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装后初始化Mysql</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/mysql</span><br><span class="line"><span class="built_in">mkdir</span> mysql-files</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql mysql-files</span><br><span class="line"><span class="built_in">chmod</span> 750 mysql-files</span><br><span class="line">bin/mysqld --initialize-insecure --user=mysql</span><br><span class="line">bin/mysql_ssl_rsa_setup</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启进程守护</span></span><br><span class="line">bin/mysqld_safe --user=mysql &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">#更改mysql安装目录的属主属组</span></span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql /usr/local/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#可选命令</span></span><br><span class="line"><span class="built_in">cp</span> support-files/mysql.server /etc/init.d/mysql.server</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化mysql数据库</span></span><br><span class="line"><span class="comment">#使用--initialize了 “ 默认安全 ”安装（即包括生成随机初始的 root密码）。在这种情况下，密码被标记为已过期，您将需要选择一个新密码。</span></span><br><span class="line"><span class="comment">#使用--initialize-insecure，不会root生成密码。这是不安全的；假定您在将服务器投入生产使用之前会及时为帐户分配密码。</span></span><br><span class="line">/usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql</span><br></pre></td></tr></table></figure>
<h4 id="数据库备份"><a href="#数据库备份" class="headerlink" title="数据库备份"></a>数据库备份</h4><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[</span><span class="comment">root@www ~</span><span class="title">]</span><span class="comment"># mysqldump</span> <span class="literal">-</span><span class="comment">uroot</span> <span class="literal">--</span><span class="comment">single</span><span class="literal">-</span><span class="comment">transaction</span> <span class="literal">--</span><span class="comment">master</span><span class="literal">-</span><span class="comment">data=2</span> <span class="literal">--</span><span class="comment">databases 数据库名称</span> &gt; <span class="comment">/backup/hellodb_`date</span> <span class="literal">+</span><span class="comment">%F`</span><span class="string">.</span><span class="comment">sql</span></span><br><span class="line"><span class="literal">--</span><span class="comment">single</span><span class="literal">-</span><span class="comment">transaction: 基于此选项能实现热备InnoDB表；因此，不需要同时使用</span><span class="literal">--</span><span class="comment">lock</span><span class="literal">-</span><span class="comment">all</span><span class="literal">-</span><span class="comment">tables；</span></span><br><span class="line"><span class="literal">--</span><span class="comment">master</span><span class="literal">-</span><span class="comment">data=2  记录备份那一时刻的二进制日志的位置，并且注释掉，1是不注释的</span></span><br><span class="line"><span class="literal">--</span><span class="comment">databases hellodb 指定备份的数据库</span></span><br><span class="line"><span class="comment">然后回到mysql服务器端，</span> </span><br></pre></td></tr></table></figure>
<h4 id="设置开机自启"><a href="#设置开机自启" class="headerlink" title="设置开机自启"></a>设置开机自启</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/lib/</span>systemd<span class="regexp">/system/my</span>sqld.service</span><br></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line"><span class="attribute">Documentation</span>=http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line"><span class="attribute">After</span>=network.target</span><br><span class="line"><span class="attribute">After</span>=syslog.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"><span class="attribute">WantedBy</span>=multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"><span class="attribute">PIDFile</span>=/usr/local/mysql/data/localhost.pid</span><br><span class="line"><span class="attribute">ExecStart</span>=/usr/local/mysql/bin/mysqld_safe --explicit_defaults_for_timestamp <span class="attribute">--user</span>=mysql <span class="attribute">--pid-file</span>=/usr/local/mysql/data/localhost.pid <span class="variable">$MYSQLD_OPTS</span></span><br></pre></td></tr></table></figure>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重新启动systemd管理器</span></span><br><span class="line"><span class="params">system</span>ctl daemon-reexec</span><br><span class="line"></span><br><span class="line"><span class="comment">#nginx开机自启</span></span><br><span class="line"><span class="params">system</span>ctl enable mysqld</span><br></pre></td></tr></table></figure>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑文件</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#增加下列code</span></span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/bin:/usr/local/mysql/bin:/usr/local/mysql/lib</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="comment">#重新载入profile</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<h4 id="启动MySQL数据库"><a href="#启动MySQL数据库" class="headerlink" title="启动MySQL数据库"></a>启动MySQL数据库</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/</span><span class="keyword">init</span>.d<span class="operator">/</span>mysql start           </span><br></pre></td></tr></table></figure>
<p>如果报下方错，则是之前没有完全卸载，<a href="#%E5%AE%89%E8%A3%85%E5%89%8D%E9%A2%84%E5%87%86%E5%A4%87">返回上方操作</a></p>
<img src="/blog/p/e4d2e8fb/mysql_safe_error.png" class="" title="Mysql数据库 mysqld.saft error">


<h3 id="常用图形管理工具"><a href="#常用图形管理工具" class="headerlink" title="常用图形管理工具"></a>常用图形管理工具</h3><ul>
<li>MySQL Workbench</li>
<li>phpMyAdmin</li>
<li>Navicat</li>
<li>MysqlDumper</li>
<li>SQLyog</li>
</ul>
<h2 id="数据库基本操作"><a href="#数据库基本操作" class="headerlink" title="数据库基本操作"></a>数据库基本操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据库</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE database_name;</span><br><span class="line"></span><br><span class="line"># 查看定义</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE database_name\G;</span><br><span class="line"></span><br><span class="line"># 查看所有存在的数据库</span><br><span class="line"><span class="keyword">SHOW</span> database_name;</span><br><span class="line"></span><br><span class="line"># 选择当前数据库</span><br><span class="line">USE database_name;</span><br><span class="line"></span><br><span class="line"># 删除数据库</span><br><span class="line"><span class="keyword">DROP</span> database_name;</span><br></pre></td></tr></table></figure>
<h2 id="数据表基本操作"><a href="#数据表基本操作" class="headerlink" title="数据表基本操作"></a>数据表基本操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name(</span><br><span class="line"> 字段名<span class="number">1</span>,数据类型 [列级别约束条件] [默认值],</span><br><span class="line"> 字段名<span class="number">2</span>,数据类型 [列级别约束条件] [默认值],</span><br><span class="line"> ...</span><br><span class="line"> [表级别约束条件]</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># Template</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name(</span><br><span class="line">    id <span class="type">int</span>(<span class="number">11</span>) UNSIGNED AUTO_INCREMENT, # 自增<span class="operator">+</span>无符号</span><br><span class="line">    uid <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, # 非空约束</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>, # 唯一性约束</span><br><span class="line">    age tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="number">20</span>, # 默认约束</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(id) # 指定主键</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(id,uid) # 指定多字段联合主键</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 查看表结构 <span class="keyword">DESCRIBE</span><span class="operator">/</span><span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">DESC</span> table_name;</span><br><span class="line"></span><br><span class="line"># 修改数据表名</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_oldname RENAME [可选参数] table_newname;</span><br><span class="line"></span><br><span class="line"># 修改字段的数据类型</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name MODIFY 字段名 数据类型</span><br><span class="line"></span><br><span class="line"># 修改字段名</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name CHANGE 旧字段名 新字段名 新数据类型</span><br><span class="line"></span><br><span class="line"># 添加字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> 新字段名 数据类型 位置[<span class="keyword">FIRST</span><span class="operator">|</span>AFTER已存在字段]</span><br><span class="line"></span><br><span class="line"># 添加无完整性约束条件的字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> managerID <span class="type">INT</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"># 添加有完整性约束条件的字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> managerID <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"># 删除表的外键约束</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键约束名;</span><br><span class="line"></span><br><span class="line"># 删除一个字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> 字段名;</span><br><span class="line"></span><br><span class="line"># 修改字段的排列位置</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name MODIFY 字段<span class="number">1</span> 数据类型 <span class="keyword">FIRST</span><span class="operator">|</span>AFTER 字段<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"># 更改表的存储引擎</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name ENGINE<span class="operator">=</span>新存储引擎名;</span><br><span class="line"></span><br><span class="line"># 删除 没有被关联 的表</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [IF <span class="keyword">EXISTS</span>]表<span class="number">1</span>, 表<span class="number">2</span>,...表n;</span><br><span class="line"></span><br><span class="line"># 删除 被关联的表 同事要删除外键约束</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键约束名;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>约束</th>
<th>作用</th>
<th>示例</th>
<th>实际业务如何使用</th>
</tr>
</thead>
<tbody><tr>
<td>外键约束</td>
<td>用来在两个表的数据之间建立连接，可以是一列或者多列。一个表可以有一个或多个外键。</td>
<td>上Template</td>
<td>不使用</td>
</tr>
<tr>
<td>非空约束</td>
<td>插入记录时，字段不能为空</td>
<td>上Template</td>
<td>看需求而定</td>
</tr>
<tr>
<td>默认约束</td>
<td>插入记录时，字段设置默认值</td>
<td>上Template</td>
<td>每个字段都要求设置默认值，不能为null</td>
</tr>
<tr>
<td>属性值自动增加</td>
<td>插入记录时，要求字段自增</td>
<td>上Template</td>
<td>看需求而定</td>
</tr>
<tr>
<td>zerofill</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>unsigned</td>
<td>无符号，符号占了一个数字位，可以选择取值范围</td>
<td>上Template</td>
<td>看需求而定</td>
</tr>
</tbody></table>
<h3 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h3><p>在MySQL 8.0版本之前，默认字符集为latin1，utf8字符集指向的是utf8mb3。网站开发人员在数据库设计的时候往往会将编码修改为utf8字符集。如果遗忘修改默认的编码，就会出现乱码的问题。</p>
<p>从MySQL 8.0开始，数据库的默认编码改为utf8mb4，从而避免了上述的乱码问题。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看数据库的默认编码</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;character_set_database&#x27;</span>;</span><br></pre></td></tr></table></figure>


<h2 id="数据类型和运算符"><a href="#数据类型和运算符" class="headerlink" title="数据类型和运算符"></a>数据类型和运算符</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>重点：</p>
<ul>
<li>数据类型详情</li>
<li>什么时候应该使用它？</li>
</ul>
<h4 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h4><ul>
<li>重点1：INT(11): 对大多数应用没有意义，他不会限制值的合法范围，只会影响显示字符的个数 也就是 <code>宽度</code>，长度范围是随数据类型就已经是固定的值，而显示宽度与长度范围无关。</li>
<li>重点2：unsigned</li>
<li>重点3：范围计算：<ul>
<li>每个字节[byte(B)]有8个位[bit(b)]，一个位(b)就代表一个0或者1，也就是2的次幂</li>
<li>INT 是4个字节 &#x3D; 4*8b &#x3D; 2的32次方</li>
<li>4294967296 减去 一个0是 4294967295</li>
<li>如果 <code>存储值</code> 超过了 定义的范围，分情况：<code>启用严格模式</code>，报错，插入失败。<code>禁用严格模式</code>，值可以插入，但是会被裁剪成 <code>定义的最大值</code></li>
<li>存储浮点数值 先看安全性<ul>
<li>高安全性 选decimal</li>
<li>低安全性<ul>
<li>如果需要存储的数值对精度要求不高时，选用float，否者选double</li>
<li>如果需要存储的数值对精度要求不高时，选用float，否者选double</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小</th>
<th>范围（默认有符号）</th>
<th>范围（unsigned）</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>整数值(极小) TINYINT</td>
<td>1 字节</td>
<td>(-128，127)</td>
<td>(0，255)</td>
<td></td>
</tr>
<tr>
<td>整数值(小) SMALLINT</td>
<td>2 字节</td>
<td>(-32 768，32 767)</td>
<td>(0，65 535)</td>
<td></td>
</tr>
<tr>
<td>整数值(中等) MEDIUMINT</td>
<td>3 字节</td>
<td>(-8 388 608，8 388 607)</td>
<td>(0，16 777 215)</td>
<td></td>
</tr>
<tr>
<td>整数值 INT或INTEGER</td>
<td>4 字节</td>
<td>(-2 147 483 648，2 147 483 647)</td>
<td>(0，4 294 967 295)</td>
<td></td>
</tr>
<tr>
<td>整数值(大) BIGINT</td>
<td>8 字节</td>
<td>(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td>
<td>(0，18 446 744 073 709 551 615)</td>
<td></td>
</tr>
<tr>
<td>浮点数值(单精度) FLOAT</td>
<td>4 字节</td>
<td>(-3.402 823 466 E+38，-1.175 494 351 E-38)，<br>0，<br>(1.175 494 351 E-38，3.402 823 466 351 E+38)</td>
<td>0，<br>(1.175 494 351 E-38，3.402 823 466 E+38)</td>
<td></td>
</tr>
<tr>
<td>浮点数值(双精度)DOUBLE</td>
<td>8 字节</td>
<td>(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，<br>0，<br>(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td>0，<br>(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td>
<td></td>
</tr>
<tr>
<td>定点小数 DECIMAL</td>
<td>对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td>
<td>依赖于M和D的值</td>
<td>依赖于M和D的值</td>
<td></td>
</tr>
</tbody></table>
<p>补充：FLOAT、DOUBLE 和 DECIMAL 都可以指定列宽，例如 DECIMAL(18, 9) 表示总共 18 位，取 9 位存储小数部分，剩下 9 位存储整数部分。</p>
<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><ul>
<li>重点1：char适合较短、定长、经常变更的字符串</li>
<li>重点2：尽量避免使用BLOB和TEXT类型，查询会使用临时表，消耗性能</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小</th>
<th>用途</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR</td>
<td>0-255字节</td>
<td>定长字符串</td>
<td>提取比Varchar效率高<br>会用空格填充</td>
</tr>
<tr>
<td>VARCHAR</td>
<td>0-65535 字节</td>
<td>变长字符串</td>
<td>比定长节省空间，<br>&lt;255会用一个字节存字符串的长度，<br>&gt;255会用两个字节 <br> <font color="red"><b>超过宽度会截断</b></font></td>
</tr>
<tr>
<td>TINYBLOB</td>
<td>0-255字节</td>
<td>不超过 255 个字符的二进制字符串</td>
<td></td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>0-255字节</td>
<td>短文本字符串</td>
<td></td>
</tr>
<tr>
<td>BLOB</td>
<td>0-65 535字节</td>
<td>二进制形式的长文本数据</td>
<td><font color="red"><b>尽量少用</b></font></td>
</tr>
<tr>
<td>TEXT</td>
<td>0-65 535字节</td>
<td>长文本数据</td>
<td><font color="red"><b>尽量少用</b></font></td>
</tr>
<tr>
<td>MEDIUMBLOB</td>
<td>0-16 777 215字节</td>
<td>二进制形式的中等长度文本数据</td>
<td></td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>0-16 777 215字节</td>
<td>中等长度文本数据</td>
<td></td>
</tr>
<tr>
<td>LONGBLOB</td>
<td>0-4 294 967 295字节</td>
<td>二进制形式的极大文本数据</td>
<td></td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>0-4 294 967 295字节</td>
<td>极大文本数据</td>
<td></td>
</tr>
</tbody></table>
<h4 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h4><ul>
<li>重点1：可以使用枚举类型替换常用的字符串，比如性别：男女保密 123，</li>
<li>重点2：枚举类型会减少表的大小，因为内部是按照数字存储的，而且每个<ul>
<li>NULL   索引是NULL</li>
<li>‘’     索引是0</li>
<li>‘one’  索引是1</li>
<li>其他值依次类推  索引是2.3….</li>
</ul>
</li>
<li>重点3：不建议用数字保存到ENUM列，数字被视为索引，并且保存的值是该索引对应的枚举成员，很容易引起混淆<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enum(&#x27;男&#x27;,&#x27;女&#x27;),</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="日期类型"><a href="#日期类型" class="headerlink" title="日期类型"></a>日期类型</h4><ul>
<li>重点1：<font color="red"><b>优先使用timestamp</b></font>，比datatime空间效率高，而且有专有的自动更新特性</li>
<li>重点2：用整数保存时间戳的格式通常不方便处理</li>
<li>重点3：存储微妙，使用bigint</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小(字节)</th>
<th>范围</th>
<th>格式</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>DATE</td>
<td>3</td>
<td>1000-01-01&#x2F;9999-12-31</td>
<td>YYYY-MM-DD</td>
<td>日期值</td>
</tr>
<tr>
<td>TIME</td>
<td>3</td>
<td>‘-838:59:59’&#x2F;‘838:59:59’</td>
<td>HH:MM:SS</td>
<td>时间值或持续时间</td>
</tr>
<tr>
<td>YEAR</td>
<td>1</td>
<td>1901&#x2F;2155</td>
<td>YYYY</td>
<td>年份值</td>
</tr>
<tr>
<td>DATETIME</td>
<td>8</td>
<td>1000-01-01 00:00:00&#x2F;9999-12-31 23:59:59</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>混合日期和时间值</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>4</td>
<td>1970-01-01 00:00:00&#x2F;2038-1-19 11:14:07</td>
<td>YYYYMMDD HHMMSS</td>
<td>混合日期和时间值，UNIX 时间戳</td>
</tr>
</tbody></table>
<h4 id="如何选择数据类型"><a href="#如何选择数据类型" class="headerlink" title="如何选择数据类型"></a>如何选择数据类型</h4><blockquote>
<p>优化存储、提高数据库性能</p>
</blockquote>
<ol>
<li>整数和浮点数<br> 如果不需要小数部分，就使用整数来保存数据；如果需要表示小数部分，就使用浮点数类型。对于浮点数据列，存入的数值会对该列定义的小数位进行四舍五入。例如，假设列的值的范围为1~99999，若使用整数，则MEDIUMINT UNSIGNED是最好的类型；若需要存储小数，则使用FLOAT类型。<br>浮点类型包括FLOAT和DOUBLE类型。DOUBLE类型精度比FLOAT类型高，因此要求存储精度较高时应选择DOUBLE类型。</li>
<li>浮点数和定点数浮点数FLOAT、DOUBLE相对于定点数DECIMAL的优势是：在长度一定的情况下，浮点数能表示更大的数据范围。由于浮点数容易产生误差，因此对精确度要求比较高时，建议使用DECIMAL来存储。DECIMAL在MySQL中是以字符串存储的，用于定义货币等对精确度要求较高的数据。在数据迁移中，float(M,D)是非标准SQL定义，数据库迁移可能会出现问题，最好不要这样使用。另外，两个浮点数进行减法和比较运算时也容易出问题，因此在进行计算的时候，一定要小心。进行数值比较时，最好使用DECIMAL类型。</li>
<li>日期与时间类型<br> MySQL对于不同种类的日期和时间有很多数据类型，比如YEAR和TIME。如果只需要记录年份，则使用YEAR类型即可；如果只记录时间，则使用TIME类型。<br>如果同时需要记录日期和时间，则可以使用TIMESTAMP或者DATETIME类型。由于TIMESTAMP列的取值范围小于DATETIME的取值范围，因此存储范围较大的日期最好使用DATETIME。<br>TIMESTAMP也有一个DATETIME不具备的属性。默认的情况下，当插入一条记录但并没有指定TIMESTAMP这个列值时，MySQL会把TIMESTAMP列设为当前的时间。因此当需要插入记录的同时插入当前时间时，使用TIMESTAMP是方便的。另外，TIMESTAMP在空间上比DATETIME更有效。</li>
<li>CHAR与VARCHAR区别:</li>
</ol>
<ul>
<li><p>CHAR是固定长度字符，VARCHAR是可变长度字符。 </p>
</li>
<li><p>CHAR会自动删除插入数据的尾部空格，VARCHAR不会删除尾部空格。</p>
<p>  CHAR是固定长度，所以它的处理速度比VARCHAR的速度要快，但是它的缺点是浪费存储空间，所以对存储不大但在速度上有要求的可以使用CHAR类型，反之可以使用VARCHAR类型来实现。存储引擎对于选择CHAR和VARCHAR的影响：<br>  - 对于MyISAM存储引擎：最好使用固定长度的数据列代替可变长度的数据列。这样可以使整个表静态化，从而使数据检索更快，用空间换时间。<br>  - 对于InnoDB存储引擎：使用可变长度的数据列，因为InnoDB数据表的存储格式不分固定长度和可变长度，因此使用CHAR不一定比使用VARCHAR更好，但由于VARCHAR是按照实际的长度存储的，比较节省空间，所以对磁盘I&#x2F;O和数据存储总量比较好。</p>
</li>
</ul>
<ol start="5">
<li>ENUM和SET<br> ENUM只能取单值，它的数据列表是一个枚举集合。它的合法取值列表最多允许有65535个成员。因此，在需要从多个值中选取一个时，可以使用ENUM。比如：性别字段适合定义为ENUM类型，每次只能从‘男’或‘女’中取一个值。<br> SET可取多值。它的合法取值列表最多允许有64个成员。空字符串也是一个合法的SET值。在需要取多个值的时候，适合使用SET类型，比如要存储一个人的兴趣爱好，最好使用SET类型。<br> ENUM和SET的值是以字符串形式出现的，但在内部，MySQL是以数值的形式存储它们的。<br>6．BLOB和TEXT<br> BLOB是二进制字符串，TEXT是非二进制字符串，两者均可存放大容量的信息。BLOB主要存储图片、音频信息等，而TEXT只能存储纯文本文件。</li>
</ol>
<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><blockquote>
<p>运算符是告诉MySQL执行特定算术或逻辑操作的符号。</p>
</blockquote>
<h4 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h4><p>算术运算符用于各类数值运算，包括加（+）、减（-）、乘（*）、除（&#x2F;）、求余（或称模运算，%）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> num,num<span class="operator">/</span><span class="number">0</span>,num <span class="operator">%</span> <span class="number">0</span> <span class="keyword">from</span> table_name;</span><br></pre></td></tr></table></figure>
<h4 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h4><p>比较运算符用于比较运算，包括大于（&gt;）、小于（&lt;）、等于（&#x3D;）、大于等于（&gt;&#x3D;）、小于等于（&lt;&#x3D;）、不等于（!&#x3D;），以及IN、BETWEEN AND、IS NULL、GREATEST、LEAST、LIKE、REGEXP等。</p>
<p><strong>等于运算符</strong></p>
<blockquote>
<p>等号（&#x3D;）用来判断数字、字符串和表达式是否相等：如果相等，返回值为1；否则返回值为0。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span><span class="operator">=</span><span class="number">0</span>,<span class="string">&#x27;2&#x27;</span><span class="operator">=</span><span class="number">2</span>,<span class="number">2</span><span class="operator">=</span><span class="number">2</span>,(<span class="number">1</span><span class="operator">+</span><span class="number">3</span>)<span class="operator">=</span>(<span class="number">2</span><span class="operator">+</span><span class="number">2</span>),<span class="keyword">NULL</span><span class="operator">=</span><span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p>数值比较时有如下规则：<br>（1）若有一个或两个参数为NULL，则比较运算的结果为NULL。<br>（2）若同一个比较运算中的两个参数都是字符串，则按照字符串进行比较。<br>（3）若两个参数均为整数，则按照整数进行比较。<br>（4）若用字符串和数字进行相等判断，则MySQL可以自动将字符串转换为数字。</p>
<p><strong>安全等于运算符（&lt;&#x3D;&gt;）</strong><br>这个操作符和&#x3D;操作符执行相同的比较操作，不过&lt;&#x3D;&gt;可以用来判断NULL值。在两个操作数均为NULL时，其返回值为1，而不为NULL；当一个操作数为NULL时，其返回值为0，而不为NULL。</p>
<p><strong>不等于运算符（&lt;&gt;或者!&#x3D;）</strong><br>‘&lt;&gt;’或者‘!&#x3D;’用于判断数字、字符串、表达式不相等的判断：如果不相等，返回值为1；否则返回值为0。这两个运算符不能用于判断空值NULL。</p>
<p><strong>小于等于运算符（&lt;&#x3D;）</strong><br>‘&lt;&#x3D;’用来判断左边的操作数是否小于等于右边的操作数：如果小于等于，返回值为1；否则返回值为0。‘&lt;&#x3D;’不能用于判断空值NULL。</p>
<p><strong>小于运算符（&lt;）</strong><br>‘&lt;’运算符用来判断左边的操作数是否小于右边的操作数：如果小于，返回值为1；否则返回值为0。‘&lt;’不能用于判断空值NULL。</p>
<p><strong>IS NULL(ISNULL)和IS NOT NULL运算符</strong><br>IS NULL和ISNULL检验一个值是否为NULL：如果为NULL，返回值为1；否则返回值为0。IS NOT NULL检验一个值是否为非NULL：如果是非NULL，返回值为1；否则返回值为0。</p>
<p><strong>BETWEEN AND运算符</strong><br>语法格式为：expr BETWEEN min AND max。假如expr大于等于min且小于等于max，则BETWEEN的返回值为1，否则返回值为0。<br><strong>LEAST运算符</strong><br>语法格式为：LEAST(值1，值2，…，值n)。其中，“值n”表示参数列表中有n个值。在有两个或多个参数的情况下，返回最小值。假如任意一个自变量为NULL，则LEAST()的返回值为NULL。</p>
<p><strong>GREATEST (value1,value2,…)</strong><br>语法格式为：GREATEST(值1，值2，…，值n)。其中，n表示参数列表中有n个值。当有两个或多个参数时，返回值为最大值。假如任意一个自变量为NULL，则GREATEST()的返回值为NULL。</p>
<p><strong>IN、NOT IN运算符</strong><br>IN运算符用来判断操作数是否为IN列表中的其中一个值：如果是，返回值为1；否则返回值为0。NOT IN运算符用来判断表达式是否为IN列表中的其中一个值：如果不是，返回值为1；否则返回值为0。</p>
<p><strong>LIKELIKE运算符</strong><br>用来匹配字符串，语法格式为：expr LIKE匹配条件。如果expr满足匹配条件，则返回值为1（TRUE）；如果不匹配，则返回值为0（FALSE）。expr或匹配条件中任何一个为NULL，则结果为NULL。</p>
<p>LIKE运算符在进行匹配时，可以使用下面通配符(通配符也是用在过滤语句中，但它只能用于文本字段)：</p>
<ul>
<li>% 匹配 &gt;&#x3D;0 个任意字符；</li>
<li>_ 匹配 &#x3D;&#x3D;1 个任意字符；</li>
<li>[] 可以匹配集合内的字符，例如 [ab] 将匹配字符 a 或者 b。用脱字符 ^ 可以对其进行否定，也就是不匹配集合内的字符。</li>
</ul>
<p>使用 Like 来进行通配符匹配。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> mytable</span><br><span class="line"><span class="keyword">WHERE</span> col <span class="keyword">LIKE</span> <span class="string">&#x27;[^AB]%&#x27;</span>; <span class="comment">-- 不以 A 和 B 开头的任意文本</span></span><br></pre></td></tr></table></figure>
<p><strong>REGEXPREGEXP运算符</strong><br>用来匹配字符串，语法格式为：expr REGEXP匹配条件。如果expr满足匹配条件，返回1；如果不满足，则返回0。若expr或匹配条件任意一个为NULL，则结果为NULL。</p>
<p>REGEXP运算符在进行匹配时，常用的有下面几种通配符：<br>（1）‘^’匹配以该字符后面的字符开头的字符串。<br>（2）‘$’匹配以该字符后面的字符结尾的字符串。<br>（3）‘.’匹配任何一个单字符。<br>（4）“[…]”匹配在方括号内的任何字符。例如，“[abc]”匹配“a”“b”或“c”。为了命名字符的范围，使用一个‘-’。“[a-z]”匹配任何字母，而“[0-9]”匹配任何数字。<br>（5）‘<em>’匹配零个或多个在它前面的字符。例如，“x</em>”匹配任何数量的‘x’字符，“[0-9]<em>”匹配任何数量的数字，而“</em>”匹配任何数量的任何字符。</p>
<h4 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h4><p>逻辑运算符的求值所得结果均为1（TRUE）、0（FALSE），这类运算符有逻辑非（NOT或者!）、逻辑与（AND或者&amp;&amp;）、逻辑或（OR或者||）、逻辑异或（XOR）。</p>
<p><strong>NOT或者!</strong><br>逻辑非运算符NOT或者！表示当操作数为0时，所得值为1；当操作数为非零值时，所得值为0；当操作数为NULL时，所得的返回值为NULL。</p>
<div class="tip">
使用运算符运算时，一定要注意不同运算符的优先级不同。如果不能确定计算顺序，最好使用括号，以保证运算结果的正确。
</div>

<p><strong>AND或者&amp;&amp;</strong><br>逻辑与运算符AND或者&amp;&amp;表示当所有操作数均为非零值并且不为NULL时，计算所得结果为1；当一个或多个操作数为0时，所得结果为0；其余情况返回值为NULL。</p>
<div class="tip">
“AND”运算符可以有多个操作数，需要注意的是：多个操作数运算时，AND两边一定要使用空格隔开，不然会影响结果的正确性。
</div>

<p><strong>OR或者||</strong><br>逻辑或运算符OR或者||表示当两个操作数均为非NULL值且任意一个操作数为非零值时，结果为1，否则结果为0；当有一个操作数为NULL，且另一个操作数为非零值时，则结果为1，否则结果为NULL；当两个操作数均为NULL时，则所得结果为NULL。</p>
<p><strong>XOR</strong><br>逻辑异或运算符XOR表示当任意一个操作数为NULL时，返回值为NULL；对于非NULL的操作数，如果两个操作数都是非0值或者都是0值，则返回结果为0；如果一个为0值、另一个为非0值，返回结果为1。</p>
<div class="tip">
a XOR b的计算等同于(a AND (NOT b))或者((NOT a)AND b)。
</div>

<h4 id="位运算符位"><a href="#位运算符位" class="headerlink" title="位运算符位"></a>位运算符位</h4><p>运算符参与运算的操作数按二进制位进行运算，包括位与（&amp;）、位或（|）、位非（~）、位异或（^）、左移（&lt;&lt;）、右移（&gt;&gt;）6种。</p>
<p><strong>位或运算符（|）</strong><br>位或运算的实质是将参与运算的几个数据按照对应的二进制数逐位进行逻辑或运算。对应的二进制位有一个或两个为1则该位的运算结果为1，否则为0。</p>
<p><strong>位与运算符（&amp;）</strong><br>位与运算的实质是将参与运算的几个操作数按照对应的二进制数逐位进行逻辑与运算。对应的二进制位都为1则该位的运算结果为1，否则为0。</p>
<p><strong>位异或运算符（^）</strong><br>位异或运算的实质是将参与运算的两个数据按照对应的二进制数逐位进行逻辑异或运算。对应位的二进制数不同时，对应位的结果才为1。如果两个对应位数都为0或者都为1，则对应位的结果为0。</p>
<p><strong>位左移运算符（&lt;&lt;）</strong><br>位左移运算符&lt;&lt;使指定的二进制值的所有位都左移指定的位数。左移指定位数之后，左边高位的数值将被移出并丢弃，右边低位空出的位置用0补齐。语法格式为：expr&lt;&lt;n。其中，n指定值expr要移位的位数。</p>
<p><strong>位右移运算符（&gt;&gt;）</strong><br>位右移运算符&gt;&gt;使指定的二进制值的所有位都右移指定的位数。右移指定位数之后，右边低位的数值将被移出并丢弃，左边高位空出的位置用0补齐。语法格式为：expr&gt;&gt;n。其中，n指定值expr要移位的位数。</p>
<p><strong>位取反运算符（~）</strong><br>位取反运算的实质是将参与运算的数据按照对应的二进制数逐位反转，即1取反后变为0、0取反后变为1。</p>
<p>在逻辑运算5&amp;<del>1中，由于位取反运算符‘</del>’的级别高于位与运算符‘&amp;’，因此先对1进行取反操作，取反之后，除了最低位为0外其他位都为1，即1110，然后与十进制数值5进行与运算，结果为0100，即整数4。</p>
<div class="tip">
MySQL经过位运算之后的数值是一个64位的无符号整数，1的二进制数值表示为最右边位为1、其他位均为0，取反操作之后，除了最低位为0外，其他位均变为1。
</div>

<h4 id="运算符的优先级"><a href="#运算符的优先级" class="headerlink" title="运算符的优先级"></a>运算符的优先级</h4><img src="/blog/p/e4d2e8fb/Mysql%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7.png" class="" title="Mysql运算符的优先级">

<p>可以看到，不同运算符的优先级是不同的。一般情况下，级别高的运算符先进行计算，如果级别相同，MySQL按表达式的顺序从左到右依次计算。当然，在无法确定优先级的情况下，可以使用圆括号（）来改变优先级，并且这样会使计算过程更加清晰。</p>
<h4 id="运算符的基本使用"><a href="#运算符的基本使用" class="headerlink" title="运算符的基本使用"></a>运算符的基本使用</h4><p>TODO：这里不做过多介绍，实际业务中，脚本层实现运算。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h3><blockquote>
<p>数学函数主要用来处理数值数据，主要的数学函数有绝对值函数、三角函数（包括正弦函数、余弦函数、正切函数、余切函数等）、对数函数、随机数函数等。在有错误产生时，数学函数将会返回空值NULL。</p>
</blockquote>
<p>ABS(X)返回X的绝对值。<br>PI()返回圆周率π的值。默认的显示小数位数是6位。<br>SQRT(x)返回非负数x的二次方根。<br>MOD(x,y)返回x被y除后的余数，MOD()对于带有小数部分的数值也起作用，它返回除法运算后的精确余数。<br>CEIL(x)和CEILING(x)的意义相同，返回不小于x的最小整数值，返回值转化为一个BIGINT。<br>FLOOR(x)返回不大于x的最大整数值，返回值转化为一个BIGINT。<br>RAND(x)返回一个随机浮点值v，范围在0到1之间（0 ≤ v ≤ 1.0）。若已指定一个整数参数x，则它被用作种子值，用来产生重复序列。<br>ROUND(x)返回最接近于参数x的整数，对x值进行四舍五入。<br>ROUND(x,y)返回最接近于参数x的数，其值保留到小数点后面y位，若y为负值，则将保留x值到小数点左边y位。</p>
<div class="tip">
y值为负数时，保留的小数点左边的相应位数直接保存为0，不进行四舍五入。
</div>

<p>TRUNCATE(x,y)返回被舍去至小数点后y位的数字x。若y的值为0，则结果不带有小数点或不带有小数部分。若y设为负数，则截去（归零）x小数点左起第y位开始后面所有低位的值。<br>TRUNCATE(1.31,1)和TRUNCATE(1.99,1)都保留小数点后1位数字，返回值分别为1.3和1.9；TRUNCATE(1.99,0)返回整数部分值1；TRUNCATE(19.99,-1)截去小数点左边第1位后面的值，并将整数部分的1位数字置0，结果为10。</p>
<div class="tip">
ROUND(x,y)函数在截取值的时候会四舍五入，而TRUNCATE (x,y)直接截取值，并不进行四舍五入。
</div>

<p>SIGN(x)返回参数的符号，x的值为负、零或正时返回结果依次为-1、0或1。</p>
<p>幂运算函数 POW(x,y)或者POWER(x,y)函数返回x的y次乘方的结果值。<br>幂运算函数 EXP(x)返回e的x乘方后的值。</p>
<p>对数运算函数 LOG(x)返回x的自然对数，x相对于基数e的对数。<br>对数运算函数 LOG10(x)返回x的基数为10的对数。</p>
<p>角度与弧度相互转换的函数 RADIANS(x)将参数x由角度转化为弧度。<br>角度与弧度相互转换的函数 DEGREES(x)将参数x由弧度转化为角度。</p>
<p>正弦函数 SIN(x)返回x正弦，其中x为弧度值。<br>反正弦函数 ASIN(x)返回x的反正弦，即正弦为x的值。若x不在-1到1的范围之内，则返回NULL。</p>
<p>余弦函数 COS(x)返回x的余弦，其中x为弧度值。<br>反余弦函数 ACOS(x)返回x的反余弦，即余弦是x的值。若x不在-1~1的范围之内，则返回NULL。</p>
<p>正切函数 TAN(x)返回x的正切，其中x为给定的弧度值。<br>反正切函数 ATAN(x)返回x的反正切，即正切为x的值。<br>余切函数 COT(x)返回x的余切。</p>
<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><blockquote>
<p>字符串函数主要用来处理数据库中的字符串数据。MySQL中的字符串函数有计算字符串长度函数、字符串合并函数、字符串替换函数、字符串比较函数、查找指定字符串位置函数等。</p>
</blockquote>
<p>TODO待补充…</p>
<h3 id="日期和时间函数"><a href="#日期和时间函数" class="headerlink" title="日期和时间函数"></a>日期和时间函数</h3><blockquote>
<p>日期和时间函数主要用来处理日期和时间值，一般的日期函数除了使用DATE类型的参数外，也可以使用DATETIME或者TIMESTAMP类型的参数，但会忽略这些值的时间部分。相同的，以TIME类型值为参数的函数，可以接受TIMESTAMP类型的参数，但会忽略日期部分，许多日期函数可以同时接受数字和字符串类型的两种参数</p>
</blockquote>
<p>TODO待补充…</p>
<h3 id="条件判断函数"><a href="#条件判断函数" class="headerlink" title="条件判断函数"></a>条件判断函数</h3><blockquote>
<p>条件判断函数也称为控制流程函数，根据满足的不同条件，执行相应的流程。MySQL中进行条件判断的函数有IF、IFNULL和CASE。</p>
</blockquote>
<p>TODO待补充…</p>
<h3 id="系统信息函数"><a href="#系统信息函数" class="headerlink" title="系统信息函数"></a>系统信息函数</h3><blockquote>
<p>MySQL中的系统信息有数据库的版本号、当前用户名和连接数、系统字符集、最后一个自动生成的ID值等。</p>
</blockquote>
<p>TODO待补充…</p>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><blockquote>
<p>本节将要介绍的函数不能笼统地分为哪一类，但是这些函数也非常有用，例如重复指定操作函数、改变字符集函数、IP地址与数字转换函数等。</p>
</blockquote>
<p>TODO待补充…</p>
<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><h3 id="基本查询语句"><a href="#基本查询语句" class="headerlink" title="基本查询语句"></a>基本查询语句</h3><img src="/blog/p/e4d2e8fb/Mysql%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5.png" class="" title="Mysql基本查询语句">
<p>各条子句的含义如下：</p>
<ul>
<li>{* | &lt;字段列表&gt;}包含星号通配符和字段列表，表示查询的字段。其中，字段列表至少包含一个字段名称，如果要查询多个字段，多个字段之间用逗号隔开，最后一个字段后不加逗号。</li>
<li>FROM &lt;表1&gt;,&lt;表2&gt;…，表1和表2表示查询数据的来源，可以是单个或者多个。</li>
<li>WHERE子句是可选项，如果选择该项，将限定查询行必须满足的查询条件。</li>
<li>GROUP BY &lt;字段&gt;，该子句告诉MySQL如何显示查询出来的数据，并按照指定的字段分组。</li>
<li>[ORDER BY &lt;字段&gt;]，该子句告诉MySQL按什么样的顺序显示查询出来的数据，可以进行的排序有升序（ASC）、降序（DESC）。</li>
<li>[LIMIT [<offset>,] <row count>]，该子句告诉MySQL每次显示查询出来的数据条数。</li>
</ul>
<h3 id="单表查询"><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有字段</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line"># 查询指定字段 指定条件 排序</span><br><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>,...字段n <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件<span class="number">1</span> <span class="keyword">and</span> 条件n <span class="keyword">order</span> <span class="keyword">by</span> 排序字段<span class="number">1</span> <span class="keyword">desc</span>,排序字段<span class="number">2</span> <span class="keyword">asc</span>(默认) <span class="keyword">group</span> <span class="keyword">by</span> 分组字段<span class="number">1</span>，分组字段n limit [位置偏移量,] 行数;</span><br><span class="line"></span><br><span class="line"># 条件</span><br><span class="line">## <span class="keyword">IN</span> 和 <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line"><span class="keyword">where</span> id <span class="keyword">IN</span>(<span class="number">100</span>,<span class="number">101</span>)</span><br><span class="line"><span class="keyword">where</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="number">100</span>,<span class="number">101</span>)</span><br><span class="line"></span><br><span class="line">## <span class="keyword">IS</span> <span class="keyword">NULL</span> 和 <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">where</span> age <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">where</span> age <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line">## 条件 范围查询</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">scope</span> <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">Like</span>字符匹配</span><br><span class="line">## <span class="operator">%</span> 匹配任意长度的字符，甚至包括零字符</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;li%&#x27;</span> </span><br><span class="line">## _ 一次只能匹配任意一个字符</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;li%&#x27;</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">OR</span> 和 <span class="keyword">AND</span>，<span class="keyword">AND</span>优先级高</span><br><span class="line"></span><br><span class="line"># 去重 <span class="keyword">DISTINCT</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DISTINCT</span> 字段名 <span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line"># 分组 <span class="keyword">GROUP</span> <span class="keyword">BY</span>，通常和集合函数一起使用，比如MAX MIN COUNT SUM AVG</span><br><span class="line"></span><br><span class="line"># 分组<span class="operator">-</span>过滤 <span class="keyword">HAVING</span>，和分组一起使用。与<span class="keyword">where</span>的区别：<span class="keyword">HAVING</span>在数据分组之后进行过滤来选择分组，</span><br><span class="line">## 而<span class="keyword">WHERE</span>在分组之前来选择记录。另外，<span class="keyword">WHERE</span>排除的记录不再包括在分组中。</span><br><span class="line"></span><br><span class="line"># 分组<span class="operator">-</span>统计记录数量 <span class="keyword">with</span> <span class="keyword">rollup</span>：在所有查询出的分组记录之后增加一条记录，该记录计算查询出的所有记录的总和，即统计记录数量。</span><br><span class="line"></span><br><span class="line"># 分组<span class="operator">+</span>排序。 <span class="keyword">order</span> <span class="keyword">by</span>和<span class="keyword">with</span> <span class="keyword">rollup</span>互斥，无法同时使用</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h4><p>把具有相同的数据值的行放在同一组中。</p>
<p>可以对同一分组数据使用汇总函数进行处理，例如求分组数据的平均值等。</p>
<p>指定的分组字段除了能按该字段进行分组，也会自动按该字段进行排序。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> col, <span class="built_in">COUNT</span>(*) <span class="keyword">AS</span> num</span><br><span class="line"><span class="keyword">FROM</span> mytable</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> col;</span><br></pre></td></tr></table></figure>

<p>GROUP BY 自动按分组字段进行排序，ORDER BY 也可以按汇总字段来进行排序。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> col, <span class="built_in">COUNT</span>(*) <span class="keyword">AS</span> num</span><br><span class="line"><span class="keyword">FROM</span> mytable</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> col</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> num;</span><br></pre></td></tr></table></figure>

<p>WHERE 过滤行，HAVING 过滤分组，行过滤应当先于分组过滤。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> col, <span class="built_in">COUNT</span>(*) <span class="keyword">AS</span> num</span><br><span class="line"><span class="keyword">FROM</span> mytable</span><br><span class="line"><span class="keyword">WHERE</span> col &gt; <span class="number">2</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> col</span><br><span class="line"><span class="keyword">HAVING</span> num &gt;= <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>分组规定：</p>
<ul>
<li>GROUP BY 子句出现在 WHERE 子句之后，ORDER BY 子句之前；</li>
<li>除了汇总字段外，SELECT 语句中的每一字段都必须在 GROUP BY 子句中给出；</li>
<li>NULL 的行会单独分为一组；</li>
<li>大多数 SQL 实现不支持 GROUP BY 列具有可变长度的数据类型。</li>
</ul>
<h3 id="集合函数查询"><a href="#集合函数查询" class="headerlink" title="集合函数查询"></a>集合函数查询</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>AVG()</td>
<td>返回某列的平均值</td>
</tr>
<tr>
<td>COUNT()</td>
<td>返回某列的行数</td>
</tr>
<tr>
<td>MAX()</td>
<td>返回某列的最大值</td>
</tr>
<tr>
<td>MIN()</td>
<td>返回某列的最小值</td>
</tr>
<tr>
<td>SUM()</td>
<td>返回某列值之和</td>
</tr>
</tbody></table>
<blockquote>
<p>Tips:AVG() 会忽略 NULL 行。</p>
</blockquote>
<h4 id="COUNT"><a href="#COUNT" class="headerlink" title="COUNT"></a>COUNT</h4><p>COUNT()函数统计数据表中包含的记录行的总数，或者根据查询结果返回列中包含的数据行数。其使用方法有两种：</p>
<ul>
<li>COUNT(*)计算表中总的行数，不管某列是否有数值或者为空值。</li>
<li>COUNT(字段名)计算指定列下总的行数，计算时将忽略空值的行。</li>
</ul>
<p>注意事项： 两个例子中不同的数值说明了两种方式在计算总数的时候对待NULL值的方式不同：</p>
<ul>
<li>指定列的值为空的行被COUNT()函数忽略；</li>
<li>如果不指定列，而在COUNT()函数中使用星号“*”，则所有记录都不忽略。</li>
</ul>
<h4 id="SUM"><a href="#SUM" class="headerlink" title="SUM"></a>SUM</h4><p>SUM()函数在计算时，忽略列值为NULL的行。</p>
<h4 id="AVG"><a href="#AVG" class="headerlink" title="AVG"></a>AVG</h4><p>AVG()函数使用时，其参数为要计算的列名称，如果要得到多个列的多个平均值，则需要在每一列上使用AVG()函数。</p>
<h4 id="MAX"><a href="#MAX" class="headerlink" title="MAX"></a>MAX</h4><p>MAX()函数除了用来找出最大的列值或日期值之外，还可以返回任意列中的最大值，包括返回字符类型的最大值。在对字符类型数据进行比较时，按照字符的ASCII码值大小进行比较，从a~z，a的ASCII码最小，z的最大。在比较时，先比较第一个字母，如果相等，继续比较下一个字符，一直到两个字符不相等或者字符结束为止。例如，‘b’与‘t’比较时，‘t’为最大值；“bcd”与“bca”比较时，“bcd”为最大值。</p>
<h4 id="MIN"><a href="#MIN" class="headerlink" title="MIN"></a>MIN</h4><p>无</p>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><p>连接用于连接多个表，使用 JOIN 关键字，并且条件语句使用 ON 而不是 WHERE。</p>
<p>连接可以替换子查询，并且比子查询的效率一般会更快。</p>
<p>可以用 AS 给列名、计算字段和表名取别名，给表名取别名是为了简化 SQL 语句以及连接相同表。</p>
<h4 id="内连接-等值连接-INNER-JOIN"><a href="#内连接-等值连接-INNER-JOIN" class="headerlink" title="内连接(等值连接) INNER JOIN"></a>内连接(等值连接) INNER JOIN</h4><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.<span class="keyword">value</span>, B.<span class="keyword">value</span></span><br><span class="line"><span class="keyword">FROM</span> tablea <span class="keyword">AS</span> A <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tableb <span class="keyword">AS</span> B</span><br><span class="line"><span class="keyword">ON</span> A.<span class="keyword">key</span> = B.<span class="keyword">key</span>;</span><br></pre></td></tr></table></figure>

<p>可以不明确使用 INNER JOIN，而使用普通查询并在 WHERE 中将两个表中要连接的列用等值方法连接起来。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.<span class="keyword">value</span>, B.<span class="keyword">value</span></span><br><span class="line"><span class="keyword">FROM</span> tablea <span class="keyword">AS</span> A, tableb <span class="keyword">AS</span> B</span><br><span class="line"><span class="keyword">WHERE</span> A.<span class="keyword">key</span> = B.<span class="keyword">key</span>;</span><br></pre></td></tr></table></figure>

<p>注意事项：<br>使用WHERE子句定义连接条件比较简单明了，而INNER JOIN语法是ANSI SQL的标准规范，使用INNER JOIN连接语法能够确保不会忘记连接条件，而且WHERE子句在某些时候会影响查询的性能。</p>
<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><p>外连接保留了没有关联的那些行。分为左外连接，右外连接以及全外连接，左外连接就是保留左表没有关联的行。</p>
<h5 id="左连接-left-outer-join"><a href="#左连接-left-outer-join" class="headerlink" title="左连接(left (outer) join)"></a>左连接(left (outer) join)</h5><blockquote>
<p>以左表为主，先查询出 <code>左表</code>，按照ON后的关联条件匹配 <code>右表</code>，没有匹配到的用NULL填充</p>
</blockquote>
<h5 id="右连接-right-join"><a href="#右连接-right-join" class="headerlink" title="右连接(right join)"></a>右连接(right join)</h5><blockquote>
<p>以左表为主，先查询出 <code>右表</code>，按照ON后的关联条件匹配 <code>左表</code>，没有匹配到的用NULL填充</p>
</blockquote>
<p>检索所有顾客的订单信息，包括还没有订单信息的顾客。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customers.cust_id, Customer.cust_name, Orders.order_id</span><br><span class="line"><span class="keyword">FROM</span> Customers <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">ON</span> Customers.cust_id = Orders.cust_id;</span><br></pre></td></tr></table></figure>
<p>customers 表：</p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>a</td>
</tr>
<tr>
<td>2</td>
<td>b</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
</tr>
</tbody></table>
<p>orders 表：</p>
<table>
<thead>
<tr>
<th>order_id</th>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>4</td>
<td>3</td>
</tr>
</tbody></table>
<p>结果：</p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
<th>order_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>a</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>a</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
<td>4</td>
</tr>
<tr>
<td>2</td>
<td>b</td>
<td>Null</td>
</tr>
</tbody></table>
<h4 id="复合条件连接查询"><a href="#复合条件连接查询" class="headerlink" title="复合条件连接查询"></a>复合条件连接查询</h4><p>复合条件连接查询是在连接查询的过程中，通过添加过滤条件限制查询的结果，使查询的结果更加准确。</p>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>子查询指一个查询语句嵌套在另一个查询语句内部的查询，这个特性从MySQL 4.1开始引入。</p>
<p>在SELECT子句中先计算子查询，子查询结果作为外层另一个查询的过滤条件，查询可以基于一个表或者多个表。子查询中常用的操作符有ANY（SOME）、ALL、IN、EXISTS。 子查询可以添加到SELECT、UPDATE和DELETE语句中，而且可以进行多层嵌套。</p>
<p>子查询中也可以使用比较运算符，如“&lt;”“&lt;&#x3D;”“&gt;”“&gt;&#x3D;”和“!&#x3D;”等。本节将介绍如何在SELECT语句中嵌套子查询。</p>
<p>子查询中只能返回一个字段的数据。 可以将子查询的结果作为 WHRER 语句的过滤条件：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> mytable1</span><br><span class="line"><span class="keyword">WHERE</span> col1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> col2</span><br><span class="line"><span class="keyword">FROM</span> mytable2);</span><br></pre></td></tr></table></figure>

<p>下面的语句可以检索出客户的订单数量，子查询语句会对第一个查询检索出的每个客户执行一次：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> Orders.cust_id = Customers.cust_id)</span><br><span class="line"><span class="keyword">AS</span> orders_num</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name;</span><br></pre></td></tr></table></figure>

<h4 id="带ANY、SOME关键字的子查询"><a href="#带ANY、SOME关键字的子查询" class="headerlink" title="带ANY、SOME关键字的子查询"></a>带ANY、SOME关键字的子查询</h4><p>ANY和SOME关键字是同义词，表示满足其中任一条件，它们允许创建一个表达式对子查询的返回值列表进行比较，只要满足内层子查询中的任何一个比较条件，就返回一个结果作为外层查询的条件。</p>
<h4 id="带ALL关键字的子查询"><a href="#带ALL关键字的子查询" class="headerlink" title="带ALL关键字的子查询"></a>带ALL关键字的子查询</h4><p>ALL关键字与ANY和SOME不同，使用ALL时需要同时满足所有内层查询的条件。例如，修改前面的例子，用ALL关键字替换ANY。ALL关键字接在一个比较操作符的后面，表示与子查询返回的所有值比较为TRUE，则返回TRUE。</p>
<h4 id="带EXISTS关键字的子查询"><a href="#带EXISTS关键字的子查询" class="headerlink" title="带EXISTS关键字的子查询"></a>带EXISTS关键字的子查询</h4><p>EXISTS关键字后面的参数是一个任意的子查询，系统对子查询进行运算以判断它是否返回行，如果至少返回一行，那么EXISTS的结果为true，此时外层查询语句将进行查询；如果子查询没有返回任何行，那么EXISTS返回的结果是false，此时外层语句将不进行查询。</p>
<p>注意事项：EXISTS和NOT EXISTS的结果只取决于是否会返回行，而不取决于这些行的内容，所以这个子查询输入列表通常是无关紧要的。</p>
<h4 id="带IN关键字的子查询"><a href="#带IN关键字的子查询" class="headerlink" title="带IN关键字的子查询"></a>带IN关键字的子查询</h4><p>IN关键字进行子查询时，内层查询语句仅仅返回一个数据列，这个数据列里的值将提供给外层查询语句进行比较操作。</p>
<p>注意事项：子查询的功能也可以通过连接查询完成，但是子查询使得MySQL代码更容易阅读和编写。</p>
<h4 id="带比较运算符的子查询"><a href="#带比较运算符的子查询" class="headerlink" title="带比较运算符的子查询"></a>带比较运算符的子查询</h4><p>在前面介绍的带ANY、ALL关键字的子查询时使用了“&gt;”比较运算符，子查询时还可以使用其他的比较运算符，如“&lt;”“&lt;&#x3D;”“&#x3D;”“&gt;&#x3D;”和“!&#x3D;”等。</p>
<h4 id="合并查询结果"><a href="#合并查询结果" class="headerlink" title="合并查询结果"></a>合并查询结果</h4><p>利用UNION关键字，可以给出多条SELECT语句，并将它们的结果组合成单个结果集。合并时，两个表对应的列数和数据类型必须相同。各个SELECT语句之间使用UNION或UNION ALL关键字分隔。UNION不使用关键字ALL，执行的时候删除重复的记录，所有返回的行都是唯一的；使用关键字ALL的作用是不删除重复行也不对结果进行自动排序。</p>
<ul>
<li>UNION ALL 效率高于 UNION</li>
</ul>
<p>(1)UNION</p>
<blockquote>
<p>把多个结果集集中在一起，UNION前的结果为基准<br>列数要相等，相同的记录行会合并<br>合并重复项</p>
</blockquote>
<p>(2)UNION ALL</p>
<blockquote>
<p>显示重复项</p>
</blockquote>
<h4 id="使用正则表达式查询"><a href="#使用正则表达式查询" class="headerlink" title="使用正则表达式查询"></a>使用正则表达式查询</h4><img src="/blog/p/e4d2e8fb/Mysql%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%B8%B8%E7%94%A8%E5%AD%97%E7%AC%A6%E5%8C%B9%E9%85%8D%E5%88%97%E8%A1%A8.png" class="" title="Mysql正则表达式常用字符匹配列表">

<h5 id="查询以特定字符或字符串开头的记录字符"><a href="#查询以特定字符或字符串开头的记录字符" class="headerlink" title="查询以特定字符或字符串开头的记录字符"></a>查询以特定字符或字符串开头的记录字符</h5><p>‘^’匹配以特定字符或者字符串开头的文本。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> furits <span class="keyword">where</span> f_name REGEXP <span class="string">&#x27;^b&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="查询以特定字符或字符串结尾的记录字符"><a href="#查询以特定字符或字符串结尾的记录字符" class="headerlink" title="查询以特定字符或字符串结尾的记录字符"></a>查询以特定字符或字符串结尾的记录字符</h5><p>‘$’匹配以特定字符或者字符串结尾的文本。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> furits <span class="keyword">where</span> f_name REGEXP <span class="string">&#x27;y$&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="用符号”-”来替代字符串中的任意一个字符字符"><a href="#用符号”-”来替代字符串中的任意一个字符字符" class="headerlink" title="用符号”.”来替代字符串中的任意一个字符字符"></a>用符号”.”来替代字符串中的任意一个字符字符</h5><p>‘.’匹配任意一个字符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> furits <span class="keyword">where</span> f_name REGEXP <span class="string">&#x27;a.g&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="使用”-”和”-”来匹配多个字符星号"><a href="#使用”-”和”-”来匹配多个字符星号" class="headerlink" title="使用”*”和”+”来匹配多个字符星号"></a>使用”*”和”+”来匹配多个字符星号</h5><p>‘*’匹配前面的字符任意多次，包括0次。加号‘+’匹配前面的字符至少一次。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> furits <span class="keyword">where</span> f_name REGEXP <span class="string">&#x27;^ba*&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="匹配指定字符串"><a href="#匹配指定字符串" class="headerlink" title="匹配指定字符串"></a>匹配指定字符串</h5><p>正则表达式可以匹配指定字符串，只要这个字符串在查询文本中即可，如要匹配多个字符串，多个字符串之间使用分隔符‘|’隔开。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> furits <span class="keyword">where</span> f_name REGEXP <span class="string">&#x27;on&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>注意事项：LIKE运算符也可以匹配指定的字符串，但与REGEXP不同，LIKE匹配的字符串如果在文本中间出现，则找不到它，相应的行也不会返回。REGEXP在文本内进行匹配，如果被匹配的字符串在文本中出现，REGEXP将会找到它，相应的行也会被返回。</p>
<h5 id="匹配指定字符中的任意一个方括号"><a href="#匹配指定字符中的任意一个方括号" class="headerlink" title="匹配指定字符中的任意一个方括号"></a>匹配指定字符中的任意一个方括号</h5><p>“[]”指定一个字符集合，只匹配其中任何一个字符，即为所查找的文本。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> furits <span class="keyword">where</span> f_name REGEXP <span class="string">&#x27;[ot]&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> furits <span class="keyword">where</span> f_name REGEXP <span class="string">&#x27;[456]&#x27;</span>; # 指定数值集合</span><br></pre></td></tr></table></figure>
<h5 id="匹配指定字符以外的字符"><a href="#匹配指定字符以外的字符" class="headerlink" title="匹配指定字符以外的字符"></a>匹配指定字符以外的字符</h5><p>“[^字符集合]”匹配不在指定集合中的任何字符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 匹配指定字符以外的字符“[<span class="operator">^</span>字符集合]”匹配不在指定集合中的任何字符。</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> furits <span class="keyword">where</span> f_name REGEXP <span class="string">&#x27;[^a-e1-2]&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>返回记录中的f_id字段值中包含指定字母和数字以外的值，如s、m、o、t等，这些字母均不在a<del>e与1</del>2之间，满足匹配条件。</p>
<h5 id="使用-n-或者-n-m-来指定字符串连续出现的次数"><a href="#使用-n-或者-n-m-来指定字符串连续出现的次数" class="headerlink" title="使用{n,}或者{n,m}来指定字符串连续出现的次数"></a>使用{n,}或者{n,m}来指定字符串连续出现的次数</h5><p>“字符串{n,}”表示至少匹配n次前面的字符；“字符串{n,m}”表示匹配前面的字符串不少于n次，不多于m次。例如，a{2,}表示字母a连续出现至少2次，也可以大于2次；a{2,4}表示字母a连续出现最少2次，最多不能超过4次。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询f_name字段值出现字母‘x’至少<span class="number">2</span>次的记录</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> furits <span class="keyword">where</span> f_name REGEXP <span class="string">&#x27;x&#123;2,&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>f_name字段的“xxxx”包含了4个字母‘x’，“xxtt”包含两个字母‘x’，均为满足匹配条件的记录。</p>
<h2 id="插入、更新、删除数据"><a href="#插入、更新、删除数据" class="headerlink" title="插入、更新、删除数据"></a>插入、更新、删除数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 插入数据</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table_name (列_list) <span class="keyword">values</span>(值_list);</span><br><span class="line"></span><br><span class="line">## 指定字段插入数据</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table_name (列<span class="number">1</span>,...列n) <span class="keyword">values</span>(列<span class="number">1</span>的值,...列n的值);</span><br><span class="line"></span><br><span class="line"># 同时插入多条记录</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table_name (列_list)</span><br><span class="line"> <span class="keyword">values</span>(值_list),</span><br><span class="line"> ...</span><br><span class="line"> <span class="keyword">values</span>(值_list);</span><br><span class="line"></span><br><span class="line"># 更新数据</span><br><span class="line"><span class="keyword">update</span> table_name <span class="keyword">set</span> 字段<span class="number">1</span><span class="operator">=</span>值,...字段n<span class="operator">=</span>值 <span class="keyword">where</span> 条件<span class="number">1</span> <span class="keyword">and</span> 条件n;</span><br><span class="line"></span><br><span class="line"># 删除数据</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> 条件<span class="number">1</span> <span class="keyword">and</span> 条件n;</span><br></pre></td></tr></table></figure>


<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><blockquote>
<p>索引是对数据库表中一列或多列的值进行排序的一种结构，使用索引可提高数据库中特定数据的查询速度。本节将介绍索引的含义、分类和设计原则。</p>
</blockquote>
<p>InnDB文件是在mysql&#x2F;data&#x2F;数据库名&#x2F;*</p>
<p>优势</p>
<ul>
<li>减少服务器需要扫描的数据量</li>
<li>帮助服务器避免排序和临时表</li>
<li>将随机I&#x2F;O变 顺序I&#x2F;O</li>
<li>提高查询速度，降低写的速度，占用磁盘(文件存储)</li>
</ul>
<p>缺点</p>
<ul>
<li>创建索引和维护索引要耗费时间，并且随着数据量的增加所耗费的时间也会增加。</li>
<li>索引需要占磁盘空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果有大量的索引，索引文件可能比数据文件更快达到最大文件尺寸。</li>
<li>当对表中的数据进行增加、删除和修改的时候，索引也要动态地维护，这样就降低了数据的维护速度。</li>
</ul>
<h3 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h3><h4 id="普通索引-和-唯一索引"><a href="#普通索引-和-唯一索引" class="headerlink" title="普通索引 和 唯一索引"></a>普通索引 和 唯一索引</h4><p>普通索引是MySQL中的基本索引类型，允许在定义索引的列中插入重复值和空值。唯一索引要求索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。主键索引是一种特殊的唯一索引，不允许有空值。</p>
<p>唯一索引：和前面的“普通索引”基本相同，但有一个区别：索引列的所有值都只能出现一次，即必须唯一<br><code>create unique index idx_articl on article(category_id);</code></p>
<h4 id="单列索引-和-组合索引-联合索引"><a href="#单列索引-和-组合索引-联合索引" class="headerlink" title="单列索引 和 组合索引(联合索引)"></a>单列索引 和 组合索引(联合索引)</h4><ul>
<li>遵循 <b>前缀原则</b></li>
<li>将多个列组合在一起创建索引，可以覆盖多个列</li>
<li>将选择性较高的列放到索引的最前列</li>
</ul>
<p><code>create index idx_articl_ccv on article(category_id,comments,view);</code></p>
<p>单列索引即一个索引只包含单个列，一个表可以有多个单列索引。组合索引是指在表的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用。使用组合索引时遵循最左前缀集合。</p>
<h4 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h4><p>(MyISAM才能用)(不常用)(只能对英文进行全文检索)(可以使用全文检索引擎)</p>
<p>全文索引类型为FULLTEXT，在定义索引的列上支持值的全文查找，允许在这些索引列中插入重复值和空值。全文索引可以在CHAR、VARCHAR或者TEXT类型的列上创建。MySQL中只有MyISAM存储引擎支持全文索引。</p>
<h4 id="空间索引"><a href="#空间索引" class="headerlink" title="空间索引"></a>空间索引</h4><p>空间索引是对空间数据类型的字段建立的索引，MySQL中的空间数据类型有4种，分别是GEOMETRY、POINT、LINESTRING和POLYGON。MySQL使用SPATIAL关键字进行扩展，使得能够用创建正规索引类似的语法创建空间索引。创建空间索引的列，必须将其声明为NOT NULL，空间索引只能在存储引擎为MyISAM的表中创建。</p>
<h3 id="索引的设计原则"><a href="#索引的设计原则" class="headerlink" title="索引的设计原则"></a>索引的设计原则</h3><p>索引设计不合理或者缺少索引都会对数据库和应用程序的性能造成障碍。高效的索引对于获得良好的性能非常重要。设计索引时，应该考虑以下准则：<br>（1）索引并非越多越好，一个表中如有大量的索引，不仅占用磁盘空间，还会影响INSERT、DELETE、UPDATE等语句的性能，因为在表中的数据更改时，索引也会进行调整和更新。<br>（2）避免对经常更新的表进行过多的索引，并且索引中的列要尽可能少。应该经常用于查询的字段创建索引，但要避免添加不必要的字段。<br>（3）数据量小的表最好不要使用索引，由于数据较少，查询花费的时间可能比遍历索引的时间还要短，索引可能不会产生优化效果。<br>（4）在条件表达式中经常用到的不同值较多的列上建立索引，在不同值很少的列上不要建立索引。比如在学生表的“性别”字段上只有“男”与“女”两个不同值，因此就无须建立索引，如果建立索引不但不会提高查询效率，反而会严重降低数据更新速度。<br>（5）当唯一性是某种数据本身的特征时，指定唯一索引。使用唯一索引需能确保定义的列的数据完整性，以提高查询速度。<br>（6）在频繁进行排序或分组（即进行group by或order by操作）的列上建立索引，如果待排序的列有多个，可以在这些列上建立组合索引。</p>
<h3 id="索引简介"><a href="#索引简介" class="headerlink" title="索引简介"></a>索引简介</h3><p>MySQL支持多种方法在单个或多个列上创建索引：在创建表的定义语句CREATE TABLE中指定索引列，使用ALTER TABLE语句在存在的表上创建索引，或者使用CREATE INDEX语句在已存在的表上添加索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 创建普通索引</span><br><span class="line">INDEX 索引名称(字段名)</span><br><span class="line"></span><br><span class="line"># 创建唯一索引</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX 索引名称(字段名)</span><br><span class="line"></span><br><span class="line"># 创建单列索引</span><br><span class="line">INDEX SingleIdx(name(<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line"># 创建组合索引，最左原则：索引可以搜索 (id),(id,name),(id,name,age)</span><br><span class="line">INDEX MultiIdx(id,name,age)</span><br><span class="line"></span><br><span class="line"># 创建全文索引，目前只有MyISAM支持，并且只为<span class="type">CHAR</span>、<span class="type">VARCHAR</span>、TEXT列创建</span><br><span class="line">FULLTEXT INDEX FullTxtIdx(字段)</span><br><span class="line"></span><br><span class="line"># 创建空间索引，目前只有MyISAM支持，并且空间类型的字段必须是<span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">SPATIAL INDEX spatIdx(字段);</span><br><span class="line"></span><br><span class="line"># <span class="number">8.0</span>版本：创建降序索引，默认升序</span><br><span class="line">INDEX idx_a_b(a,b <span class="keyword">desc</span>)</span><br><span class="line"></span><br><span class="line"># 删除索引</span><br><span class="line"><span class="keyword">DROP</span> INDEX index_name <span class="keyword">ON</span> table_name;</span><br></pre></td></tr></table></figure>
<h3 id="索引补充"><a href="#索引补充" class="headerlink" title="索引补充"></a>索引补充</h3><p>疑问1：索引对数据库性能如此重要，应该如何使用它？<br>    为数据库选择正确的索引是一项复杂的任务。如果索引列较少，则需要的磁盘空间和维护开销都较少。如果在一个大表上创建了多种组合索引，索引文件也会膨胀很快。另一方面，索引较多可覆盖更多的查询。可能需要试验若干不同的设计，才能找到最有效的索引。可以添加、修改和删除索引而不影响数据库架构或应用程序设计。因此，应尝试多个不同的索引从而建立最优的索引。<br>疑问2：尽量使用短索引。对字符串类型的字段进行索引，如果可能，应该指定一个前缀长度。<br>    例如，有一个CHAR(255)的列，如果在前10个或30个字符内，多数值是唯一的，则不需要对整个列进行索引。短索引不仅可以提高查询速度，还可以节省磁盘空间、减少I&#x2F;O操作。</p>
<h2 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h2><p>使用存储过程的好处：</p>
<p>代码封装，保证了一定的安全性；<br>代码复用；<br>由于是预先编译，因此具有很高的性能。<br>命令行中创建存储过程需要自定义分隔符，因为命令行是以 ; 为结束符，而存储过程中也包含了分号，因此会错误把这部分分号当成是结束符，造成语法错误。</p>
<p>包含 in、out 和 inout 三种参数。</p>
<p>给变量赋值都需要用 select into 语句。</p>
<p>每次只能给一个变量赋值，不支持集合的操作。</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter <span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> <span class="title function_">myprocedure</span><span class="params">( <span class="keyword">out</span> ret int )</span></span><br><span class="line"><span class="title function_">begin</span></span><br><span class="line"><span class="title function_">declare</span> <span class="title function_">y</span> <span class="title function_">int</span>;</span><br><span class="line"><span class="keyword">select</span> sum(col1)</span><br><span class="line"><span class="keyword">from</span> mytable</span><br><span class="line"><span class="keyword">into</span> y<span class="punctuation">;</span></span><br><span class="line"><span class="keyword">select</span> y*y <span class="keyword">into</span> ret<span class="punctuation">;</span></span><br><span class="line"><span class="keyword">end</span> <span class="comment">//</span></span><br><span class="line">delimiter <span class="punctuation">;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">call</span> <span class="selector-tag">myprocedure</span>(<span class="variable">@ret</span>);</span><br><span class="line"><span class="selector-tag">select</span> @<span class="selector-tag">ret</span>;</span><br></pre></td></tr></table></figure>

<p>TODO 待补充…</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图是虚拟的表，本身不包含数据，也就不能对其进行索引操作。</p>
<p>对视图的操作和对普通表的操作一样。</p>
<p>视图具有如下好处：</p>
<p>简化复杂的 SQL 操作，比如复杂的连接；<br>只使用实际表的一部分数据；<br>通过只给用户访问视图的权限，保证数据的安全性；<br>更改数据格式和表示。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myview <span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">SELECT</span> Concat(col1, col2) <span class="keyword">AS</span> concat_col, col3*col4 <span class="keyword">AS</span> compute_col</span><br><span class="line">        <span class="keyword">FROM</span> mytable</span><br><span class="line">        <span class="keyword">WHERE</span> col5 = val;</span><br></pre></td></tr></table></figure>

<p>TODO 待补充…</p>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>TODO 待补充…</p>
<h2 id="权限与安全管理"><a href="#权限与安全管理" class="headerlink" title="权限与安全管理"></a>权限与安全管理</h2><h3 id="权限表"><a href="#权限表" class="headerlink" title="权限表"></a>权限表</h3><p>MySQL服务器通过权限表来控制用户对数据库的访问，权限表存放在MySQL数据库中，由MySQL_install_db脚本初始化。存储账户权限信息的表主要有user、db、host、tables_priv、columns_priv和procs_priv。本节将为读者介绍这些表的内容和作用。</p>
<h3 id="账户管理"><a href="#账户管理" class="headerlink" title="账户管理"></a>账户管理</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#创建用户</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span>`用户名`@`*` identified <span class="keyword">by</span><span class="string">&#x27;密码&#x27;</span>;  \*代表任意ip地址，</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span>`yzx_discuz`@`localhost` identified <span class="keyword">by</span><span class="string">&#x27;JCDS&amp;&amp;JDCAMCLA&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#删除用户</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;IP地址&#x27;</span>;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> `yzx_discuz`@`localhost`;</span><br><span class="line"></span><br><span class="line">#修改用户</span><br><span class="line"><span class="keyword">rename</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;IP地址&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;新用户名&#x27;</span>@<span class="string">&#x27;IP地址&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 修改用户的密码</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;IP地址&#x27;</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> mysql.<span class="keyword">user</span> <span class="keyword">set</span> authentication_string=<span class="keyword">password</span>(<span class="string">&#x27;JDCAMCLAJDCAMCLA&#x27;</span>) <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> mysql.<span class="keyword">user</span> <span class="keyword">set</span> authentication_string=<span class="keyword">password</span>(<span class="string">&#x27;JDCAMCLAJDCAMCLA&#x27;</span>) <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">&#x27;user&#x27;</span> <span class="keyword">and</span> Host=<span class="string">&#x27;hostname&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看权限</span><br><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> <span class="string">&#x27;用户&#x27;</span>@<span class="string">&#x27;IP地址&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> <span class="string">&#x27;yzx_discuz&#x27;</span>@<span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#授权操作</span><br><span class="line"><span class="keyword">grant</span>  权限/<span class="keyword">all</span> <span class="keyword">on</span> 数据库.表 <span class="keyword">to</span>   <span class="string">&#x27;用户&#x27;</span>@<span class="string">&#x27;IP地址&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> discuz.* <span class="keyword">to</span> <span class="string">&#x27;yzx_discuz&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;yzx_discuz&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#删除权限</span><br><span class="line"><span class="keyword">revoke</span> 权限 <span class="keyword">on</span> 数据库.表 <span class="keyword">from</span> <span class="string">&#x27;用户&#x27;</span>@<span class="string">&#x27;IP地址&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#将修改后的配置推入mysql内存</span><br><span class="line">flush <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>
<h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><p>TODO 待补充…</p>
<h3 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h3><p>TODO 待补充…</p>
<h2 id="数据备份与恢复"><a href="#数据备份与恢复" class="headerlink" title="数据备份与恢复"></a>数据备份与恢复</h2><h3 id="方案1-MySQLdump命令"><a href="#方案1-MySQLdump命令" class="headerlink" title="方案1 MySQLdump命令"></a>方案1 MySQLdump命令</h3><p>MySQLdump是MySQL提供的一个非常有用的数据库备份工具。MySQLdump命令执行时，可以将数据库备份成一个文本文件，该文件中实际包含了多个CREATE和INSERT语句，使用这些语句可以重新创建表和插入数据。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 备份数据库</span><br><span class="line">mysqldump -u user -h host -ppassword dbname[tbname, [tbname...]] &gt; /user/backup/filename.sql</span><br><span class="line"></span><br><span class="line"># 备份多个数据库</span><br><span class="line">mysqldump -u user -h host -ppassword --databases [dbname[tbname, [tbname...]], dbname[tbname, [tbname...]]] &gt; /user/backup/filename.sql</span><br><span class="line"></span><br><span class="line"># 备份所有数据库</span><br><span class="line">mysqldump -u user -h host -ppassword --all-databases &gt; /user/backup/filename.sql</span><br></pre></td></tr></table></figure>
<h3 id="方案2-直接复制整个数据库目录"><a href="#方案2-直接复制整个数据库目录" class="headerlink" title="方案2 直接复制整个数据库目录"></a>方案2 直接复制整个数据库目录</h3><p>因为MySQL表保存为文件方式，所以可以直接复制MySQL数据库的存储目录及文件进行备份。MySQL的数据库目录位置不一定相同，在Windows平台下，MySQL 8.0存放数据库的目录通常默认为“C:\Documents and Settings\All Users\Application Data\MySQL\MySQL Server 8.0\data”或者其他用户自定义目录；在Linux平台下，数据库目录位置通常为&#x2F;var&#x2F;lib&#x2F;MySQL&#x2F;，不同Linux版本下目录会有所不同，读者应在自己使用的平台下查找该目录。</p>
<p>这是一种简单、快速、有效的备份方式。要想保持备份的一致性，备份前需要对相关表执行LOCK TABLES操作，然后对表执行FLUSH TABLES。这样当复制数据库目录中的文件时，允许其他客户继续查询表。需要FLUSH TABLES语句来确保开始备份前将所有激活的索引页写入硬盘。当然，也可以停止MySQL服务再进行备份操作。</p>
<p>这种方法虽然简单，但并不是最好的方法。因为这种方法对InnoDB存储引擎的表不适用。使用这种方法备份的数据最好恢复到相同版本的服务器中，不同的版本可能不兼容。</p>
<h3 id="方案3-MySQLhotcopy工具"><a href="#方案3-MySQLhotcopy工具" class="headerlink" title="方案3 MySQLhotcopy工具"></a>方案3 MySQLhotcopy工具</h3><p>MySQLhotcopy是一个Perl脚本，最初由Tim Bunce编写并提供。它使用LOCK TABLES、FLUSH TABLES和cp或scp来快速备份数据库。它是备份数据库或单个表最快的途径，但它只能运行在数据库目录所在的机器上，并且只能备份MyISAM类型的表。MySQLhotcopy在UNIX系统中运行。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlhotcopy 数据库名<span class="number">1</span>, ... 数据库名n /user/backup</span><br></pre></td></tr></table></figure>

<p>注意事项：MySQLhotcopy只是将表所在的目录复制到另一个位置，只能用于备份MyISAM和ARCHIVE表。备份InnoDB类型的数据表时会出现错误信息。由于它复制本地格式的文件，因此也不能移植到其他硬件或操作系统下。</p>
<h3 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h3><h4 id="方案1-Mysql命令恢复"><a href="#方案1-Mysql命令恢复" class="headerlink" title="方案1 Mysql命令恢复"></a>方案1 Mysql命令恢复</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u user -p [数据库名] &lt; filename.sql</span><br></pre></td></tr></table></figure>
<h4 id="方案2-Mysql服务器-source"><a href="#方案2-Mysql服务器-source" class="headerlink" title="方案2 Mysql服务器 source"></a>方案2 Mysql服务器 source</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 登录服务器后</span><br><span class="line">use 数据库;</span><br><span class="line">source filename</span><br></pre></td></tr></table></figure>
<h3 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h3><p>TODO 待补充…</p>
<h3 id="表的导入和导出"><a href="#表的导入和导出" class="headerlink" title="表的导入和导出"></a>表的导入和导出</h3><p>TODO 待补充…</p>
<h2 id="数据库日志"><a href="#数据库日志" class="headerlink" title="数据库日志"></a>数据库日志</h2><p>TODO 待补充…</p>
<h3 id="日志简介"><a href="#日志简介" class="headerlink" title="日志简介"></a>日志简介</h3><p>MySQL日志主要分为4类，使用这些日志文件，可以查看MySQL内部发生的事情。<br>●　错误日志：记录MySQL服务的启动、运行或停止MySQL服务时出现的问题。<br>●　查询日志：记录建立的客户端连接和执行的语句。<br>●　二进制日志：记录所有更改数据的语句，可以用于数据复制。<br>●　慢查询日志：记录所有执行时间超过long_query_time的所有查询或不使用索引的查询。</p>
<p>默认情况下，所有日志创建于MySQL数据目录中。通过刷新日志，可以强制MySQL关闭和重新打开日志文件（或者在某些情况下切换到一个新的日志）。当执行一个FLUSH LOGS语句或执行MySQLadmin flush-logs或MySQLadmin refresh时，将刷新日志。</p>
<p>如果正使用MySQL复制功能，在复制服务器上可以维护更多日志文件，这种日志称为接替日志。</p>
<p>启动日志功能会降低MySQL数据库的性能。例如，在查询非常频繁的MySQL数据库系统中，如果开启了通用查询日志和慢查询日志，MySQL数据库会花费很多时间记录日志。同时，日志会占用大量的磁盘空间。</p>
<h3 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h3><p>二进制日志主要记录MySQL数据库的变化。二进制日志以一种有效的格式并且是事务安全的方式包含更新日志中可用的所有信息。二进制日志包含了所有更新了数据或者已经潜在更新了数据（例如，没有匹配任何行的一个DELETE）的语句。语句以“事件”的形式保存，描述数据更改。</p>
<p>二进制日志还包含关于每个更新数据库的语句的执行时间信息。它不包含没有修改任何数据的语句。如果想要记录所有语句（例如，为了识别有问题的查询），需要使用一般查询日志。使用二进制日志的主要目的是最大可能地恢复数据库，因为二进制日志包含备份后进行的所有更新。本节将介绍二进制日志相关的内容。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my.ini</span></span><br><span class="line">log-bin <span class="section">[=path/[filename]]</span></span><br><span class="line"><span class="attr">expire_logs_days</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">max_binlog_size</span> = <span class="number">100</span>M</span><br></pre></td></tr></table></figure>
<h3 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h3><h3 id="通用查询日志"><a href="#通用查询日志" class="headerlink" title="通用查询日志"></a>通用查询日志</h3><h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h3><h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><h2 id="优化简介"><a href="#优化简介" class="headerlink" title="优化简介"></a>优化简介</h2><h3 id="优化查询"><a href="#优化查询" class="headerlink" title="优化查询"></a>优化查询</h3><h3 id="优化数据库结构"><a href="#优化数据库结构" class="headerlink" title="优化数据库结构"></a>优化数据库结构</h3><h3 id="优化Mysql服务器"><a href="#优化Mysql服务器" class="headerlink" title="优化Mysql服务器"></a>优化Mysql服务器</h3><h3 id="临时表性能优化"><a href="#临时表性能优化" class="headerlink" title="临时表性能优化"></a>临时表性能优化</h3><h3 id="服务器语句超时处理"><a href="#服务器语句超时处理" class="headerlink" title="服务器语句超时处理"></a>服务器语句超时处理</h3><h3 id="创建全局通用表空间"><a href="#创建全局通用表空间" class="headerlink" title="创建全局通用表空间"></a>创建全局通用表空间</h3><h2 id="Mysql复制"><a href="#Mysql复制" class="headerlink" title="Mysql复制"></a>Mysql复制</h2><h3 id="复制简介"><a href="#复制简介" class="headerlink" title="复制简介"></a>复制简介</h3><h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><h3 id="日常管理和维护"><a href="#日常管理和维护" class="headerlink" title="日常管理和维护"></a>日常管理和维护</h3><h3 id="切换主从服务器"><a href="#切换主从服务器" class="headerlink" title="切换主从服务器"></a>切换主从服务器</h3><h3 id="多源复制的改进"><a href="#多源复制的改进" class="headerlink" title="多源复制的改进"></a>多源复制的改进</h3><h2 id="Workbench"><a href="#Workbench" class="headerlink" title="Workbench"></a>Workbench</h2><h3 id="Workbench简述"><a href="#Workbench简述" class="headerlink" title="Workbench简述"></a>Workbench简述</h3><p>MySQL Workbench是下一代可视化数据库设计软件，为数据库管理员和开发人员提供了一整套可视化数据库操作环境</p>
<p>主要功能有：</p>
<ul>
<li>数据库设计和模型建立。</li>
<li>SQL开发（取代MySQL Query Browser）。</li>
<li>数据库管理（取代MySQL Administrator）。</li>
</ul>
<p>MySQL Workbench有两个版本：<br>（1）MySQL Workbench Community Edition（也叫MySQL Workbench OSS，社区版），是在GPL证书下发布的开源社区版本。<br>（2）MySQL Workbench Standard Edition（也叫MySQL Workbench SE，商业版），是按年收费的商业版本。</p>
<h3 id="SQL-Development的基本操作"><a href="#SQL-Development的基本操作" class="headerlink" title="SQL Development的基本操作"></a>SQL Development的基本操作</h3><h3 id="Data-Modeling的基本操作"><a href="#Data-Modeling的基本操作" class="headerlink" title="Data Modeling的基本操作"></a>Data Modeling的基本操作</h3><h3 id="Server-Administration的基本操作"><a href="#Server-Administration的基本操作" class="headerlink" title="Server Administration的基本操作"></a>Server Administration的基本操作</h3><h2 id="管理神器-Mysql-Utilities"><a href="#管理神器-Mysql-Utilities" class="headerlink" title="管理神器 Mysql Utilities"></a>管理神器 Mysql Utilities</h2><h3 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h3><h3 id="安装与配置-1"><a href="#安装与配置-1" class="headerlink" title="安装与配置"></a>安装与配置</h3><h3 id="管理与维护"><a href="#管理与维护" class="headerlink" title="管理与维护"></a>管理与维护</h3><h2 id="读写分离神器-Mysql-Proxy"><a href="#读写分离神器-Mysql-Proxy" class="headerlink" title="读写分离神器 Mysql Proxy"></a>读写分离神器 Mysql Proxy</h2><h3 id="简述-1"><a href="#简述-1" class="headerlink" title="简述"></a>简述</h3><h3 id="安装与配置-2"><a href="#安装与配置-2" class="headerlink" title="安装与配置"></a>安装与配置</h3><h3 id="管理与维护-1"><a href="#管理与维护-1" class="headerlink" title="管理与维护"></a>管理与维护</h3><h2 id="实战应用"><a href="#实战应用" class="headerlink" title="实战应用"></a>实战应用</h2><h3 id="开发规范"><a href="#开发规范" class="headerlink" title="开发规范"></a>开发规范</h3><h4 id="字符集-1"><a href="#字符集-1" class="headerlink" title="字符集"></a>字符集</h4><ol>
<li><p>统一字符集，建议UTF8mb4<br>常用的字符集包括:Latin1、gbk、utf8、utf8mb4。</p>
<img src="/blog/p/e4d2e8fb/mysql%E5%AD%97%E7%AC%A6%E9%9B%86.png" class="" title="mysql字符集">
</li>
<li><p>统一排序规则<br>目前互联网上以UTF8mb4字符集为主，是官方8.0默认字符集。在之前的5.5、5.6、5.7版本是建表使用的Utf8，排序规 则是默认“utf8_general_ci”。在8.0之前UTF8mb4独有的默认排序方式是“utf8_general_ci”,在8.0之后默认规则为 “utf8mb4_0900_ai_ci”，所以有时会出现不同版本间字符集排序规则不兼容的问题，需要注意。</p>
</li>
</ol>
<h4 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h4><p>1.统一字段名&#x2F;类型<br>统一字段名是为了解决业务歧义问题。MySQL内部系统Information_schema下边的Tables表，假设按照不规范的 命名如“table_name”字段可能就会命名成“name”。如果这时Columns表中的COLUMN_NAME字段也命名 为“Name”字段，在查询的时候，可能会导致意义上的混乱。统一类型是为了解决隐式转换问题，包括表的连接、查询 都会存在隐式转换问题。<br>2.字段长度 varchar(255)<br>常见的问题是字段长度都配置为varchar(255)，在不知道业务将来存多少长度的情况下，先设成255，在开发阶段可能比 较方便，但存在性能隐患。比如索引评估，在一个255列长的字段上建索引，实际索引评估会考虑列长，如果默认255长度，会导致索引使用时评估不准确。<br>再比如字段，如果字段有2个255或3个255要做复合索引时，虽然真实的值可能每个字段长度只存了10或20，在默认参数 配置下会发现索引由于太长建不出来，对线上维护与后续业务开发都有影响。<br>3.定义 id int primary key<br>PK 在业务中建议强制必须建立。可以保证主从架构下的数据一致性以及避免复制时性能问题。另一个是主键要如果采用 数值型建议使用无符号类型，一般来说在一个表里ID肯定是自增的，不存在负值，如果定义一个有符号Int，会导致Int可用 的值少一半。因为Int最大的值在有符号情况下是21亿，如果定义成无符号最大可以到42亿。说明数据快速增长时，有符号 类型导致ID或某个自增长满的问题。<br>4.禁止Null值<br>Null &amp; Null &#x3D;?。比如在排序场景下，两个行按某个允许null的列值做排序，如果不存储有意义的值，默认为null值的情况 下，会导致一个随机的顺序，实际上就是业务上的乱序。 又比如无主键表情况下，会导致复制数据不一致的问题，所以要 禁止空值。</p>
<h4 id="索引-1"><a href="#索引-1" class="headerlink" title="索引"></a>索引</h4><p>0%的语句性能问题都可以靠索引解决，但索引有几个问题:<br>第一，单列索引要充分评估，比如有20个列，每个列上都有1个单列的情况，会造成对写入的影响很大，同时单列索引的 建议一定要评估可选择性。<br>第二，定期Review索引有效性，索引是不是在业务中真正使用在MySQL里相对不好定位，失效索引在业务快速发展频 繁变更的场景下会很常见，随着新业务新添加很多新索引，这时要看新的索引是不是已经覆盖之前的旧索引，此时旧索引 实际上是没有用的。维护无效索引要多一份IO成本，删除除重复索引保留有效的即可。<br>第三，不要走极端，包括两点:复合索引所有列与所有列都建单列索引。 比如一张表有七八个列，只在单列有索引，因为索引有回表不回表的区别，所以直接建立一个包含所有列复合索引，这个<br>方法不可取，虽然提升了查询的效率，但等于又另外维护了一张所有字段都要排序的表。 所有列都建单列索引，实际上跟是复合索引所有列是一样的。主要消耗会出现索引维护上。 索引有关内容，请关注【MySQL表和索引优化实战】课程。</p>
<h3 id="SQL语句编写规范"><a href="#SQL语句编写规范" class="headerlink" title="SQL语句编写规范"></a>SQL语句编写规范</h3><h4 id="一-规范语法"><a href="#一-规范语法" class="headerlink" title="(一)规范语法"></a>(一)规范语法</h4><p>不兼容语法:</p>
<ul>
<li><code>Select * from sbtest.sbtest1 group by id;</code></li>
<li><code>Select id,count(*) from sbtest.sbtest1 group by id desc;</code></li>
</ul>
<p>MySQL是一个相对成熟的产品，但它支持的一些语法并不标准，比如“Select * from sbtest.sbtest1 group by id;”在传 统的数据库如Oracle和其他关系型数据库里中是非法的语法，系统不支持，而“Select id,count(*) from sbtest.sbtest1 group by id desc;”在 8.0版本已经淘汰。随着MySQL语法越来越规范化，在版本升级后，这种不兼容语法可能会带来应 用或语句报错，因此在实际环境下不建议使用。</p>
<h4 id="二-别名"><a href="#二-别名" class="headerlink" title="(二)别名"></a>(二)别名</h4><p><code>Select id,count(*) id_count from sbtest.sbtest1 group by id;</code><br>所有返回列要给有意义的命名，与列名原则一致，强制AS关键词，防止造成语意不清。</p>
<h4 id="三-执行顺序"><a href="#三-执行顺序" class="headerlink" title="(三)执行顺序"></a>(三)执行顺序</h4><p>执行顺序如下:</p>
<ol>
<li>FROM,(-including JOIN )</li>
<li>WHERE</li>
<li>GROUP BY</li>
<li>HAVING</li>
<li>WINDOW functions</li>
<li>SELECT</li>
<li>DISTINCT</li>
<li>UNION</li>
<li>ORDER BY</li>
<li>LIMIT and OFFSET ·语句性能应注意两个方面:<br>1)数据流的流向;<br>2)order by limit场景。<br>从执行顺序上看，在SELECT之前的所有子语都是在做数据筛选，SELECT以后开始执行运算，用户应注意数据流的流 向。order by limit一般是在最后运行，如果在一开始运行，有时候会造成返回数据量过大，进而导致执行时间过长。<br>·数据返回逻辑应注意两个方面:<br>1)数据的筛选机制;<br>2)left join where场景。<br>许多用户的概念中都是先做WHERE再做JOIN，这是错误的。例如在做Left Join时，先获得所有数据，再通过Where筛 选数据。用户应注意梳理流向，才能最优地输出数据。</li>
</ol>
<h4 id="四-如何判断语句是否已最优explain"><a href="#四-如何判断语句是否已最优explain" class="headerlink" title="(四)如何判断语句是否已最优explain"></a>(四)如何判断语句是否已最优explain</h4><img src="/blog/p/e4d2e8fb/%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5%E6%98%AF%E5%90%A6%E5%B7%B2%E6%9C%80%E4%BC%98explain.png" class="" title="如何判断语句是否已最优explain">

<p>如上图所示，用户可以通过Explain判断语句是否已最优，其中Type与Extra的主要类型与含义如下:<br><strong>Type</strong></p>
<ol>
<li>ALL:Full Table Scan 全表扫描;</li>
<li>index: Full Index Scan，索引扫描;</li>
<li>range:范围扫描;</li>
<li>ref: 表示连接匹配条件;</li>
<li>eq_ref: 类似ref，区别就在使用的索引是唯一索引;</li>
<li>const: 常量查询，比如pk等值;</li>
<li>system是Const类型的特例;当查询的表只有一行的情况下，使用system。</li>
</ol>
<p>从性能角度来看，从上往下性能越来越高，根据《开发手册》，此处最低要求是到Range范围扫描。</p>
<p><strong>Extra</strong></p>
<ol>
<li>Using filesort 排序;</li>
<li>Using index 使用索引可以返回请求列;</li>
<li>Using index condition 通过索引初步过滤;回表再过滤其它条件;</li>
<li>Using temporary 临时表;</li>
<li>Using where 单独出现时;一般代表表上出现全表扫描过滤;</li>
<li>Using index &amp; Using where 使用索引返回数据;同时通过索引过滤。</li>
</ol>
<p>Extra反映了执行计划的真实执行情况。</p>
<p>结合上图执行计划分析，C表是外部驱动表，索引方式为idx_pk，Type是Range，Extra有Using index condition、Using where以及Using MRR，表示进行全表扫描，通过索引初步过滤，回表B再过滤其他条件。B表是从外表取数据做内循环， 索引方式为i_text，扫描的列为c.b.KeyNo，这种情况说明这个执行计划相对完善。</p>
<h4 id="五-禁止与建议"><a href="#五-禁止与建议" class="headerlink" title="(五)禁止与建议"></a>(五)禁止与建议</h4><p>SQL的语句编写包含一些禁止项与建议项语句，用户深入了解与熟练掌握这些内容能够更好地开展业务。</p>
<p><strong>禁止项</strong></p>
<ol>
<li>select *，返回无用数据，过多IO消耗，以及Schema 变更问题;</li>
<li>Insert语句指定具体字段名称，不要写成insert into t1 values(…)，道理同上;</li>
<li>禁止不带WHERE，导致全表扫描以及误操作;</li>
<li>Where条件里等号左右字段类型必须一致，否则可能 会产生隐式转换，无法利用索引;</li>
<li>索引列不要使用函数或表达式，否则无法利用索引。<br>如where length(name)&#x3D;‘Admin’或where user_id+2&#x3D;5;</li>
<li>Replace into，会导致主备不一致; 7. 业务语句中带有DDL操作，特别是Truncate。</li>
</ol>
<p><strong>建议项</strong></p>
<ol>
<li>减小三表以上Join;</li>
<li>用Union all 替代Union;</li>
<li>使用Join 替代子查询;</li>
<li>不要使用 like ‘%abc%’，可以使用 like ‘abc%’;</li>
<li>Order by &#x2F;distinct &#x2F;group by 都可以利用索引有序性;</li>
<li>减少使用event&#x2F;存储过程，通过业务逻辑实现;</li>
<li>减小where in() 条件数据量;</li>
<li>减少过于复杂的查询和拼串写法。</li>
</ol>
<h4 id="六-用数据库的思维考虑SQL"><a href="#六-用数据库的思维考虑SQL" class="headerlink" title="(六)用数据库的思维考虑SQL"></a>(六)用数据库的思维考虑SQL</h4><p>我们提倡用户用数据库的思维考虑SQL，由于数据库要处理的是数据集而非单行数据，因此与开发的逻辑不太一样。<br>在开发逻辑中，有时候会希望通过用一个语句解决所有问题，但这在数据库中会导致SQL语句过大甚至上万行，过于复杂 的查询使得执行计划不稳定。因此我们倡导少即是美，每一层结果集都要最大限度地减小。<br>数据库中无法用开发应用的逻辑写语句，而应把所有的运算、判断应用逻辑都放到SQL实现。存储过程使用过重的话，会 导致难以调适、定位问题。同时，应减少单条数据集处理，减少数据访问与扫描。<br>对于新Feature，在未经过充分测试的情况下，应谨慎考虑使用到生产中，防止造成Bug或存在性能上的问题。</p>
<h4 id="七-SQL改写"><a href="#七-SQL改写" class="headerlink" title="(七)SQL改写"></a>(七)SQL改写</h4><p>SQL有一些编写规范，这些规范是在优化日常问题时总结而来，下面举例说明。<br><strong>SQL改写-join</strong><br>select count(a.id) from sbtest1 a left join sbtest2 b on a.id&#x3D;b.id</p>
<img src="/blog/p/e4d2e8fb/sql%E6%94%B9%E5%86%99join.png" class="" title="sql改写join">

<p>如上图所示，请注意Join键为PK，也就是左表右表应该是1对1的关系，在Left Join的情况下，可以理解成返回的数据全部 是左边的数据，也就是“a”表的数据，执行时间大概为20秒。</p>
<img src="/blog/p/e4d2e8fb/sql%E6%94%B9%E5%86%99join-2.png" class="" title="sql改写join-2">

<p>如上图说是，可以将“select count(a.id) from sbtest1 a left join sbtest2 b on a.id&#x3D;b.id;”简化为“select count(a.id) from sbtest1 a”，执行时间缩减到3秒左右，大幅提升执行效率。</p>
<p>SQL改写一般会出现在复杂查询的Join场景中，除去显式Join(left join与right join)，还包括半连接(exists,in)和反连 接(not exists,not in)。</p>
<p>此类查询过慢时，请参考执行计划，考虑是否可通过SQL改写优化。</p>
<p><strong>SQL改写-分页统计</strong><br>分页统计是一种常见的业务逻辑，例如我们现在有一条分页语句: select a.id from sbtest1 a left join sbtest2 b on a.id&#x3D;b.id limit 200,20; 取总数据量:<br>select count(*) from<br>(select a.id from sbtest1 a left join sbtest2 b on a.id&#x3D;b.id) as a;</p>
<img src="/blog/p/e4d2e8fb/sql%E6%94%B9%E5%86%99%E5%88%86%E9%A1%B5%E7%BB%9F%E8%AE%A1.png" class="" title="sql改写分页统计">

<p>分页统计是一种常见的业务逻辑，比如有1万条数据需要分页，常见的处理方法是把以上所有的语句逻辑框起来，在外面 加“Count”，这种做法会导致语句冗余，且执行时间长。改写的方法有:<br>改写1:<code>select count(a.id) from sbtest1 a left join sbtest2 b on a.id=b.id; </code><br>改写2:<code>select count(a.id) from sbtest1 a;</code></p>
<img src="/blog/p/e4d2e8fb/sql%E6%94%B9%E5%86%99%E5%88%86%E9%A1%B5%E7%BB%9F%E8%AE%A1-2.png" class="" title="sql改写分页统计-2">

<p>如上图所示，两种改写方式的执行计划与最初写法的语义逻辑上无本质区别，第一种改写后执行时间为15秒，第二种改写 后执行时间为0.25秒，且语句更加简单。</p>
<p>此类改写目的:</p>
<ol>
<li>精简语句，简化语句逻辑;</li>
<li>进一步寻找优化空间。</li>
</ol>
<h3 id="事务的使用与优化"><a href="#事务的使用与优化" class="headerlink" title="事务的使用与优化"></a>事务的使用与优化</h3><h4 id="一-事务是什么"><a href="#一-事务是什么" class="headerlink" title="(一)事务是什么?"></a>(一)事务是什么?</h4><p>事务是指访问并可能更新数据库中各种数据项的一个程序执行单元(Unit)。<br>事务应该具有四个属性:</p>
<ul>
<li>原子性(Atomicity)</li>
<li>一致性(Consistency)</li>
<li>隔离性(Isolation)</li>
<li>持久性(Durability)</li>
</ul>
<p>这四个属性通常称为ACID特性。</p>
<p>目前生产环境所用的隔离级别较多，主要有以下四种:</p>
<ol>
<li>Read Uncommitted</li>
<li>Read Committed(一般采用)</li>
<li>Repeatable Read (官方默认)</li>
<li>Serializable</li>
</ol>
<p>关于事务需要强调一点:大事务不等于长事务。 例如:</p>
<ol>
<li>Insert table batch 它是个大事务，但它可能并不长。</li>
<li>Begin<br>insert single data<br>sleep(3600)<br>Commit 这是个长事务，但不是大事务。</li>
</ol>
<p>同时要说一下，有些DDL本身是原子性的，包括加列、建索引，事务可能大且长。</p>
<h4 id="二-事务的问题"><a href="#二-事务的问题" class="headerlink" title="(二)事务的问题"></a>(二)事务的问题</h4><p>长事务和大事务可能存在以下问题:</p>
<ol>
<li><p>Undo 异常增长<br>导致Ibdata空间问题，增加存储成本，也会使得Hitory List过长，导致严重的性能问题。</p>
</li>
<li><p>Binlog 异常增长<br>由于单个事务不拆分存放，会导致某一个或者某一些Binlog非常的大，做复制或主从时会产生一定问题。</p>
</li>
<li><p>Slave延迟<br>DDL类，写入等，DDL是语句级回放，Slave要等到执行结束后再继续。</p>
</li>
<li><p>锁问题<br>死锁、阻塞。 针对大事务与长事务做出优化:</p>
<ul>
<li>大事务<ol>
<li>大事务拆分为小事务;</li>
<li>DDL拆分(无锁变更)。</li>
</ol>
</li>
<li>长事务<ol>
<li>合并为大事务(特别合适应用于写入场景，对写提升很大，而且数据不会特别长);</li>
<li>事务分解(不必要的请求摘除);</li>
<li>应用侧保证一致性。</li>
</ol>
</li>
</ul>
<p>事务使用基本原则:在保证业务逻辑的前提下，尽可能缩短事务长度。</p>
</li>
</ol>
<h4 id="三-事务问题定位"><a href="#三-事务问题定位" class="headerlink" title="(三)事务问题定位"></a>(三)事务问题定位</h4><ol>
<li>长事务问题定位<br>定位命令:<code>Information_schema.innodb_trx</code><br>例如:<code>SELECT trx.trx_id, trx.trx_started, trx.trx_mysql_thread_id FROM INFORMATION_SCHEMA.INNODB_TRX trx WHERE trx.trx_started &lt; CURRENT_TIMESTAMP - INTERVAL 1 SECOND</code></li>
<li>锁问题定位<br>8.0以前:information_schema.innodb_lock_waits、innodb_locks。<br>8.0及以后:performance_schema. data_lock_waits、data_locks。<img src="/blog/p/e4d2e8fb/%E9%94%81%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D.png" class="" title="锁问题定位"></li>
</ol>
<h3 id="其他最佳实践"><a href="#其他最佳实践" class="headerlink" title="其他最佳实践"></a>其他最佳实践</h3><h4 id="一-分页问题"><a href="#一-分页问题" class="headerlink" title="(一)分页问题"></a>(一)分页问题</h4><p>分页的传统写法：<code>select * from sbtest1 order by id limit M,N;</code></p>
<p>它存在的问题点:需要扫描大量无效数据后，再返回请求数据，成本很高。</p>
<p>根据业务需求，有以下三种解决方法:</p>
<ol>
<li>适用顺序翻页的场景，每次记录上一页#max_id#带入下一次查询中。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sbtest1 <span class="keyword">where</span> id <span class="operator">&gt;</span> #max_id# <span class="keyword">order</span> <span class="keyword">by</span> id limit n;</span><br></pre></td></tr></table></figure></li>
<li>适用只按照id进行分页，无Where条件。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sbtest1 <span class="keyword">as</span> a <span class="keyword">inner</span> <span class="keyword">join</span> (<span class="keyword">select</span> id <span class="keyword">from</span> sbtest1 <span class="keyword">order</span> <span class="keyword">by</span> id limit m, n) <span class="keyword">as</span> b <span class="keyword">on</span> a.id <span class="operator">=</span> b.id <span class="keyword">order</span> <span class="keyword">by</span> a.id;</span><br></pre></td></tr></table></figure></li>
<li>适用于带Where条件，同时按照ID顺序分页。此时，需要在Where条件上创建二级索引。 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sbtest1 <span class="keyword">as</span> a <span class="keyword">inner</span> <span class="keyword">join</span> (<span class="keyword">select</span> id <span class="keyword">from</span> sbtest1where col<span class="operator">=</span>xxxx <span class="keyword">order</span> <span class="keyword">by</span> id limit m, n) <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">on</span> a.id <span class="operator">=</span> b.id <span class="keyword">order</span> <span class="keyword">by</span> a.id;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="二-大表数据清理"><a href="#二-大表数据清理" class="headerlink" title="(二)大表数据清理"></a>(二)大表数据清理</h4><p><strong>1. 数据清理场景</strong><br>一般的数据清理场景为历史数据清理，例如数据归档、Delete等。 这里经常存在的问题有:</p>
<ol>
<li>单次Delete行数过多，容易导致锁堵塞、主从复制延迟、影响线上业务;</li>
<li>易失败，死锁、超时等。</li>
</ol>
<p>解决的建议方案:</p>
<ol>
<li>伪代码<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="built_in">min</span>(id),<span class="built_in">max</span>(id) <span class="keyword">from</span> t <span class="keyword">where</span> gmt_create<span class="operator">&lt;</span>$<span class="type">date</span></span><br><span class="line"><span class="keyword">For</span> I <span class="keyword">in</span> “<span class="built_in">max</span>(id)<span class="operator">-</span><span class="built_in">min</span>(id)<span class="operator">/</span><span class="number">1000</span></span><br><span class="line"><span class="keyword">Delete</span> <span class="keyword">from</span> t <span class="keyword">where</span> id<span class="operator">&gt;=</span><span class="built_in">min</span>(id) <span class="keyword">and</span> id<span class="operator">&lt;</span><span class="built_in">min</span>(id)<span class="operator">+</span><span class="number">1000</span> <span class="keyword">and</span> gmt_create<span class="operator">&lt;</span>$<span class="type">date</span> ......</span><br></pre></td></tr></table></figure></li>
<li>定期Optimize Table回收碎片。</li>
</ol>
<p><strong>2. 全表数据清理</strong><br>常用的方法: 用Truncate删掉整张表的数据。<br>存在问题: 大表(如:&gt;100G)，Truncate期间会造成IO持续抖动。<br>解决方案: 硬连接方式后Truncate，异步Trim文件。</p>
<h4 id="三-隐式转换问题"><a href="#三-隐式转换问题" class="headerlink" title="(三)隐式转换问题"></a>(三)隐式转换问题</h4><p>隐式转换问题发生在比较值类型不一致的场景下，除去一些规定情况，所有的比较最终都是转换为浮点数进行。</p>
<ul>
<li><code>Create table testtb(id varchar(10) primary key);</code></li>
<li><code>Select * from testtb where id=1;</code></li>
</ul>
<p>此类问题在编写sql语句时很难发现，上线可能会导致严重的性能问题。</p>
<h4 id="四-循环"><a href="#四-循环" class="headerlink" title="(四)循环"></a>(四)循环</h4><blockquote>
<p>开发环境中的循环分为外部循环与内部循环。</p>
</blockquote>
<p><strong>1. 外部循环</strong><br>外部循环在应用侧实现，主要问题来自每次请求的RT。 例如:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i<span class="operator">=</span><span class="number">0</span>;i<span class="operator">+</span><span class="operator">+</span>;i<span class="operator">&lt;</span><span class="number">500</span> </span><br><span class="line">    <span class="keyword">insert</span>(db 交互) </span><br><span class="line">    next</span><br><span class="line">rt<span class="operator">=</span>single rt<span class="operator">*</span> total count</span><br></pre></td></tr></table></figure>
<p>建议Batch一次写入。</p>
<p><strong>2. 内部循环</strong><br>内部循环常用在存储过程，事务无法保证。<br>例如:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">While do </span><br><span class="line">    <span class="keyword">insert</span>;</span><br><span class="line">    <span class="keyword">Commit</span>; </span><br><span class="line"><span class="keyword">end</span> while</span><br></pre></td></tr></table></figure>
<p>存在频繁Commit问题，造成IO上的冲击。</p>
<p>或:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Begin</span> tran </span><br><span class="line">While do</span><br><span class="line">    <span class="keyword">insert</span>; </span><br><span class="line"><span class="keyword">end</span> while </span><br><span class="line"><span class="keyword">Commit</span></span><br></pre></td></tr></table></figure>
<p>无法保证数据一致性，以及事务过长。</p>
<h4 id="五-存储过程中的事务处理"><a href="#五-存储过程中的事务处理" class="headerlink" title="(五)存储过程中的事务处理"></a>(五)存储过程中的事务处理</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> insertTest(<span class="keyword">IN</span> num <span class="type">int</span>) <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> errno <span class="type">int</span>;</span><br><span class="line">    <span class="keyword">declare</span> i <span class="type">int</span>;</span><br><span class="line">    <span class="keyword">declare</span> continue HANDLER <span class="keyword">for</span> <span class="keyword">sqlexception</span> <span class="keyword">set</span> errno<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">start</span> transaction; <span class="keyword">set</span> i<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">while i<span class="operator">&lt;</span>num do</span><br><span class="line">    <span class="keyword">INSERT</span> testfor <span class="keyword">VALUES</span>(i);</span><br><span class="line">    <span class="keyword">set</span> i<span class="operator">=</span>i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span> while;</span><br><span class="line"></span><br><span class="line">if errno<span class="operator">=</span><span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">rollback</span>; </span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">commit</span>; </span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<p>以上方为例，在BEGIN Train后，下面最终有一个Commit。如果这里是一个重复键值，但前面已经插了10条数据，这10条 数据是不回滚的，所以这个事务要直接在这里声明捕捉错误，然后回滚整个事务，才能完成这整个存储过程的回滚。</p>
<h4 id="六-常见问题"><a href="#六-常见问题" class="headerlink" title="(六)常见问题"></a>(六)常见问题</h4><p><strong>1. Where 后面的列顺序是不是要符合最左原则?</strong><br>Where a&#x3D;1 and b&#x3D;2 等价于 Where b&#x3D;2 and a&#x3D;1<br>最左原则指的是索引顺序，不是谓词顺序，以上两个条件都匹配( a,b) 复合索引。</p>
<p><strong>2. Join 的顺序是否指定左边为驱动表?</strong><br>Inner Join场景下，在执行计划中按统计信息的预估自动选中驱动表，Left Join ,Right Join 时左右写的顺序才有显式意义。</p>
<p><strong>3. 业务上有随机返回的需求，能否用order by rand()</strong><br>一般不建议，如果结果集非常小，勉强可用，但结果集大时由于随机数排序，会产生Sort操作甚至溢出到磁盘，有很大性 能损耗，此类需求可以考虑伪随机算法。</p>
<p><strong>4. Delete数据之后，为什么磁盘空间占用反而大了?</strong><br>Delete数据并不能清理数据文件空间，反而会导致Undo,Binlog文件的增长，使用Optimize收缩。</p>
<p><strong>5. Binlog是否一定要Row格式?</strong><br>在主从场景下，Binlog使用Row格式是为了保证主从数据一致性。<br>单机场景下，Binlog做为增长数据备份使用，同时也包括一些语句级数据恢复的功能。</p>
<p><strong>6. 死锁、阻塞的区别</strong><br>通常说的阻塞，主要是由于锁获取不到，产生的请求被阻塞，一般需要手动解锁(Kill或等待)。<br>死锁不等于阻塞，虽然死锁中阻塞是必现的，但是会自动回滚事务解锁，不用手动处理，但需要业务判断语句逻辑。</p>
<p>以上两种情况都是由于业务侧逻辑出现，并非内核原因。</p>
<p><strong>7. 做DDL时是否会锁表</strong><br>所有的DDL都需要锁表，只是操作顺序和操作获取时间的问题。如下图所示，允许并发DDL是No，就证明对业务有一些 阻塞。</p>
<img src="/blog/p/e4d2e8fb/%E5%81%9ADDL%E6%97%B6%E6%98%AF%E5%90%A6%E4%BC%9A%E9%94%81%E8%A1%A8.png" class="" title="做DDL时是否会锁表">

<h4 id="表和索引优化实战"><a href="#表和索引优化实战" class="headerlink" title="表和索引优化实战"></a>表和索引优化实战</h4><p>TODO，待补充</p>
<h4 id="日常运维开发的使用的规范和建议"><a href="#日常运维开发的使用的规范和建议" class="headerlink" title="日常运维开发的使用的规范和建议"></a>日常运维开发的使用的规范和建议</h4><img src="/blog/p/e4d2e8fb/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E7%9A%84%E4%BD%BF%E7%94%A8%E7%9A%84%E8%A7%84%E8%8C%83%E5%92%8C%E5%BB%BA%E8%AE%AE-01.png" class="" title="MySQL数据库的日常运维开发的使用的规范和建议-01">

<img src="/blog/p/e4d2e8fb/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91%E7%9A%84%E4%BD%BF%E7%94%A8%E7%9A%84%E8%A7%84%E8%8C%83%E5%92%8C%E5%BB%BA%E8%AE%AE-02.png" class="" title="MySQL数据库的日常运维开发的使用的规范和建议-02">

<h3 id="Mysql优化"><a href="#Mysql优化" class="headerlink" title="Mysql优化"></a>Mysql优化</h3><h4 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h4><h5 id="优化目的"><a href="#优化目的" class="headerlink" title="优化目的"></a>优化目的</h5><blockquote>
<p>提高资源的利用率，让资源充分发挥价值，能同时满足更多用户的在线需求。</p>
</blockquote>
<h5 id="如何优化"><a href="#如何优化" class="headerlink" title="如何优化"></a>如何优化</h5><img src="/blog/p/e4d2e8fb/%E4%BC%98%E5%8C%96%E7%9B%AE%E6%A0%87%EF%BC%9A%E9%92%88%E5%AF%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B5%84%E6%BA%90%E5%8E%BB%E8%A7%A3%E5%86%B3.png" class="" title="优化目标：针对服务器资源去解决">

<img src="/blog/p/e4d2e8fb/%E4%BC%98%E5%8C%96%E6%89%8B%E6%AE%B5.png" class="" title="优化手段.png">
<p>上金字塔从下往上优化，成本是逐步提升的，效果反而越来越差。通常来说，<code>SQL及索引调优</code> 性价比最高。</p>
<h5 id="优化前准备"><a href="#优化前准备" class="headerlink" title="优化前准备"></a>优化前准备</h5><ul>
<li><p>通过慢查询日志，工具是pt-query-digest</p>
</li>
<li><p>使用 <code>query profile</code> 功能</p>
<ul>
<li><code>set profiling = 1</code> 开启，将所有语句消耗的时间存到临时表<img src="/blog/p/e4d2e8fb/set_profiling_1.png" class="" title="set_profiling_1.png">

<ul>
<li><p><code>show profiles</code> 从临时表中查看所有语句 和 执行时间</p>
<img src="/blog/p/e4d2e8fb/show_profiles.png" class="" title="show_profiles.png">
</li>
<li><p><code>show profile for query 临时表ID</code> 查看某个临时表中的记录详情</p>
<img src="/blog/p/e4d2e8fb/show_profile_for_query.png" class="" title="show_profile_for_query命令">
</li>
<li><p><code>show profile cpu,block for query 临时表ID</code> 查看某个临时表中的CPU和Block IO的消耗记录详情</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>使用 <code>show status</code></p>
<ul>
<li><code>show status</code> 会返回一些计数器，<code>show global status</code> 查看服务器级别的所有计数</li>
<li>根据这些计数，可以猜测出哪些操作代价比较高或者消耗时间多</li>
</ul>
</li>
<li><p>使用 <code>show processlist</code></p>
<ul>
<li><code>show processlist</code> 观察是否有大量线程处于不正常的状态或者特征</li>
</ul>
</li>
<li><p>使用 <code>explain</code> 别名 <code>desc</code></p>
<ul>
<li><code>explain</code> 分析单条SQL语句<img src="/blog/p/e4d2e8fb/explain_and_desc.png" class="" title="explain_and_desc命令"></li>
</ul>
</li>
</ul>
<h5 id="优化前准备：原理剖析"><a href="#优化前准备：原理剖析" class="headerlink" title="优化前准备：原理剖析"></a>优化前准备：原理剖析</h5><h6 id="一-B-Tree-index"><a href="#一-B-Tree-index" class="headerlink" title="(一)B+ Tree index"></a>(一)B+ Tree index</h6><img src="/blog/p/e4d2e8fb/B+Tree%E7%B4%A2%E5%BC%95.png" class="" title="B+Tree索引">

<p>如上图所示，B+ Tree Index索引分为3个部分:<code>根、枝、叶</code>。</p>
<p>核心特点是根和枝不存储数据，行高比较固定。 通过“B+Tree”索引取数据，必然经过根枝叶三个节点路径，取数据的 代价比较稳定;</p>
<p>另外一点，叶子节点上的数据是有序存储的。</p>
<h6 id="二-Innodb-Table"><a href="#二-Innodb-Table" class="headerlink" title="(二)Innodb Table"></a>(二)Innodb Table</h6><p>Innodb 是MySOL的核心存储引擎，Innodb Table是IOT有序存储，核心概念为:Innodb的表数据按照“B+ Tree”的结 构进行组织，表数据本身是“B+ Tree”索引的叶子节点。</p>
<p>如下图所示，每张表，也就是每个存储段，实际是在MySOL里构建了一个“B+ Tree”索引的树状结构，段的物理存储跟 其他关系数据库的存储方式一样分区和块。</p>
<img src="/blog/p/e4d2e8fb/InnodbTable.png" class="" title="InnodbTable">

<h6 id="三-索引检索过程"><a href="#三-索引检索过程" class="headerlink" title="(三)索引检索过程"></a>(三)索引检索过程</h6><img src="/blog/p/e4d2e8fb/%E7%B4%A2%E5%BC%95%E6%A3%80%E7%B4%A2%E8%BF%87%E7%A8%8B.png" class="" title="索引检索过程">
<p>如上图所示有三个流程，上面两块是二级索引，下面是属于主键索引，也叫聚集索引，是Innodb表的数据本身，依次看这 三个流程:</p>
<ul>
<li>第一，非主键查询，入口是从二级索引，通过二级索引，第一个过程返回聚集索引的ID;第二个过程是回表，相当于再做 一次数据检索，然后从聚集索引中获取数据。</li>
<li>第二，主键查询，入口是直接通过聚集索引的ID，可以在聚集索引中获取数据。</li>
<li>第三，覆盖索引，入口是二级索引，直接从二级索引当中获取数据。</li>
</ul>
<h6 id="MySQL的行为"><a href="#MySQL的行为" class="headerlink" title="MySQL的行为"></a>MySQL的行为</h6><p>####### (一)MySQL SQL执行过程</p>
<img src="/blog/p/e4d2e8fb/%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E7%A4%BA%E4%BE%8B.png" class="" title="执行过程示例">

<p>如上图所示，MySQL的执行的过程包括:</p>
<ol>
<li>客户端提交一条语句;</li>
<li>先在查询缓存查看是否存在对应的缓存数据，如有则直接返回(一般有的可能性极小，因此一般建议关闭查询缓存. ;</li>
<li>交给解析器处理，解析器会将提交的语句生成一个解析树;</li>
<li>预处理器会处理解析树，形成新的解析树。这一阶段存在一些SQL改写的过程;</li>
<li>改写后的解析树提交给查询优化器。查询优化器生成执行计划;</li>
<li>执行计划交由执行引擎调用存储引擎接口，完成执行过程。这里要注意，MySQL的Server层和Engine层是分离的;</li>
<li>最终的结果由执行引擎返回给客户端，如果开启查询缓存的话，则会缓存。</li>
</ol>
<p>SQL执行顺序：<br>(8) SELECT (9) DISTINCT <select_list> (1) FROM <left_table><br>(3) <join_type> JOIN <right_table><br>(2) ON <join_condition><br>(4) WHERE <where_condition> (5) GROUP <group_by_list><br>(6) WITH {CUBE|ROLLUP}<br>(7) HAVING <having_condition> (10) ORDER BY <order_by_list> (11) LIMIT <limit_number><br>关于SQL的执行顺序，在某些时候也可以给我们一些指导性建议。<br>比如Where条件和Order by，在通常情况下，SQL语 句先获取数据，再做Select操作，先获取数据再返回到Server端结果集的存储区之后进行排序，从这里我们可以假设如 果通过索引获取数据，那么在取数据时，数据排序就已经完成，相当于MySQL存储引擎的层面已经做了优化，而不需要 再增加额外的排序计算操作。</p>
<p>####### (二)MySQL优化器与执行计划</p>
<ol>
<li>查询优化器<br>查询优化器的主要作用是用来负责生成SQL语句的执行计划。优化器是数据库的核心价值所在，它是数据库的“大脑”， 优化SQL某种意义上就是理解优化器的行为。</li>
</ol>
<p>在MySQL里面，优化的依据是执行成本，它的本质是CBO，也就是说执行计划的生成是基于成本的。<br>目前MySQL优化 器没有那么完善，执行成本主要基于行数而定。优化器工作的前提是了解数据，工作的目的是解析SQL，生成执行计划。<br>总结如下:</p>
<ul>
<li>负责生成 SQL 语句的有效执行计划的数据库组件;</li>
<li>优化器是数据库的核心价值所在，它是数据库的“大脑”;</li>
<li>优化SQL，某种意义上就是理解优化器的行为;</li>
<li>优化的依据是执行成本(CBO);</li>
<li>优化器工作的前提是了解数据，工作的目的是解析SQL，生成执行计划。</li>
</ul>
<ol start="2">
<li>查询优化器工作过程<img src="/blog/p/e4d2e8fb/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E5%99%A8%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B.png" class="" title="查询优化器工作过程"></li>
</ol>
<p>如上图所示，查询优化器工作过程包括:</p>
<ol>
<li>词法分析、语法分析、语义检查;</li>
<li>预处理阶段(查询改写等);</li>
<li>查询优化阶段，可详细划分为逻辑优化、物理优化两部分 逻辑优化:把SQL交给查询优化器之后，会去做相应的改写动作。 物理优化:过程是优化器生成获取数据去扫描数据的路径。</li>
<li>查询优化器优化依据，来自于代价估算器估算结果(它会调用统计信息作为计算依据);</li>
<li>交由执行器执行。</li>
</ol>
<p>####### (三)查看和干预执行计划</p>
<p>在MySQL里查看SQL的执行计划直接通过Explain关键词就可以了，或者我们可以添加Extended关键字，它会展示 MySQL优化器的逻辑优化改写过程。</p>
<p>在MySQL里查看SQL的执行计划直接通过Explain关键词就可以了，或者我们可以添加Extended关键字，它会展示 MySQL优化器的逻辑优化改写过程。<br>1.执行计划<br>·explain [extended] SQL_Statement</p>
<img src="/blog/p/e4d2e8fb/%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92explain.png" class="" title="执行计划explain">

<p>当我们认为SQL的执行计划不合理时，可以通过适当的手段，强制加索引或者强制驱动表的顺序，通过这种hints方式干预 SQL的执行计划。另外MySQL查询优化器的一些关键特性，我们也可以通过控制优化器开关的参数，从而控制优化器相 关的行为。</p>
<p>2.优化器开关<br>·show variables like ‘optimizer_switch’</p>
<img src="/blog/p/e4d2e8fb/%E4%BC%98%E5%8C%96%E5%99%A8%E5%BC%80%E5%85%B3show_variables.png" class="" title="优化器开关show_variables">

<p>3.Processlist<br>另一种观测MySQL行为的常用手段就是Processlist。</p>
<p>通过Processlist，我们可以看到当前在MySQL中执行的所有SQL 语句，有没有异常的会话或比较特殊的SQL状态。</p>
<p>查看会话操作可以通过2种途径:</p>
<ul>
<li>show [full] processlist;</li>
<li>information_schema.processlist。</li>
</ul>
<p>这里列出了几种常见的异常行为:</p>
<ol>
<li>Copy to tmp table<br>出现在某些Alter Table语句的Copy Table操作。</li>
<li>Copying to tmp table on disk<br>由于临时结果集大于tmp_table_size，正在将临时表从内存存储转为磁盘存储以此节省内存。</li>
<li>Converting HEAP to MyISAM<br>线程正在转换内部Memory临时表到磁盘MyISAM临时表。</li>
<li>Creating sort index<br>正在使用内部临时表处理Select查询。</li>
<li>Sorting index<br>磁盘排序操作的一个过程。</li>
<li>Sending data<br>正在处理Select查询的记录，同时正在把结果发送给客户端。</li>
<li>Waiting for table metadata lock<br>等待元数据锁。</li>
</ol>
<h5 id="常规优化策略"><a href="#常规优化策略" class="headerlink" title="常规优化策略"></a>常规优化策略</h5><h6 id="一-Select优化"><a href="#一-Select优化" class="headerlink" title="(一)Select优化"></a>(一)Select优化</h6><p>####### 1. Order by<br>Order by查询的两种情况:</p>
<ol>
<li>Using index，是针对查询优化器的两种行为来去区分的。Using index就是说MySQL它可以直接通过索引去返回有序 的记录，而不需要去经过额外的排序的操作;</li>
<li>Using filesort需要去做额外的排序，在某些特殊的情况下，可能还会出现临时表排序的情况。</li>
</ol>
<p>优化目标:尽量通过索引来避免额外的排序，减少CPU资源的消耗。</p>
<p>主要优化策略:</p>
<ul>
<li>Where条件和Order by使用相同的索引;</li>
<li>Order by的顺序和索引顺序相同;</li>
<li>Order by 的字段同为升序或降序。</li>
</ul>
<p>注:当Where条件中的过滤字段为覆盖索引的前缀列，而Order by字段是第二个索引列时，只有Where条件是Const匹配 时，才可以通过索引消除排序，而between…and或&gt;?、&lt;?这种Range匹配都无法避免Filesort操作。</p>
<p><strong>当无法避免Filesort操作时，优化思路就是让Filesort的操作更快。</strong></p>
<p>排序算法</p>
<ol>
<li>两次扫描算法。两次访问数据，第一步获取排序字段的行指针信息，在内存中排序，第二步根据行指针获取记录。</li>
<li>一次扫描算法。一次性取出满足条件的所有记录，在排序区中排序后输出结果集。是采用空间换时间的方式。<br>注:需要排序的字段总长度越小，越趋向于第二种扫描算法，MySQL通过max_length_for_sort_data参数的值来进行参 考选择。</li>
</ol>
<p>优化策略</p>
<ol>
<li>适当调大max_length_for_sort_data这个参数的值，让优化器更倾向于选择第二种扫描算法;</li>
<li>只使用必要的字段，不要使用Select *的写法;</li>
<li>适当加大sort_buffer_size这个参数的值，避免磁盘排序的出现(线程参数，不要设置过大)。</li>
</ol>
<p>####### 2. Subquery<br>对于子查询，一般的优化策略是做等价改写，在MySQL查询优化器中也叫反嵌套。在MySQL里，查询优化器本身也可以 做一些简单查询的反嵌套操作，但在绝大部分情况下还是需要去做一些人为的干预。</p>
<p>Subquery优化总结:</p>
<ol>
<li>子查询会用到临时表，需尽量避免;</li>
<li>可以使用效率更高的Join查询来替代。</li>
</ol>
<p>优化策略 等价改写、反嵌套。 如下SQL:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer <span class="keyword">where</span> customer_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> customer_id <span class="keyword">from</span> payment)</span><br></pre></td></tr></table></figure>
<p>改写形式:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> customer a <span class="keyword">left</span> <span class="keyword">join</span> payment b <span class="keyword">on</span> a.customer_id<span class="operator">=</span>b.customer_id <span class="keyword">where</span> b.customer_id <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>
<p>如上所示，SQL语句用Not In的这样的方式，在子查询里执行Select语句。对于这个SQL语句，直接把Not In改写成Left Join，从而提升它的执行效率。在MySQL里，一般情况下Join的效率比子查询要高。</p>
<p>####### 3. Limit<br>分页查询，就是将过多的结果在有限的界面上分多页来显示。<br>其实质是每次查询只返回有限行，翻页一次执行一次。<br>优化目标：</p>
<ol>
<li>消除排序;</li>
<li>避免扫描到大量不需要的记录。</li>
</ol>
<p>SQL场景(film_id为主键):<code>select film_id,description from film order by title limit 10000,20</code></p>
<p>此时MySQL排序出前10020条记录后仅仅需要返回第10001到10020条记录，前 10000条记录造成额外的代价消耗。</p>
<p><strong>对于分页查询的优化的策略</strong><br>优化策略一：“覆盖索引”<br><code>Alter table film add index idx_lmtest(title,description);</code><br>记录直接从索引中获取，效率最高。 仅适合查询字段较少的情况。</p>
<p>优化策略二：“SQL改写”<br><code>select a.film_id,a.description from film a inner join (select film_id from film order by title limit 1000,20) b on a.film_id=b.film_id;</code><br>优化的前提是Title字段有索引。<br>思路是从索引中取出20条满足条件记录的主键值，然后回表获取记录。</p>
<p>####### 4. Or&#x2F;And Condition</p>
<img src="/blog/p/e4d2e8fb/Condition_Or_And.png" class="" title="Condition:Or_And">

<p>And结果集为关键字前后过滤结果的交集;<br>Or结果集为关键字前后分别查询的并集;<br>And条件可以在前一个条件过滤基础上过滤;<br>Or条件被处理为UNION，相当于两个单独条件的查询;<br>复合索引对于Or条件相当于一个单列索引。</p>
<p>处理策略</p>
<ol>
<li>And子句多个条件中拥有一个过滤性较高的索引即可;</li>
<li>Or条件前后字段均要创建索引;</li>
<li>为最常用的And组合条件创建复合索引。</li>
</ol>
<h6 id="二-Join优化"><a href="#二-Join优化" class="headerlink" title="(二)Join优化"></a>(二)Join优化</h6><p>####### 1. Nested-Loop Join算法</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> <span class="keyword">in</span> t1 matching range &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> <span class="keyword">in</span> t2 matching reference key &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> <span class="keyword">in</span> t3 &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">row</span> satisfies <span class="keyword">join</span> conditions, send toclient</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在MySQL里，关于join的典型算法就是Nested-Loop Join，也就是嵌套循环。<br>如上图所示，T1、T2、T3三张表Join，首先扫描T1表找到匹配条件的行，然后根据T1、T2的关联条件，再扫描 T2表找 到匹配条件的的行，T2、T3也做同样的操作。<br>既然本质是嵌套循环，那么我们主要需要注意两点:</p>
<ol>
<li>关联字段索引:每层内部循环仅获取需要关心的数据。 引申算法:Bloack Nested-Loop。<img src="/blog/p/e4d2e8fb/Nested-Loop.png" class="" title="Nested-Loop">
如上图所示，下方是Bloack Nested-Loop，在MySQL里有一个特性叫join_buffer，当两张表关联，如果不能够通过索 引去做关联条件的匹配，这时候就会产生join_buffer的使用。<br>当SQL的Join语句，执行计划里出现Bloack Nested-Loop时，通常情况下，需要看关联条件是否有索引，或者是其他原 因而导致关联条件的匹配没有正常使用到索引。一旦SQL语句执行计划出现Bloack Nested-Loop，绝大部分场景下都意 味着SQL执行效率会大幅下降。</li>
<li>小表驱动原则:外层循环的结果集尽量小，目的是为了减少循环的次数。</li>
</ol>
<p>####### 2. 关联字段索引的必要性<br>案例:</p>
<img src="/blog/p/e4d2e8fb/%E5%85%B3%E8%81%94%E5%AD%97%E6%AE%B5%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7-%E6%A1%88%E4%BE%8B.png" class="" title="关联字段索引的必要性-案例">
<p>如上图所示，对于这一条Select语句，是两个表Join关联。SQL语句执行计划时，出现了join_buffer，执行计划extra部 分就是前面所说的Bloack Nested-Loop。</p>
<p>我们可以看到，通过b表关联访问a表时，Rows是127042，整个访问过程的代价特别大，对于这种场景，优化策略是给关 联条件添加索引。如下图所示:</p>
<img src="/blog/p/e4d2e8fb/%E5%85%B3%E8%81%94%E5%AD%97%E6%AE%B5%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7-%E6%A1%88%E4%BE%8B02.png" class="" title="关联字段索引的必要性-案例02">
<p>后面可以看到，通过b表访问a表时，执行计划里Key使用到了刚才所添加的索引，Rows从127042下降到125。前者执行 时间接近两分钟，后者只需要0.31秒，执行效率大幅提升。</p>
<p>####### 3. 小表驱动原则<br>忽略b表的索引，使b表作为驱动表，如下图所示:</p>
<img src="/blog/p/e4d2e8fb/%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%8E%9F%E5%88%99-%E6%A1%88%E4%BE%8B03.png" class="" title="小表驱动原则-案例03">
<p>同样的SQL语句，这里增加忽略索引的hints，目的是为了通过b表做驱动表，可以看到Rows是4000×125，执行时间是 0.31秒。<br>忽略a表的索引，使a表作为驱动表:</p>
<img src="/blog/p/e4d2e8fb/%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%8E%9F%E5%88%992.png" class="" title="小表驱动原则2">
<img src="/blog/p/e4d2e8fb/%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%8E%9F%E5%88%993.png" class="" title="小表驱动原则3">
<p>这时b表成了被驱动表，Rows为127042×4，总行数接近的情况下后者驱动表行数有明显增加。</p>
<p>这两个SQL语句做关联时，无论通过a表还是b表驱动，最后关联时都通过索引进行数据检索。但是由于驱动表的大小问 题，导致了执行效率的不同，后面一条语句执行的时间是0.53秒，比前者慢了一倍左右。</p>
<h6 id="三-Insert优化"><a href="#三-Insert优化" class="headerlink" title="(三)Insert优化"></a>(三)Insert优化</h6><p>关于Insert的插入优化策略主要有2种:</p>
<ol>
<li>优化策略一: “减少交互次数”<br>如批量插入语句:<br><code>insert into test values(1,2,3); insert into test values(4,5,6); insert into test </code>values(7,8,9); …<br>可改写为如下形式:<br><code>insert into test values(1,2,3),(4,5,6),(7,8,9) ...</code></li>
<li>优化策略二: “文本装载方式”<br>通过LOAD DATA INFILE句式从文本装载数据，通常比Insert语句快20倍。</li>
</ol>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>常规优化策略:MySQL查询优化</p>
<ol>
<li>关于MySQL的查询优化目的和目标:<ul>
<li>优化的目的是让资源发挥价值;</li>
<li>SQL和索引是调优的关键，往往可以起到“四两拨千斤”的效果。</li>
</ul>
</li>
<li>关于优化的流程和思路:<br>充分了解核心指标，并构建完备的监控体系，这是优化工作的前提; SQL优化的原则是减少数据访问及计算; 常用的优化方法主要是调整索引、改写SQL、干预执行计划。<br>Apache监控软件:<ul>
<li>skywalking <a href="https://github.com/apache/skywalking" target="_blank" rel="noopener">https://github.com/apache/skywalking</a></li>
<li>prometheus <a href="https://github.com/prometheus/prometheus" target="_blank" rel="noopener">https://github.com/prometheus/prometheus</a></li>
<li>netdata</li>
</ul>
</li>
<li>关于MySQL的核心概念及原理:<ul>
<li>Innodb的表是典型的IOT，数据本身是B+ tree索引的叶节点;</li>
<li>扫描二级索引可以直接获取数据，或者返回主键ID;</li>
<li>优化器是数据库的大脑，我们要了解优化器，并观测以及干预MySQL的行为。</li>
</ul>
</li>
</ol>
<p>数据库级别优化<br>例如：</p>
<ul>
<li>应用程序是否使用适当的 锁定策略？(行表锁)</li>
<li>用于缓存的 所有内存区域大小是否正确？</li>
<li>是否为每个表使用了 <code>正确的存储引擎</code></li>
<li><code>表结构</code> 是否正确</li>
<li>是否使用了 <code>正确的索引</code>，提高查询效率</li>
<li>是否为每一行使用了 <code>正确的属性</code></li>
</ul>
<table>
<thead>
<tr>
<th>支持事务</th>
<th>系统崩溃后安全恢复</th>
<th>锁</th>
<th>文件存储</th>
<th>使用场景</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>InnoDB</td>
<td>√</td>
<td>√</td>
<td>行锁(select * … for update)(只能在事务以及InnoDB中执行)</td>
<td><b>.frm文件</b>：与该表相关的元数据信息、表结构的定义信息等。<br> <b>.ibd文件</b>：与该表相关的数据、索引、表的内部数据字典信息。</td>
<td><b>小型数据</b>：全盘扫描<br> <b>中型数据</b>：索引<br> <b>大型数据</b>：索引+分区分表<br></td>
</tr>
<tr>
<td>MyISAM</td>
<td>×</td>
<td>×</td>
<td>表锁</td>
<td>MYD(数据文件)<br>MYI(索引文件)</td>
<td></td>
</tr>
</tbody></table>
<p>InnoDB中<br>主键查询，可能是行级锁<br>索引查询，可能是行级锁<br>非主键查询，可能是表锁</p>
<p>以下情况下，表锁优于行级锁</p>
<ol>
<li>表的大多数语句均为读取</li>
</ol>
<h4 id="官网文档，待整理"><a href="#官网文档，待整理" class="headerlink" title="官网文档，待整理"></a>官网文档，待整理</h4><blockquote>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/optimization.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/optimization.html</a></p>
</blockquote>
<h5 id="优化SQL语句"><a href="#优化SQL语句" class="headerlink" title="优化SQL语句"></a>优化SQL语句</h5><ol>
<li>添加合理的索引，EXPLAIN查询是否正确使用</li>
<li>隔离和调整查询中花费时间过多的任何地方，例如函数调用。根据查询的结构，可以对结果集中的每一行调用一次函数，甚至可以对表中的每一行调用一次函数，从而极大地提高了效率。</li>
<li>减少全盘扫描的次数，特别是大表</li>
<li>通过 <code>analyze table</code> 定期使用该语句来使表统计信息保持最新 ，因此优化器具有构造有效执行计划所需的信息。</li>
<li>优化存储引擎</li>
<li>优化InnoDB表的 单查询事务</li>
<li>避免以难以理解的方式转换查询，尤其是在优化程序自动执行某些相同转换的情况下。</li>
<li>通过阅读EXPLAIN计划并调整索引，WHERE子句，连接子句等来调查特定查询的内部详细信息 。</li>
<li>调整MySQL用于缓存的内存区域的大小和属性。通过有效地使用 InnoDB 缓冲池， MyISAM键高速缓存和MySQL查询高速缓存，重复查询的运行速度更快，因为第二次及其后的结果是从内存中检索的。</li>
<li>进一步优化缓存区域快速运行的查询</li>
<li>处理锁定问题，其中其他会话同时访问表可能会影响查询速度。</li>
</ol>
<h5 id="优化InnoDB缓冲池"><a href="#优化InnoDB缓冲池" class="headerlink" title="优化InnoDB缓冲池"></a>优化InnoDB缓冲池</h5><p>概念</p>
<ol>
<li>缓冲池(buffer pool)是一种常见的降低磁盘访问的机制；</li>
<li>缓冲池通常以页(page)为单位缓存数据；</li>
<li>缓冲池的常见管理算法是LRU，memcache，OS，InnoDB都使用了这种算法；</li>
<li>InnoDB对普通LRU进行了优化：</li>
</ol>
<p>将缓冲池分为老生代和新生代，入缓冲池的页，优先进入老生代，页被访问，才进入新生代，以解决预读失效的问题<br>页被访问，且在老生代停留时间超过配置阈值的，才进入新生代，以解决批量数据访问，大量热数据淘汰的问题</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">参数：innodb_buffer_pool_size，默认128MB</span><br><span class="line">介绍：配置缓冲池的大小，在内存允许的情况下，DBA往往会建议调大这个参数，越多数据和索引放到内存里，数据库的性能会越好。</span><br><span class="line"></span><br><span class="line">参数：innodb_old_blocks_pct</span><br><span class="line"><span class="section">介绍：老生代占整个LRU链长度的比例，默认是37，即整个LRU中新生代与老生代长度比例是63:37。</span></span><br><span class="line"></span><br><span class="line">画外音：如果把这个参数设为100，就退化为普通LRU了。</span><br><span class="line">参数：innodb_old_blocks_time</span><br><span class="line">介绍：老生代停留时间窗口，单位是毫秒，默认是1000，即同时满足“被访问”与“在老生代停留时间超过1秒”两个条件，才会被插入到新生代头部。</span><br></pre></td></tr></table></figure>
<h5 id="优化-where子句"><a href="#优化-where子句" class="headerlink" title="优化 where子句"></a>优化 where子句</h5><ol>
<li>删除不必要的括号<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   ((a <span class="keyword">AND </span><span class="keyword">b) </span><span class="keyword">AND </span>c <span class="keyword">OR </span>(((a <span class="keyword">AND </span><span class="keyword">b) </span><span class="keyword">AND </span>(c <span class="keyword">AND </span>d))))</span><br><span class="line">-&gt; (a <span class="keyword">AND </span><span class="keyword">b </span><span class="keyword">AND </span>c) <span class="keyword">OR </span>(a <span class="keyword">AND </span><span class="keyword">b </span><span class="keyword">AND </span>c <span class="keyword">AND </span>d)</span><br></pre></td></tr></table></figure></li>
<li>恒定折叠<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   (a&lt;<span class="keyword">b </span><span class="keyword">AND </span><span class="keyword">b=c) </span><span class="keyword">AND </span>a=<span class="number">5</span></span><br><span class="line">-&gt; <span class="keyword">b&gt;5 </span><span class="keyword">AND </span><span class="keyword">b=c </span><span class="keyword">AND </span>a=<span class="number">5</span></span><br></pre></td></tr></table></figure></li>
<li>恒定条件消除<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   (b&gt;=5 <span class="keyword">AND</span> <span class="attribute">b</span>=5) <span class="keyword">OR</span> (<span class="attribute">b</span>=6 <span class="keyword">AND</span> <span class="attribute">5</span>=5) <span class="keyword">OR</span> (<span class="attribute">b</span>=7 <span class="keyword">AND</span> <span class="attribute">5</span>=6)</span><br><span class="line">-&gt; <span class="attribute">b</span>=5 <span class="keyword">OR</span> <span class="attribute">b</span>=6</span><br></pre></td></tr></table></figure></li>
<li>索引使用的常量表达式仅计算一次。</li>
</ol>
<h3 id="Mysql高可用"><a href="#Mysql高可用" class="headerlink" title="Mysql高可用"></a>Mysql高可用</h3><p>解决的问题：<code>单点故障</code></p>
<p>实现方案：MGR8.0</p>
<ul>
<li>数据库切换</li>
<li>跨IDC(互联网数据中心)同步</li>
</ul>
<h4 id="（1）主从复制是异步复制"><a href="#（1）主从复制是异步复制" class="headerlink" title="（1）主从复制是异步复制"></a>（1）主从复制是异步复制</h4><blockquote>
<p>master事务的提交不需要经过slave的确认，slave是否接收到master的binlog，master并不care。slave接收到master binlog后先写relay log，最后异步地去执行relay log中的sql应用到自身。</p>
</blockquote>
<p>导致的问题：</p>
<ul>
<li>数据的一致性问题无法保证：当slave接受master binlog失败或者relay log应用失败，master无法感知。</li>
</ul>
<h4 id="（2）半同步复制"><a href="#（2）半同步复制" class="headerlink" title="（2）半同步复制"></a>（2）半同步复制</h4><blockquote>
<p>对传统异步复制的改进，主库commit之前开启从库的ACK，收到回馈再进行commit。</p>
</blockquote>
<p>导致的问题：</p>
<ul>
<li>数据的一致性问题无法保证：slave对于relay log的应用仍然是异步进行的。</li>
</ul>
<h4 id="（3）组复制-MGR"><a href="#（3）组复制-MGR" class="headerlink" title="（3）组复制 MGR"></a>（3）组复制 MGR</h4><blockquote>
<p>MGR是具备强大的分布式协调能力，可用于创建弹性、高可用性、高容错的复制拓扑的一个MySQL插件。</p>
</blockquote>
<p><strong>通讯协议</strong> ：基于Paxos算法的GCS原子广播协议，保证了一条事务在集群内要么在全部节点上提交，要么全部回滚。</p>
<p><strong>组成员资格</strong> ：MGR内部提供一个视图服务，集群节点之间相互交换各自的视图信息， 从而且实现集群整体的稳态。</p>
<p><strong>数据一致性</strong> ：MGR内部实现了一套不同事务之间修改数据的冲突认证检测机制。在集群的所有节点当中进行一个冲突认证检测，反之，通过冲突认证检测的事务即可提交成功。</p>
<img src="/blog/p/e4d2e8fb/MGR%E7%A4%BA%E4%BE%8B.png" class="" title="MGR示例.png">
<blockquote>
<p>上图是一个三节点的MGR实例集群，Member1代表Primary主节点，Member2、Member3代表 Secondary副节点。</p>
</blockquote>
<h4 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h4><p>当一个<strong>事务发起提交后</strong>，它会通过原子广播协议分发到集群其他 Secondary副节点。集群的 Secondary副节点 通过冲突检测之后，事务提交成功。在大多数的 Secondary副节点 提交成功之后，会在Primary主节点进行提交。</p>
<p>反之，如果在冲突认证检测失败，Secondary副节点会丢弃这段事务对应的Binlog，Primary主节点 回滚该事务。</p>
<h4 id="集群架构"><a href="#集群架构" class="headerlink" title="集群架构"></a>集群架构</h4><blockquote>
<p>MGR架构分为单主模式和多主模式。</p>
</blockquote>
<h5 id="单主模式"><a href="#单主模式" class="headerlink" title="单主模式"></a>单主模式</h5><blockquote>
<p>group_replication_single_primary_mode &#x3D; ON # ON表示单主模式，也是默认模式，OFF表示多主模式。</p>
</blockquote>
<p>注意事项：</p>
<ul>
<li>同一个组中，不能将成员部署在不同模式中。例如，一个成员配置为单主 模式，另一个成员配置为多主模式。</li>
<li>该集群具有一个设置为读写模式的主节点，组中的所有其他成员都设置为只读模式(superread-only &#x3D; ON);<img src="/blog/p/e4d2e8fb/%E5%8D%95%E4%B8%BB%E6%A8%A1%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%8E%9F%E7%90%86%E6%B5%81%E7%A8%8B%E5%9B%BE.png" class="" title="单主模式集群原理流程图.png"></li>
<li>读写节点通常是引导该组的第一个节点，加入该集群的所有其他只读节点均需要从读写节点同步数据，并自动设置为只 读模式。</li>
</ul>
<h5 id="多主模式"><a href="#多主模式" class="headerlink" title="多主模式"></a>多主模式</h5><blockquote>
<p>group_replication_single_primary_mode &#x3D; OFF # ON表示单主模式，也是默认模式，OFF表示多主模式。</p>
</blockquote>
<img src="/blog/p/e4d2e8fb/%E5%A4%9A%E4%B8%BB%E6%A8%A1%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%8E%9F%E7%90%86%E6%B5%81%E7%A8%8B%E5%9B%BE.png" class="" title="多主模式集群原理流程图.png">
<p>注意事项：</p>
<ol>
<li>所有节点不会区分Primary和Standby角色</li>
<li>加入该集群时，与其他组成员兼容的任何节点都被设置为读写模式，并且可以处理写请求，即使它们在集群内是并发执 行的;</li>
<li>如果组复制中的某个节点停止接受写事务，例如，在某个节点意外宕机的情况下，可以将与其连接的客户端重定向或故 障转移到处于读写模式的任何其他健康的节点;</li>
<li>组复制本身不处理客户端故障转移，因此需要使用中间件框架(例如MySQL Router 8.0代理，连接器或应用程序本 身)来实现。</li>
</ol>
<blockquote>
<p>MySQL Router 8.0 <a href="https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-deploying-bootstrapping.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/mysql-router/8.0/en/mysql-router-deploying-bootstrapping.html</a></p>
</blockquote>
<h3 id="Mysql数据一致性"><a href="#Mysql数据一致性" class="headerlink" title="Mysql数据一致性"></a>Mysql数据一致性</h3><p>排他锁(悲观锁) &#x3D; 行锁 或 表锁<br>并发处理方案：</p>
<ol>
<li>排他锁(悲观锁)，但是会阻塞其他请求，效率低下</li>
<li>乐观锁(CAS，Version)，但是有ABA的问题以及bad请求过多，解决办法：重入机制</li>
</ol>
<h3 id="计算字段"><a href="#计算字段" class="headerlink" title="计算字段"></a>计算字段</h3><p>CONCAT() 用于连接两个字段。许多数据库会使用空格把一个值填充为列宽，因此连接的结果会出现一些不必要的空格，使用 TRIM() 可以去除首尾空格。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(TRIM(col1), <span class="string">&#x27;(&#x27;</span>, TRIM(col2), <span class="string">&#x27;)&#x27;</span>) <span class="keyword">AS</span> concat_col</span><br><span class="line"><span class="keyword">FROM</span> mytable;</span><br></pre></td></tr></table></figure>


<h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h4><p>自连接可以看成内连接的一种，只是连接的表是自身而已。</p>
<p>一张员工表，包含员工姓名和员工所属部门，要找出与 Jim 处在同一部门的所有员工姓名。</p>
<p>子查询版本</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="type">name</span></span><br><span class="line"><span class="keyword">FROM</span> employee</span><br><span class="line"><span class="keyword">WHERE</span> department = (</span><br><span class="line"><span class="keyword">SELECT</span> department</span><br><span class="line"><span class="keyword">FROM</span> employee</span><br><span class="line"><span class="keyword">WHERE</span> <span class="type">name</span> = &quot;Jim&quot;);</span><br></pre></td></tr></table></figure>

<p>自连接版本</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e1.name</span><br><span class="line"><span class="keyword">FROM</span> employee <span class="keyword">AS</span> e1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> employee <span class="keyword">AS</span> e2</span><br><span class="line"><span class="keyword">ON</span> e1.department = e2.department</span><br><span class="line"><span class="keyword">AND</span> e2.name = &quot;Jim&quot;;</span><br></pre></td></tr></table></figure>

<h4 id="自然连接"><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h4><p>自然连接是把同名列通过等值测试连接起来的，同名列可以有多个。</p>
<p>内连接和自然连接的区别：内连接提供连接的列，而自然连接自动连接所有同名列。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.<span class="keyword">value</span>, B.<span class="keyword">value</span></span><br><span class="line"><span class="keyword">FROM</span> tablea <span class="keyword">AS</span> A <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> tableb <span class="keyword">AS</span> B;</span><br></pre></td></tr></table></figure>

<h3 id="关联更新"><a href="#关联更新" class="headerlink" title="关联更新"></a>关联更新</h3><ol>
<li><p>交叉连接CROSS JOIN</p>
<blockquote>
<p>没有关联条件，结果是笛卡尔积，没有任何意义</p>
</blockquote>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from A,B(,C)</span><br><span class="line">||</span><br><span class="line">select * from A CROSS JOIN B(CROSS JOIN C)</span><br></pre></td></tr></table></figure></li>
<li><p>内连接 INNER JION 或 JOIN</p>
<blockquote>
<p>多表中同时符合某种条件的数据记录的集合</p>
</blockquote>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ON A.id &gt; B.id</span><br><span class="line">ON A.id &gt; B.id</span><br><span class="line"></span><br></pre></td></tr></table></figure>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from A INNER JOIN B on A.id = B.id</span><br></pre></td></tr></table></figure>
</li>
<li><p>全连接FULL JOIN(Mysql不支持)</p>
<blockquote>
<p>可以使用 外连接和联合查询 联合使用</p>
</blockquote>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM A LEFT JOIN B ON A.id=B.id UNION</span><br><span class="line">SELECT * FRPM A RIGHT JOIN B ON A.id=B.id</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h3><p>使用 UNION 来组合两个查询，如果第一个查询返回 M 行，第二个查询返回 N 行，那么组合查询的结果一般为 M+N 行。</p>
<p>每个查询必须包含相同的列、表达式和聚集函数。</p>
<p>默认会去除相同行，如果需要保留相同行，使用 UNION ALL。</p>
<p>只能包含一个 ORDER BY 子句，并且必须位于语句的最后。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> col</span><br><span class="line">    <span class="keyword">FROM</span> mytable</span><br><span class="line">    <span class="keyword">WHERE</span> col = <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> col</span><br><span class="line">    <span class="keyword">FROM</span> mytable</span><br><span class="line">    <span class="keyword">WHERE</span> col =<span class="number">2</span>;</span><br></pre></td></tr></table></figure>



<h3 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h3><p>Engine|事务|锁级别|外键|热备份|全文索引|系统崩溃后安全恢复|存储方式|说明<br>-|-|-|-|-<br>InnoDB(default)|支持|行锁-支持更高的并发|支持|支持||支持|.frm文件：与该表相关的元数据信息、表结构的定义信息等。 <br>.ibd文件：与该表相关的数据、索引、表的内部数据字典信息。|默认的事务型存储引擎，只有需要用到它不支持的特性时，才考虑使用其它存储引擎<br>MyISAM||表锁|||支持||MYD(数据文件) <br>MYI(索引文件)|非事务处理存储引擎<br>MEMORY||表锁|||||全部数据放在内存中|访问速度较快，但是系统崩溃的话数据都会丢失。<br>CSV||||||||主要存储的是.csv格式的文本数据，可以直接打开存储的文件进行编辑。</p>
<h4 id="InnoDB补充"><a href="#InnoDB补充" class="headerlink" title="InnoDB补充"></a>InnoDB补充</h4><p>主索引是聚簇索引，在索引中保存了数据，从而避免直接读取磁盘，因此对查询性能有很大的提升。</p>
<p>内部做了很多优化，包括从磁盘读取数据时采用的可预测性读、能够加快读操作并且自动创建的自适应哈希索引、能够加速插入操作的插入缓冲区等。</p>
<p>支持真正的在线热备份。其它存储引擎不支持在线热备份，要获取一致性视图需要停止对所有表的写入，而在读写混合场景中，停止写入可能也意味着停止读取。</p>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>事务指的是满足 ACID 特性的一组操作，可以通过 Commit 提交一个事务，也可以使用 Rollback 进行回滚。</p>
<h4 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h4><ul>
<li><code>原子性(Atomicity)</code>：被视为不可分割的最小单元，所有操作要么全部提交成功，要么全部失败回滚。</li>
<li><code>一致性(Consistency)</code>：数据库在事务执行前后都保持一致性状态。在一致性状态下，所有事务对同一个数据的读取结果都是相同的。</li>
<li><code>隔离性(Isolation)</code>一个事务所做的修改在最终提交以前，对其他事务是不可见的。</li>
<li><code>持久性(Durability)</code>：一旦事务提交，则其所做的修改就会永久保存到数据库中，即使系统发生崩溃，事务执行的结果也不能丢失，应对系统崩溃的情况。<ul>
<li>系统发生崩溃可以用重做日志（Redo Log）进行恢复，从而实现持久性。与回滚日志记录数据的逻辑修改不同，重做日志记录的是数据页的物理修改。</li>
</ul>
</li>
</ul>
<h4 id="AUTOCOMMIT"><a href="#AUTOCOMMIT" class="headerlink" title="AUTOCOMMIT"></a>AUTOCOMMIT</h4><p>MySQL 默认采用自动提交模式。也就是说，如果不显式使用START TRANSACTION语句来开始一个事务，那么每个查询操作都会被当做一个事务并自动提交。</p>
<h4 id="并发一致性的问题"><a href="#并发一致性的问题" class="headerlink" title="并发一致性的问题"></a>并发一致性的问题</h4><h5 id="丢失修改"><a href="#丢失修改" class="headerlink" title="丢失修改"></a>丢失修改</h5><p>丢失修改指一个事务的更新操作被另外一个事务的更新操作替换。</p>
<p>一般在现实生活中常会遇到， 例如：T1 和 T2 两个事务都对一个数据进行修改，T1 先修改并提交生效，T2 随后修改，T2 的修改覆盖了 T1 的修改。</p>
<img src="/blog/p/e4d2e8fb/%E4%B8%A2%E5%A4%B1%E4%BF%AE%E6%94%B9.png" class="" title="丢失修改.png">

<h5 id="读脏数据"><a href="#读脏数据" class="headerlink" title="读脏数据"></a>读脏数据</h5><p>读脏数据指在不同的事务下，当前事务可以读到另外事务未提交的数据。</p>
<p>例如：T1 修改一个数据但未提交，T2 随后读取这个数据。如果 T1 撤销了这次修改，那么 T2 读取的数据是脏数据。</p>
<img src="/blog/p/e4d2e8fb/%E8%AF%BB%E8%84%8F%E6%95%B0%E6%8D%AE.png" class="" title="读脏数据">

<h5 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h5><p>不可重复读指在一个事务内多次读取同一数据集合。<br>在这一事务还未结束前，另一事务也访问了该同一数据集合并做了修改，由于第二个事务的修改，第一次事务的两次读取的数据可能不一致。</p>
<p>例如：T2 读取一个数据，T1 对该数据做了修改。如果 T2 再次读取这个数据，此时读取的结果和第一次读取的结果不同。</p>
<img src="/blog/p/e4d2e8fb/%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB.png" class="" title="不可重复读.png">


<h5 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h5><p>幻读本质上也属于不可重复读的情况</p>
<p>T1 读取某个范围的数据，T2 在这个范围内插入新的数据，T1 再次读取这个范围的数据，此时读取的结果和和第一次读取的结果不同。</p>
<img src="/blog/p/e4d2e8fb/%E5%B9%BB%E8%AF%BB.png" class="" title="幻读.png">


<p>产生并发不一致性问题的主要原因是破坏了事务的隔离性，解决方法是通过并发控制来保证隔离性。<br>并发控制可以通过封锁来实现，但是封锁操作需要用户自己控制，相当复杂。数据库管理系统提供了事务的隔离级别，让用户以一种更轻松的方式处理并发一致性问题。</p>
<h4 id="封锁"><a href="#封锁" class="headerlink" title="封锁"></a>封锁</h4><h5 id="封锁粒度"><a href="#封锁粒度" class="headerlink" title="封锁粒度"></a>封锁粒度</h5><p>MySQL 中提供了两种封锁粒度：行级锁以及表级锁。</p>
<p>应该尽量只锁定需要修改的那部分数据，而不是所有的资源。<br>锁定的数据量越少，发生锁争用的可能就越小，系统的并发程度就越高。</p>
<p>但是加锁需要消耗资源，锁的各种操作（包括获取锁、释放锁、以及检查锁状态）都会增加系统开销。<br>因此封锁粒度越小，系统开销就越大。</p>
<p>在选择封锁粒度时，需要在锁开销和并发程度之间做一个权衡。</p>
<h5 id="封锁类型"><a href="#封锁类型" class="headerlink" title="封锁类型"></a>封锁类型</h5><ol>
<li>读写锁</li>
</ol>
<ul>
<li>互斥锁（Exclusive），简写为 X 锁，又称写锁。</li>
<li>共享锁（Shared），简写为 S 锁，又称读锁。</li>
</ul>
<p>有以下两个规定：</p>
<ul>
<li>一个事务对数据对象 A 加了 X 锁，就可以对 A 进行读取和更新。加锁期间其它事务不能对 A 加任何锁。</li>
<li>一个事务对数据对象 A 加了 S 锁，可以对 A 进行读取操作，但是不能进行更新操作。加锁期间其它事务能对 A 加 S 锁，但是不能加 X 锁。</li>
</ul>
<p>锁的兼容关系如下：</p>
<img src="/blog/p/e4d2e8fb/%E9%94%81%E7%9A%84%E5%85%BC%E5%AE%B9%E5%85%B3%E7%B3%BB.png" class="" title="锁的兼容关系.png">

<ol start="2">
<li>意向锁<br>使用意向锁（Intention Locks）可以更容易地支持多粒度封锁。</li>
</ol>
<p>在存在行级锁和表级锁的情况下，事务 T 想要对表 A 加 X 锁，就需要先检测是否有其它事务对表 A 或者表 A 中的任意一行加了锁，那么就需要对表 A 的每一行都检测一次，这是非常耗时的。</p>
<p>意向锁在原来的 X&#x2F;S 锁之上引入了 IX&#x2F;IS，IX&#x2F;IS 都是表锁，用来表示一个事务想要在表中的某个数据行上加 X 锁或 S 锁。<br>有以下两个规定：</p>
<ul>
<li>一个事务在获得某个数据行对象的 S 锁之前，必须先获得表的 IS 锁或者更强的锁；</li>
<li>一个事务在获得某个数据行对象的 X 锁之前，必须先获得表的 IX 锁。</li>
</ul>
<p>通过引入意向锁，事务 T 想要对表 A 加 X 锁，只需要先检测是否有其它事务对表 A 加了 X&#x2F;IX&#x2F;S&#x2F;IS 锁，如果加了就表示有其它事务正在使用这个表或者表中某一行的锁，因此事务 T 加 X 锁失败。</p>
<p>各种锁的兼容关系如下：</p>
<img src="/blog/p/e4d2e8fb/%E5%90%84%E7%A7%8D%E9%94%81%E7%9A%84%E5%85%BC%E5%AE%B9%E5%85%B3%E7%B3%BB.png" class="" title="各种锁的兼容关系.png">

<p>解释如下：</p>
<p>任意 IS&#x2F;IX 锁之间都是兼容的，因为它们只表示想要对表加锁，而不是真正加锁；<br>这里兼容关系针对的是表级锁，而表级的 IX 锁和行级的 X 锁兼容，两个事务可以对两个数据行加 X 锁。<br>（事务 T1 想要对数据行 R1 加 X 锁，事务 T2 想要对同一个表的数据行 R2 加 X 锁，两个事务都需要对该表加 IX 锁，但是 IX 锁是兼容的，并且 IX 锁与行级的 X 锁也是兼容的，因此两个事务都能加锁成功，对同一个表中的两个数据行做修改。）</p>
<h4 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h4><p>事务中有四个标准的隔离级别，<code>默认级别</code>是 <code>可重复读(Repeatable read)</code>。</p>
<p>隔离级别|含义|实现方式|出现的问题|问题核心|举例问题|解决办法<br>-|-|-|-|-|-<br>读未提交<br>(Read uncommitted)|A事务中修改了数据但还没提交时，别的事务就可以看到修改后的数据|直接读取最新值|<span style="color:red;font-weight: bold;">脏读</span>|读取到了其他事务未提交或者回滚的数据|A事务读取到了B未提交的数据|隔离级别设置为读已提交<br>读已提交<br>(Read committed)|A事务提交之后，别的事务才可以看到修改的数据|每一次读数据都生成快照，读取快照值(先不深入)|<span style="color:red;font-weight: bold;">不可重复读</span>|在一次事务中读到的数据不一样（这期间别的事务提交了）|A事务两次相同的查询语句，结果却不一样。|隔离级别设置为可重复读<br>可重复读<br>(Repeatable read)|保证在同一个事务中多次读取同一数据的结果是一样的。|事务开始后第一次读的时候生成快照，之后的操作都重复使用这个快照，从而避免幻读。|<span style="color:red;font-weight: bold;">幻读</span>|一个事务按相同条件检索，发现了新的数据（发现不了修改了的数据）|A事务把表中某个字段+1，恰巧这时候事务B向该表中表中插入了一条数据。A用户提交事务之后发现还有数据未修改，好像产生了幻觉。|隔离级别设置成串行化（效率差），不建议。｜｜增加范围锁RangeS，锁定检索范围为只读<br>可串行化<br>(Serializable)|强制事务串行执行，这样多个事务互不干扰，不会出现并发一致性问题。|需要加锁实现||||</p>
<h4 id="多版本并发控制"><a href="#多版本并发控制" class="headerlink" title="多版本并发控制"></a>多版本并发控制</h4><p>多版本并发控制（Multi-Version Concurrency Control, MVCC）是 MySQL 的 InnoDB 存储引擎实现隔离级别的一种具体方式，用于实现提交读和可重复读这两种隔离级别。<br>而未提交读隔离级别总是读取最新的数据行，要求很低，无需使用 MVCC。可串行化隔离级别需要对所有读取的行都加锁，单纯使用 MVCC 无法实现。</p>
<h4 id="解决幻读"><a href="#解决幻读" class="headerlink" title="解决幻读"></a>解决幻读</h4><p>MySQL 可重复读隔离级别并没有彻底解决幻读，只是很大程度上避免了幻读现象的发生。<br>要完全解决幻读需要在开启事务之后，马上执行 select … for update 这类当前读的语句，因为它会对记录加 next-key lock，从而避免其他事务插入一条新记录。</p>
<h3 id="Mysql分区、分表、负载均衡"><a href="#Mysql分区、分表、负载均衡" class="headerlink" title="Mysql分区、分表、负载均衡"></a>Mysql分区、分表、负载均衡</h3><h4 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h4><h5 id="简述-2"><a href="#简述-2" class="headerlink" title="简述"></a>简述</h5><ul>
<li>对于Mysql底层：将表分成多个物理表</li>
<li>对于用户和程序调用MYSQL处是无感知的</li>
</ul>
<h5 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h5><p>创建表时使用 <code>partition by</code> 子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义过滤那些没有我们需要数据的分区，这样查询只需要查询所需数组在的分区即可<br>如果想一次性删除整个分区的数据也方便<br>比如：以年龄分配，更新时间分配</p>
<h5 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h5><ol>
<li>容易维护，可以对独立的分区进行独立的操作</li>
<li>分区表的数据可以分布在不同的机器上，从而高效的使用资源</li>
<li>方便备份和恢复独立的分区</li>
</ol>
<h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><ol>
<li>一个表只能有1024个分区</li>
<li>5.1版本分区表表达式必须是整数，5.5可以使用列分区</li>
<li>分区字段中如果有主键和唯一索引列，那么主键列和唯一列都必须包含进来</li>
<li>分区表中无法使用外键约束</li>
<li>现有表想分区则需要修改表的结构</li>
<li>所有分区都必须使用相同的存储引擎</li>
<li>分区函数中可以使用的函数和表达式会有一些限制</li>
<li>InnoDB和MyISAM都可以使用分区，但是有些不支持分区功能</li>
<li>对于MyISAM的分区表，不能使用load index into cache</li>
<li>对于MyISAM的分区表，需要打开更多的文件描述符</li>
</ol>
<h5 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h5><ol>
<li>表非常大</li>
<li>局部有热点数据，其他都是不常更新XX数据</li>
</ol>
<h4 id="分表"><a href="#分表" class="headerlink" title="分表"></a>分表</h4><ul>
<li>分表的缺点<ol>
<li>有些分表的策略基于应用层的逻辑算法，一旦改变，整个分表逻辑都会改变，扩展性较差</li>
<li>对于应用层，逻辑算法增加开发成本</li>
</ol>
</li>
</ul>
<h5 id="工作原理-1"><a href="#工作原理-1" class="headerlink" title="工作原理"></a>工作原理</h5><p>通过一些HASH算法或者工具时限将一张数据表垂直或者水平进行物理切分</p>
<ol>
<li>通过hash算法，找出 已经切分中 存放的数据表</li>
</ol>
<h5 id="分表方式"><a href="#分表方式" class="headerlink" title="分表方式"></a>分表方式</h5><ol>
<li><p>水平分割<br>表很大，分割后可以降低在查询时需要读的数据和索引的页数，同时也降低了索引的层数，提高查询速度</p>
<ul>
<li><p>作用</p>
<ol>
<li>按照活跃、不活跃数据区分</li>
<li>按照不同地区、不同时期区分</li>
<li>需要把数据存放在多个介质上(缓存、不同服务器)</li>
</ol>
</li>
<li><p>缺点</p>
<ol>
<li>操作变复杂，通常查询时需要多个表明，查询所有数据时需要UNION操作</li>
<li>使用水平分表查询时，会增加一个读索引层的磁盘次数</li>
</ol>
</li>
<li><p>使用场景</p>
</li>
</ul>
</li>
<li><p>垂直分割<br>把主键和一些列放在一个表，然后把主键和另外的列放在另外一个表中</p>
<ul>
<li><p>作用</p>
<ol>
<li>可以使数据行变小，一个数据页能存储更多的数据，查询时减少I&#x2F;O次数</li>
</ol>
</li>
<li><p>缺点</p>
<ol>
<li>管理冗余列，查询所有数据都需要关联操作(JION)</li>
</ol>
</li>
<li><p>使用场景</p>
<ol>
<li>如果一个表中某些列常用，另外一些列不常用</li>
<li>可以将</li>
</ol>
</li>
</ul>
</li>
</ol>
<h4 id="主从复制-和-负载均衡"><a href="#主从复制-和-负载均衡" class="headerlink" title="主从复制 和 负载均衡"></a>主从复制 和 负载均衡</h4><h5 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h5><ol>
<li>将主库上 把数据更改 记录到 二进制日志</li>
<li>从库将 主库的日志 复制到自己的 中继日志</li>
<li>从库读取中继日志的事件(SQL)，将其重放到从库数据中</li>
</ol>
<h5 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h5><ol>
<li>数据分布：随意停止或开始复制，并在不同地理位置分布数据备份</li>
<li>负载均衡：降低单个服务器的压力</li>
<li>高可用和故障切换：帮助应用程序避免单点失败</li>
<li>升级测试：可以使用更高版本的Mysql作为从库 (灰度测试从库，可以则全部覆盖)</li>
</ol>
<h5 id="解题思路："><a href="#解题思路：" class="headerlink" title="解题思路："></a>解题思路：</h5><ol>
<li>分区分表 概述 优点 缺点 使用场景</li>
<li>主从复制、负载均衡 概述 优点 缺点 使用场景</li>
</ol>
<h5 id="真题："><a href="#真题：" class="headerlink" title="真题："></a>真题：</h5><ul>
<li>设定网站的用户数量在千万级，但是活跃用户的数量只有1%，如何优化数据库提高活跃用户访问数据？</li>
</ul>
<hr>
<h3 id="Mysql安全性"><a href="#Mysql安全性" class="headerlink" title="Mysql安全性"></a>Mysql安全性</h3><h4 id="SQL安全"><a href="#SQL安全" class="headerlink" title="SQL安全"></a>SQL安全</h4><ol>
<li>使用预处理语句，防止SQL注入，建议使用PDO， <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url= &#x27;user/delete/?id=1 or 1=1&#x27;</span><br><span class="line">delete from user where id = 1 or 1=1;</span><br><span class="line">PDO prepare(预处理)</span><br></pre></td></tr></table></figure></li>
<li>写入数据库的数据要进行特殊字符的转义</li>
<li>查询错误信息不返回给用户，将错误记录到日志</li>
</ol>
<h4 id="其他安全设置"><a href="#其他安全设置" class="headerlink" title="其他安全设置"></a>其他安全设置</h4><ol>
<li>定期做数据备份</li>
<li>不给查询用户ROOT权限，合理分配权限(sql权限)</li>
<li>限制用户对数据文件的访问权限(文件权限)</li>
<li>限制一般用户浏览其他库</li>
<li>关闭远程访问数据库权限</li>
<li>修改ROOT密码</li>
<li>删除多余的用户</li>
<li>改变root用户的名称</li>
</ol>
<h4 id="真题"><a href="#真题" class="headerlink" title="真题"></a>真题</h4><ul>
<li>为什么使用PDO和mysqli连接数据库会比mysql函数库更加安全<br>答：Mysqli和PDO有预处理功能，防止SQL注入，安全性高</li>
</ul>
<h4 id="PDO使用方式"><a href="#PDO使用方式" class="headerlink" title="PDO使用方式"></a>PDO使用方式</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dsn: &quot;mysql:host=127.0.0.1;dbname=study&quot;</span></span><br><span class="line"><span class="comment">#options = [PDO::MYSQL_ATTR_INIT_COMMAND=&gt;&quot;SET NAMES UTF8&quot;]</span></span><br><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="variable">$dsn</span>,<span class="variable">$username</span>,<span class="variable">$password</span>,<span class="keyword">array</span> <span class="variable">$options</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#增(方式1)</span></span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="variable">$pdo_pre</span> = <span class="string">&#x27;insert into liuyan(`name`,`content`) values(?,?)&#x27;</span>;</span><br><span class="line"><span class="variable">$pdo_pre</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="number">1</span>,<span class="variable">$name</span>);</span><br><span class="line"><span class="variable">$pdo_pre</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="number">2</span>,<span class="variable">$content</span>);</span><br><span class="line"><span class="variable">$pdo_pre</span>-&gt;<span class="title function_ invoke__">execute</span>()</span><br><span class="line"><span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">insertLastId</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#增(方式2)</span></span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="variable">$pdo_pre</span> = <span class="string">&#x27;insert into liuyan(`name`,`content`) values(name=:name,content:content)&#x27;</span>;</span><br><span class="line"><span class="variable">$pdo_pre</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="string">&#x27;:name&#x27;</span>=&gt;<span class="variable">$name</span>,<span class="string">&#x27;:content&#x27;</span>=&gt;<span class="variable">$content</span>]);</span><br><span class="line"><span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">insertLastId</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询(方式1)</span></span><br><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;neirong&#x27;</span>;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&#x27;select * from liuyan where content = ?&#x27;</span>;</span><br><span class="line"><span class="variable">$pdo_pre</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$pdo_pre</span>-&gt;<span class="title function_ invoke__">bindvalue</span>(<span class="number">1</span>,<span class="variable">$content</span>);</span><br><span class="line"><span class="variable">$pdo_pre</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$pdo_pre</span>-&gt;<span class="title function_ invoke__">fetchAll</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查询(方式2)</span></span><br><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;neirong&#x27;</span>;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&#x27;select * from liuyan where content = :content&#x27;</span>;</span><br><span class="line"><span class="variable">$pdo_pre</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$pdo_pre</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="string">&#x27;:content&#x27;</span>=&gt;<span class="variable">$content</span>]);</span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$pdo_pre</span>-&gt;<span class="title function_ invoke__">fetchAll</span>(PDO::<span class="variable constant_">FETCH_ASSOC</span>);</span><br></pre></td></tr></table></figure>



<h3 id="主从复制-1"><a href="#主从复制-1" class="headerlink" title="主从复制"></a>主从复制</h3><h4 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h4><p>主要涉及三个线程：binlog 线程、I&#x2F;O 线程和 SQL 线程。</p>
<ul>
<li>binlog 线程 ：数据更改后，负责将主服务器上的数据更改写入二进制日志（Binary log）中。</li>
<li>I&#x2F;O 线程 ：负责通过端口从主服务器上读取二进制日志，并写入从服务器的中继日志（Relay log）。</li>
<li>SQL 线程 ：负责读取中继日志，解析出主服务器已经执行的数据更改并在从服务器中重放（Replay）。<img src="/blog/p/e4d2e8fb/zhucongfuzhi.png" class="" title="zhucongfuzhi.png"></li>
</ul>
<h3 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h3><p>主服务器处理写操作以及实时性要求比较高的读操作，而从服务器处理读操作。</p>
<p>读写分离能提高性能的原因在于：</p>
<ul>
<li>主从服务器负责各自的读和写，极大程度缓解了锁的争用；</li>
<li>从服务器可以使用 MyISAM，提升查询性能以及节约系统开销；</li>
<li>增加冗余，提高可用性。</li>
</ul>
<p>读写分离常用代理方式来实现(php框架几乎都有读写分离代理功能)，代理服务器接收应用层传来的读写请求，然后决定转发到哪个服务器。</p>
<img src="/blog/p/e4d2e8fb/duxiefenliproxy.png" class="" title="duxiefenliproxy.png">

<h4 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h4><h5 id="主服务器"><a href="#主服务器" class="headerlink" title="主服务器"></a>主服务器</h5><ol>
<li><p>修改主服务器mysql的配置文件，开启 binary log</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mysql/bin/my.ini</span><br><span class="line"><span class="attr">log-bin</span>=mysql-bin <span class="comment">#mysql-bin是日志文件名称</span></span><br><span class="line"><span class="attr">bin_log_format</span>=fixed <span class="comment">#混合模式，记录SQL语句 以及 被修改的数据详情</span></span><br><span class="line"><span class="attr">server_id</span>=唯一的id <span class="comment">#可以设置成ip的最后面位数</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启主服务器</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 会在mysql目录下的var目录生成日志文件 XXX.00001/XXX.00002</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看主服务器的状态信息</span></span><br><span class="line">show <span class="keyword">master</span> <span class="title">status</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置master的信息</span></span><br><span class="line">reset <span class="keyword">master</span> <span class="title"></span></span><br></pre></td></tr></table></figure>

</li>
<li><p>设置 允许从服务器监听</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;<span class="keyword">grant</span> <span class="keyword">replication</span> slave <span class="keyword">on</span> \*\.\*(所有库的所有表) <span class="keyword">to</span> slave@<span class="number">192.168</span><span class="number">.1</span>.IP identified <span class="keyword">by</span> <span class="string">&#x27;密码&#x27;</span></span><br><span class="line">允许slave用户 使用ip和密码访问 主服务器所有库的所有表信息</span><br><span class="line">&gt; <span class="keyword">GRANT</span> <span class="keyword">REPLICATION</span> SLAVE <span class="keyword">ON</span> *.* <span class="keyword">to</span> <span class="string">&#x27;slave3110&#x27;</span>@<span class="string">&#x27;192.168.3.110&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;abcABC123&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="从服务器"><a href="#从服务器" class="headerlink" title="从服务器"></a>从服务器</h5><ol>
<li><p>开启 binary log</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mysql/<span class="built_in">bin</span>/my.ini</span><br><span class="line"></span><br><span class="line"><span class="comment">#log-bin=mysql-bin #注释掉</span></span><br><span class="line"><span class="comment">#bin_log_format=fixed #注释掉</span></span><br><span class="line">relay_log=mysql-relay-<span class="built_in">bin</span> <span class="comment">#mysql-relay-bin是中继日志文件名称</span></span><br><span class="line">server_id=唯一的<span class="built_in">id</span> <span class="comment">#可以设置成ip的最后面位数</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启</p>
</li>
<li><p>确定是否与主服务器ip连通 <code>ping 主服务器ip</code></p>
</li>
<li><p>监听主服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;change master to</span><br><span class="line">master_host=&#x27;主服务器ip,</span><br><span class="line">master_port=3306,</span><br><span class="line">master_user=&#x27;slave&#x27;,</span><br><span class="line">master_password=&#x27;&#x27;,</span><br><span class="line">master_log_file=&#x27;中继文件名称&#x27; ,</span><br><span class="line">master_log_pos=主服务器show master status时显示的位置;</span><br><span class="line"></span><br><span class="line">&gt;start slave;  #开启监听</span><br><span class="line">&gt;show slave status;</span><br><span class="line">#查看 slave status的 `Slave_IO_Running: Yes` 以及 `Slave_SQL_Running: Yes` 判断是否连接成功即可</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Mysql-双主热备"><a href="#Mysql-双主热备" class="headerlink" title="Mysql 双主热备"></a>Mysql 双主热备</h3><p>概念：Master挂掉不会影响业务，实现心跳感应</p>
<img src="/blog/p/e4d2e8fb/Mysql%E5%BC%80%E5%90%AF%E5%8F%8C%E4%B8%BB%E7%83%AD%E5%A4%87.png" class="" title="Mysql开启双主热备">

<p>核心：将一台正在使用的Slave更改成主服务器</p>
<blockquote>
<p>服务器A 和 服务器B 互为主从</p>
</blockquote>
<img src="/blog/p/e4d2e8fb/Mysql%E5%BC%80%E5%90%AF%E5%8F%8C%E4%B8%BB%E7%83%AD%E5%A4%87_%E4%BA%92%E4%B8%BA%E4%B8%BB%E4%BB%8E.png" class="" title="Mysql开启双主热备_互为主从.png">

<p><font color="red"><b>注意事项：</b></font></p>
<ol>
<li>从服务器开启 binary 日志记录 <font color="red"><b>和 <code>log_slave_updates = 1</code></b></font></li>
<li>主服务器开启 relay 日志拷贝</li>
<li>从服务器赋予 主服务器权限 以及 从服务器&#x2F;用户名&#x2F;密码&#x2F;master_pos</li>
<li>主服务器 <code>change master to (主服务器/用户名/密码/master_pos)</code> 并 <code>start master</code> 开启监听</li>
<li>使用 <code>show master</code> 查看是否正常运行</li>
</ol>
<p>从服务器设置</p>
<ol>
<li><p>从服务器开启 <code>log_slave_updates = 1</code><br>vim &#x2F;etc&#x2F;mysql&#x2F;bin&#x2F;my.ini</p>
<p>log-bin&#x3D;mysql-bin #打开<br>bin_log_format&#x3D;fixed #打开<br>新增 <code>log_slave_updates = 1</code> #含义是将中继日志文件的内容拷贝到 日志文件(mysql-bin)当中<br>relay_log&#x3D;mysql-relay-bin #mysql-relay-bin是中继日志文件名称<br>server_id&#x3D;唯一的id #可以设置成ip的最后面位数</p>
</li>
<li><p>重启从服务器</p>
</li>
<li><p>确定是否与主服务器ip连通 <code>ping 主服务器ip</code></p>
</li>
<li><p>授权主服务器可以监听<br>mysql&gt;grant replication slave on *.*(所有库的所有表) to master@主服务器IP indentified by ‘密码’<br>允许master用户 使用ip和密码访问 从服务器所有库的所有表信息</p>
</li>
<li><p>在主服务器的my.ini开启 <code>relay_log = mysql-relay-bin</code> 和 <code>log_slave_updates = 1</code></p>
</li>
<li><p>主服务器 监听 从服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;change master to</span><br><span class="line">master_host=&#x27;从服务器ip,</span><br><span class="line">master_port=3306,</span><br><span class="line">master_user=&#x27;master&#x27;,</span><br><span class="line">master_password=&#x27;&#x27;,</span><br><span class="line">master_log_file=&#x27;中继文件名称&#x27; ,</span><br><span class="line">master_log_pos=从服务器show master status时显示的位置;</span><br><span class="line"></span><br><span class="line">&gt;start master;  #开启监听</span><br><span class="line">&gt;show master status;</span><br><span class="line">#查看 master status的 `Slave_IO_Running: Yes` 以及 `Slave_SQL_Running: Yes` 判断是否连接成功即可</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Mysql中间件-Mycat-代理"><a href="#Mysql中间件-Mycat-代理" class="headerlink" title="Mysql中间件 Mycat 代理"></a>Mysql中间件 Mycat 代理</h3><p>基本概念：彻底开源，面向企业应用开发的大数据库集群</p>
<hr>
<h3 id="并发检查"><a href="#并发检查" class="headerlink" title="并发检查"></a>并发检查</h3><p>优化索引<br>是否建立合理的索引<br>查看索引是否正常使用<br>优化SQL</p>
<h2 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h2><h3 id="生成大量测试数据"><a href="#生成大量测试数据" class="headerlink" title="生成大量测试数据"></a>生成大量测试数据</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">1000</span>);</span><br><span class="line"><span class="variable">$t</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line"><span class="variable">$pwd</span> = <span class="title function_ invoke__">getcwd</span>();</span><br><span class="line"><span class="variable">$myFile</span> = <span class="variable">$pwd</span> . <span class="string">&#x27;\\&#x27;</span> . <span class="string">&#x27;insert.sql&#x27;</span>;</span><br><span class="line"><span class="variable">$fhandler</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$myFile</span>, <span class="string">&#x27;wb&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$fhandler</span>) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$i</span> = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (<span class="variable">$i</span> &lt; <span class="number">1000</span>)<span class="comment">//1,0000,000</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$name</span> = <span class="string">&#x27;linfeng&#x27;</span> . <span class="variable">$i</span>;</span><br><span class="line">		<span class="variable">$age</span> = <span class="title function_ invoke__">rand</span>(<span class="number">1</span>, <span class="number">150</span>);</span><br><span class="line">		<span class="variable">$m</span> = <span class="title function_ invoke__">rand</span>(<span class="number">100000000</span>, <span class="number">999999999</span>);</span><br><span class="line">		<span class="variable">$phone</span> = <span class="string">&#x27;13&#x27;</span> . <span class="variable">$m</span>;</span><br><span class="line">		<span class="variable">$time</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line">		<span class="variable">$static</span> = <span class="title function_ invoke__">rand</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">		<span class="variable">$i</span>++;</span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;<span class="subst">$i</span>\t<span class="subst">$name</span>\t<span class="subst">$age</span>\t<span class="subst">$phone</span>\t<span class="subst">$time</span>\t<span class="subst">$static</span>&quot;</span>;</span><br><span class="line">		<span class="title function_ invoke__">fwrite</span>(<span class="variable">$fhandler</span>, <span class="variable">$sql</span> . <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;写入成功,耗时：&quot;</span>, <span class="title function_ invoke__">time</span>() - <span class="variable">$t</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">exists</span> `cache`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `cache`</span><br><span class="line">(</span><br><span class="line">    `id`    <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    `name`  <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `age`   <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `phone` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `<span class="type">time</span>`  <span class="type">TIMESTAMP</span>   <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `<span class="keyword">static</span>`  <span class="type">varchar</span>(<span class="number">50</span>)   <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">    #KEY `a` (`a`),</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use study;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">exists</span> `cache`;</span><br><span class="line"></span><br><span class="line">LOAD DATA <span class="keyword">local</span> INFILE <span class="string">&#x27;C:/Users/Administrator/Desktop/study_php/insert.sql&#x27;</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> `cache`(`id`,`name`,`age`,`phone`,`<span class="type">time</span>`,`<span class="keyword">static</span>`);</span><br></pre></td></tr></table></figure>


<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul>
<li><p>连接</p>
<blockquote>
<p>mysql -u -p -h -P 用户名 密码 主机 端口</p>
</blockquote>
</li>
<li><p>关闭 or 其他</p>
</li>
<li><p><code>\G</code> 打印结果格式化 垂直显示</p>
</li>
<li><p><code>\c</code> 取消当前mysql命令</p>
</li>
<li><p><code>\q</code> 退出mysql</p>
</li>
<li><p><code>\s</code> 显示服务器状态</p>
</li>
<li><p><code>\h</code> 显示帮助信息</p>
</li>
<li><p><code>\d</code> 改变 执行符号;</p>
</li>
</ul>
<p><strong>查看配置文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看所有端口(或3306)的进程信息</span></span><br><span class="line">lsof -i(:3306)</span><br><span class="line"></span><br><span class="line"><span class="comment">#列出指定进程所打开的文件</span></span><br><span class="line">lsof -c mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看my.ini的存储位置优先级排序</span></span><br><span class="line">mysql --<span class="built_in">help</span> | grep <span class="string">&#x27;my.cnf&#x27;</span></span><br></pre></td></tr></table></figure>


<h2 id="面试相关"><a href="#面试相关" class="headerlink" title="面试相关"></a>面试相关</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="数据类型-1"><a href="#数据类型-1" class="headerlink" title="数据类型"></a>数据类型</h4><h4 id="Server架构"><a href="#Server架构" class="headerlink" title="Server架构"></a>Server架构</h4><p>网络连接层<br>服务层<br>存储引擎层<br>系统文件层</p>
<p>数据查询<br>常用函数<br>模糊查询<br>多表连接查询</p>
<h3 id="真题-1"><a href="#真题-1" class="headerlink" title="真题"></a>真题</h3><p>A(id, sex, par, c1, c2)<br>B(id, age, c1, c1)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update A,B set A.c1 = B.c1,A.c2=B.c2</span><br><span class="line">where A.id = B.id and B.age&gt;50</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update A INNER JOIN B on A.id = B.id #on做关联</span><br><span class="line">set A.c1 = B.c1,A.c2=B.c2 #修改的数据</span><br><span class="line">where B.age&gt;50 #设置条件</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/Mysql/" rel="tag"># Mysql</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/p/f3599f9d/" rel="prev" title="Redis">
                  <i class="fa fa-chevron-left"></i> Redis
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/p/a28b9864/" rel="next" title="Linux">
                  Linux <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿尤</span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/schemes/muse.js"></script><script src="/blog/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/blog/js/third-party/search/local-search.js"></script>





  





</body>
</html>
